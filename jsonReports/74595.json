{"id":74595,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC83NDU5NQ==","url":"https://hackerone.com/reports/74595","title":"The product/status method CSRF","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2015-07-09T10:59:26.018Z","submitted_at":"2015-07-09T10:59:26.018Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"s_p_q_r","url":"/s_p_q_r","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/032/547/1d8b3feccf1a8281a2285cdbfc482aaf3b046b22_original.jpg/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":293,"url":"https://hackerone.com/digitalsellz","handle":"digitalsellz","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/293/1bb2ed357dd1bcaa52d338cb5dd93d1e1adf1b4d_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/293/1bb2ed357dd1bcaa52d338cb5dd93d1e1adf1b4d_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"paused","default_currency":"usd","awards_miles":false,"offers_bounties":false,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"DigitalSellz","twitter_handle":null,"website":"https://www.digitalsellz.com/","about":"Planning to sell your files? Need a platform to sell your new e-book? May be just music, photos, articles, digital art or movies? Try DigitalSellz.com"}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2015-08-25T21:31:01.906Z","bug_reporter_agreed_on_going_public_at":"2015-07-26T21:30:46.353Z","team_member_agreed_on_going_public_at":null,"comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"When we use the \"on/off\" buttons to set the products to be shown on the [products page](https://www.digitalsellz.com/user/#/products), a POST-request to https://www.digitalsellz.com/product/status is sent with only the product id as a parameter (no other security tokens).\r\n\r\nSo the idea is to make my rival visit a web page with a code like this:\r\n\r\n\u003e \u003cform action=\"https://www.digitalsellz.com/product/status\" method=\"POST\" onload=\"this.submit ()\"\u003e\r\n  \u003cinput type=\"hidden\" name=\"id\" value=\"%PRODUCT_ID%\" /\u003e\r\n\u003c/form\u003e\r\n\r\nwhere %PRODUCT_ID% is an ID of one of the products shown on his DigitalSellz page. This way me make him hide his product, so the customers will more likely buy mine.\r\n\r\nSo the purpose is to get a proper product id. Let's find out how it's formed. To do this let's upload a few projects at our page. After this when we check the https://www.digitalsellz.com/product/alllist/1 page we see that every product has both a key and an id, for example:\r\n\r\n\u003e {\"Id\":\"__WlojNDgxNSNZVg__\",\"name\":\"test\",\"currency\":\"USD\",\"price\":\"0.90\",\"prwlink\":null,\"prwtype\":\"No\",\"createddate\":\"2015-07-08 12:58:08\",\"key\":\"__NDgxNQ__\",\"onprofile\":\"Enable\"}\r\n\r\nThe key is a public identificator: it's contained in the product URL: https://www.digitalsellz.com/p/NDgxNQ, and the id is a private one: it's not shown there. So we need to figure out the connection between the key and the id.\r\n\r\nIf we take a look at them, we can notice they both look like Base64-encoded. Indeed, if we add \"==\" at the end and then do the Base64 decoding, __NDgxNQ__ and __WlojNDgxNSNZVg__ will turn into __4815__ and __ZZ#4815#YV__ correspondingly. Thus we see the product key is just its integer number and the id is the same number, just with some random symbols added!\r\n\r\nAnd what if we try to add some other symbols, for example AA, instead? Let's check it: __ZZ#4815#YV__ → __AA#4815#AA__ → __QUEjNDgxNSNBQQ__, and then we send a POST-request to https://www.digitalsellz.com/product/status with \"id=QUEjNDgxNSNBQQ\" parameters. In response we get {code:1}. Now if we open the [products page](https://www.digitalsellz.com/user/#/products) we can see the product status changed. So it works!\r\n\r\n__This way the scenario for the attacker can be as follows:__\r\n\r\n1. He goes to his rival's page\r\n2. He opens the product he's interested in and gets its key from the URL\r\n3. He decodes it, adds \"AA#\" and \"#AA\" at both sides and then encodes it back and thus gets the product id\r\n4. He creates a web page with such content:\r\n\r\n\u003e \u003e \u003cform action=\"https://www.digitalsellz.com/product/status\" method=\"POST\" onload=\"this.submit ()\"\u003e\r\n  \u003cinput type=\"hidden\" name=\"id\" value=\"%PRODUCT_ID%\" /\u003e\r\n\u003c/form\u003e\r\n\r\nwhere %PRODUCT_ID% is the product id he got, and sends a link to this page to the victim\r\n\r\nWhen the victim visits it, his product gets hidden from his page.\r\n\r\n__Proof of concept:__\r\n\r\n1. Go to your account and upload a product\r\n2. Go to your [products page](https://www.digitalsellz.com/user/#/products) and get its key from the url in the \"Buy now link\" cell. For example, __NDgxNQ__\r\n3. Add \"==\" at the end and Base64-decode it: __4815__\r\n4. Surround it by \"AA\" symbols: __AA#4815#AA__\r\n5. Encode it into Base64 and remove the \"==\" symbols from the end: __QUEjNDgxNSNBQQ__\r\n6. Send a POST-request to https://www.digitalsellz.com/product/status with the \"id=QUEjNDgxNSNBQQ\" body\r\n7. Update your [products page](https://www.digitalsellz.com/user/#/products) — you will see the product status has been successfully changed\r\n\r\n__Ways to fix:__\r\n\r\n1. Check the id entirely, not only the number\r\n2. Add another anti-CSRF token","vulnerability_information_html":"\u003cp\u003eWhen we use the \u0026quot;on/off\u0026quot; buttons to set the products to be shown on the \u003ca href=\"/redirect?url=https%3A%2F%2Fwww.digitalsellz.com%2Fuser%2F%23%2Fproducts\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003eproducts page\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e, a POST-request to \u003ca title=\"https://www.digitalsellz.com/product/status\" href=\"/redirect?url=https%3A%2F%2Fwww.digitalsellz.com%2Fproduct%2Fstatus\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://www.digitalsellz.com/product/status\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e is sent with only the product id as a parameter (no other security tokens).\u003c/p\u003e\n\n\u003cp\u003eSo the idea is to make my rival visit a web page with a code like this:\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e\u0026lt;form action=\u0026quot;https://www.digitalsellz.com/product/status\u0026quot; method=\u0026quot;POST\u0026quot; onload=\u0026quot;this.submit ()\u0026quot;\u0026gt;\u003cbr\u003e\n  \u0026lt;input type=\u0026quot;hidden\u0026quot; name=\u0026quot;id\u0026quot; value=\u0026quot;%PRODUCT_ID%\u0026quot; /\u0026gt;\u003cbr\u003e\n\u0026lt;/form\u0026gt;\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003ewhere %PRODUCT_ID% is an ID of one of the products shown on his DigitalSellz page. This way me make him hide his product, so the customers will more likely buy mine.\u003c/p\u003e\n\n\u003cp\u003eSo the purpose is to get a proper product id. Let\u0026#39;s find out how it\u0026#39;s formed. To do this let\u0026#39;s upload a few projects at our page. After this when we check the \u003ca title=\"https://www.digitalsellz.com/product/alllist/1\" href=\"/redirect?url=https%3A%2F%2Fwww.digitalsellz.com%2Fproduct%2Falllist%2F1\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://www.digitalsellz.com/product/alllist/1\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e page we see that every product has both a key and an id, for example:\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e{\u0026quot;Id\u0026quot;:\u0026quot;\u003cstrong\u003eWlojNDgxNSNZVg\u003c/strong\u003e\u0026quot;,\u0026quot;name\u0026quot;:\u0026quot;test\u0026quot;,\u0026quot;currency\u0026quot;:\u0026quot;USD\u0026quot;,\u0026quot;price\u0026quot;:\u0026quot;0.90\u0026quot;,\u0026quot;prwlink\u0026quot;:null,\u0026quot;prwtype\u0026quot;:\u0026quot;No\u0026quot;,\u0026quot;createddate\u0026quot;:\u0026quot;2015-07-08 12:58:08\u0026quot;,\u0026quot;key\u0026quot;:\u0026quot;\u003cstrong\u003eNDgxNQ\u003c/strong\u003e\u0026quot;,\u0026quot;onprofile\u0026quot;:\u0026quot;Enable\u0026quot;}\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eThe key is a public identificator: it\u0026#39;s contained in the product URL: \u003ca title=\"https://www.digitalsellz.com/p/NDgxNQ\" href=\"/redirect?url=https%3A%2F%2Fwww.digitalsellz.com%2Fp%2FNDgxNQ\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://www.digitalsellz.com/p/NDgxNQ\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e, and the id is a private one: it\u0026#39;s not shown there. So we need to figure out the connection between the key and the id.\u003c/p\u003e\n\n\u003cp\u003eIf we take a look at them, we can notice they both look like Base64-encoded. Indeed, if we add \u0026quot;==\u0026quot; at the end and then do the Base64 decoding, \u003cstrong\u003eNDgxNQ\u003c/strong\u003e and \u003cstrong\u003eWlojNDgxNSNZVg\u003c/strong\u003e will turn into \u003cstrong\u003e4815\u003c/strong\u003e and \u003cstrong\u003eZZ#4815#YV\u003c/strong\u003e correspondingly. Thus we see the product key is just its integer number and the id is the same number, just with some random symbols added!\u003c/p\u003e\n\n\u003cp\u003eAnd what if we try to add some other symbols, for example AA, instead? Let\u0026#39;s check it: \u003cstrong\u003eZZ#4815#YV\u003c/strong\u003e → \u003cstrong\u003eAA#4815#AA\u003c/strong\u003e → \u003cstrong\u003eQUEjNDgxNSNBQQ\u003c/strong\u003e, and then we send a POST-request to \u003ca title=\"https://www.digitalsellz.com/product/status\" href=\"/redirect?url=https%3A%2F%2Fwww.digitalsellz.com%2Fproduct%2Fstatus\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://www.digitalsellz.com/product/status\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e with \u0026quot;id=QUEjNDgxNSNBQQ\u0026quot; parameters. In response we get {code:1}. Now if we open the \u003ca href=\"/redirect?url=https%3A%2F%2Fwww.digitalsellz.com%2Fuser%2F%23%2Fproducts\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003eproducts page\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e we can see the product status changed. So it works!\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eThis way the scenario for the attacker can be as follows:\u003c/strong\u003e\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eHe goes to his rival\u0026#39;s page\u003c/li\u003e\n\u003cli\u003eHe opens the product he\u0026#39;s interested in and gets its key from the URL\u003c/li\u003e\n\u003cli\u003eHe decodes it, adds \u0026quot;AA#\u0026quot; and \u0026quot;#AA\u0026quot; at both sides and then encodes it back and thus gets the product id\u003c/li\u003e\n\u003cli\u003eHe creates a web page with such content:\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cblockquote\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u0026lt;form action=\u0026quot;https://www.digitalsellz.com/product/status\u0026quot; method=\u0026quot;POST\u0026quot; onload=\u0026quot;this.submit ()\u0026quot;\u0026gt;\u003cbr\u003e\n  \u0026lt;input type=\u0026quot;hidden\u0026quot; name=\u0026quot;id\u0026quot; value=\u0026quot;%PRODUCT_ID%\u0026quot; /\u0026gt;\u003cbr\u003e\n\u0026lt;/form\u0026gt;\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003ewhere %PRODUCT_ID% is the product id he got, and sends a link to this page to the victim\u003c/p\u003e\n\n\u003cp\u003eWhen the victim visits it, his product gets hidden from his page.\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eProof of concept:\u003c/strong\u003e\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eGo to your account and upload a product\u003c/li\u003e\n\u003cli\u003eGo to your \u003ca href=\"/redirect?url=https%3A%2F%2Fwww.digitalsellz.com%2Fuser%2F%23%2Fproducts\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003eproducts page\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e and get its key from the url in the \u0026quot;Buy now link\u0026quot; cell. For example, \u003cstrong\u003eNDgxNQ\u003c/strong\u003e\n\u003c/li\u003e\n\u003cli\u003eAdd \u0026quot;==\u0026quot; at the end and Base64-decode it: \u003cstrong\u003e4815\u003c/strong\u003e\n\u003c/li\u003e\n\u003cli\u003eSurround it by \u0026quot;AA\u0026quot; symbols: \u003cstrong\u003eAA#4815#AA\u003c/strong\u003e\n\u003c/li\u003e\n\u003cli\u003eEncode it into Base64 and remove the \u0026quot;==\u0026quot; symbols from the end: \u003cstrong\u003eQUEjNDgxNSNBQQ\u003c/strong\u003e\n\u003c/li\u003e\n\u003cli\u003eSend a POST-request to \u003ca title=\"https://www.digitalsellz.com/product/status\" href=\"/redirect?url=https%3A%2F%2Fwww.digitalsellz.com%2Fproduct%2Fstatus\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://www.digitalsellz.com/product/status\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e with the \u0026quot;id=QUEjNDgxNSNBQQ\u0026quot; body\u003c/li\u003e\n\u003cli\u003eUpdate your \u003ca href=\"/redirect?url=https%3A%2F%2Fwww.digitalsellz.com%2Fuser%2F%23%2Fproducts\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003eproducts page\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e — you will see the product status has been successfully changed\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003e\u003cstrong\u003eWays to fix:\u003c/strong\u003e\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eCheck the id entirely, not only the number\u003c/li\u003e\n\u003cli\u003eAdd another anti-CSRF token\u003c/li\u003e\n\u003c/ol\u003e\n","weakness":{"id":45,"name":"Cross-Site Request Forgery (CSRF)"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2015-08-25T21:30:47.067Z","allow_singular_disclosure_after":-168686089.85940292,"singular_disclosure_allowed":true,"vote_count":2,"voters":["sw33tlie","spetr0x"],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":504372,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Nice Find! I will share this report with our team. Talk soon.","markdown_message":"\u003cp\u003eNice Find! I will share this report with our team. Talk soon.\u003c/p\u003e\n","automated_response":false,"created_at":"2015-07-09T22:37:21.529Z","updated_at":"2015-07-09T22:37:21.529Z","actor":{"username":"panchocosil","cleared":true,"url":"/panchocosil","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/460/fcd3435c16cd3ee97e1862bdaf92c7409c7e4267_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"digitalsellz","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":510856,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Can you please confirm this bug it has been fixed?","markdown_message":"\u003cp\u003eCan you please confirm this bug it has been fixed?\u003c/p\u003e\n","automated_response":false,"created_at":"2015-07-15T22:29:23.352Z","updated_at":"2015-07-15T22:29:23.352Z","actor":{"username":"panchocosil","cleared":true,"url":"/panchocosil","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/460/fcd3435c16cd3ee97e1862bdaf92c7409c7e4267_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"digitalsellz","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":511824,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Yep, the CSRF-token has been added. The id is properly checked now as well.","markdown_message":"\u003cp\u003eYep, the CSRF-token has been added. The id is properly checked now as well.\u003c/p\u003e\n","automated_response":false,"created_at":"2015-07-16T11:12:59.327Z","updated_at":"2015-07-16T11:12:59.327Z","actor":{"username":"s_p_q_r","cleared":false,"url":"/s_p_q_r","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/032/547/1d8b3feccf1a8281a2285cdbfc482aaf3b046b22_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"digitalsellz","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":516781,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Thanks for your help! and Welcome to our Wall of fame","markdown_message":"\u003cp\u003eThanks for your help! and Welcome to our Wall of fame\u003c/p\u003e\n","automated_response":false,"created_at":"2015-07-20T06:14:42.367Z","updated_at":"2015-07-20T06:14:42.367Z","actor":{"username":"panchocosil","cleared":true,"url":"/panchocosil","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/460/fcd3435c16cd3ee97e1862bdaf92c7409c7e4267_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"s_p_q_r","url":"/s_p_q_r"},"genius_execution_id":null,"team_handle":"digitalsellz","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":526319,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2015-07-26T21:30:46.807Z","updated_at":"2015-07-26T21:30:46.807Z","first_to_agree":true,"actor":{"username":"s_p_q_r","cleared":false,"url":"/s_p_q_r","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/032/547/1d8b3feccf1a8281a2285cdbfc482aaf3b046b22_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"digitalsellz","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":563070,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2015-08-25T21:31:02.049Z","updated_at":"2015-08-25T21:31:02.049Z","actor":{"url":"/digitalsellz","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/293/1bb2ed357dd1bcaa52d338cb5dd93d1e1adf1b4d_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"DigitalSellz"}},"genius_execution_id":null,"team_handle":"digitalsellz","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}