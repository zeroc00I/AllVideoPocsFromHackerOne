{"id":416983,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC80MTY5ODM=","url":"https://hackerone.com/reports/416983","title":"H1514 Removed Staff members who had \"Apps\" permission can still modify flow app connections","state":"Closed","substate":"resolved","severity_rating":"low","readable_substate":"Resolved","created_at":"2018-10-01T17:57:50.647Z","submitted_at":"2018-10-01T17:57:50.647Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"zombiehelp54","url":"/zombiehelp54","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/036/135/f45785bb8d3f76465ddf981069b5b7f94ad1d93c_original.jpg/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":1382,"url":"https://hackerone.com/shopify","handle":"shopify","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/fjjiC5585s8WoDGHv2M5okbJ/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/fjjiC5585s8WoDGHv2M5okbJ/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Shopify","twitter_handle":"","website":"https://www.shopify.com","about":"Shopify is a multi-channel commerce platform that helps people sell online, in-store, and everywhere in between."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2019-06-14T18:05:30.030Z","bug_reporter_agreed_on_going_public_at":"2019-06-14T18:05:29.935Z","team_member_agreed_on_going_public_at":"2019-05-22T18:06:42.784Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"**Summary:** \nIt's been found that removed staff members who had \"Apps\" permission can still modify flow app connection settings due to improper authorization.\n\n**Description:**\nFlow app (https://apps.shopify.com/flow) allows users to connect their Google Sheets, Trello and Asana accounts to their flow accounts to be used later in workflows (e.g storing new customer information to google spreadsheet).\n\nIt's been found that when a user tries to connect his google account, he is redirected to `https://flow-connectors.shopifycloud.com/gsheet/connect?shop_domain=[shop].myshopify.com\u0026shop_id=[shop-id]\u0026path_hmac=[path_hmac]`, the parameter `path_hmac` is the only way the application determines whether the user can modify the connection settings for that shop or not and it's the same for all staff members and doesn't depend on any session as it's hmac of the path `/gsheet/connect?shop_domain=[shop].myshopify.com\u0026shop_id=[shop-id]`  \n\nWith that said, it's possible for a staff member who had \"Apps\" permission then was removed to modify the connection settings for Google SpreadSheets, Trello and Asana by just saving the `path_hmac`.\n\n## Steps To Reproduce:\n\n1. Login to your shop as the shop owner and add a staff member with only \"Apps\" permission.\n2. Install flow app: https://apps.shopify.com/flow\n3. Login with the new user you added and navigate to `https://[Your-Shop].myshopify.com/admin/apps/flow/connectors`\n4. Click All **Settings** links next to Google Sheets, Trello and Asana and save them\n5. Login with the shop owner and remove the user you added\n6. You can now use the links you saved to modify connectors settings.\n\n**Live PoC:**\nYou can modify my shop's google spread sheet connection by navigating to `https://flow-connectors.shopifycloud.com/gsheet/connect?shop_id=24615823\u0026path_hmac=%2BPnVhhFIC49KrHZGqwC08LoSMSkieG7UHWgtnriV2vQ%3D`\n\n## Impact\n\nThrough this vulnerability a removed staff member will be able to modify google spread sheet, trello and asana connections to connect his own accounts so that workflow actions regarding the connections go to his accounts and therefore he can still access the shop data.","vulnerability_information_html":"\u003cp\u003e\u003cstrong\u003eSummary:\u003c/strong\u003e \u003cbr\u003e\nIt\u0026#39;s been found that removed staff members who had \u0026quot;Apps\u0026quot; permission can still modify flow app connection settings due to improper authorization.\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eDescription:\u003c/strong\u003e\u003cbr\u003e\nFlow app (\u003ca title=\"https://apps.shopify.com/flow\" href=\"/redirect?url=https%3A%2F%2Fapps.shopify.com%2Fflow\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://apps.shopify.com/flow\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e) allows users to connect their Google Sheets, Trello and Asana accounts to their flow accounts to be used later in workflows (e.g storing new customer information to google spreadsheet).\u003c/p\u003e\n\n\u003cp\u003eIt\u0026#39;s been found that when a user tries to connect his google account, he is redirected to \u003ccode\u003ehttps://flow-connectors.shopifycloud.com/gsheet/connect?shop_domain=[shop].myshopify.com\u0026amp;shop_id=[shop-id]\u0026amp;path_hmac=[path_hmac]\u003c/code\u003e, the parameter \u003ccode\u003epath_hmac\u003c/code\u003e is the only way the application determines whether the user can modify the connection settings for that shop or not and it\u0026#39;s the same for all staff members and doesn\u0026#39;t depend on any session as it\u0026#39;s hmac of the path \u003ccode\u003e/gsheet/connect?shop_domain=[shop].myshopify.com\u0026amp;shop_id=[shop-id]\u003c/code\u003e  \u003c/p\u003e\n\n\u003cp\u003eWith that said, it\u0026#39;s possible for a staff member who had \u0026quot;Apps\u0026quot; permission then was removed to modify the connection settings for Google SpreadSheets, Trello and Asana by just saving the \u003ccode\u003epath_hmac\u003c/code\u003e.\u003c/p\u003e\n\n\u003ch2 id=\"steps-to-reproduce\"\u003eSteps To Reproduce:\u003c/h2\u003e\n\n\u003col\u003e\n\u003cli\u003eLogin to your shop as the shop owner and add a staff member with only \u0026quot;Apps\u0026quot; permission.\u003c/li\u003e\n\u003cli\u003eInstall flow app: \u003ca title=\"https://apps.shopify.com/flow\" href=\"/redirect?url=https%3A%2F%2Fapps.shopify.com%2Fflow\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://apps.shopify.com/flow\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003eLogin with the new user you added and navigate to \u003ccode\u003ehttps://[Your-Shop].myshopify.com/admin/apps/flow/connectors\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003eClick All \u003cstrong\u003eSettings\u003c/strong\u003e links next to Google Sheets, Trello and Asana and save them\u003c/li\u003e\n\u003cli\u003eLogin with the shop owner and remove the user you added\u003c/li\u003e\n\u003cli\u003eYou can now use the links you saved to modify connectors settings.\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003e\u003cstrong\u003eLive PoC:\u003c/strong\u003e\u003cbr\u003e\nYou can modify my shop\u0026#39;s google spread sheet connection by navigating to \u003ccode\u003ehttps://flow-connectors.shopifycloud.com/gsheet/connect?shop_id=24615823\u0026amp;path_hmac=%2BPnVhhFIC49KrHZGqwC08LoSMSkieG7UHWgtnriV2vQ%3D\u003c/code\u003e\u003c/p\u003e\n\n\u003ch2 id=\"impact\"\u003eImpact\u003c/h2\u003e\n\n\u003cp\u003eThrough this vulnerability a removed staff member will be able to modify google spread sheet, trello and asana connections to connect his own accounts so that workflow actions regarding the connections go to his accounts and therefore he can still access the shop data.\u003c/p\u003e\n","bounty_amount":"2000.0","formatted_bounty":"$2,000","weakness":{"id":124,"name":"Improper Authorization"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":null,"vote_count":36,"voters":["sultancad","w1j3r","mygf","tungpun","powerjacobb1","malcolmx","exception","codeanddecode","leiz95","tems","and 26 more..."],"severity":{"rating":"low","score":3.6,"author_type":"Team","metrics":{"attack_vector":"network","attack_complexity":"low","privileges_required":"low","user_interaction":"none","scope":"unchanged","confidentiality":"low","integrity":"none","availability":"none"}},"structured_scope":{"databaseId":37198,"asset_type":"OTHER","asset_identifier":"Shopify Developed Apps","max_severity":"medium"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":3475503,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","markdown_message":"","automated_response":false,"created_at":"2018-10-13T14:54:14.183Z","updated_at":"2018-10-13T14:54:14.183Z","actor":{"url":"/shopify","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/fjjiC5585s8WoDGHv2M5okbJ/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Shopify"}},"bounty_amount":"2000.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"shopify","collaborator":{"username":"zombiehelp54","url":"/zombiehelp54"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3475547,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","markdown_message":"","automated_response":false,"created_at":"2018-10-13T15:07:50.091Z","updated_at":"2018-10-13T15:07:50.091Z","actor":{"username":"francoischagnon","cleared":false,"url":"/francoischagnon","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/019/168/5d577fe97283a5483331257b629b6287ed4d287b_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3588946,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Thanks again for your report. We have resolved this issue by adding a timestamp to the signed flow-connectors.shopifycloud.com URL, so that it remains valid only during a period of one hour.","markdown_message":"\u003cp\u003eThanks again for your report. We have resolved this issue by adding a timestamp to the signed flow-connectors.shopifycloud.com URL, so that it remains valid only during a period of one hour.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-11-05T18:27:33.040Z","updated_at":"2018-11-05T18:27:33.040Z","actor":{"username":"clayton","cleared":false,"url":"/clayton","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/YKjJrQvn996bd2n67ELXwtHt/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"zombiehelp54","url":"/zombiehelp54"},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3716191,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","markdown_message":"","automated_response":false,"created_at":"2018-11-27T15:01:21.823Z","updated_at":"2018-11-27T15:01:21.823Z","additional_data":{"old_severity":null,"new_severity":"Medium (4.3)","old_severity_id":null,"new_severity_id":250370},"actor":{"username":"shopify-peteryaworski","cleared":false,"url":"/shopify-peteryaworski","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/175/526/7ba4844078e290c91c4c46a345b4f9e7666f3ed4_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":4903957,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2019-05-22T18:06:42.818Z","updated_at":"2019-05-22T18:06:42.818Z","first_to_agree":true,"actor":{"username":"shopify-peteryaworski","cleared":false,"url":"/shopify-peteryaworski","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/175/526/7ba4844078e290c91c4c46a345b4f9e7666f3ed4_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":5096998,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2019-06-14T18:05:29.973Z","updated_at":"2019-06-14T18:05:29.973Z","actor":{"username":"zombiehelp54","cleared":true,"url":"/zombiehelp54","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/036/135/f45785bb8d3f76465ddf981069b5b7f94ad1d93c_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5096999,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2019-06-14T18:05:30.049Z","updated_at":"2019-06-14T18:05:30.049Z","actor":{"username":"zombiehelp54","cleared":true,"url":"/zombiehelp54","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/036/135/f45785bb8d3f76465ddf981069b5b7f94ad1d93c_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":7147507,"is_internal":false,"editable":false,"type":"Activities::ChangedScope","message":"","markdown_message":"","automated_response":false,"created_at":"2020-02-25T14:58:45.536Z","updated_at":"2020-02-25T14:58:45.536Z","actor":{"username":"shopify-peteryaworski","cleared":false,"url":"/shopify-peteryaworski","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/175/526/7ba4844078e290c91c4c46a345b4f9e7666f3ed4_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"old_scope":"None","new_scope":"Shopify Developed Apps","genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"id":11053,"category":"team","content":"@zombiehelp54 noticed that signed URLs generated by Shopify Flow (https://apps.shopify.com/flow) do not expire. This could allow a former staff member (or current staff member who no longer has Apps permission) to connect or disconnect Google Sheets, Trello and Asana accounts from Flow. This could allow unauthorized access to store data.","can_view?":true,"can_edit?":false,"content_html":"\u003cp\u003e\u003ca href=\"/zombiehelp54\"\u003e@zombiehelp54\u003c/a\u003e noticed that signed URLs generated by Shopify Flow (\u003ca title=\"https://apps.shopify.com/flow\" href=\"/redirect?url=https%3A%2F%2Fapps.shopify.com%2Fflow\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://apps.shopify.com/flow\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e) do not expire. This could allow a former staff member (or current staff member who no longer has Apps permission) to connect or disconnect Google Sheets, Trello and Asana accounts from Flow. This could allow unauthorized access to store data.\u003c/p\u003e\n"},{"category":"researcher","can_view?":true,"can_create?":false}]}