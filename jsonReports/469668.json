{"id":469668,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC80Njk2Njg=","url":"https://hackerone.com/reports/469668","title":"Passwords being stored as plain text in logging","state":"Closed","substate":"resolved","severity_rating":"low","readable_substate":"Resolved","created_at":"2018-12-18T16:44:58.604Z","submitted_at":"2018-12-18T16:44:58.604Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"xatom","url":"/xatom","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":13291,"url":"https://hackerone.com/nextcloud","handle":"nextcloud","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Nextcloud","twitter_handle":"nextclouders","website":"https://nextcloud.com","about":"Access, share and protect your files, calendars, contacts, communication \u0026 more at home and in your enterprise."}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2019-08-31T12:45:35.999Z","bug_reporter_agreed_on_going_public_at":null,"team_member_agreed_on_going_public_at":"2019-08-01T12:45:31.723Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"When an exception occurs, any password sent to or being processed by the server may be stored as plain text in the log.\n\nI noticed that some methods are already being filtered in `ExceptionSerializer.php`, but many methods are missing from this list.\n\nSuggestion: instead of relying on a list of sensitive methods, filter every method with a `$password` parameter.\n\n----\n\nSteps to reproduce (example):\n\n1. Install NextCloud without SMTP server\n1. Create a new user at `https://nextcloud/settings/users`\n1. Check the logging at `https://nextcloud/settings/admin/logging`\n\nResults in 2 exceptions:\n\n```\n[ocs_api] Error: OCP\\AppFramework\\OCS\\OCSException: Unable to send the invitation mail at \u003c\u003cclosure\u003e\u003e\n\n0. /var/www/html/lib/private/AppFramework/Http/Dispatcher.php line 166\n                                      vvvvvvvv\n   addUser(\"[redacted]\", \"[redacted - PASSWORD]\", \"[redacted]\", \"[redacted]\", [], [], \"10 GB\", \"en\")\n                                      ^^^^^^^^\n1. /var/www/html/lib/private/AppFramework/Http/Dispatcher.php line 99\n   executeController(OCA\\Provisioning ... {}, \"addUser\")\n2. /var/www/html/lib/private/AppFramework/App.php line 118\n   dispatch(OCA\\Provisioning ... {}, \"addUser\")\n3. /var/www/html/lib/private/AppFramework/Routing/RouteActionHandler.php line 47\n   main(\"OCA\\\\Provisioni ... r\", \"addUser\", OC\\AppFramework\\ ... {}, {_route: \"ocs.pr ... \"})\n4. \u003c\u003cclosure\u003e\u003e\n   __invoke({_route: \"ocs.pr ... \"})\n5. /var/www/html/lib/private/Route/Router.php line 297\n   call_user_func(OC\\AppFramework\\ ... {}, {_route: \"ocs.pr ... \"})\n6. /var/www/html/ocs/v1.php line 82\n   match(\"/ocsapp/cloud/users\")\n7. /var/www/html/ocs/v2.php line 24\n   require_once(\"/var/www/html/ocs/v1.php\")\n\nPOST /ocs/v2.php/cloud/users\nfrom 172.18.0.4 by [redacted] at 2018-12-17T19:38:41+00:00\n```\n\n```\n[ocs_api] Error: Swift_TransportException: Connection could not be established with host 127.0.0.1 [Connection refused #111] at \u003c\u003cclosure\u003e\u003e\n\n 0. /var/www/html/3rdparty/swiftmailer/swiftmailer/lib/classes/Swift/Transport/StreamBuffer.php line 58\n    establishSocketConnection()\n 1. /var/www/html/3rdparty/swiftmailer/swiftmailer/lib/classes/Swift/Transport/AbstractSmtpTransport.php line 143\n    initialize({protocol: \"\",ho ... ]})\n 2. /var/www/html/3rdparty/swiftmailer/swiftmailer/lib/classes/Swift/Mailer.php line 65\n    start()\n 3. /var/www/html/lib/private/Mail/Mailer.php line 180\n    send(Swift_Message {}, [])\n 4. /var/www/html/settings/Mailer/NewUserMailHelper.php line 169\n    send(OC\\Mail\\Message {})\n 5. /var/www/html/apps/provisioning_api/lib/Controller/UsersController.php line 307\n    sendMail(OC\\User\\User {}, OC\\Mail\\EMailTemplate {})\n 6. /var/www/html/lib/private/AppFramework/Http/Dispatcher.php line 166\n                                       vvvvvvvv\n    addUser(\"[redacted]\", \"[redacted - PASSWORD]\", \"[redacted]\", \"[redacted]\", [], [], \"10 GB\", \"en\")\n                                       ^^^^^^^^\n 7. /var/www/html/lib/private/AppFramework/Http/Dispatcher.php line 99\n    executeController(OCA\\Provisioning ... {}, \"addUser\")\n 8. /var/www/html/lib/private/AppFramework/App.php line 118\n    dispatch(OCA\\Provisioning ... {}, \"addUser\")\n 9. /var/www/html/lib/private/AppFramework/Routing/RouteActionHandler.php line 47\n    main(\"OCA\\\\Provisioni ... r\", \"addUser\", OC\\AppFramework\\ ... {}, {_route: \"ocs.pr ... \"})\n10. \u003c\u003cclosure\u003e\u003e\n    __invoke({_route: \"ocs.pr ... \"})\n11. /var/www/html/lib/private/Route/Router.php line 297\n    call_user_func(OC\\AppFramework\\ ... {}, {_route: \"ocs.pr ... \"})\n12. /var/www/html/ocs/v1.php line 82\n    match(\"/ocsapp/cloud/users\")\n13. /var/www/html/ocs/v2.php line 24\n    require_once(\"/var/www/html/ocs/v1.php\")\n\nPOST /ocs/v2.php/cloud/users\nfrom 172.18.0.4 by [redacted] at 2018-12-17T19:38:41+00:00\n```\n\n## Impact\n\nGet various user names, e-mail addresses and passwords from log files.","vulnerability_information_html":"\u003cp\u003eWhen an exception occurs, any password sent to or being processed by the server may be stored as plain text in the log.\u003c/p\u003e\n\n\u003cp\u003eI noticed that some methods are already being filtered in \u003ccode\u003eExceptionSerializer.php\u003c/code\u003e, but many methods are missing from this list.\u003c/p\u003e\n\n\u003cp\u003eSuggestion: instead of relying on a list of sensitive methods, filter every method with a \u003ccode\u003e$password\u003c/code\u003e parameter.\u003c/p\u003e\n\n\u003chr\u003e\n\n\u003cp\u003eSteps to reproduce (example):\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eInstall NextCloud without SMTP server\u003c/li\u003e\n\u003cli\u003eCreate a new user at \u003ccode\u003ehttps://nextcloud/settings/users\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003eCheck the logging at \u003ccode\u003ehttps://nextcloud/settings/admin/logging\u003c/code\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eResults in 2 exceptions:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e[ocs_api] Error: OCP\\AppFramework\\OCS\\OCSException: Unable to send the invitation mail at \u0026lt;\u0026lt;closure\u0026gt;\u0026gt;\n\n0. /var/www/html/lib/private/AppFramework/Http/Dispatcher.php line 166\n                                      vvvvvvvv\n   addUser(\u0026quot;[redacted]\u0026quot;, \u0026quot;[redacted - PASSWORD]\u0026quot;, \u0026quot;[redacted]\u0026quot;, \u0026quot;[redacted]\u0026quot;, [], [], \u0026quot;10 GB\u0026quot;, \u0026quot;en\u0026quot;)\n                                      ^^^^^^^^\n1. /var/www/html/lib/private/AppFramework/Http/Dispatcher.php line 99\n   executeController(OCA\\Provisioning ... {}, \u0026quot;addUser\u0026quot;)\n2. /var/www/html/lib/private/AppFramework/App.php line 118\n   dispatch(OCA\\Provisioning ... {}, \u0026quot;addUser\u0026quot;)\n3. /var/www/html/lib/private/AppFramework/Routing/RouteActionHandler.php line 47\n   main(\u0026quot;OCA\\\\Provisioni ... r\u0026quot;, \u0026quot;addUser\u0026quot;, OC\\AppFramework\\ ... {}, {_route: \u0026quot;ocs.pr ... \u0026quot;})\n4. \u0026lt;\u0026lt;closure\u0026gt;\u0026gt;\n   __invoke({_route: \u0026quot;ocs.pr ... \u0026quot;})\n5. /var/www/html/lib/private/Route/Router.php line 297\n   call_user_func(OC\\AppFramework\\ ... {}, {_route: \u0026quot;ocs.pr ... \u0026quot;})\n6. /var/www/html/ocs/v1.php line 82\n   match(\u0026quot;/ocsapp/cloud/users\u0026quot;)\n7. /var/www/html/ocs/v2.php line 24\n   require_once(\u0026quot;/var/www/html/ocs/v1.php\u0026quot;)\n\nPOST /ocs/v2.php/cloud/users\nfrom 172.18.0.4 by [redacted] at 2018-12-17T19:38:41+00:00\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e[ocs_api] Error: Swift_TransportException: Connection could not be established with host 127.0.0.1 [Connection refused #111] at \u0026lt;\u0026lt;closure\u0026gt;\u0026gt;\n\n 0. /var/www/html/3rdparty/swiftmailer/swiftmailer/lib/classes/Swift/Transport/StreamBuffer.php line 58\n    establishSocketConnection()\n 1. /var/www/html/3rdparty/swiftmailer/swiftmailer/lib/classes/Swift/Transport/AbstractSmtpTransport.php line 143\n    initialize({protocol: \u0026quot;\u0026quot;,ho ... ]})\n 2. /var/www/html/3rdparty/swiftmailer/swiftmailer/lib/classes/Swift/Mailer.php line 65\n    start()\n 3. /var/www/html/lib/private/Mail/Mailer.php line 180\n    send(Swift_Message {}, [])\n 4. /var/www/html/settings/Mailer/NewUserMailHelper.php line 169\n    send(OC\\Mail\\Message {})\n 5. /var/www/html/apps/provisioning_api/lib/Controller/UsersController.php line 307\n    sendMail(OC\\User\\User {}, OC\\Mail\\EMailTemplate {})\n 6. /var/www/html/lib/private/AppFramework/Http/Dispatcher.php line 166\n                                       vvvvvvvv\n    addUser(\u0026quot;[redacted]\u0026quot;, \u0026quot;[redacted - PASSWORD]\u0026quot;, \u0026quot;[redacted]\u0026quot;, \u0026quot;[redacted]\u0026quot;, [], [], \u0026quot;10 GB\u0026quot;, \u0026quot;en\u0026quot;)\n                                       ^^^^^^^^\n 7. /var/www/html/lib/private/AppFramework/Http/Dispatcher.php line 99\n    executeController(OCA\\Provisioning ... {}, \u0026quot;addUser\u0026quot;)\n 8. /var/www/html/lib/private/AppFramework/App.php line 118\n    dispatch(OCA\\Provisioning ... {}, \u0026quot;addUser\u0026quot;)\n 9. /var/www/html/lib/private/AppFramework/Routing/RouteActionHandler.php line 47\n    main(\u0026quot;OCA\\\\Provisioni ... r\u0026quot;, \u0026quot;addUser\u0026quot;, OC\\AppFramework\\ ... {}, {_route: \u0026quot;ocs.pr ... \u0026quot;})\n10. \u0026lt;\u0026lt;closure\u0026gt;\u0026gt;\n    __invoke({_route: \u0026quot;ocs.pr ... \u0026quot;})\n11. /var/www/html/lib/private/Route/Router.php line 297\n    call_user_func(OC\\AppFramework\\ ... {}, {_route: \u0026quot;ocs.pr ... \u0026quot;})\n12. /var/www/html/ocs/v1.php line 82\n    match(\u0026quot;/ocsapp/cloud/users\u0026quot;)\n13. /var/www/html/ocs/v2.php line 24\n    require_once(\u0026quot;/var/www/html/ocs/v1.php\u0026quot;)\n\nPOST /ocs/v2.php/cloud/users\nfrom 172.18.0.4 by [redacted] at 2018-12-17T19:38:41+00:00\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2 id=\"impact\"\u003eImpact\u003c/h2\u003e\n\n\u003cp\u003eGet various user names, e-mail addresses and passwords from log files.\u003c/p\u003e\n","weakness":{"id":33,"name":"Cleartext Storage of Sensitive Information"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2019-08-31T12:45:31.807Z","allow_singular_disclosure_after":-41966212.534288056,"singular_disclosure_allowed":true,"vote_count":30,"voters":["ness","mashoud1122","sameerphad72","mygf","dhakal_bibek","bb00x","cryptographer","codingchili","lenses","faultytoo","and 20 more..."],"severity":{"rating":"low","author_type":"User"},"structured_scope":{"databaseId":13,"asset_type":"SOURCE_CODE","asset_identifier":"nextcloud/server","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":3862334,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks a lot for reporting this potential issue back to us!\n\nOur security team will take a look at this issue as soon as possible. We will reply to your report within 72 hours, usually much faster. For obvious reasons we'd like to ask you to not disclose this issue to any other party.","markdown_message":"\u003cp\u003eThanks a lot for reporting this potential issue back to us!\u003c/p\u003e\n\n\u003cp\u003eOur security team will take a look at this issue as soon as possible. We will reply to your report within 72 hours, usually much faster. For obvious reasons we\u0026#39;d like to ask you to not disclose this issue to any other party.\u003c/p\u003e\n","automated_response":true,"created_at":"2018-12-18T16:44:59.062Z","updated_at":"2018-12-18T16:44:59.062Z","actor":{"url":"/nextcloud","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Nextcloud"}},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3895411,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @xatom,\n\nSorry for the late reponse. Christmas break etc got a bit in the way.\nI'll review this internally and get back to you (probably in the new year when most of the engineers are back).\n\nCheers,\n--Roeland","markdown_message":"\u003cp\u003eHi \u003ca href=\"/xatom\"\u003e@xatom\u003c/a\u003e,\u003c/p\u003e\n\n\u003cp\u003eSorry for the late reponse. Christmas break etc got a bit in the way.\u003cbr\u003e\nI\u0026#39;ll review this internally and get back to you (probably in the new year when most of the engineers are back).\u003c/p\u003e\n\n\u003cp\u003eCheers,\u003cbr\u003e\n--Roeland\u003c/p\u003e\n","automated_response":false,"created_at":"2018-12-27T08:56:10.885Z","updated_at":"2018-12-27T08:56:10.885Z","actor":{"username":"rullzer","cleared":false,"url":"/rullzer","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/086/005/20095c4a0c77c88375f8db5d6ed10f350d98a5a3_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3895437,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","markdown_message":"","automated_response":false,"created_at":"2018-12-27T09:01:08.268Z","updated_at":"2018-12-27T09:01:08.268Z","actor":{"username":"rullzer","cleared":false,"url":"/rullzer","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/086/005/20095c4a0c77c88375f8db5d6ed10f350d98a5a3_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3953420,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Patch at https://github.com/nextcloud/server/pull/13473","markdown_message":"\u003cp\u003ePatch at \u003ca title=\"https://github.com/nextcloud/server/pull/13473\" href=\"/redirect?url=https%3A%2F%2Fgithub.com%2Fnextcloud%2Fserver%2Fpull%2F13473\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://github.com/nextcloud/server/pull/13473\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n","automated_response":false,"created_at":"2019-01-10T09:51:02.468Z","updated_at":"2019-01-10T09:51:02.468Z","actor":{"username":"nickvergessen","cleared":false,"url":"/nickvergessen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/5DBbeB7om4ZiKgskrEoeTyGH/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":4708824,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Thanks a lot for your report again. This has been resolved since a long time, we just forgot to close the issue.\n","markdown_message":"\u003cp\u003eThanks a lot for your report again. This has been resolved since a long time, we just forgot to close the issue.\u003c/p\u003e\n","automated_response":false,"created_at":"2019-05-02T08:37:52.986Z","updated_at":"2019-05-02T08:37:52.986Z","actor":{"username":"nickvergessen","cleared":false,"url":"/nickvergessen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/5DBbeB7om4ZiKgskrEoeTyGH/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"xatom","url":"/xatom"},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":5200473,"is_internal":false,"editable":false,"type":"Activities::SwagAwarded","message":"Since this can not be abused really, as admins only can see the log file, but admins at the same time can do anything to the code, even reverting the change we did to solve this, it does not qualify for a bounty.","markdown_message":"\u003cp\u003eSince this can not be abused really, as admins only can see the log file, but admins at the same time can do anything to the code, even reverting the change we did to solve this, it does not qualify for a bounty.\u003c/p\u003e\n","automated_response":false,"created_at":"2019-06-26T15:31:31.678Z","updated_at":"2019-06-26T15:31:31.678Z","actor":{"url":"/nextcloud","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Nextcloud"}},"reporter":{"username":"xatom","url":"/xatom"},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5200474,"is_internal":false,"editable":false,"type":"Activities::NotEligibleForBounty","message":"","markdown_message":"","automated_response":false,"created_at":"2019-06-26T15:31:31.773Z","updated_at":"2019-06-26T15:31:31.773Z","actor":{"url":"/nextcloud","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Nextcloud"}},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":5479482,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2019-08-01T12:45:31.761Z","updated_at":"2019-08-01T12:45:31.761Z","first_to_agree":true,"actor":{"username":"rullzer","cleared":false,"url":"/rullzer","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/086/005/20095c4a0c77c88375f8db5d6ed10f350d98a5a3_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":5704545,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2019-08-31T12:45:36.021Z","updated_at":"2019-08-31T12:45:36.021Z","actor":{"url":"/nextcloud","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/291/68f57538488b5716cdeeb6b78955f9e46685bc09_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Nextcloud"}},"genius_execution_id":null,"team_handle":"nextcloud","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}