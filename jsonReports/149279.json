{"id":149279,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xNDkyNzk=","url":"https://hackerone.com/reports/149279","title":"Arbitrary SQL query execution and reflected XSS in the \"SQL Query Form\"","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2016-07-05T06:37:06.437Z","submitted_at":"2016-07-05T06:37:06.437Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"strukt","url":"/strukt","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/038/303/42cd71a4698d80f88ab65e3117fd9fc401a57048_original.jpg/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":265,"url":"https://hackerone.com/expressionengine","handle":"expressionengine","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/265/25251ba4ab1d0b0304a6c3d197fba5c833c6003e_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/265/25251ba4ab1d0b0304a6c3d197fba5c833c6003e_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":false,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"ExpressionEngine","twitter_handle":"eecms","website":"https://expressionengine.com/","about":"ExpressionEngine is a robust and flexible open-source Content Management System."}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2016-08-18T02:22:07.937Z","bug_reporter_agreed_on_going_public_at":"2016-07-19T02:21:55.727Z","team_member_agreed_on_going_public_at":null,"comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Hello,\n\nThe mentioned module is vulnerable to SQL injection due to the fact that a query can be done in a GET request, with the query is Base64 encoded and supplied as the value of the parameter \"thequery\".\n\nThis allows an attacker to perform arbitrary SQL queries if they trick an authenticated admin to click a specially crafted link, which can have devastating outcomes, including the deletion/dropping of whole records/databases, the insertion of new data, etc, following is a PoC:\n\nhttp://localhost/ee/admin.php?/cp/utilities/query/run-query\u0026thequery=c2VsZWN0ICogZnJvbSBleHBfbWVtYmVycw==\n\nWith c2VsZWN0ICogZnJvbSBleHBfbWVtYmVycw== as the Base64 encoded form of `select * from exp_members`.\nAlso, the same GET parameter is vulnerable to reflected XSS, which originates from the fact that MySQL errors get thrown unencoded when a malformed SQL query is processed. This, in combination with the previously mentioned flaw, can make an attacker not only capable of executing arbitrary SQL queries, but also able to read whatever data is returned from a query, in addition to the normal attacks that can be done with an XSS, following is a PoC:\n\nhttp://localhost/ee/admin.php?/cp/utilities/query/run-query\u0026thequery=c2VsZWN0IDxzdmcgb25sb2FkPWFsZXJ0KDEpPg==\n\nWhere c2VsZWN0IDxzdmcgb25sb2FkPWFsZXJ0KDEpPg== is the Base64 encoded form of `select \u003csvg onload=alert(1)\u003e`.\n\nRegards","vulnerability_information_html":"\u003cp\u003eHello,\u003c/p\u003e\n\n\u003cp\u003eThe mentioned module is vulnerable to SQL injection due to the fact that a query can be done in a GET request, with the query is Base64 encoded and supplied as the value of the parameter \u0026quot;thequery\u0026quot;.\u003c/p\u003e\n\n\u003cp\u003eThis allows an attacker to perform arbitrary SQL queries if they trick an authenticated admin to click a specially crafted link, which can have devastating outcomes, including the deletion/dropping of whole records/databases, the insertion of new data, etc, following is a PoC:\u003c/p\u003e\n\n\u003cp\u003e\u003ca title=\"http://localhost/ee/admin.php?/cp/utilities/query/run-query\u0026amp;thequery=c2VsZWN0ICogZnJvbSBleHBfbWVtYmVycw==\" href=\"/redirect?url=http%3A%2F%2Flocalhost%2Fee%2Fadmin.php%3F%2Fcp%2Futilities%2Fquery%2Frun-query%26thequery%3Dc2VsZWN0ICogZnJvbSBleHBfbWVtYmVycw%3D%3D\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://localhost/ee/admin.php?/cp/utilities/query/run-query\u0026amp;thequery=c2VsZWN0ICogZnJvbSBleHBfbWVtYmVycw==\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eWith c2VsZWN0ICogZnJvbSBleHBfbWVtYmVycw== as the Base64 encoded form of \u003ccode\u003eselect * from exp_members\u003c/code\u003e.\u003cbr\u003e\nAlso, the same GET parameter is vulnerable to reflected XSS, which originates from the fact that MySQL errors get thrown unencoded when a malformed SQL query is processed. This, in combination with the previously mentioned flaw, can make an attacker not only capable of executing arbitrary SQL queries, but also able to read whatever data is returned from a query, in addition to the normal attacks that can be done with an XSS, following is a PoC:\u003c/p\u003e\n\n\u003cp\u003e\u003ca title=\"http://localhost/ee/admin.php?/cp/utilities/query/run-query\u0026amp;thequery=c2VsZWN0IDxzdmcgb25sb2FkPWFsZXJ0KDEpPg==\" href=\"/redirect?url=http%3A%2F%2Flocalhost%2Fee%2Fadmin.php%3F%2Fcp%2Futilities%2Fquery%2Frun-query%26thequery%3Dc2VsZWN0IDxzdmcgb25sb2FkPWFsZXJ0KDEpPg%3D%3D\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://localhost/ee/admin.php?/cp/utilities/query/run-query\u0026amp;thequery=c2VsZWN0IDxzdmcgb25sb2FkPWFsZXJ0KDEpPg==\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eWhere c2VsZWN0IDxzdmcgb25sb2FkPWFsZXJ0KDEpPg== is the Base64 encoded form of \u003ccode\u003eselect \u0026lt;svg onload=alert(1)\u0026gt;\u003c/code\u003e.\u003c/p\u003e\n\n\u003cp\u003eRegards\u003c/p\u003e\n","weakness":{"id":48,"name":"Denial of Service"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2016-08-18T02:21:55.875Z","allow_singular_disclosure_after":-137729424.39704385,"singular_disclosure_allowed":true,"vote_count":4,"voters":["zombiehelp54","giteshsharmanxtlvl","dyabla","otwist"],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":1069702,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Any news about this ?","markdown_message":"\u003cp\u003eAny news about this ?\u003c/p\u003e\n","automated_response":false,"created_at":"2016-07-15T00:49:41.346Z","updated_at":"2016-07-15T00:49:41.346Z","actor":{"username":"strukt","cleared":true,"url":"/strukt","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/038/303/42cd71a4698d80f88ab65e3117fd9fc401a57048_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"expressionengine","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1070460,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi Mustafa,\n\nWe're slowly working through all of your reports, but given the number of them we've also decided to do a slightly bigger audit. I can confirm this one, and I think we'll solve it by signing the request in some way (hash of secret+query). I'll let you know when it's resolved!","markdown_message":"\u003cp\u003eHi Mustafa,\u003c/p\u003e\n\n\u003cp\u003eWe\u0026#39;re slowly working through all of your reports, but given the number of them we\u0026#39;ve also decided to do a slightly bigger audit. I can confirm this one, and I think we\u0026#39;ll solve it by signing the request in some way (hash of secret+query). I\u0026#39;ll let you know when it\u0026#39;s resolved!\u003c/p\u003e\n","automated_response":false,"created_at":"2016-07-15T13:22:41.905Z","updated_at":"2016-07-15T13:22:41.905Z","actor":{"username":"pkriete","cleared":false,"url":"/pkriete","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"expressionengine","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1070538,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks, will be waiting.","markdown_message":"\u003cp\u003eThanks, will be waiting.\u003c/p\u003e\n","automated_response":false,"created_at":"2016-07-15T14:18:57.860Z","updated_at":"2016-07-15T14:18:57.860Z","actor":{"username":"strukt","cleared":true,"url":"/strukt","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/038/303/42cd71a4698d80f88ab65e3117fd9fc401a57048_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"expressionengine","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1074851,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Hi Mustafa,\n\nThis one should be fixed for our next release. Anywhere the query is shown it's properly encoded now and any GET based queries need a valid hmac sent along to be accepted. It's worth noting that the existing behavior did limit GET queries to just `SELECT` and `SHOW`, so hopefully deleting was never possible.","markdown_message":"\u003cp\u003eHi Mustafa,\u003c/p\u003e\n\n\u003cp\u003eThis one should be fixed for our next release. Anywhere the query is shown it\u0026#39;s properly encoded now and any GET based queries need a valid hmac sent along to be accepted. It\u0026#39;s worth noting that the existing behavior did limit GET queries to just \u003ccode\u003eSELECT\u003c/code\u003e and \u003ccode\u003eSHOW\u003c/code\u003e, so hopefully deleting was never possible.\u003c/p\u003e\n","automated_response":false,"created_at":"2016-07-18T21:49:36.453Z","updated_at":"2016-07-18T21:49:36.453Z","actor":{"username":"pkriete","cleared":false,"url":"/pkriete","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"strukt","url":"/strukt"},"genius_execution_id":null,"team_handle":"expressionengine","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1075165,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Thanks, I just tried SELECT and SHOW too, so can't confirm/deny your claim, but surely that was something you had to mitigate upon.","markdown_message":"\u003cp\u003eThanks, I just tried SELECT and SHOW too, so can\u0026#39;t confirm/deny your claim, but surely that was something you had to mitigate upon.\u003c/p\u003e\n","automated_response":false,"created_at":"2016-07-19T02:21:55.807Z","updated_at":"2016-07-19T02:21:55.807Z","first_to_agree":true,"actor":{"username":"strukt","cleared":true,"url":"/strukt","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/038/303/42cd71a4698d80f88ab65e3117fd9fc401a57048_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"expressionengine","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1076708,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Yep, the XSS issues was a genuine concern. Thanks for all your work on these!","markdown_message":"\u003cp\u003eYep, the XSS issues was a genuine concern. Thanks for all your work on these!\u003c/p\u003e\n","automated_response":false,"created_at":"2016-07-19T20:44:36.173Z","updated_at":"2016-07-19T20:44:36.173Z","actor":{"username":"pkriete","cleared":false,"url":"/pkriete","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"expressionengine","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1077288,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"No worries, public disclosure please ?","markdown_message":"\u003cp\u003eNo worries, public disclosure please ?\u003c/p\u003e\n","automated_response":false,"created_at":"2016-07-20T04:07:20.318Z","updated_at":"2016-07-20T04:07:20.318Z","actor":{"username":"strukt","cleared":true,"url":"/strukt","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/038/303/42cd71a4698d80f88ab65e3117fd9fc401a57048_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"expressionengine","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1078484,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Yep, I don't mind this going public, but I would like to wait for the next release to go out first so users have recourse. Should be soon!","markdown_message":"\u003cp\u003eYep, I don\u0026#39;t mind this going public, but I would like to wait for the next release to go out first so users have recourse. Should be soon!\u003c/p\u003e\n","automated_response":false,"created_at":"2016-07-20T17:40:39.551Z","updated_at":"2016-07-20T17:40:39.551Z","actor":{"username":"pkriete","cleared":false,"url":"/pkriete","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"expressionengine","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1082653,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Sure, thank you.","markdown_message":"\u003cp\u003eSure, thank you.\u003c/p\u003e\n","automated_response":false,"created_at":"2016-07-22T17:44:06.221Z","updated_at":"2016-07-22T17:44:06.221Z","actor":{"username":"strukt","cleared":true,"url":"/strukt","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/038/303/42cd71a4698d80f88ab65e3117fd9fc401a57048_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"expressionengine","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1133546,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2016-08-18T02:22:08.131Z","updated_at":"2016-08-18T02:22:08.131Z","actor":{"url":"/expressionengine","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/265/25251ba4ab1d0b0304a6c3d197fba5c833c6003e_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"ExpressionEngine"}},"genius_execution_id":null,"team_handle":"expressionengine","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}