{"id":479144,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC80NzkxNDQ=","url":"https://hackerone.com/reports/479144","title":"DOS attack by consuming all CPU and using all available memory","state":"Closed","substate":"resolved","severity_rating":"low","readable_substate":"Resolved","created_at":"2019-01-14T05:15:00.892Z","submitted_at":"2019-01-14T05:15:00.892Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"danishshrestha","url":"/danishshrestha","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":29904,"url":"https://hackerone.com/tronfoundation","handle":"tronfoundation","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/029/904/dbe1c9e87c5612e27c53f1c2dded81d312ec3cd2_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/029/904/dbe1c9e87c5612e27c53f1c2dded81d312ec3cd2_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Tron Foundation","twitter_handle":"Tronfoundation","website":"https://tron.network","about":"TRON is dedicated to building the infrastructure for a truly decentralized Internet."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"no-content","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2019-05-02T20:25:50.093Z","bug_reporter_agreed_on_going_public_at":null,"team_member_agreed_on_going_public_at":"2019-05-02T19:47:56.756Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"","vulnerability_information_html":"","bounty_amount":"1500.0","formatted_bounty":"$1,500","weakness":{"id":48,"name":"Denial of Service"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2019-06-01T19:47:56.900Z","allow_singular_disclosure_after":-49803405.45881857,"singular_disclosure_allowed":true,"vote_count":23,"voters":["dhakal_ananda","mygf","itsunixiknowthis","eveeez","harry_mg","khizer47","bhu","m7mdharoun","cryptographer","ph0b0s","and 13 more..."],"severity":{"rating":"low","author_type":"Team"},"structured_scope":{"databaseId":10767,"asset_type":"URL","asset_identifier":"https://github.com/tronprotocol/java-tron","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":3970543,"is_internal":false,"editable":false,"type":"Activities::ReportTitleUpdated","message":"","markdown_message":"","automated_response":false,"created_at":"2019-01-14T05:21:39.586Z","updated_at":"2019-01-14T05:21:39.586Z","additional_data":{},"actor":{"username":"danishshrestha","cleared":false,"url":"/danishshrestha","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"tronfoundation","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3974773,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2019-01-14T20:20:45.543Z","updated_at":"2019-01-14T20:20:45.543Z","actor":{"username":"tuxedo","cleared":false,"url":"/tuxedo","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/9G6pgB95of3ikt3prqQunAfD/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":true,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"tronfoundation","actor_is_team_member":true,"actor_is_concealed_member":true},{"id":3975450,"is_internal":false,"editable":false,"type":"Activities::BugNeedsMoreInfo","message":"","markdown_message":"","automated_response":false,"created_at":"2019-01-14T22:04:32.970Z","updated_at":"2019-01-14T22:04:32.970Z","actor":{"username":"tuxedo","cleared":false,"url":"/tuxedo","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/9G6pgB95of3ikt3prqQunAfD/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":true,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"tronfoundation","actor_is_team_member":true,"actor_is_concealed_member":true},{"id":3975601,"is_internal":false,"editable":false,"type":"Activities::BugNew","message":"","markdown_message":"","automated_response":false,"created_at":"2019-01-14T22:37:56.290Z","updated_at":"2019-01-14T22:37:56.290Z","actor":{"username":"danishshrestha","cleared":false,"url":"/danishshrestha","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"tronfoundation","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4025607,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2019-01-23T17:15:21.307Z","updated_at":"2019-01-23T17:15:21.307Z","actor":{"username":"nasr0x01","cleared":false,"url":"/nasr0x01","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/386/674/ec2e2c825a554851c42c122ffd61aa8f18b08174_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"tronfoundation","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4073009,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2019-01-31T19:17:04.646Z","updated_at":"2019-01-31T19:17:04.646Z","actor":{"username":"danishshrestha","cleared":false,"url":"/danishshrestha","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"tronfoundation","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4075794,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2019-02-01T04:24:46.571Z","updated_at":"2019-02-01T04:24:46.571Z","actor":{"username":"nobodyatall","cleared":false,"url":"/nobodyatall","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"tronfoundation","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4075844,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2019-02-01T05:18:39.116Z","updated_at":"2019-02-01T05:18:39.116Z","actor":{"username":"danishshrestha","cleared":false,"url":"/danishshrestha","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"tronfoundation","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4075962,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","markdown_message":"","automated_response":false,"created_at":"2019-02-01T06:48:04.413Z","updated_at":"2019-02-01T06:48:04.413Z","actor":{"url":"/tronfoundation","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/029/904/dbe1c9e87c5612e27c53f1c2dded81d312ec3cd2_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Tron Foundation"}},"bounty_amount":"1500.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"tronfoundation","collaborator":{"username":"danishshrestha","url":"/danishshrestha"},"actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4075965,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"","markdown_message":"","automated_response":false,"created_at":"2019-02-01T06:51:24.241Z","updated_at":"2019-02-01T06:51:24.241Z","actor":{"username":"nobodyatall","cleared":false,"url":"/nobodyatall","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"reporter":{"username":"danishshrestha","url":"/danishshrestha"},"genius_execution_id":null,"team_handle":"tronfoundation","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4720059,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2019-05-02T19:47:56.826Z","updated_at":"2019-05-02T19:47:56.826Z","first_to_agree":true,"actor":{"username":"taraffic","cleared":false,"url":"/taraffic","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/Lb1DPdXu9tHW9HrSbScjwNkc/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"tronfoundation","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4721034,"is_internal":false,"editable":false,"type":"Activities::ManuallyDisclosed","message":"","markdown_message":"","automated_response":false,"created_at":"2019-05-02T20:25:50.013Z","updated_at":"2019-05-02T20:25:50.013Z","actor":{"username":"taraffic","cleared":false,"url":"/taraffic","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/Lb1DPdXu9tHW9HrSbScjwNkc/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"tronfoundation","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4839136,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","markdown_message":"","automated_response":false,"created_at":"2019-05-14T23:11:15.620Z","updated_at":"2019-05-14T23:11:15.620Z","additional_data":{},"actor":{"username":"taraffic","cleared":false,"url":"/taraffic","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/Lb1DPdXu9tHW9HrSbScjwNkc/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":true},"genius_execution_id":null,"team_handle":"tronfoundation","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"id":15634,"category":"team","content":"**Summary:**\nA single request to submit a post to /wallet/deploycontract with several megabytes of bytecode along with CPU intensive long parsing will consume CPU for about 10 minutes while still holding several megabytes of bytecode in heap. With enough requests (lets say 1K-10K depending upon available memory), its enough to use all the available threads to service incoming HTTP request, fill up the memory and render DDOS.\n\n**Description:**\n\n*Getting a longValue from big decimal for large exponent is extremely slow. new BigDecimal(\"10000000e100000000\").longValue(); snippet takes about 2-3 minutes to run in a modern macbook pro.\n*/wallet/deploycontract has 6 fields that gets a long value from a parsed json object i.e. token_id, call_token_value, fee_limit, call_value, consume_user_resource_percent, origin_energy_limit. This means a single request can use up a thread for up to 12 minutes (assuming 2 minutes per parsing).\n*While a thread is being locked for 12 minutes /deploycontract also puts the entire bytecode in memory which can fill up the memory and prematurely move objects from eden memory space to old memory space\n*Once objects are moved to old memory space it will be very difficult to clean them up when when the pointers are released and hence the GC will get stuck trying to clean fore ever. Notice the gc log and screenshot where the memory stays up at 3G long after the attack was stopped.\n\n**Supporting Material/References:**\n* jconsole screenshots representing memory, cpu and threads\n* gc log to show JVM going into infinite GCs and still unable to free up memory\n\n**Suggested fix**\n* JSONObject.parse uses Feature.UseBigDecimal.getMask(); by default. Not using BigDecimal will fix the issue but may introduce issue in other places where BigDecimal is required.\n* Also, would be great if the entire bytecode wasnt put in memory the whole time.\n\n**Impact**\nUsing a single machine an attacker could send DDOS attack to all or 51% of the SR node and render Tron network unusable or make it unavailable.","can_view?":true,"can_edit?":false,"content_html":"\u003cp\u003e\u003cstrong\u003eSummary:\u003c/strong\u003e\u003cbr\u003e\nA single request to submit a post to /wallet/deploycontract with several megabytes of bytecode along with CPU intensive long parsing will consume CPU for about 10 minutes while still holding several megabytes of bytecode in heap. With enough requests (lets say 1K-10K depending upon available memory), its enough to use all the available threads to service incoming HTTP request, fill up the memory and render DDOS.\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eDescription:\u003c/strong\u003e\u003c/p\u003e\n\n\u003cp\u003e*Getting a longValue from big decimal for large exponent is extremely slow. new BigDecimal(\u0026quot;10000000e100000000\u0026quot;).longValue(); snippet takes about 2-3 minutes to run in a modern macbook pro.\u003cbr\u003e\n*/wallet/deploycontract has 6 fields that gets a long value from a parsed json object i.e. token_id, call_token_value, fee_limit, call_value, consume_user_resource_percent, origin_energy_limit. This means a single request can use up a thread for up to 12 minutes (assuming 2 minutes per parsing).\u003cbr\u003e\n*While a thread is being locked for 12 minutes /deploycontract also puts the entire bytecode in memory which can fill up the memory and prematurely move objects from eden memory space to old memory space\u003cbr\u003e\n*Once objects are moved to old memory space it will be very difficult to clean them up when when the pointers are released and hence the GC will get stuck trying to clean fore ever. Notice the gc log and screenshot where the memory stays up at 3G long after the attack was stopped.\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eSupporting Material/References:\u003c/strong\u003e\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003ejconsole screenshots representing memory, cpu and threads\u003c/li\u003e\n\u003cli\u003egc log to show JVM going into infinite GCs and still unable to free up memory\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e\u003cstrong\u003eSuggested fix\u003c/strong\u003e\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eJSONObject.parse uses Feature.UseBigDecimal.getMask(); by default. Not using BigDecimal will fix the issue but may introduce issue in other places where BigDecimal is required.\u003c/li\u003e\n\u003cli\u003eAlso, would be great if the entire bytecode wasnt put in memory the whole time.\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e\u003cstrong\u003eImpact\u003c/strong\u003e\u003cbr\u003e\nUsing a single machine an attacker could send DDOS attack to all or 51% of the SR node and render Tron network unusable or make it unavailable.\u003c/p\u003e\n"},{"category":"researcher","can_view?":true,"can_create?":false}]}