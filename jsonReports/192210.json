{"id":192210,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xOTIyMTA=","url":"https://hackerone.com/reports/192210","title":"Stored XSS in blog comments through Shopify API","state":"Closed","substate":"resolved","severity_rating":"medium","readable_substate":"Resolved","created_at":"2016-12-18T13:43:21.084Z","submitted_at":"2016-12-18T13:43:21.084Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"prakharprasad","url":"/prakharprasad","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/4Qcsaci6HdNLQCPM7oBdhJYY/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":1382,"url":"https://hackerone.com/shopify","handle":"shopify","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/fjjiC5585s8WoDGHv2M5okbJ/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/fjjiC5585s8WoDGHv2M5okbJ/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Shopify","twitter_handle":"","website":"https://www.shopify.com","about":"Shopify is a multi-channel commerce platform that helps people sell online, in-store, and everywhere in between."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2017-03-16T04:22:33.627Z","bug_reporter_agreed_on_going_public_at":"2017-03-16T04:22:33.579Z","team_member_agreed_on_going_public_at":"2017-03-14T21:01:47.636Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Hi there!\n\nAs far I understand the Shopify Shop have blogs which allow users to comment on blog posts, however the comments with HTML content automatically gets sanitised and then posted to avoid XSS issue. However using the API for comment modification, any application with comment permission can modify a comment and include arbitrary HTML leading to XSS. \n\n**Steps to Reproduce** \n\n1.  Open the Shopify Shop's blog and post a comment on a blogpost through a browser. \n2. Note the *comment id*, this can be easily grabbed by checking the HTML after the comment is posted: \nEg. `\u003cdiv id=\"comment-2929551246\" class=\"comment border-bottom clearfix\"\u003e`\n3. Now setup an application with comment permission on the Shop \n4. Send the following JSON to the API endpoint /admin/comments/\u003ccomment-id\u003e.json\n`  {\n  \"comment\": {\n    \"id\": \u003ccomment-id\u003e,\n    \"body\": \"blahblah\",\n    \"body_html\": \"blah\u003cimg src=x onerror=alert(0);\u003e\"\n  }\n  }`\n5. Send request twice.\n6. Visit the blog post, JS in the comment should execute.\n\nI believe this is a valid bug as the comment should get stripped of HTML, which is not the case in case of the above request, however it does gets stripped when posted via web or modified through the comment API documentation at https://help.shopify.com/api/reference/comment#update. To insert arbitrary HTML I've purposely added `body_html` in the request, which is not mentioned in the API reference, the allows me to add HTML, in the comment. The HTML even executes in the Shop's Admin Panel when viewing comments for a particular blog. \n\nPoC (see comment section for JS execution): https://derp-10.myshopify.com/blogs/news/43260355-first-post\n\nVideo: https://www.dropbox.com/s/7ie1tiex1eo4kk9/Comment%20XSS.mov?dl=0\n\nThanks,\nPrakhar Prasad\n","vulnerability_information_html":"\u003cp\u003eHi there!\u003c/p\u003e\n\n\u003cp\u003eAs far I understand the Shopify Shop have blogs which allow users to comment on blog posts, however the comments with HTML content automatically gets sanitised and then posted to avoid XSS issue. However using the API for comment modification, any application with comment permission can modify a comment and include arbitrary HTML leading to XSS. \u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eSteps to Reproduce\u003c/strong\u003e \u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003e Open the Shopify Shop\u0026#39;s blog and post a comment on a blogpost through a browser. \u003c/li\u003e\n\u003cli\u003eNote the \u003cem\u003ecomment id\u003c/em\u003e, this can be easily grabbed by checking the HTML after the comment is posted: \nEg. \u003ccode\u003e\u0026lt;div id=\u0026quot;comment-2929551246\u0026quot; class=\u0026quot;comment border-bottom clearfix\u0026quot;\u0026gt;\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003eNow setup an application with comment permission on the Shop \u003c/li\u003e\n\u003cli\u003eSend the following JSON to the API endpoint /admin/comments/\u0026lt;comment-id\u0026gt;.json\n\u003ccode\u003e{\n\u0026quot;comment\u0026quot;: {\n\u0026quot;id\u0026quot;: \u0026lt;comment-id\u0026gt;,\n\u0026quot;body\u0026quot;: \u0026quot;blahblah\u0026quot;,\n\u0026quot;body_html\u0026quot;: \u0026quot;blah\u0026lt;img src=x onerror=alert(0);\u0026gt;\u0026quot;\n}\n}\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003eSend request twice.\u003c/li\u003e\n\u003cli\u003eVisit the blog post, JS in the comment should execute.\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eI believe this is a valid bug as the comment should get stripped of HTML, which is not the case in case of the above request, however it does gets stripped when posted via web or modified through the comment API documentation at \u003ca title=\"https://help.shopify.com/api/reference/comment#update\" href=\"/redirect?url=https%3A%2F%2Fhelp.shopify.com%2Fapi%2Freference%2Fcomment%23update\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://help.shopify.com/api/reference/comment#update\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e. To insert arbitrary HTML I\u0026#39;ve purposely added \u003ccode\u003ebody_html\u003c/code\u003e in the request, which is not mentioned in the API reference, the allows me to add HTML, in the comment. The HTML even executes in the Shop\u0026#39;s Admin Panel when viewing comments for a particular blog. \u003c/p\u003e\n\n\u003cp\u003ePoC (see comment section for JS execution): \u003ca title=\"https://derp-10.myshopify.com/blogs/news/43260355-first-post\" href=\"/redirect?url=https%3A%2F%2Fderp-10.myshopify.com%2Fblogs%2Fnews%2F43260355-first-post\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://derp-10.myshopify.com/blogs/news/43260355-first-post\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eVideo: \u003ca title=\"https://www.dropbox.com/s/7ie1tiex1eo4kk9/Comment%20XSS.mov?dl=0\" href=\"/redirect?url=https%3A%2F%2Fwww.dropbox.com%2Fs%2F7ie1tiex1eo4kk9%2FComment%2520XSS.mov%3Fdl%3D0\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://www.dropbox.com/s/7ie1tiex1eo4kk9/Comment%20XSS.mov?dl=0\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eThanks,\u003cbr\u003e\nPrakhar Prasad\u003c/p\u003e\n","bounty_amount":"1000.0","formatted_bounty":"$1,000","weakness":{"id":60,"name":"Cross-site Scripting (XSS) - Generic"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":null,"vote_count":37,"voters":["delimitry","sp1d3rs","ston3","bogdantcaciuc","yaworsk","icanthack","supernatural","madrobot","muhammad_uwais","mpz","and 27 more..."],"severity":{"rating":"medium","author_type":"User"},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":1372544,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"In step 4. The request will be a `PUT` request","markdown_message":"\u003cp\u003eIn step 4. The request will be a \u003ccode\u003ePUT\u003c/code\u003e request\u003c/p\u003e\n","automated_response":false,"created_at":"2016-12-18T13:46:52.274Z","updated_at":"2016-12-18T13:46:52.274Z","actor":{"username":"prakharprasad","cleared":true,"url":"/prakharprasad","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/4Qcsaci6HdNLQCPM7oBdhJYY/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1375441,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Thank you for your report. Our engineering team is investigating the issue.","markdown_message":"\u003cp\u003eThank you for your report. Our engineering team is investigating the issue.\u003c/p\u003e\n","automated_response":false,"created_at":"2016-12-19T21:58:52.149Z","updated_at":"2016-12-19T21:58:52.149Z","actor":{"username":"jenn-shopify","cleared":false,"url":"/jenn-shopify","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1449662,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hey! how is the progress so far on this ticket. ","markdown_message":"\u003cp\u003eHey! how is the progress so far on this ticket. \u003c/p\u003e\n","automated_response":false,"created_at":"2017-01-28T17:36:37.705Z","updated_at":"2017-01-28T17:36:37.705Z","actor":{"username":"prakharprasad","cleared":true,"url":"/prakharprasad","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/4Qcsaci6HdNLQCPM7oBdhJYY/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1456329,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"We're still working on this, and will contact you when we have an update. Thank you for your patience.","markdown_message":"\u003cp\u003eWe\u0026#39;re still working on this, and will contact you when we have an update. Thank you for your patience.\u003c/p\u003e\n","automated_response":false,"created_at":"2017-02-01T15:36:31.992Z","updated_at":"2017-02-01T15:36:31.992Z","actor":{"username":"jenn-shopify","cleared":false,"url":"/jenn-shopify","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1528458,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Thanks again for your report!\nWe have deployed a fix for this issue. Our next round of bounty decisions will take place within two weeks, so we will be in touch with you again soon.","markdown_message":"\u003cp\u003eThanks again for your report!\u003cbr\u003e\nWe have deployed a fix for this issue. Our next round of bounty decisions will take place within two weeks, so we will be in touch with you again soon.\u003c/p\u003e\n","automated_response":false,"created_at":"2017-03-08T23:02:55.478Z","updated_at":"2017-03-08T23:02:55.478Z","actor":{"username":"jenn-shopify","cleared":false,"url":"/jenn-shopify","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"prakharprasad","url":"/prakharprasad"},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1541548,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Thanks for helping improve the security of Shopify!","markdown_message":"\u003cp\u003eThanks for helping improve the security of Shopify!\u003c/p\u003e\n","automated_response":false,"created_at":"2017-03-14T21:01:41.538Z","updated_at":"2017-03-14T21:01:41.538Z","actor":{"url":"/shopify","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/fjjiC5585s8WoDGHv2M5okbJ/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Shopify"}},"bounty_amount":"1000.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"shopify","collaborator":{"username":"prakharprasad","url":"/prakharprasad"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1541549,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2017-03-14T21:01:47.656Z","updated_at":"2017-03-14T21:01:47.656Z","first_to_agree":true,"actor":{"username":"andrewdunbar","cleared":false,"url":"/andrewdunbar","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/019/164/5b0e89675ed6dbb9df87223e9f8f58e2125bb56b_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1544545,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2017-03-16T04:22:33.598Z","updated_at":"2017-03-16T04:22:33.598Z","actor":{"username":"prakharprasad","cleared":true,"url":"/prakharprasad","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/4Qcsaci6HdNLQCPM7oBdhJYY/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1544546,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2017-03-16T04:22:33.645Z","updated_at":"2017-03-16T04:22:33.645Z","actor":{"username":"prakharprasad","cleared":true,"url":"/prakharprasad","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/4Qcsaci6HdNLQCPM7oBdhJYY/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"id":3489,"category":"team","content":"Though html content can be set through the API for many locations in the Shopify storefront, this report was a special case. We were also displaying the body_html of these comments in Shopify admin, leading to XSS in admin rather than the storefront.","can_view?":true,"can_edit?":false,"content_html":"\u003cp\u003eThough html content can be set through the API for many locations in the Shopify storefront, this report was a special case. We were also displaying the body_html of these comments in Shopify admin, leading to XSS in admin rather than the storefront.\u003c/p\u003e\n"},{"category":"researcher","can_view?":true,"can_create?":false}]}