{"id":362033,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8zNjIwMzM=","url":"https://hackerone.com/reports/362033","title":"Csrf token does not meet security design","state":"Closed","substate":"duplicate","readable_substate":"Duplicate","created_at":"2018-06-05T09:35:45.005Z","submitted_at":"2018-06-05T09:35:45.005Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"wsfengfan474","url":"/wsfengfan474","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":28411,"url":"https://hackerone.com/liberapay","handle":"liberapay","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/028/411/c0a012abdcef38b417e29616505b1a3b4ed87b81_original./3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/028/411/c0a012abdcef38b417e29616505b1a3b4ed87b81_original./eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Liberapay","twitter_handle":"liberapay","website":"https://liberapay.com","about":"An open source platform designed to facilitate recurrent donations."}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2018-06-05T11:34:16.684Z","bug_reporter_agreed_on_going_public_at":"2018-06-05T11:34:16.618Z","team_member_agreed_on_going_public_at":"2018-06-05T10:00:08.328Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Almost all APIs in liberapay.com have csrf tokens.However, this token is not useful for the specified user. In the case that the user is not logged in, the csrf token is also generated, and after the login is successful, the token does not change.And the csrf tokens generated by other web browsers are replaced by the user and still work.\n\nStart request:\n```\nPOST /~153780/identity HTTP/1.1\nHost: liberapay.com\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64; rv:60.0) Gecko/20100101 Firefox/60.0\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\nAccept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2\nAccept-Encoding: gzip, deflate\nReferer: https://liberapay.com/~153780/identity\nContent-Type: application/x-www-form-urlencoded\nContent-Length: 128\nCookie: __cfduid=dbae28a1d218515c7d4551d1f70b64c8d1528123170; csrf_token=Jsf9LQiIMR362WsEP0elX54Ml4HTSCmv; session=\"153780:1:lnigjeEgIGmab5Bn60IJXBDEno5cFhv_\"\nDNT: 1\nConnection: close\nUpgrade-Insecure-Requests: 1\n\ncsrf_token=Jsf9LQiIMR362WsEP0elX54Ml4HTSCmv\u0026FirstName=feng\u0026LastName=fan\u0026CountryOfResidence=CN\u0026Nationality=CN\u0026Birthday=1997-12-19\n```\n\n```\nHTTP/1.1 200 OK\nDate: Tue, 05 Jun 2018 09:17:20 GMT\nContent-Type: text/html; charset=UTF-8\nConnection: close\nX-Xss-Protection: 1; mode=block\nContent-Security-Policy: default-src 'self' liberapay.com;connect-src 'self' *.liberapay.org *.mangopay.com *.payline.com;form-action 'self';img-src * blob: data:;object-src 'none';report-uri https://liberapay.report-uri.com/r/d/csp/enforce;upgrade-insecure-requests;\nCache-Control: no-cache\nX-Frame-Options: SAMEORIGIN\nReferrer-Policy: strict-origin-when-cross-origin\nSet-Cookie: csrf_token=Jsf9LQiIMR362WsEP0elX54Ml4HTSCmv; Domain=.liberapay.com; expires=Tue, 12 Jun 2018 09:17:20 GMT; Path=/; secure\nStrict-Transport-Security: max-age=31536000; includeSubDomains; preload\nX-Content-Type-Options: nosniff\nExpect-CT: max-age=604800, report-uri=\"https://report-uri.cloudflare.com/cdn-cgi/beacon/expect-ct\"\nServer: cloudflare\nCF-RAY: 42618ba8ed0013b3-LAX\nContent-Length: 59590\n```\n\nAfter modification, use other csrf tokens:\n```\nPOST /~153780/identity HTTP/1.1\nHost: liberapay.com\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64; rv:60.0) Gecko/20100101 Firefox/60.0\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\nAccept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2\nAccept-Encoding: gzip, deflate\nReferer: https://liberapay.com/~153780/identity\nContent-Type: application/x-www-form-urlencoded\nContent-Length: 128\nCookie: __cfduid=dbae28a1d218515c7d4551d1f70b64c8d1528123170; csrf_token=F798zSeZ80HjZipmUAh9ga4DFTgJgZ1H; session=\"153780:1:lnigjeEgIGmab5Bn60IJXBDEno5cFhv_\"\nDNT: 1\nConnection: close\nUpgrade-Insecure-Requests: 1\n\ncsrf_token=F798zSeZ80HjZipmUAh9ga4DFTgJgZ1H\u0026FirstName=feng\u0026LastName=fan\u0026CountryOfResidence=CN\u0026Nationality=CN\u0026Birthday=1997-12-19\n```\n\n```\nHTTP/1.1 200 OK\nDate: Tue, 05 Jun 2018 09:20:56 GMT\nContent-Type: text/html; charset=UTF-8\nConnection: close\nX-Xss-Protection: 1; mode=block\nContent-Security-Policy: default-src 'self' liberapay.com;connect-src 'self' *.liberapay.org *.mangopay.com *.payline.com;form-action 'self';img-src * blob: data:;object-src 'none';report-uri https://liberapay.report-uri.com/r/d/csp/enforce;upgrade-insecure-requests;\nCache-Control: no-cache\nX-Frame-Options: SAMEORIGIN\nReferrer-Policy: strict-origin-when-cross-origin\nSet-Cookie: csrf_token=F798zSeZ80HjZipmUAh9ga4DFTgJgZ1H; Domain=.liberapay.com; expires=Tue, 12 Jun 2018 09:20:56 GMT; Path=/; secure\nStrict-Transport-Security: max-age=31536000; includeSubDomains; preload\nX-Content-Type-Options: nosniff\nExpect-CT: max-age=604800, report-uri=\"https://report-uri.cloudflare.com/cdn-cgi/beacon/expect-ct\"\nServer: cloudflare\nCF-RAY: 426190ed780313b9-LAX\nContent-Length: 59590\n```\n\n## Impact\n\nThe uniqueness of csrf can reduce the risk of web applications","vulnerability_information_html":"\u003cp\u003eAlmost all APIs in liberapay.com have csrf tokens.However, this token is not useful for the specified user. In the case that the user is not logged in, the csrf token is also generated, and after the login is successful, the token does not change.And the csrf tokens generated by other web browsers are replaced by the user and still work.\u003c/p\u003e\n\n\u003cp\u003eStart request:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003ePOST /~153780/identity HTTP/1.1\nHost: liberapay.com\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64; rv:60.0) Gecko/20100101 Firefox/60.0\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\nAccept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2\nAccept-Encoding: gzip, deflate\nReferer: https://liberapay.com/~153780/identity\nContent-Type: application/x-www-form-urlencoded\nContent-Length: 128\nCookie: __cfduid=dbae28a1d218515c7d4551d1f70b64c8d1528123170; csrf_token=Jsf9LQiIMR362WsEP0elX54Ml4HTSCmv; session=\u0026quot;153780:1:lnigjeEgIGmab5Bn60IJXBDEno5cFhv_\u0026quot;\nDNT: 1\nConnection: close\nUpgrade-Insecure-Requests: 1\n\ncsrf_token=Jsf9LQiIMR362WsEP0elX54Ml4HTSCmv\u0026amp;FirstName=feng\u0026amp;LastName=fan\u0026amp;CountryOfResidence=CN\u0026amp;Nationality=CN\u0026amp;Birthday=1997-12-19\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003eHTTP/1.1 200 OK\nDate: Tue, 05 Jun 2018 09:17:20 GMT\nContent-Type: text/html; charset=UTF-8\nConnection: close\nX-Xss-Protection: 1; mode=block\nContent-Security-Policy: default-src \u0026#39;self\u0026#39; liberapay.com;connect-src \u0026#39;self\u0026#39; *.liberapay.org *.mangopay.com *.payline.com;form-action \u0026#39;self\u0026#39;;img-src * blob: data:;object-src \u0026#39;none\u0026#39;;report-uri https://liberapay.report-uri.com/r/d/csp/enforce;upgrade-insecure-requests;\nCache-Control: no-cache\nX-Frame-Options: SAMEORIGIN\nReferrer-Policy: strict-origin-when-cross-origin\nSet-Cookie: csrf_token=Jsf9LQiIMR362WsEP0elX54Ml4HTSCmv; Domain=.liberapay.com; expires=Tue, 12 Jun 2018 09:17:20 GMT; Path=/; secure\nStrict-Transport-Security: max-age=31536000; includeSubDomains; preload\nX-Content-Type-Options: nosniff\nExpect-CT: max-age=604800, report-uri=\u0026quot;https://report-uri.cloudflare.com/cdn-cgi/beacon/expect-ct\u0026quot;\nServer: cloudflare\nCF-RAY: 42618ba8ed0013b3-LAX\nContent-Length: 59590\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eAfter modification, use other csrf tokens:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003ePOST /~153780/identity HTTP/1.1\nHost: liberapay.com\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64; rv:60.0) Gecko/20100101 Firefox/60.0\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\nAccept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2\nAccept-Encoding: gzip, deflate\nReferer: https://liberapay.com/~153780/identity\nContent-Type: application/x-www-form-urlencoded\nContent-Length: 128\nCookie: __cfduid=dbae28a1d218515c7d4551d1f70b64c8d1528123170; csrf_token=F798zSeZ80HjZipmUAh9ga4DFTgJgZ1H; session=\u0026quot;153780:1:lnigjeEgIGmab5Bn60IJXBDEno5cFhv_\u0026quot;\nDNT: 1\nConnection: close\nUpgrade-Insecure-Requests: 1\n\ncsrf_token=F798zSeZ80HjZipmUAh9ga4DFTgJgZ1H\u0026amp;FirstName=feng\u0026amp;LastName=fan\u0026amp;CountryOfResidence=CN\u0026amp;Nationality=CN\u0026amp;Birthday=1997-12-19\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003eHTTP/1.1 200 OK\nDate: Tue, 05 Jun 2018 09:20:56 GMT\nContent-Type: text/html; charset=UTF-8\nConnection: close\nX-Xss-Protection: 1; mode=block\nContent-Security-Policy: default-src \u0026#39;self\u0026#39; liberapay.com;connect-src \u0026#39;self\u0026#39; *.liberapay.org *.mangopay.com *.payline.com;form-action \u0026#39;self\u0026#39;;img-src * blob: data:;object-src \u0026#39;none\u0026#39;;report-uri https://liberapay.report-uri.com/r/d/csp/enforce;upgrade-insecure-requests;\nCache-Control: no-cache\nX-Frame-Options: SAMEORIGIN\nReferrer-Policy: strict-origin-when-cross-origin\nSet-Cookie: csrf_token=F798zSeZ80HjZipmUAh9ga4DFTgJgZ1H; Domain=.liberapay.com; expires=Tue, 12 Jun 2018 09:20:56 GMT; Path=/; secure\nStrict-Transport-Security: max-age=31536000; includeSubDomains; preload\nX-Content-Type-Options: nosniff\nExpect-CT: max-age=604800, report-uri=\u0026quot;https://report-uri.cloudflare.com/cdn-cgi/beacon/expect-ct\u0026quot;\nServer: cloudflare\nCF-RAY: 426190ed780313b9-LAX\nContent-Length: 59590\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2 id=\"impact\"\u003eImpact\u003c/h2\u003e\n\n\u003cp\u003eThe uniqueness of csrf can reduce the risk of web applications\u003c/p\u003e\n","original_report_id":361414,"original_report_url":"https://hackerone.com/reports/361414","attachments":[],"allow_singular_disclosure_at":null,"vote_count":1,"voters":["0x08"],"structured_scope":{"databaseId":8926,"asset_type":"URL","asset_identifier":"*.liberapay.com","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":2844000,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thank you for your submission! We have received your report and a security analyst will respond shortly.","markdown_message":"\u003cp\u003eThank you for your submission! We have received your report and a security analyst will respond shortly.\u003c/p\u003e\n","automated_response":true,"created_at":"2018-06-05T09:36:57.792Z","updated_at":"2018-06-05T09:36:57.792Z","actor":{"url":"/liberapay","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/028/411/c0a012abdcef38b417e29616505b1a3b4ed87b81_original./eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Liberapay"}},"genius_execution_id":null,"team_handle":"liberapay","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2844076,"is_internal":false,"editable":false,"type":"Activities::BugDuplicate","message":"See also \u003chttps://github.com/liberapay/liberapay.com/issues/1131\u003e.","markdown_message":"\u003cp\u003eSee also \u003ca title=\"https://github.com/liberapay/liberapay.com/issues/1131\" href=\"/redirect?url=https%3A%2F%2Fgithub.com%2Fliberapay%2Fliberapay.com%2Fissues%2F1131\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://github.com/liberapay/liberapay.com/issues/1131\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-06-05T09:59:45.676Z","updated_at":"2018-06-05T09:59:45.676Z","original_report_id":361414,"actor":{"username":"changaco","cleared":false,"url":"/changaco","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/057/214/a4a950c93bb68bb76a61cf02b1484a518e8c7a90_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"liberapay","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2844078,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2018-06-05T10:00:08.402Z","updated_at":"2018-06-05T10:00:08.402Z","first_to_agree":true,"actor":{"username":"changaco","cleared":false,"url":"/changaco","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/057/214/a4a950c93bb68bb76a61cf02b1484a518e8c7a90_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"liberapay","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2844296,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2018-06-05T11:34:16.650Z","updated_at":"2018-06-05T11:34:16.650Z","actor":{"username":"wsfengfan474","cleared":false,"url":"/wsfengfan474","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"liberapay","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2844297,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2018-06-05T11:34:16.715Z","updated_at":"2018-06-05T11:34:16.715Z","actor":{"username":"wsfengfan474","cleared":false,"url":"/wsfengfan474","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"liberapay","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}