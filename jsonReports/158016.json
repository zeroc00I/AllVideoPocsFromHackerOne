{"id":158016,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xNTgwMTY=","url":"https://hackerone.com/reports/158016","title":"Server side request forgery on image upload for lists","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2016-08-09T23:44:41.943Z","submitted_at":"2016-08-09T23:44:41.943Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"eboda","url":"/eboda","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/014/247/a6446792be4fa0fc962bcba2811ef801ddff87be_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":555,"url":"https://hackerone.com/instacart","handle":"instacart","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/555/df662b77c791ed1296275d032f446300e1a5a6b3_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/555/df662b77c791ed1296275d032f446300e1a5a6b3_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":false,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Instacart","twitter_handle":"instacart","website":"https://www.instacart.com/","about":"Same-day grocery delivery"}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2016-10-12T21:11:01.088Z","bug_reporter_agreed_on_going_public_at":null,"team_member_agreed_on_going_public_at":"2016-09-12T21:10:57.759Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Summary\n----------\n\nThere is a Server-side request forgery when updating the image for a list.\n\nSteps to reproduce\n-----------------\n\n1. Create a list and change its image. That will send a POST request to https://beta.instacart.com/api/v2/lists/[LIST_ID] with the following parameters:\n\n    ```\nlist[remote_image_url]=https://example.com/yourimage.jpg\n```\n\n2. Change the  url to http://127.0.0.1:21 and you will get as response:\n\n    ```{json}\n{\n\t\"meta\":\n\t{\n\t\t\"code\": 400,\n\t\t\"error_type\": \"List Error\",\n\t\t\"error_message\": \"There was an error while updating this list\",\n\t\t\"errors\": [\"Image could not download file: wrong status line: \\\"SSH-2.0-OpenSSH_6.6.1p1 Ubuntu-2ubuntu2.3\\\"\"]\n\t}\n}\n```\n    Which shows that it tried to connect to the SSH port on localhost.  \n","vulnerability_information_html":"\u003ch2 id=\"summary\"\u003eSummary\u003c/h2\u003e\n\n\u003cp\u003eThere is a Server-side request forgery when updating the image for a list.\u003c/p\u003e\n\n\u003ch2 id=\"steps-to-reproduce\"\u003eSteps to reproduce\u003c/h2\u003e\n\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003eCreate a list and change its image. That will send a POST request to \u003ca title=\"https://beta.instacart.com/api/v2/lists/%5BLIST_ID%5D\" href=\"/redirect?url=https%3A%2F%2Fbeta.instacart.com%2Fapi%2Fv2%2Flists%2F%255BLIST_ID%255D\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://beta.instacart.com/api/v2/lists/%5BLIST_ID%5D\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e with the following parameters:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003elist[remote_image_url]=https://example.com/yourimage.jpg\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eChange the  url to \u003ca title=\"http://127.0.0.1:21\" href=\"/redirect?url=http%3A%2F%2F127.0.0.1%3A21\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://127.0.0.1:21\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e and you will get as response:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight json\"\u003e\u003ccode\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026quot;meta\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026quot;code\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"mi\"\u003e400\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026quot;error_type\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026quot;List Error\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026quot;error_message\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026quot;There was an error while updating this list\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\u0026quot;errors\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026quot;Image could not download file: wrong status line: \u003c/span\u003e\u003cspan class=\"se\"\u003e\\\u0026quot;\u003c/span\u003e\u003cspan class=\"s2\"\u003eSSH-2.0-OpenSSH_6.6.1p1 Ubuntu-2ubuntu2.3\u003c/span\u003e\u003cspan class=\"se\"\u003e\\\u0026quot;\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eWhich shows that it tried to connect to the SSH port on localhost.  \u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n","bounty_amount":"50.0","formatted_bounty":"$50","weakness":{"id":70,"name":"Code Injection"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2016-10-12T21:10:57.843Z","allow_singular_disclosure_after":-132909891.48096204,"singular_disclosure_allowed":true,"vote_count":19,"voters":["peace_life","hunter","gamliel","supernatural","zuh4n","kiraak-boy","ak1t4","exception","fantam1","japz","and 9 more..."],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":1127776,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Thanks! We'll look into this and get back to you when we have an update.","markdown_message":"\u003cp\u003eThanks! We\u0026#39;ll look into this and get back to you when we have an update.\u003c/p\u003e\n","automated_response":false,"created_at":"2016-08-15T20:04:46.363Z","updated_at":"2016-08-15T20:04:46.363Z","actor":{"username":"mikeinstacart","cleared":false,"url":"/mikeinstacart","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"instacart","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1146256,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Thank you for the report,\n\nThis should now be fixed.","markdown_message":"\u003cp\u003eThank you for the report,\u003c/p\u003e\n\n\u003cp\u003eThis should now be fixed.\u003c/p\u003e\n","automated_response":false,"created_at":"2016-08-22T22:52:01.125Z","updated_at":"2016-08-22T22:52:01.125Z","actor":{"username":"anf","cleared":false,"url":"/anf","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/569/6f3c5a7f7e76bc75a837f2b4ce698afe4e88d5e6_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"eboda","url":"/eboda"},"genius_execution_id":null,"team_handle":"instacart","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1146257,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","markdown_message":"","automated_response":false,"created_at":"2016-08-22T22:52:18.550Z","updated_at":"2016-08-22T22:52:18.550Z","actor":{"url":"/instacart","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/555/df662b77c791ed1296275d032f446300e1a5a6b3_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Instacart"}},"bounty_amount":"50.0","bounty_currency":"usd","genius_execution_id":null,"team_handle":"instacart","collaborator":{"username":"eboda","url":"/eboda"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1156506,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thank you for the bounty. \n\nYou  might also want to limit access to 169.254.169.254 which is the multicast address used by EC2 to distribute instance metadata and could potentially contain sensitive information. Since I don't see any way to extract information using this SSRF at this point, it is obviously a minor issue as well, but doesn't hurt to be on the safe side I guess.","markdown_message":"\u003cp\u003eThank you for the bounty. \u003c/p\u003e\n\n\u003cp\u003eYou  might also want to limit access to 169.254.169.254 which is the multicast address used by EC2 to distribute instance metadata and could potentially contain sensitive information. Since I don\u0026#39;t see any way to extract information using this SSRF at this point, it is obviously a minor issue as well, but doesn\u0026#39;t hurt to be on the safe side I guess.\u003c/p\u003e\n","automated_response":false,"created_at":"2016-08-26T18:56:20.562Z","updated_at":"2016-08-26T18:56:20.562Z","actor":{"username":"eboda","cleared":true,"url":"/eboda","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/014/247/a6446792be4fa0fc962bcba2811ef801ddff87be_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"instacart","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1189633,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2016-09-12T21:10:57.808Z","updated_at":"2016-09-12T21:10:57.808Z","first_to_agree":true,"actor":{"username":"anf","cleared":false,"url":"/anf","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/013/569/6f3c5a7f7e76bc75a837f2b4ce698afe4e88d5e6_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"instacart","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1244846,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2016-10-12T21:11:01.103Z","updated_at":"2016-10-12T21:11:01.103Z","actor":{"url":"/instacart","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/555/df662b77c791ed1296275d032f446300e1a5a6b3_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Instacart"}},"genius_execution_id":null,"team_handle":"instacart","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}