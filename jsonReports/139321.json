{"id":139321,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xMzkzMjE=","url":"https://hackerone.com/reports/139321","title":"Unsafe Query Generation (CVE-2012-2660, CVE-2012-2694 and CVE-2013-0155) mitigation bypass","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2016-05-17T13:38:03.756Z","submitted_at":"2016-05-17T13:38:03.756Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"joernchen","url":"/joernchen","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/075/5c3bb9f26b9116faa19b35d813ae411be62433e5_original.jpg/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":22,"url":"https://hackerone.com/rails","handle":"rails","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/022/5e2b46658c8b86bed62f574d8e1793f353cbbc63_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/022/5e2b46658c8b86bed62f574d8e1793f353cbbc63_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Ruby on Rails","twitter_handle":null,"website":"http://rubyonrails.org/security","about":"Web development that doesn't hurt."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"no-content","cve_ids":["CVE-2016-6317"],"singular_disclosure_disabled":false,"disclosed_at":"2018-02-07T21:02:19.175Z","bug_reporter_agreed_on_going_public_at":"2018-02-07T21:02:19.055Z","team_member_agreed_on_going_public_at":"2018-02-07T20:14:11.422Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"","vulnerability_information_html":"","bounty_amount":"1500.0","formatted_bounty":"$1,500","original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2018-03-09T20:14:11.534Z","allow_singular_disclosure_after":-88589606.84448439,"singular_disclosure_allowed":true,"vote_count":7,"voters":["dee-see","eveeez","cr4xerbik4sh","japz","sumit7","cryptographer","akon_kahuak"],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":962525,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2016-05-18T02:51:23.062Z","updated_at":"2016-05-18T02:51:23.062Z","actor":{"username":"jeremy","cleared":false,"url":"/jeremy","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/121/d8d8bc5a99a5229118f3f1064beb83458d1d10d6_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":962526,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","markdown_message":"","automated_response":false,"created_at":"2016-05-18T02:51:32.594Z","updated_at":"2016-05-18T02:51:32.594Z","actor":{"username":"jeremy","cleared":false,"url":"/jeremy","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/121/d8d8bc5a99a5229118f3f1064beb83458d1d10d6_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":963276,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2016-05-18T15:33:08.145Z","updated_at":"2016-05-18T15:33:08.145Z","actor":{"username":"joernchen","cleared":false,"url":"/joernchen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/075/5c3bb9f26b9116faa19b35d813ae411be62433e5_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":964028,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2016-05-18T22:51:17.838Z","updated_at":"2016-05-18T22:51:17.838Z","actor":{"username":"jeremy","cleared":false,"url":"/jeremy","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/121/d8d8bc5a99a5229118f3f1064beb83458d1d10d6_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":964560,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2016-05-19T12:07:05.529Z","updated_at":"2016-05-19T12:07:05.529Z","actor":{"username":"joernchen","cleared":false,"url":"/joernchen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/075/5c3bb9f26b9116faa19b35d813ae411be62433e5_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1057227,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2016-07-07T11:57:45.377Z","updated_at":"2016-07-07T11:57:45.377Z","actor":{"username":"joernchen","cleared":false,"url":"/joernchen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/075/5c3bb9f26b9116faa19b35d813ae411be62433e5_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1089741,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2016-07-27T00:56:16.057Z","updated_at":"2016-07-27T00:56:36.993Z","actor":{"username":"tenderlove","cleared":false,"url":"/tenderlove","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/318/60d828744b5d16813ecbf975fdc453dc4a933f4f_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1089743,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2016-07-27T00:58:02.245Z","updated_at":"2016-07-27T00:58:02.245Z","actor":{"username":"tenderlove","cleared":false,"url":"/tenderlove","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/318/60d828744b5d16813ecbf975fdc453dc4a933f4f_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1090500,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2016-07-27T12:04:23.835Z","updated_at":"2016-07-27T12:04:23.835Z","actor":{"username":"joernchen","cleared":false,"url":"/joernchen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/075/5c3bb9f26b9116faa19b35d813ae411be62433e5_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1092076,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2016-07-28T00:39:52.741Z","updated_at":"2016-07-28T00:39:52.741Z","actor":{"username":"tenderlove","cleared":false,"url":"/tenderlove","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/318/60d828744b5d16813ecbf975fdc453dc4a933f4f_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1092361,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2016-07-28T08:19:04.069Z","updated_at":"2016-07-28T08:19:04.069Z","actor":{"username":"joernchen","cleared":false,"url":"/joernchen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/075/5c3bb9f26b9116faa19b35d813ae411be62433e5_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1093081,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2016-07-28T15:15:11.524Z","updated_at":"2016-07-28T15:15:11.524Z","actor":{"username":"tenderlove","cleared":false,"url":"/tenderlove","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/318/60d828744b5d16813ecbf975fdc453dc4a933f4f_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1094014,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2016-07-28T22:12:48.961Z","updated_at":"2016-07-28T22:12:48.961Z","actor":{"username":"tenderlove","cleared":false,"url":"/tenderlove","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/318/60d828744b5d16813ecbf975fdc453dc4a933f4f_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1094737,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2016-07-29T09:28:10.900Z","updated_at":"2016-07-29T09:28:10.900Z","actor":{"username":"joernchen","cleared":false,"url":"/joernchen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/075/5c3bb9f26b9116faa19b35d813ae411be62433e5_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1109121,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2016-08-05T22:09:08.810Z","updated_at":"2016-08-05T22:09:08.810Z","actor":{"username":"tenderlove","cleared":false,"url":"/tenderlove","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/318/60d828744b5d16813ecbf975fdc453dc4a933f4f_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1114828,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"","markdown_message":"","automated_response":false,"created_at":"2016-08-09T14:16:24.109Z","updated_at":"2016-08-09T14:16:24.109Z","actor":{"username":"joernchen","cleared":false,"url":"/joernchen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/075/5c3bb9f26b9116faa19b35d813ae411be62433e5_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1119917,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"","markdown_message":"","automated_response":false,"created_at":"2016-08-11T18:13:59.958Z","updated_at":"2016-08-11T18:13:59.958Z","actor":{"username":"tenderlove","cleared":false,"url":"/tenderlove","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/003/318/60d828744b5d16813ecbf975fdc453dc4a933f4f_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"joernchen","url":"/joernchen"},"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2360253,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","markdown_message":"","automated_response":false,"created_at":"2018-02-07T20:11:41.846Z","updated_at":"2018-02-07T20:11:41.846Z","actor":{"url":"/rails","ibb":true,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/022/5e2b46658c8b86bed62f574d8e1793f353cbbc63_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Ruby on Rails"}},"bounty_amount":"1500.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"rails","collaborator":{"username":"joernchen","url":"/joernchen"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2360259,"is_internal":false,"editable":false,"type":"Activities::CveIdAdded","message":"","markdown_message":"","automated_response":false,"created_at":"2018-02-07T20:13:53.653Z","updated_at":"2018-02-07T20:13:53.653Z","cve_ids":["CVE-2016-6317"],"actor":{"username":"rafaelfranca","cleared":false,"url":"/rafaelfranca","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/004/981/dd3b6bb41f9c33e3448ebbc47303f5a135f25105_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2360260,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2018-02-07T20:14:11.456Z","updated_at":"2018-02-07T20:14:11.456Z","first_to_agree":true,"actor":{"username":"rafaelfranca","cleared":false,"url":"/rafaelfranca","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/004/981/dd3b6bb41f9c33e3448ebbc47303f5a135f25105_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2360385,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2018-02-07T21:02:19.087Z","updated_at":"2018-02-07T21:02:19.087Z","actor":{"username":"joernchen","cleared":false,"url":"/joernchen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/075/5c3bb9f26b9116faa19b35d813ae411be62433e5_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2360386,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2018-02-07T21:02:19.207Z","updated_at":"2018-02-07T21:02:19.207Z","actor":{"username":"joernchen","cleared":false,"url":"/joernchen","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/075/5c3bb9f26b9116faa19b35d813ae411be62433e5_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"rails","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"id":6573,"category":"team","content":"# Unsafe Query Generation Risk in Active Record \n\nThere is a vulnerability when Active Record is used in conjunction with JSON \nparameter parsing. This vulnerability has been assigned the CVE identifier \nCVE-2016-6317.  This vulnerability is similar to CVE-2012-2660, CVE-2012-2694 \nand CVE-2013-0155. \n\nVersions Affected:  \u003e= 4.2.0 \nNot affected:       \u003c 4.2.0, \u003e= 5.0.0 \nFixed Versions:     4.2.7.1 \n\nImpact \n------ \n\nDue to the way Active Record interprets parameters in combination with the way that JSON parameters are parsed, it is possible for an attacker to issue unexpected database queries with \"IS NULL\" or empty where clauses.  This issue does *not* let an attacker insert arbitrary values into an SQL query, however they can cause the query to check for NULL or eliminate a WHERE clause when most users wouldn't expect it. \n\nFor example, a system has password reset with token functionality: \n\n    unless params[:token].nil? \n      user = User.find_by_token(params[:token]) \n      user.reset_password! \n    end \n\nAn attacker can craft a request such that `params[:token]` will return `[nil]`.  The `[nil]` value will bypass the test for nil, but will still add an \"IN ('xyz', NULL)\" clause to the SQL query. \n\nSimilarly, an attacker can craft a request such that `params[:token]` will return an empty hash.  An empty hash will eliminate the WHERE clause of the query, but can bypass the `nil?` check. \n\nNote that this impacts not only dynamic finders (`find_by_*`) but also relations (`User.where(:name =\u003e params[:name])`). \n\nAll users running an affected release should either upgrade or use one of the work arounds immediately. All users running an affected release should upgrade immediately. Please note, this vulnerability is a variant of CVE-2012-2660, CVE-2012-2694, and CVE-2013-0155.  Even if you upgraded to address those issues, you must take action again. \n\nIf this chance in behavior impacts your application, you can manually decode the original values from the request like so: \n\n    ActiveSupport::JSON.decode(request.body) \n\nReleases \n-------- \nThe FIXED releases are available at the normal locations. \n\nWorkarounds \n----------- \nThis problem can be mitigated by casting the parameter to a string before passing it to Active Record.  For example: \n\n    unless params[:token].nil? || params[:token].to_s.empty? \n      user = User.find_by_token(params[:token].to_s) \n      user.reset_password! \n    end \n\n\nPatches \n------- \nTo aid users who aren't able to upgrade immediately we have provided patches for \nthe two supported release series. They are in git-am format and consist of a \nsingle changeset. \n\n* 4-2-unsafe-query-generation.patch - Patch for 4.2 series \n\nPlease note that only the 5.0.x and 4.2.x series are supported at present. Users \nof earlier unsupported releases are advised to upgrade as soon as possible as we \ncannot guarantee the continued availability of security fixes for unsupported \nreleases. \n\nCredits \n------- \n\nThanks to joernchen of Phenoelit for reporting this! ","can_view?":true,"can_edit?":false,"content_html":"\u003ch1 id=\"unsafe-query-generation-risk-in-active-record\"\u003eUnsafe Query Generation Risk in Active Record\u003c/h1\u003e\n\n\u003cp\u003eThere is a vulnerability when Active Record is used in conjunction with JSON \u003cbr\u003e\nparameter parsing. This vulnerability has been assigned the CVE identifier \u003cbr\u003e\nCVE-2016-6317.  This vulnerability is similar to CVE-2012-2660, CVE-2012-2694 \u003cbr\u003e\nand CVE-2013-0155. \u003c/p\u003e\n\n\u003cp\u003eVersions Affected:  \u0026gt;= 4.2.0 \u003cbr\u003e\nNot affected:       \u0026lt; 4.2.0, \u0026gt;= 5.0.0 \u003cbr\u003e\nFixed Versions:     4.2.7.1 \u003c/p\u003e\n\n\u003ch2 id=\"impact\"\u003eImpact \u003c/h2\u003e\n\n\u003cp\u003eDue to the way Active Record interprets parameters in combination with the way that JSON parameters are parsed, it is possible for an attacker to issue unexpected database queries with \u0026quot;IS NULL\u0026quot; or empty where clauses.  This issue does \u003cem\u003enot\u003c/em\u003e let an attacker insert arbitrary values into an SQL query, however they can cause the query to check for NULL or eliminate a WHERE clause when most users wouldn\u0026#39;t expect it. \u003c/p\u003e\n\n\u003cp\u003eFor example, a system has password reset with token functionality: \u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003eunless params[:token].nil? \n  user = User.find_by_token(params[:token]) \n  user.reset_password! \nend \n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eAn attacker can craft a request such that \u003ccode\u003eparams[:token]\u003c/code\u003e will return \u003ccode\u003e[nil]\u003c/code\u003e.  The \u003ccode\u003e[nil]\u003c/code\u003e value will bypass the test for nil, but will still add an \u0026quot;IN (\u0026#39;xyz\u0026#39;, NULL)\u0026quot; clause to the SQL query. \u003c/p\u003e\n\n\u003cp\u003eSimilarly, an attacker can craft a request such that \u003ccode\u003eparams[:token]\u003c/code\u003e will return an empty hash.  An empty hash will eliminate the WHERE clause of the query, but can bypass the \u003ccode\u003enil?\u003c/code\u003e check. \u003c/p\u003e\n\n\u003cp\u003eNote that this impacts not only dynamic finders (\u003ccode\u003efind_by_*\u003c/code\u003e) but also relations (\u003ccode\u003eUser.where(:name =\u0026gt; params[:name])\u003c/code\u003e). \u003c/p\u003e\n\n\u003cp\u003eAll users running an affected release should either upgrade or use one of the work arounds immediately. All users running an affected release should upgrade immediately. Please note, this vulnerability is a variant of CVE-2012-2660, CVE-2012-2694, and CVE-2013-0155.  Even if you upgraded to address those issues, you must take action again. \u003c/p\u003e\n\n\u003cp\u003eIf this chance in behavior impacts your application, you can manually decode the original values from the request like so: \u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003eActiveSupport::JSON.decode(request.body) \n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2 id=\"releases\"\u003eReleases \u003c/h2\u003e\n\n\u003cp\u003eThe FIXED releases are available at the normal locations. \u003c/p\u003e\n\n\u003ch2 id=\"workarounds\"\u003eWorkarounds \u003c/h2\u003e\n\n\u003cp\u003eThis problem can be mitigated by casting the parameter to a string before passing it to Active Record.  For example: \u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003eunless params[:token].nil? || params[:token].to_s.empty? \n  user = User.find_by_token(params[:token].to_s) \n  user.reset_password! \nend \n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2 id=\"patches\"\u003ePatches \u003c/h2\u003e\n\n\u003cp\u003eTo aid users who aren\u0026#39;t able to upgrade immediately we have provided patches for \u003cbr\u003e\nthe two supported release series. They are in git-am format and consist of a \u003cbr\u003e\nsingle changeset. \u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e4-2-unsafe-query-generation.patch - Patch for 4.2 series \u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003ePlease note that only the 5.0.x and 4.2.x series are supported at present. Users \u003cbr\u003e\nof earlier unsupported releases are advised to upgrade as soon as possible as we \u003cbr\u003e\ncannot guarantee the continued availability of security fixes for unsupported \u003cbr\u003e\nreleases. \u003c/p\u003e\n\n\u003ch2 id=\"credits\"\u003eCredits \u003c/h2\u003e\n\n\u003cp\u003eThanks to joernchen of Phenoelit for reporting this! \u003c/p\u003e\n"},{"category":"researcher","can_view?":true,"can_create?":false}]}