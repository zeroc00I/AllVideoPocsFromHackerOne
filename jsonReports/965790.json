{"id":965790,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC85NjU3OTA=","url":"https://hackerone.com/reports/965790","title":"Assert failed in `edit_mail_istream_read`","state":"Closed","substate":"resolved","severity_rating":"none","readable_substate":"Resolved","created_at":"2020-08-24T13:29:24.117Z","submitted_at":"2020-08-24T13:29:24.165Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"catenacyber","url":"/catenacyber","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":8906,"url":"https://hackerone.com/open-xchange","handle":"open-xchange","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/JtYLEsu5yRZxGitSmAjeAFtK/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/JtYLEsu5yRZxGitSmAjeAFtK/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Open-Xchange","twitter_handle":"openxchange","website":"https://www.open-xchange.com/","about":"Messaging, collaboration and office productivity software for service providers"}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2020-08-27T11:20:46.562Z","bug_reporter_agreed_on_going_public_at":"2020-08-27T11:20:46.495Z","team_member_agreed_on_going_public_at":"2020-08-27T06:02:45.506Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"To reproduce, run test suite on following input :\n```\nrequire \"vnd.dovecot.testsuite\";\nrequire \"variables\";\nrequire \"editheader\";\n\n\ntest_set \"message\" \"${mege}\";\ntest \"\" {\taddheader :last \"der\" \"Her-3\";\n\n\tif not test_result_execute {\n\t\t\n\t}\n\n}\n```\n\nOutput is with (ASAN enabled) stack trace\n```\ntestsuite: Panic: file edit-mail.c: line 1946 (edit_mail_istream_read): assertion failed: (hdr_size \u003e 0)\n==89789== ERROR: libFuzzer: deadly signal\n    #0 0x10cd8d0e7 in __sanitizer_print_stack_trace (libclang_rt.asan_osx_dynamic.dylib:x86_64h+0x600e7)\n    #1 0x10c58fd5a in fuzzer::PrintStackTrace() FuzzerUtil.cpp:205\n    #2 0x10c571b66 in fuzzer::Fuzzer::CrashCallback() FuzzerLoop.cpp:232\n    #3 0x7fff6121df59 in _sigtramp (libsystem_platform.dylib:x86_64+0x1f59)\n    #4 0x7ffee36c5ce7  (\u003cunknown module\u003e)\n    #5 0x7fff60fbb1ad in abort (libsystem_c.dylib:x86_64+0x5d1ad)\n    #6 0x10cbf4a55 in default_fatal_finish failures.c:459\n    #7 0x10cbf325c in fatal_handler_real failures.c:471\n    #8 0x10cbf3220 in default_fatal_handler failures.c:479\n    #9 0x10cbf345f in i_panic failures.c:523\n    #10 0x10c777a89 in edit_mail_istream_read edit-mail.c:1946\n    #11 0x10cc01827 in i_stream_read_memarea istream.c:313\n    #12 0x10cc07016 in i_stream_crlf_read_common istream-crlf.c:22\n    #13 0x10cc06d56 in i_stream_crlf_read_lf istream-crlf.c:124\n    #14 0x10cc01827 in i_stream_read_memarea istream.c:313\n    #15 0x10cc016c9 in i_stream_read istream.c:271\n    #16 0x10cc0c3d4 in i_stream_tee_read istream-tee.c:143\n    #17 0x10cc01827 in i_stream_read_memarea istream.c:313\n    #18 0x10cc02ab3 in i_stream_read_data istream.c:271\n    #19 0x10cc20589 in io_stream_copy istream.h:217\n    #20 0x10cc22ad4 in o_stream_file_send_istream ostream-file.c\n    #21 0x10cc200e2 in o_stream_send_istream ostream.c:398\n    #22 0x10ca64379 in index_storage_save_continue index-storage.c:1193\n    #23 0x10ca08c9c in maildir_save_continue maildir-save.c:436\n    #24 0x10c9df8d7 in mailbox_save_continue mail-storage.c:2606\n    #25 0x10c9cec50 in mail_storage_copy mail-copy.c:81\n    #26 0x10ca05572 in maildir_copy maildir-copy.c:148\n    #27 0x10c9dfd2f in mailbox_copy_int mail-storage.c:2733\n    #28 0x10c6c5423 in act_store_execute sieve-actions.c:654\n    #29 0x10c6a5d15 in _sieve_result_implicit_keep sieve-result.c:1017\n    #30 0x10c6a6b1c in sieve_result_execute sieve-result.c:1484\n    #31 0x10c543576 in testsuite_result_execute testsuite-result.c:95\n    #32 0x10c552b9a in tst_test_result_execute_operation_execute tst-test-result-execute.c:80\n    #33 0x10c69b5dd in sieve_interpreter_operation_execute sieve-interpreter.c:899\n    #34 0x10c69afee in sieve_interpreter_continue sieve-interpreter.c:940\n    #35 0x10c69bbc6 in sieve_interpreter_start sieve-interpreter.c:1012\n    #36 0x10c553cee in testsuite_run fuzz_testsuite.c:60\n```\n\n## Impact\n\nI do not think there is a security impact, but there might be one as this assert is followed by the condition `append_v_offset \u003c= hdr_size - 1` where we will have an unsigned integer underflow when `hdr_size == 0` as is the case here","vulnerability_information_html":"\u003cp\u003eTo reproduce, run test suite on following input :\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003erequire \u0026quot;vnd.dovecot.testsuite\u0026quot;;\nrequire \u0026quot;variables\u0026quot;;\nrequire \u0026quot;editheader\u0026quot;;\n\n\ntest_set \u0026quot;message\u0026quot; \u0026quot;${mege}\u0026quot;;\ntest \u0026quot;\u0026quot; {   addheader :last \u0026quot;der\u0026quot; \u0026quot;Her-3\u0026quot;;\n\n    if not test_result_execute {\n\n    }\n\n}\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eOutput is with (ASAN enabled) stack trace\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003etestsuite: Panic: file edit-mail.c: line 1946 (edit_mail_istream_read): assertion failed: (hdr_size \u0026gt; 0)\n==89789== ERROR: libFuzzer: deadly signal\n    #0 0x10cd8d0e7 in __sanitizer_print_stack_trace (libclang_rt.asan_osx_dynamic.dylib:x86_64h+0x600e7)\n    #1 0x10c58fd5a in fuzzer::PrintStackTrace() FuzzerUtil.cpp:205\n    #2 0x10c571b66 in fuzzer::Fuzzer::CrashCallback() FuzzerLoop.cpp:232\n    #3 0x7fff6121df59 in _sigtramp (libsystem_platform.dylib:x86_64+0x1f59)\n    #4 0x7ffee36c5ce7  (\u0026lt;unknown module\u0026gt;)\n    #5 0x7fff60fbb1ad in abort (libsystem_c.dylib:x86_64+0x5d1ad)\n    #6 0x10cbf4a55 in default_fatal_finish failures.c:459\n    #7 0x10cbf325c in fatal_handler_real failures.c:471\n    #8 0x10cbf3220 in default_fatal_handler failures.c:479\n    #9 0x10cbf345f in i_panic failures.c:523\n    #10 0x10c777a89 in edit_mail_istream_read edit-mail.c:1946\n    #11 0x10cc01827 in i_stream_read_memarea istream.c:313\n    #12 0x10cc07016 in i_stream_crlf_read_common istream-crlf.c:22\n    #13 0x10cc06d56 in i_stream_crlf_read_lf istream-crlf.c:124\n    #14 0x10cc01827 in i_stream_read_memarea istream.c:313\n    #15 0x10cc016c9 in i_stream_read istream.c:271\n    #16 0x10cc0c3d4 in i_stream_tee_read istream-tee.c:143\n    #17 0x10cc01827 in i_stream_read_memarea istream.c:313\n    #18 0x10cc02ab3 in i_stream_read_data istream.c:271\n    #19 0x10cc20589 in io_stream_copy istream.h:217\n    #20 0x10cc22ad4 in o_stream_file_send_istream ostream-file.c\n    #21 0x10cc200e2 in o_stream_send_istream ostream.c:398\n    #22 0x10ca64379 in index_storage_save_continue index-storage.c:1193\n    #23 0x10ca08c9c in maildir_save_continue maildir-save.c:436\n    #24 0x10c9df8d7 in mailbox_save_continue mail-storage.c:2606\n    #25 0x10c9cec50 in mail_storage_copy mail-copy.c:81\n    #26 0x10ca05572 in maildir_copy maildir-copy.c:148\n    #27 0x10c9dfd2f in mailbox_copy_int mail-storage.c:2733\n    #28 0x10c6c5423 in act_store_execute sieve-actions.c:654\n    #29 0x10c6a5d15 in _sieve_result_implicit_keep sieve-result.c:1017\n    #30 0x10c6a6b1c in sieve_result_execute sieve-result.c:1484\n    #31 0x10c543576 in testsuite_result_execute testsuite-result.c:95\n    #32 0x10c552b9a in tst_test_result_execute_operation_execute tst-test-result-execute.c:80\n    #33 0x10c69b5dd in sieve_interpreter_operation_execute sieve-interpreter.c:899\n    #34 0x10c69afee in sieve_interpreter_continue sieve-interpreter.c:940\n    #35 0x10c69bbc6 in sieve_interpreter_start sieve-interpreter.c:1012\n    #36 0x10c553cee in testsuite_run fuzz_testsuite.c:60\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2 id=\"impact\"\u003eImpact\u003c/h2\u003e\n\n\u003cp\u003eI do not think there is a security impact, but there might be one as this assert is followed by the condition \u003ccode\u003eappend_v_offset \u0026lt;= hdr_size - 1\u003c/code\u003e where we will have an unsigned integer underflow when \u003ccode\u003ehdr_size == 0\u003c/code\u003e as is the case here\u003c/p\u003e\n","bounty_amount":"50.0","formatted_bounty":"$50","weakness":{"id":65,"name":"Business Logic Errors"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":null,"vote_count":0,"voters":[],"severity":{"rating":"none","author_type":"Team"},"structured_scope":{"databaseId":42900,"asset_type":"SOURCE_CODE","asset_identifier":"https://github.com/dovecot/pigeonhole","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":9039642,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"This is caused by the empty input message. The problem is practically limited to the test suite; empty messages are not encountered in practice. I have a fix.","markdown_message":"\u003cp\u003eThis is caused by the empty input message. The problem is practically limited to the test suite; empty messages are not encountered in practice. I have a fix.\u003c/p\u003e\n","automated_response":false,"created_at":"2020-08-25T23:15:17.101Z","updated_at":"2020-08-25T23:15:17.101Z","actor":{"username":"sbosch","cleared":false,"url":"/sbosch","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9050978,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","markdown_message":"","automated_response":false,"created_at":"2020-08-27T05:34:17.637Z","updated_at":"2020-08-27T05:34:17.637Z","actor":{"username":"akituomi","cleared":false,"url":"/akituomi","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/060/216/805d230879c8e3757d37eedddaadf9efed0a8094_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9051168,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","markdown_message":"","automated_response":false,"created_at":"2020-08-27T06:02:22.450Z","updated_at":"2020-08-27T06:02:22.450Z","actor":{"url":"/open-xchange","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/JtYLEsu5yRZxGitSmAjeAFtK/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Open-Xchange"}},"bounty_amount":"0.0","bounty_currency":"usd","bonus_amount":"50.0","genius_execution_id":null,"team_handle":"open-xchange","collaborator":{"username":"catenacyber","url":"/catenacyber"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9051171,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","markdown_message":"","automated_response":false,"created_at":"2020-08-27T06:02:35.360Z","updated_at":"2020-08-27T06:02:35.360Z","additional_data":{"old_severity":"Low (2.3)","new_severity":"None","old_severity_id":827091,"new_severity_id":830000},"actor":{"username":"akituomi","cleared":false,"url":"/akituomi","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/060/216/805d230879c8e3757d37eedddaadf9efed0a8094_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9051172,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"This is not a security issue, and we thank you for taking time to report this to us. We will fix this bug eventually.\n","markdown_message":"\u003cp\u003eThis is not a security issue, and we thank you for taking time to report this to us. We will fix this bug eventually.\u003c/p\u003e\n","automated_response":false,"created_at":"2020-08-27T06:02:37.477Z","updated_at":"2020-08-27T06:02:37.477Z","actor":{"username":"akituomi","cleared":false,"url":"/akituomi","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/060/216/805d230879c8e3757d37eedddaadf9efed0a8094_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"catenacyber","url":"/catenacyber"},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9051173,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2020-08-27T06:02:45.521Z","updated_at":"2020-08-27T06:02:45.521Z","first_to_agree":true,"actor":{"username":"akituomi","cleared":false,"url":"/akituomi","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/060/216/805d230879c8e3757d37eedddaadf9efed0a8094_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":9053400,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2020-08-27T11:20:46.516Z","updated_at":"2020-08-27T11:20:46.516Z","actor":{"username":"catenacyber","cleared":false,"url":"/catenacyber","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":9053401,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2020-08-27T11:20:46.593Z","updated_at":"2020-08-27T11:20:46.593Z","actor":{"username":"catenacyber","cleared":false,"url":"/catenacyber","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"open-xchange","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}