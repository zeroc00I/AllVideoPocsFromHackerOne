{"id":184712,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xODQ3MTI=","url":"https://hackerone.com/reports/184712","title":"Denial of service due to invalid memory access in mrb_ary_concat","state":"Closed","substate":"resolved","severity_rating":"high","readable_substate":"Resolved","created_at":"2016-11-24T04:35:19.514Z","submitted_at":"2016-11-24T04:35:19.514Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"haquaman","url":"/haquaman","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/017/646/07cbfc394d4d3432eb95cf9735f225ea803090bb_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":15668,"url":"https://hackerone.com/shopify-scripts","handle":"shopify-scripts","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/015/668/ebbe467de8ef2fc936053593e1289e30f04c3b06_original.jpg/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/015/668/ebbe467de8ef2fc936053593e1289e30f04c3b06_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"paused","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"shopify-scripts","twitter_handle":"","website":"","about":""}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2016-12-17T20:07:10.168Z","bug_reporter_agreed_on_going_public_at":"2016-12-17T20:07:10.125Z","team_member_agreed_on_going_public_at":"2016-12-16T20:24:00.236Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Hi,\n\nThe following file causes a segmentation fault in mruby, which also causes a segmentation fault in mruby-engine. I've minimized this file down to the bare bones what crashes it, then renamed variables and tidied so you can see what is needed and what isn't.\n\n```\ncase \"\"\n  when 0\nend\nx *case\n  when true\n    * = 0\nend\n```\n\nAlso this file causes the same issue:\n\n```\ncase \"\"\n  when 0\nend\nx = *case\n  when 0\n    * = 0\nend\n```\n\nDifference between the two is one is a method call, and one is assignment.\n\n```\n$ ./dev/bin/mruby --version\nmruby 1.2.0 (2015-11-17)\n```\n\n```\n$ ./dev/bin/mruby crash-1.rb\ncrash-1.rb:4:3: '*' interpreted as argument prefix\nSegmentation fault: 11\n```\n\n```\n$ lldb ./dev/bin/mruby crash-1.rb\n(lldb) target create \"./dev/bin/mruby\"\nCurrent executable set to './dev/bin/mruby' (x86_64).\n(lldb) settings set -- target.run-args  \"crash-1.rb\"\n(lldb) r\nProcess 54552 launched: './dev/bin/mruby' (x86_64)\ncrash-1.rb:4:3: '*' interpreted as argument prefix\nProcess 54552 stopped\n* thread #1: tid = 0x652cabc, 0x0000000100001837 mruby`ary_modify + 55, queue = 'com.apple.main-thread', stop reason = EXC_BAD_ACCESS (code=1, address=0x4800000019)\n    frame #0: 0x0000000100001837 mruby`ary_modify + 55\nmruby`ary_modify:\n-\u003e  0x100001837 \u003c+55\u003e: cmpl   $0x1, (%rax)\n    0x10000183a \u003c+58\u003e: jne    0x100001889               ; \u003c+137\u003e\n    0x100001840 \u003c+64\u003e: movq   -0x10(%rbp), %rax\n    0x100001844 \u003c+68\u003e: movq   0x28(%rax), %rax\n(lldb) bt\n* thread #1: tid = 0x652cabc, 0x0000000100001837 mruby`ary_modify + 55, queue = 'com.apple.main-thread', stop reason = EXC_BAD_ACCESS (code=1, address=0x4800000019)\n  * frame #0: 0x0000000100001837 mruby`ary_modify + 55\n    frame #1: 0x0000000100001ca1 mruby`ary_concat + 49\n    frame #2: 0x0000000100001c66 mruby`mrb_ary_concat + 70\n    frame #3: 0x000000010004263f mruby`mrb_vm_exec + 25439\n    frame #4: 0x000000010003c2c7 mruby`mrb_vm_run + 135\n    frame #5: 0x00000001000446b4 mruby`mrb_top_run + 100\n    frame #6: 0x000000010006f19f mruby`load_exec + 1183\n    frame #7: 0x000000010006ece3 mruby`mrb_load_file_cxt + 67\n    frame #8: 0x0000000100000d78 mruby`main + 904\n    frame #9: 0x00007fff8a9db5ad libdyld.dylib`start + 1\n    frame #10: 0x00007fff8a9db5ad libdyld.dylib`start + 1\n(lldb) register read\nGeneral Purpose Registers:\n       rax = 0x0000004800000019\n       rbx = 0x0000000000000000\n       rcx = 0x0000000000200086\n       rdx = 0x0000000100000000  mruby`_mh_execute_header\n       rdi = 0x00000001002029f0\n       rsi = 0x0000000100000000  mruby`_mh_execute_header\n       rbp = 0x00007fff5fbfc9d0\n       rsp = 0x00007fff5fbfc9a0\n        r8 = 0x0000000000000001\n        r9 = 0x0000000000000000\n       r10 = 0x0000000000000001\n       r11 = 0x0000000100200000\n       r12 = 0x0000000000000000\n       r13 = 0x0000000000000000\n       r14 = 0x0000000000000000\n       r15 = 0x0000000000000000\n       rip = 0x0000000100001837  mruby`ary_modify + 55\n    rflags = 0x0000000000010206\n        cs = 0x000000000000002b\n        fs = 0x0000000000000000\n        gs = 0x0000000000000000\n\n(lldb) q\nQuitting LLDB will kill one or more processes. Do you really want to proceed: [Y/n] y\n\n```\n\nand the second file:\n\n```\n$ ./dev/bin/mruby crash-2.rb\nSegmentation fault: 11\n```\n\n```\n$ lldb ./dev/bin/mruby crash-2.rb\n(lldb) target create \"./dev/bin/mruby\"\nCurrent executable set to './dev/bin/mruby' (x86_64).\n(lldb) settings set -- target.run-args  \"crash-2.rb\"\n(lldb) r\nProcess 66755 launched: './dev/bin/mruby' (x86_64)\nProcess 66755 stopped\n* thread #1: tid = 0x652fc10, 0x0000000100001837 mruby`ary_modify + 55, queue = 'com.apple.main-thread', stop reason = EXC_BAD_ACCESS (code=1, address=0x4800000019)\n    frame #0: 0x0000000100001837 mruby`ary_modify + 55\nmruby`ary_modify:\n-\u003e  0x100001837 \u003c+55\u003e: cmpl   $0x1, (%rax)\n    0x10000183a \u003c+58\u003e: jne    0x100001889               ; \u003c+137\u003e\n    0x100001840 \u003c+64\u003e: movq   -0x10(%rbp), %rax\n    0x100001844 \u003c+68\u003e: movq   0x28(%rax), %rax\n(lldb) bt\n* thread #1: tid = 0x652fc10, 0x0000000100001837 mruby`ary_modify + 55, queue = 'com.apple.main-thread', stop reason = EXC_BAD_ACCESS (code=1, address=0x4800000019)\n  * frame #0: 0x0000000100001837 mruby`ary_modify + 55\n    frame #1: 0x0000000100001ca1 mruby`ary_concat + 49\n    frame #2: 0x0000000100001c66 mruby`mrb_ary_concat + 70\n    frame #3: 0x000000010004263f mruby`mrb_vm_exec + 25439\n    frame #4: 0x000000010003c2c7 mruby`mrb_vm_run + 135\n    frame #5: 0x00000001000446b4 mruby`mrb_top_run + 100\n    frame #6: 0x000000010006f19f mruby`load_exec + 1183\n    frame #7: 0x000000010006ece3 mruby`mrb_load_file_cxt + 67\n    frame #8: 0x0000000100000d78 mruby`main + 904\n    frame #9: 0x00007fff8a9db5ad libdyld.dylib`start + 1\n    frame #10: 0x00007fff8a9db5ad libdyld.dylib`start + 1\n(lldb) register read\nGeneral Purpose Registers:\n       rax = 0x0000004800000019\n       rbx = 0x0000000000000000\n       rcx = 0x0000000000200086\n       rdx = 0x0000000100000000  mruby`_mh_execute_header\n       rdi = 0x00000001002029f0\n       rsi = 0x0000000100000000  mruby`_mh_execute_header\n       rbp = 0x00007fff5fbfc9d0\n       rsp = 0x00007fff5fbfc9a0\n        r8 = 0x0000000000000001\n        r9 = 0x0000000000000000\n       r10 = 0x0000000000000001\n       r11 = 0x0000000100700000\n       r12 = 0x0000000000000000\n       r13 = 0x0000000000000000\n       r14 = 0x0000000000000000\n       r15 = 0x0000000000000000\n       rip = 0x0000000100001837  mruby`ary_modify + 55\n    rflags = 0x0000000000010206\n        cs = 0x000000000000002b\n        fs = 0x0000000000000000\n        gs = 0x0000000000000000\n\n(lldb) q\nQuitting LLDB will kill one or more processes. Do you really want to proceed: [Y/n] y\n\n```\n\nI took a look at the cause in the codegeneration, ... and gave up. But in the `src/array.c` I could fix these two issues with one patch, as follows:\n\n```\ndiff --git a/src/array.c b/src/array.c\nindex 5a319d8..4814968 100644\n--- a/src/array.c\n+++ b/src/array.c\n@@ -259,6 +259,15 @@ ary_concat(mrb_state *mrb, struct RArray *a, mrb_value *ptr, mrb_int blen)\n MRB_API void\n mrb_ary_concat(mrb_state *mrb, mrb_value self, mrb_value other)\n {\n+  if (!mrb_array_p(self)) {\n+    mrb_raisef(mrb, E_TYPE_ERROR, \"expecting Array, got %S\", mrb_obj_value(mrb_obj_class(mrb, self)));\n+    return;\n+  }\n+  if (!mrb_array_p(other)) {\n+    mrb_raisef(mrb, E_TYPE_ERROR, \"expecting Array, got %S\", mrb_obj_value(mrb_obj_class(mrb, other)));\n+    return;\n+  }\n+\n   struct RArray *a2 = mrb_ary_ptr(other);\n \n   ary_concat(mrb, mrb_ary_ptr(self), a2-\u003eptr, a2-\u003elen);\n```\n\nAs mentioned above, both these files affect mruby-engine as well:\n\n```\n./bin/sandbox:20: [BUG] Segmentation fault at 0x00000000000019\nruby 2.3.0p0 (2015-12-25 revision 53290) [x86_64-darwin15]\n\n-- Crash Report log information --------------------------------------------\n   See Crash Report log file under the one of following:\n     * ~/Library/Logs/CrashReporter\n     * /Library/Logs/CrashReporter\n     * ~/Library/Logs/DiagnosticReports\n     * /Library/Logs/DiagnosticReports\n   for more details.\nDon't forget to include the above Crash Report log file in bug reports.\n\n-- Control frame information -----------------------------------------------\nc:0003 p:---- s:0010 e:000009 CFUNC  :sandbox_eval\nc:0002 p:0201 s:0005 E:0006b8 EVAL   ./bin/sandbox:20 [FINISH]\nc:0001 p:0000 s:0002 E:002310 (none) [FINISH]\n\n-- Ruby level backtrace information ----------------------------------------\n./bin/sandbox:20:in `\u003cmain\u003e'\n./bin/sandbox:20:in `sandbox_eval'\n\n-- Machine register context ------------------------------------------------\n rax: 0x000000011061c3f0 rbx: 0x0000000110674668 rcx: 0x0000000000000004\n rdx: 0x000000011061c3f0 rdi: 0x0000000110614440 rsi: 0x0000000000000001\n rbp: 0x00007fff50037f40 rsp: 0x00007fff50037f10  r8: 0x0000000000000003\n  r9: 0x0000000000000000 r10: 0x0000000000000000 r11: 0x00000001106145a8\n r12: 0x00000001106145a8 r13: 0x000000011063b2f0 r14: 0x0000000000000001\n r15: 0x0000000000000001 rip: 0x00000001104f233d rfl: 0x0000000000010246\n\n-- C level backtrace information -------------------------------------------\n0   ruby                                0x000000010fd645d4 rb_vm_bugreport + 388\n1   ruby                                0x000000010fc06023 rb_bug_context + 483\n2   ruby                                0x000000010fcd9653 sigsegv + 83\n3   libsystem_platform.dylib            0x00007fff9826d52a _sigtramp + 26\n4   mruby_engine.bundle                 0x00000001104f233d mrb_ary_concat + 29\n5   ???                                 0x0000000110614440 0x0 + 4569777216\n\n-- Other runtime information -----------------------------------------------\n\n* Loaded script: ./bin/sandbox\n\n* Loaded features:\n\n    0 enumerator.so\n    1 thread.rb\n    2 rational.so\n    3 complex.so\n\u003csnip various gems\u003e\n  185 /Users/\u003csnip\u003e/mruby-engine/lib/mruby_engine/mruby_engine.bundle\n  186 /Users/\u003csnip\u003e/mruby-engine/lib/mruby_engine.rb\n\n[NOTE]\nYou may have encountered a bug in the Ruby interpreter or extension libraries.\nBug reports are welcome.\nFor details: http://www.ruby-lang.org/bugreport.html\n\n```\n\nThe second file produced same backtrace, but different register values.\n\nAfter applying that patch to `ext/mruby_engine/mruby` and recompiling, these two files no longer crash.\n\nIf you end up finding a better patch elsewhere for the root cause, can you let me know what you end up applying so I can change what I fuzz against?\n\nCheers,\n\nHugh","vulnerability_information_html":"\u003cp\u003eHi,\u003c/p\u003e\n\n\u003cp\u003eThe following file causes a segmentation fault in mruby, which also causes a segmentation fault in mruby-engine. I\u0026#39;ve minimized this file down to the bare bones what crashes it, then renamed variables and tidied so you can see what is needed and what isn\u0026#39;t.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003ecase \u0026quot;\u0026quot;\n  when 0\nend\nx *case\n  when true\n    * = 0\nend\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eAlso this file causes the same issue:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003ecase \u0026quot;\u0026quot;\n  when 0\nend\nx = *case\n  when 0\n    * = 0\nend\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eDifference between the two is one is a method call, and one is assignment.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e$ ./dev/bin/mruby --version\nmruby 1.2.0 (2015-11-17)\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e$ ./dev/bin/mruby crash-1.rb\ncrash-1.rb:4:3: \u0026#39;*\u0026#39; interpreted as argument prefix\nSegmentation fault: 11\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e$ lldb ./dev/bin/mruby crash-1.rb\n(lldb) target create \u0026quot;./dev/bin/mruby\u0026quot;\nCurrent executable set to \u0026#39;./dev/bin/mruby\u0026#39; (x86_64).\n(lldb) settings set -- target.run-args  \u0026quot;crash-1.rb\u0026quot;\n(lldb) r\nProcess 54552 launched: \u0026#39;./dev/bin/mruby\u0026#39; (x86_64)\ncrash-1.rb:4:3: \u0026#39;*\u0026#39; interpreted as argument prefix\nProcess 54552 stopped\n* thread #1: tid = 0x652cabc, 0x0000000100001837 mruby`ary_modify + 55, queue = \u0026#39;com.apple.main-thread\u0026#39;, stop reason = EXC_BAD_ACCESS (code=1, address=0x4800000019)\n    frame #0: 0x0000000100001837 mruby`ary_modify + 55\nmruby`ary_modify:\n-\u0026gt;  0x100001837 \u0026lt;+55\u0026gt;: cmpl   $0x1, (%rax)\n    0x10000183a \u0026lt;+58\u0026gt;: jne    0x100001889               ; \u0026lt;+137\u0026gt;\n    0x100001840 \u0026lt;+64\u0026gt;: movq   -0x10(%rbp), %rax\n    0x100001844 \u0026lt;+68\u0026gt;: movq   0x28(%rax), %rax\n(lldb) bt\n* thread #1: tid = 0x652cabc, 0x0000000100001837 mruby`ary_modify + 55, queue = \u0026#39;com.apple.main-thread\u0026#39;, stop reason = EXC_BAD_ACCESS (code=1, address=0x4800000019)\n  * frame #0: 0x0000000100001837 mruby`ary_modify + 55\n    frame #1: 0x0000000100001ca1 mruby`ary_concat + 49\n    frame #2: 0x0000000100001c66 mruby`mrb_ary_concat + 70\n    frame #3: 0x000000010004263f mruby`mrb_vm_exec + 25439\n    frame #4: 0x000000010003c2c7 mruby`mrb_vm_run + 135\n    frame #5: 0x00000001000446b4 mruby`mrb_top_run + 100\n    frame #6: 0x000000010006f19f mruby`load_exec + 1183\n    frame #7: 0x000000010006ece3 mruby`mrb_load_file_cxt + 67\n    frame #8: 0x0000000100000d78 mruby`main + 904\n    frame #9: 0x00007fff8a9db5ad libdyld.dylib`start + 1\n    frame #10: 0x00007fff8a9db5ad libdyld.dylib`start + 1\n(lldb) register read\nGeneral Purpose Registers:\n       rax = 0x0000004800000019\n       rbx = 0x0000000000000000\n       rcx = 0x0000000000200086\n       rdx = 0x0000000100000000  mruby`_mh_execute_header\n       rdi = 0x00000001002029f0\n       rsi = 0x0000000100000000  mruby`_mh_execute_header\n       rbp = 0x00007fff5fbfc9d0\n       rsp = 0x00007fff5fbfc9a0\n        r8 = 0x0000000000000001\n        r9 = 0x0000000000000000\n       r10 = 0x0000000000000001\n       r11 = 0x0000000100200000\n       r12 = 0x0000000000000000\n       r13 = 0x0000000000000000\n       r14 = 0x0000000000000000\n       r15 = 0x0000000000000000\n       rip = 0x0000000100001837  mruby`ary_modify + 55\n    rflags = 0x0000000000010206\n        cs = 0x000000000000002b\n        fs = 0x0000000000000000\n        gs = 0x0000000000000000\n\n(lldb) q\nQuitting LLDB will kill one or more processes. Do you really want to proceed: [Y/n] y\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eand the second file:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e$ ./dev/bin/mruby crash-2.rb\nSegmentation fault: 11\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e$ lldb ./dev/bin/mruby crash-2.rb\n(lldb) target create \u0026quot;./dev/bin/mruby\u0026quot;\nCurrent executable set to \u0026#39;./dev/bin/mruby\u0026#39; (x86_64).\n(lldb) settings set -- target.run-args  \u0026quot;crash-2.rb\u0026quot;\n(lldb) r\nProcess 66755 launched: \u0026#39;./dev/bin/mruby\u0026#39; (x86_64)\nProcess 66755 stopped\n* thread #1: tid = 0x652fc10, 0x0000000100001837 mruby`ary_modify + 55, queue = \u0026#39;com.apple.main-thread\u0026#39;, stop reason = EXC_BAD_ACCESS (code=1, address=0x4800000019)\n    frame #0: 0x0000000100001837 mruby`ary_modify + 55\nmruby`ary_modify:\n-\u0026gt;  0x100001837 \u0026lt;+55\u0026gt;: cmpl   $0x1, (%rax)\n    0x10000183a \u0026lt;+58\u0026gt;: jne    0x100001889               ; \u0026lt;+137\u0026gt;\n    0x100001840 \u0026lt;+64\u0026gt;: movq   -0x10(%rbp), %rax\n    0x100001844 \u0026lt;+68\u0026gt;: movq   0x28(%rax), %rax\n(lldb) bt\n* thread #1: tid = 0x652fc10, 0x0000000100001837 mruby`ary_modify + 55, queue = \u0026#39;com.apple.main-thread\u0026#39;, stop reason = EXC_BAD_ACCESS (code=1, address=0x4800000019)\n  * frame #0: 0x0000000100001837 mruby`ary_modify + 55\n    frame #1: 0x0000000100001ca1 mruby`ary_concat + 49\n    frame #2: 0x0000000100001c66 mruby`mrb_ary_concat + 70\n    frame #3: 0x000000010004263f mruby`mrb_vm_exec + 25439\n    frame #4: 0x000000010003c2c7 mruby`mrb_vm_run + 135\n    frame #5: 0x00000001000446b4 mruby`mrb_top_run + 100\n    frame #6: 0x000000010006f19f mruby`load_exec + 1183\n    frame #7: 0x000000010006ece3 mruby`mrb_load_file_cxt + 67\n    frame #8: 0x0000000100000d78 mruby`main + 904\n    frame #9: 0x00007fff8a9db5ad libdyld.dylib`start + 1\n    frame #10: 0x00007fff8a9db5ad libdyld.dylib`start + 1\n(lldb) register read\nGeneral Purpose Registers:\n       rax = 0x0000004800000019\n       rbx = 0x0000000000000000\n       rcx = 0x0000000000200086\n       rdx = 0x0000000100000000  mruby`_mh_execute_header\n       rdi = 0x00000001002029f0\n       rsi = 0x0000000100000000  mruby`_mh_execute_header\n       rbp = 0x00007fff5fbfc9d0\n       rsp = 0x00007fff5fbfc9a0\n        r8 = 0x0000000000000001\n        r9 = 0x0000000000000000\n       r10 = 0x0000000000000001\n       r11 = 0x0000000100700000\n       r12 = 0x0000000000000000\n       r13 = 0x0000000000000000\n       r14 = 0x0000000000000000\n       r15 = 0x0000000000000000\n       rip = 0x0000000100001837  mruby`ary_modify + 55\n    rflags = 0x0000000000010206\n        cs = 0x000000000000002b\n        fs = 0x0000000000000000\n        gs = 0x0000000000000000\n\n(lldb) q\nQuitting LLDB will kill one or more processes. Do you really want to proceed: [Y/n] y\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eI took a look at the cause in the codegeneration, ... and gave up. But in the \u003ccode\u003esrc/array.c\u003c/code\u003e I could fix these two issues with one patch, as follows:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight diff\"\u003e\u003ccode\u003e\u003cspan class=\"gh\"\u003ediff --git a/src/array.c b/src/array.c\nindex 5a319d8..4814968 100644\n\u003c/span\u003e\u003cspan class=\"gd\"\u003e--- a/src/array.c\n\u003c/span\u003e\u003cspan class=\"gi\"\u003e+++ b/src/array.c\n\u003c/span\u003e\u003cspan class=\"p\"\u003e@@ -259,6 +259,15 @@\u003c/span\u003e ary_concat(mrb_state *mrb, struct RArray *a, mrb_value *ptr, mrb_int blen)\n MRB_API void\n mrb_ary_concat(mrb_state *mrb, mrb_value self, mrb_value other)\n {\n\u003cspan class=\"gi\"\u003e+  if (!mrb_array_p(self)) {\n+    mrb_raisef(mrb, E_TYPE_ERROR, \u0026quot;expecting Array, got %S\u0026quot;, mrb_obj_value(mrb_obj_class(mrb, self)));\n+    return;\n+  }\n+  if (!mrb_array_p(other)) {\n+    mrb_raisef(mrb, E_TYPE_ERROR, \u0026quot;expecting Array, got %S\u0026quot;, mrb_obj_value(mrb_obj_class(mrb, other)));\n+    return;\n+  }\n+\n\u003c/span\u003e   struct RArray *a2 = mrb_ary_ptr(other);\n\n   ary_concat(mrb, mrb_ary_ptr(self), a2-\u0026gt;ptr, a2-\u0026gt;len);\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eAs mentioned above, both these files affect mruby-engine as well:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e./bin/sandbox:20: [BUG] Segmentation fault at 0x00000000000019\nruby 2.3.0p0 (2015-12-25 revision 53290) [x86_64-darwin15]\n\n-- Crash Report log information --------------------------------------------\n   See Crash Report log file under the one of following:\n     * ~/Library/Logs/CrashReporter\n     * /Library/Logs/CrashReporter\n     * ~/Library/Logs/DiagnosticReports\n     * /Library/Logs/DiagnosticReports\n   for more details.\nDon\u0026#39;t forget to include the above Crash Report log file in bug reports.\n\n-- Control frame information -----------------------------------------------\nc:0003 p:---- s:0010 e:000009 CFUNC  :sandbox_eval\nc:0002 p:0201 s:0005 E:0006b8 EVAL   ./bin/sandbox:20 [FINISH]\nc:0001 p:0000 s:0002 E:002310 (none) [FINISH]\n\n-- Ruby level backtrace information ----------------------------------------\n./bin/sandbox:20:in `\u0026lt;main\u0026gt;\u0026#39;\n./bin/sandbox:20:in `sandbox_eval\u0026#39;\n\n-- Machine register context ------------------------------------------------\n rax: 0x000000011061c3f0 rbx: 0x0000000110674668 rcx: 0x0000000000000004\n rdx: 0x000000011061c3f0 rdi: 0x0000000110614440 rsi: 0x0000000000000001\n rbp: 0x00007fff50037f40 rsp: 0x00007fff50037f10  r8: 0x0000000000000003\n  r9: 0x0000000000000000 r10: 0x0000000000000000 r11: 0x00000001106145a8\n r12: 0x00000001106145a8 r13: 0x000000011063b2f0 r14: 0x0000000000000001\n r15: 0x0000000000000001 rip: 0x00000001104f233d rfl: 0x0000000000010246\n\n-- C level backtrace information -------------------------------------------\n0   ruby                                0x000000010fd645d4 rb_vm_bugreport + 388\n1   ruby                                0x000000010fc06023 rb_bug_context + 483\n2   ruby                                0x000000010fcd9653 sigsegv + 83\n3   libsystem_platform.dylib            0x00007fff9826d52a _sigtramp + 26\n4   mruby_engine.bundle                 0x00000001104f233d mrb_ary_concat + 29\n5   ???                                 0x0000000110614440 0x0 + 4569777216\n\n-- Other runtime information -----------------------------------------------\n\n* Loaded script: ./bin/sandbox\n\n* Loaded features:\n\n    0 enumerator.so\n    1 thread.rb\n    2 rational.so\n    3 complex.so\n\u0026lt;snip various gems\u0026gt;\n  185 /Users/\u0026lt;snip\u0026gt;/mruby-engine/lib/mruby_engine/mruby_engine.bundle\n  186 /Users/\u0026lt;snip\u0026gt;/mruby-engine/lib/mruby_engine.rb\n\n[NOTE]\nYou may have encountered a bug in the Ruby interpreter or extension libraries.\nBug reports are welcome.\nFor details: http://www.ruby-lang.org/bugreport.html\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThe second file produced same backtrace, but different register values.\u003c/p\u003e\n\n\u003cp\u003eAfter applying that patch to \u003ccode\u003eext/mruby_engine/mruby\u003c/code\u003e and recompiling, these two files no longer crash.\u003c/p\u003e\n\n\u003cp\u003eIf you end up finding a better patch elsewhere for the root cause, can you let me know what you end up applying so I can change what I fuzz against?\u003c/p\u003e\n\n\u003cp\u003eCheers,\u003c/p\u003e\n\n\u003cp\u003eHugh\u003c/p\u003e\n","bounty_amount":"8000.0","formatted_bounty":"$8,000","weakness":{"id":48,"name":"Denial of Service"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2017-01-15T20:24:00.266Z","allow_singular_disclosure_after":-124705388.6755387,"singular_disclosure_allowed":true,"vote_count":9,"voters":["madrobot","eveeez","c1231665","linkks","japz","spetr0x","callibrator","no-longer-with-company","xcom"],"severity":{"rating":"high","author_type":"Team"},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":1316891,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Attached the two crash files, and the potential patch to fix.","markdown_message":"\u003cp\u003eAttached the two crash files, and the potential patch to fix.\u003c/p\u003e\n","automated_response":false,"created_at":"2016-11-24T04:36:24.373Z","updated_at":"2016-11-24T04:36:24.373Z","actor":{"username":"haquaman","cleared":false,"url":"/haquaman","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/017/646/07cbfc394d4d3432eb95cf9735f225ea803090bb_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"attachments":[{"id":136645,"filename":"crash-184712-2.rb","type":"text/x-c++","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/136/645/701c0bdb501b8a987c56844701b6d76f69a67df3/crash-184712-2.rb?response-content-disposition=attachment%3B%20filename%3D%22crash-184712-2.rb%22%3B%20filename%2A%3DUTF-8%27%27crash-184712-2.rb\u0026response-content-type=text%2Fx-c%2B%2B\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQ6J7UOFHP%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T044708Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJn%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQDamJ7YR2N3cIBOa8zjuSmUd9OCX8zCykCDx%2B6kH2J%2BlQIhAPFk51DuoGb47ygm%2F46VUWXIRiNzzPuAJCxpuNY6C9r8KrQDCFIQARoMMDEzNjE5Mjc0ODQ5IgwfJ9Wm2OgZB0TD5wEqkQMAyHxawucw3AMqEaVZmpdf%2FWoK6P8gu%2FCj%2FoC7vu86houcl7d5S1aesU3sbrOzgm6RSEhwz%2FFS3jL7D6T4JI4Ce1ND%2FrgO0lyXrQzDIcV61dzQW3FvNLr0ZImyyUdtac%2BXOj%2B4Yuxg3B%2Fw8%2FASrjXwhjBS66Kymk3L6dUfBdgwlGyaWjSrEj7pUe4QmHItRfpiYrIugF6V0YbiwTzCRnupZGkhFUvdnKltp%2B4hMIJ8ZpZXjRaPMFGYbJODmmGmpbXrkLNmtpD9ssAfsLLmMNbkAbfGTVhz1jb8jNtS70QChWZUcaVF%2BUJ%2BnjyviI%2BzOI3PvJo6%2BFF7nuwLNAutvngzDIQqSSVMoO%2F3MB45%2Bi7mOnnapSDDsV974XkQgCuM7vsb5p2hLCxzrxps5NEHGajQr5tkHe3qivszLUiVfsV43w8FYD%2BBONxEK7W9P8Fz8NZ67SyH7GG2ksQHMqmv0OcEaprPoRqnV3X2FUQMilKfrm8Mwo6y2b3BolwJdahB%2FiN%2B4DEDiSex%2FihlgZtj7Y4SxDDk%2FKn%2FBTrqAf559VpL8gNLdFBoVG3N%2FZOK1jnsPcfoIUSZtPAKUZCx%2FfYM8b4F5pg%2FUgEn1Lv%2B2LBdmNBasw6RmzajA5OSfdAMndyjJN9XxpB%2BQCxuWhR%2B4l3UYvcHCs0ptmeXrxe03i6oCQg6cNND1wBmViOKSrRB7ycvKEbOUFZtkHoRDVaID3Z%2BuOzyOMaLFXSvzsVsAcCFgFhIk5QJcY%2B1scZVna72pH8jnKw%2FwC1cIv1j%2FAmz0zBabFT7deSC5tUMl0pZQVYKiEGsgryYN9fSfaoMv2wR80e4kst1hVdlJHDktel9plUkLBliVB9%2BDQ%3D%3D\u0026X-Amz-Signature=76c1f3a11f4cb9ace82ce40b6be3ee74bcdfd200e3aa47ee0b1615699c1340b1"},{"id":136644,"filename":"bug-184712.patch","type":"text/x-diff","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/136/644/d1de0f8c0686d6d94551e8f34754bd464ed0066e/bug-184712.patch?response-content-disposition=attachment%3B%20filename%3D%22bug-184712.patch%22%3B%20filename%2A%3DUTF-8%27%27bug-184712.patch\u0026response-content-type=text%2Fx-diff\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQ6J7UOFHP%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T044708Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJn%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQDamJ7YR2N3cIBOa8zjuSmUd9OCX8zCykCDx%2B6kH2J%2BlQIhAPFk51DuoGb47ygm%2F46VUWXIRiNzzPuAJCxpuNY6C9r8KrQDCFIQARoMMDEzNjE5Mjc0ODQ5IgwfJ9Wm2OgZB0TD5wEqkQMAyHxawucw3AMqEaVZmpdf%2FWoK6P8gu%2FCj%2FoC7vu86houcl7d5S1aesU3sbrOzgm6RSEhwz%2FFS3jL7D6T4JI4Ce1ND%2FrgO0lyXrQzDIcV61dzQW3FvNLr0ZImyyUdtac%2BXOj%2B4Yuxg3B%2Fw8%2FASrjXwhjBS66Kymk3L6dUfBdgwlGyaWjSrEj7pUe4QmHItRfpiYrIugF6V0YbiwTzCRnupZGkhFUvdnKltp%2B4hMIJ8ZpZXjRaPMFGYbJODmmGmpbXrkLNmtpD9ssAfsLLmMNbkAbfGTVhz1jb8jNtS70QChWZUcaVF%2BUJ%2BnjyviI%2BzOI3PvJo6%2BFF7nuwLNAutvngzDIQqSSVMoO%2F3MB45%2Bi7mOnnapSDDsV974XkQgCuM7vsb5p2hLCxzrxps5NEHGajQr5tkHe3qivszLUiVfsV43w8FYD%2BBONxEK7W9P8Fz8NZ67SyH7GG2ksQHMqmv0OcEaprPoRqnV3X2FUQMilKfrm8Mwo6y2b3BolwJdahB%2FiN%2B4DEDiSex%2FihlgZtj7Y4SxDDk%2FKn%2FBTrqAf559VpL8gNLdFBoVG3N%2FZOK1jnsPcfoIUSZtPAKUZCx%2FfYM8b4F5pg%2FUgEn1Lv%2B2LBdmNBasw6RmzajA5OSfdAMndyjJN9XxpB%2BQCxuWhR%2B4l3UYvcHCs0ptmeXrxe03i6oCQg6cNND1wBmViOKSrRB7ycvKEbOUFZtkHoRDVaID3Z%2BuOzyOMaLFXSvzsVsAcCFgFhIk5QJcY%2B1scZVna72pH8jnKw%2FwC1cIv1j%2FAmz0zBabFT7deSC5tUMl0pZQVYKiEGsgryYN9fSfaoMv2wR80e4kst1hVdlJHDktel9plUkLBliVB9%2BDQ%3D%3D\u0026X-Amz-Signature=fad1c1cb979c1bfc07460ef7e5abf907989121c51bc0958293f2e4de50ea48ee"},{"id":136643,"filename":"crash-184712-1.rb","type":"text/plain","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/136/643/e4c8f8cf454989f5519421bc266308e3a861ee86/crash-184712-1.rb?response-content-disposition=attachment%3B%20filename%3D%22crash-184712-1.rb%22%3B%20filename%2A%3DUTF-8%27%27crash-184712-1.rb\u0026response-content-type=text%2Fplain\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQ6J7UOFHP%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T044708Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJn%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQDamJ7YR2N3cIBOa8zjuSmUd9OCX8zCykCDx%2B6kH2J%2BlQIhAPFk51DuoGb47ygm%2F46VUWXIRiNzzPuAJCxpuNY6C9r8KrQDCFIQARoMMDEzNjE5Mjc0ODQ5IgwfJ9Wm2OgZB0TD5wEqkQMAyHxawucw3AMqEaVZmpdf%2FWoK6P8gu%2FCj%2FoC7vu86houcl7d5S1aesU3sbrOzgm6RSEhwz%2FFS3jL7D6T4JI4Ce1ND%2FrgO0lyXrQzDIcV61dzQW3FvNLr0ZImyyUdtac%2BXOj%2B4Yuxg3B%2Fw8%2FASrjXwhjBS66Kymk3L6dUfBdgwlGyaWjSrEj7pUe4QmHItRfpiYrIugF6V0YbiwTzCRnupZGkhFUvdnKltp%2B4hMIJ8ZpZXjRaPMFGYbJODmmGmpbXrkLNmtpD9ssAfsLLmMNbkAbfGTVhz1jb8jNtS70QChWZUcaVF%2BUJ%2BnjyviI%2BzOI3PvJo6%2BFF7nuwLNAutvngzDIQqSSVMoO%2F3MB45%2Bi7mOnnapSDDsV974XkQgCuM7vsb5p2hLCxzrxps5NEHGajQr5tkHe3qivszLUiVfsV43w8FYD%2BBONxEK7W9P8Fz8NZ67SyH7GG2ksQHMqmv0OcEaprPoRqnV3X2FUQMilKfrm8Mwo6y2b3BolwJdahB%2FiN%2B4DEDiSex%2FihlgZtj7Y4SxDDk%2FKn%2FBTrqAf559VpL8gNLdFBoVG3N%2FZOK1jnsPcfoIUSZtPAKUZCx%2FfYM8b4F5pg%2FUgEn1Lv%2B2LBdmNBasw6RmzajA5OSfdAMndyjJN9XxpB%2BQCxuWhR%2B4l3UYvcHCs0ptmeXrxe03i6oCQg6cNND1wBmViOKSrRB7ycvKEbOUFZtkHoRDVaID3Z%2BuOzyOMaLFXSvzsVsAcCFgFhIk5QJcY%2B1scZVna72pH8jnKw%2FwC1cIv1j%2FAmz0zBabFT7deSC5tUMl0pZQVYKiEGsgryYN9fSfaoMv2wR80e4kst1hVdlJHDktel9plUkLBliVB9%2BDQ%3D%3D\u0026X-Amz-Signature=532dff9f0820568b8c503022a790d8aaff72a48eb0d136a03e3ddf9d1a712063"}],"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1316893,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Whoops, wrong crash file for -2.rb, this one instead.","markdown_message":"\u003cp\u003eWhoops, wrong crash file for -2.rb, this one instead.\u003c/p\u003e\n","automated_response":false,"created_at":"2016-11-24T04:37:28.166Z","updated_at":"2016-11-24T04:37:28.166Z","actor":{"username":"haquaman","cleared":false,"url":"/haquaman","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/017/646/07cbfc394d4d3432eb95cf9735f225ea803090bb_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"attachments":[{"id":136646,"filename":"crash-184712-2.rb","type":"text/plain","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/136/646/ea80f421201e5678de84b2429c8b33dd4159daad/crash-184712-2.rb?response-content-disposition=attachment%3B%20filename%3D%22crash-184712-2.rb%22%3B%20filename%2A%3DUTF-8%27%27crash-184712-2.rb\u0026response-content-type=text%2Fplain\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQ6J7UOFHP%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T044709Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJn%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQDamJ7YR2N3cIBOa8zjuSmUd9OCX8zCykCDx%2B6kH2J%2BlQIhAPFk51DuoGb47ygm%2F46VUWXIRiNzzPuAJCxpuNY6C9r8KrQDCFIQARoMMDEzNjE5Mjc0ODQ5IgwfJ9Wm2OgZB0TD5wEqkQMAyHxawucw3AMqEaVZmpdf%2FWoK6P8gu%2FCj%2FoC7vu86houcl7d5S1aesU3sbrOzgm6RSEhwz%2FFS3jL7D6T4JI4Ce1ND%2FrgO0lyXrQzDIcV61dzQW3FvNLr0ZImyyUdtac%2BXOj%2B4Yuxg3B%2Fw8%2FASrjXwhjBS66Kymk3L6dUfBdgwlGyaWjSrEj7pUe4QmHItRfpiYrIugF6V0YbiwTzCRnupZGkhFUvdnKltp%2B4hMIJ8ZpZXjRaPMFGYbJODmmGmpbXrkLNmtpD9ssAfsLLmMNbkAbfGTVhz1jb8jNtS70QChWZUcaVF%2BUJ%2BnjyviI%2BzOI3PvJo6%2BFF7nuwLNAutvngzDIQqSSVMoO%2F3MB45%2Bi7mOnnapSDDsV974XkQgCuM7vsb5p2hLCxzrxps5NEHGajQr5tkHe3qivszLUiVfsV43w8FYD%2BBONxEK7W9P8Fz8NZ67SyH7GG2ksQHMqmv0OcEaprPoRqnV3X2FUQMilKfrm8Mwo6y2b3BolwJdahB%2FiN%2B4DEDiSex%2FihlgZtj7Y4SxDDk%2FKn%2FBTrqAf559VpL8gNLdFBoVG3N%2FZOK1jnsPcfoIUSZtPAKUZCx%2FfYM8b4F5pg%2FUgEn1Lv%2B2LBdmNBasw6RmzajA5OSfdAMndyjJN9XxpB%2BQCxuWhR%2B4l3UYvcHCs0ptmeXrxe03i6oCQg6cNND1wBmViOKSrRB7ycvKEbOUFZtkHoRDVaID3Z%2BuOzyOMaLFXSvzsVsAcCFgFhIk5QJcY%2B1scZVna72pH8jnKw%2FwC1cIv1j%2FAmz0zBabFT7deSC5tUMl0pZQVYKiEGsgryYN9fSfaoMv2wR80e4kst1hVdlJHDktel9plUkLBliVB9%2BDQ%3D%3D\u0026X-Amz-Signature=27b16295b84861f00572fb8db43b07446bd7af5dbbcf7017eeda771839b3bf6d"}],"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1318281,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Thank you for your report. We've reproduced the issue, and our engineering team is investigating.","markdown_message":"\u003cp\u003eThank you for your report. We\u0026#39;ve reproduced the issue, and our engineering team is investigating.\u003c/p\u003e\n","automated_response":false,"created_at":"2016-11-24T19:29:18.530Z","updated_at":"2016-11-24T19:29:18.530Z","actor":{"username":"clayton","cleared":false,"url":"/clayton","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/YKjJrQvn996bd2n67ELXwtHt/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1318282,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","markdown_message":"","automated_response":false,"created_at":"2016-11-24T19:29:24.884Z","updated_at":"2016-11-24T19:29:24.884Z","additional_data":{"old_severity":null,"new_severity":"High","old_severity_id":null,"new_severity_id":9072},"actor":{"username":"clayton","cleared":false,"url":"/clayton","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/YKjJrQvn996bd2n67ELXwtHt/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1319993,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Hi @haquaman, thanks again for reporting this issue! We've pushed a fix for this issue to our production environment.\n\nI'm marking this issue as resolved now but we still need to fix this bug upstream before we can assess the impact \u0026 determine a final bounty amount. This may take a few weeks since we received a large number of valid issues and we want to calibrate our payouts across all of them.","markdown_message":"\u003cp\u003eHi \u003ca href=\"/haquaman\"\u003e@haquaman\u003c/a\u003e, thanks again for reporting this issue! We\u0026#39;ve pushed a fix for this issue to our production environment.\u003c/p\u003e\n\n\u003cp\u003eI\u0026#39;m marking this issue as resolved now but we still need to fix this bug upstream before we can assess the impact \u0026amp; determine a final bounty amount. This may take a few weeks since we received a large number of valid issues and we want to calibrate our payouts across all of them.\u003c/p\u003e\n","automated_response":false,"created_at":"2016-11-25T22:03:04.864Z","updated_at":"2016-11-25T22:03:04.864Z","actor":{"username":"francoischagnon","cleared":false,"url":"/francoischagnon","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/019/168/5d577fe97283a5483331257b629b6287ed4d287b_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"haquaman","url":"/haquaman"},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1320292,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Cool thanks","markdown_message":"\u003cp\u003eCool thanks\u003c/p\u003e\n","automated_response":false,"created_at":"2016-11-26T02:52:51.911Z","updated_at":"2016-11-26T02:52:51.911Z","actor":{"username":"haquaman","cleared":false,"url":"/haquaman","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/017/646/07cbfc394d4d3432eb95cf9735f225ea803090bb_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1323419,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi Francois. Would you be able to share the patch you've applied?\n\nCheers,\n\nHugh","markdown_message":"\u003cp\u003eHi Francois. Would you be able to share the patch you\u0026#39;ve applied?\u003c/p\u003e\n\n\u003cp\u003eCheers,\u003c/p\u003e\n\n\u003cp\u003eHugh\u003c/p\u003e\n","automated_response":false,"created_at":"2016-11-28T17:11:16.987Z","updated_at":"2016-11-28T17:11:16.987Z","actor":{"username":"haquaman","cleared":false,"url":"/haquaman","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/017/646/07cbfc394d4d3432eb95cf9735f225ea803090bb_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1323476,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"here it is:\n\n```patch\nFrom 9f877dcdce33d336224d71754463b799acb42bbd Mon Sep 17 00:00:00 2001\nFrom: Bouke van der Bijl \u003cboukevanderbijl@gmail.com\u003e\nDate: Thu, 24 Nov 2016 13:31:47 -0500\nSubject: [PATCH] Fix segfault when using result of rest assignment\n\nReported by https://hackerone.com/haquaman\n---\n mrbgems/mruby-compiler/core/codegen.c | 4 +++-\n test/t/codegen.rb                     | 9 +++++++++\n 2 files changed, 12 insertions(+), 1 deletion(-)\n\ndiff --git a/mrbgems/mruby-compiler/core/codegen.c b/mrbgems/mruby-compiler/core/codegen.c\nindex 0b870f3..89c12eb 100644\n--- a/mrbgems/mruby-compiler/core/codegen.c\n+++ b/mrbgems/mruby-compiler/core/codegen.c\n@@ -1057,7 +1057,9 @@ gen_vmassignment(codegen_scope *s, node *tree, int rhs, int val)\n         n++;\n       }\n     }\n-    push();\n+    if (!val) {\n+      push();\n+    }\n   }\n }\n \ndiff --git a/test/t/codegen.rb b/test/t/codegen.rb\nindex ad36e19..a78576a 100644\n--- a/test/t/codegen.rb\n+++ b/test/t/codegen.rb\n@@ -68,3 +68,12 @@ def method\n     A ||= break while break\n   end\n end\n+\n+assert('splat in case splat') do\n+  a = *case\n+    when 0\n+      * = 1\n+  end\n+\n+  assert_equal [1], a\n+end\n```","markdown_message":"\u003cp\u003ehere it is:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight diff\"\u003e\u003ccode\u003e\u003cspan class=\"p\"\u003eFrom 9f877dcdce33d336224d71754463b799acb42bbd Mon Sep 17 00:00:00 2001\nFrom: Bouke van der Bijl \u0026lt;boukevanderbijl@gmail.com\u0026gt;\nDate: Thu, 24 Nov 2016 13:31:47 -0500\nSubject: [PATCH] Fix segfault when using result of rest assignment\n\u003c/span\u003e\nReported by https://hackerone.com/haquaman\n\u003cspan class=\"p\"\u003e---\n\u003c/span\u003e mrbgems/mruby-compiler/core/codegen.c | 4 +++-\n test/t/codegen.rb                     | 9 +++++++++\n 2 files changed, 12 insertions(+), 1 deletion(-)\n\ndiff --git a/mrbgems/mruby-compiler/core/codegen.c b/mrbgems/mruby-compiler/core/codegen.c\n\u003cspan class=\"gh\"\u003eindex 0b870f3..89c12eb 100644\n\u003c/span\u003e\u003cspan class=\"gd\"\u003e--- a/mrbgems/mruby-compiler/core/codegen.c\n\u003c/span\u003e\u003cspan class=\"gi\"\u003e+++ b/mrbgems/mruby-compiler/core/codegen.c\n\u003c/span\u003e\u003cspan class=\"p\"\u003e@@ -1057,7 +1057,9 @@\u003c/span\u003e gen_vmassignment(codegen_scope *s, node *tree, int rhs, int val)\n         n++;\n       }\n     }\n\u003cspan class=\"gd\"\u003e-    push();\n\u003c/span\u003e\u003cspan class=\"gi\"\u003e+    if (!val) {\n+      push();\n+    }\n\u003c/span\u003e   }\n }\n\ndiff --git a/test/t/codegen.rb b/test/t/codegen.rb\n\u003cspan class=\"gh\"\u003eindex ad36e19..a78576a 100644\n\u003c/span\u003e\u003cspan class=\"gd\"\u003e--- a/test/t/codegen.rb\n\u003c/span\u003e\u003cspan class=\"gi\"\u003e+++ b/test/t/codegen.rb\n\u003c/span\u003e\u003cspan class=\"p\"\u003e@@ -68,3 +68,12 @@\u003c/span\u003e def method\n     A ||= break while break\n   end\n end\n\u003cspan class=\"gi\"\u003e+\n+assert(\u0026#39;splat in case splat\u0026#39;) do\n+  a = *case\n+    when 0\n+      * = 1\n+  end\n+\n+  assert_equal [1], a\n+end\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","automated_response":false,"created_at":"2016-11-28T17:42:51.734Z","updated_at":"2016-11-28T17:42:51.734Z","actor":{"username":"francoischagnon","cleared":false,"url":"/francoischagnon","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/019/168/5d577fe97283a5483331257b629b6287ed4d287b_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1323482,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Ta","markdown_message":"\u003cp\u003eTa\u003c/p\u003e\n","automated_response":false,"created_at":"2016-11-28T17:45:23.312Z","updated_at":"2016-11-28T17:45:23.312Z","actor":{"username":"haquaman","cleared":false,"url":"/haquaman","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/017/646/07cbfc394d4d3432eb95cf9735f225ea803090bb_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1370166,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Thanks for helping improve the security of Shopify Scripts and the mruby project!","markdown_message":"\u003cp\u003eThanks for helping improve the security of Shopify Scripts and the mruby project!\u003c/p\u003e\n","automated_response":false,"created_at":"2016-12-16T20:23:54.834Z","updated_at":"2016-12-16T20:23:54.834Z","actor":{"url":"/shopify-scripts","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/015/668/ebbe467de8ef2fc936053593e1289e30f04c3b06_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"shopify-scripts"}},"bounty_amount":"8000.0","bounty_currency":"usd","genius_execution_id":null,"team_handle":"shopify-scripts","collaborator":{"username":"haquaman","url":"/haquaman"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1370167,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2016-12-16T20:24:00.251Z","updated_at":"2016-12-16T20:24:00.251Z","first_to_agree":true,"actor":{"username":"andrewdunbar","cleared":false,"url":"/andrewdunbar","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/019/164/5b0e89675ed6dbb9df87223e9f8f58e2125bb56b_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1371649,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Hey thanks for the bounty!","markdown_message":"\u003cp\u003eHey thanks for the bounty!\u003c/p\u003e\n","automated_response":false,"created_at":"2016-12-17T20:07:10.140Z","updated_at":"2016-12-17T20:07:10.140Z","actor":{"username":"haquaman","cleared":false,"url":"/haquaman","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/017/646/07cbfc394d4d3432eb95cf9735f225ea803090bb_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1371650,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2016-12-17T20:07:10.183Z","updated_at":"2016-12-17T20:07:10.183Z","actor":{"username":"haquaman","cleared":false,"url":"/haquaman","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/017/646/07cbfc394d4d3432eb95cf9735f225ea803090bb_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}