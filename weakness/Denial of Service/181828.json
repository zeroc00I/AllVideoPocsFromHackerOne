{"id":181828,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xODE4Mjg=","url":"https://hackerone.com/reports/181828","title":"Segfault in mruby, mruby_engine and the parent MRI Ruby due to null pointer dereference","state":"Closed","substate":"resolved","severity_rating":"high","readable_substate":"Resolved","created_at":"2016-11-12T20:25:31.821Z","submitted_at":"2016-11-12T20:25:31.821Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"dkasak","url":"/dkasak","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/122/858/df3e45a00fd0f5e53ef7dc7f9b12168cbde93200_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":15668,"url":"https://hackerone.com/shopify-scripts","handle":"shopify-scripts","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/015/668/ebbe467de8ef2fc936053593e1289e30f04c3b06_original.jpg/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/015/668/ebbe467de8ef2fc936053593e1289e30f04c3b06_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"paused","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"shopify-scripts","twitter_handle":"","website":"","about":""}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2016-12-16T21:42:33.468Z","bug_reporter_agreed_on_going_public_at":"2016-12-16T21:42:33.435Z","team_member_agreed_on_going_public_at":"2016-12-16T19:49:16.674Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Introduction\n============\n\nCertain valid Ruby programs are able to cause a segmentation fault in mruby through a null pointer derefence, which in turn leads to a crash in mruby_engine and the parent MRI Ruby process.\n\nProof of concept\n================\n\ncrash.rb:\n---------\n\n    def method\n        yield\n    end\n\n    method(\u0026a \u0026\u0026= 0)\n\n1. Save the above code as crash.rb\n2. Run either:\n   a) mruby crash.rb\n   b) sandbox crash.rb\n3. Both cause a segmentation fault.\n\nDiscussion\n==========\n\nEverything below assumes the latest master of the mruby repository as of Nov 12th, which is commit `88604e39ac9c25ffdad2e3f03be26516fe866038`.\n\nThe null pointer dereference itself for the above POC happens in `ext/mruby_engine/mruby/src/vm.c`, line 1266:\n\n        regs[0] = m-\u003eenv-\u003estack[0];\n\nThe `env` member of is a null pointer since `m` refers to a `RProc *` of a non-closure lambda.\n\nThe underlying cause of the bug is an unsafe peephole optimization during code generation which isn't a valid transformation in certain contexts. Let's examine the debug information generated by running `mruby -v crash.rb`:\n\n    00001 NODE_SCOPE:\n    00005   local variables:\n    00005     a\n    00001   NODE_BEGIN:\n    00001     NODE_DEF:\n    00003       method\n    00002       NODE_BEGIN:\n    00002         NODE_YIELD:\n    00005     NODE_CALL:\n    00005       NODE_SELF\n    00005       method='method' (665)\n    00005       args:\n    00005       block:\n    00005         NODE_BLOCK_ARG:\n    00005           NODE_OP_ASGN:\n    00005             lhs:\n    00005               NODE_LVAR a\n    00005             op='\u0026\u0026' (666)\n    00005             NODE_INT 0 base 10\n    irep 0x10d5920 nregs=4 nlocals=2 pools=0 syms=1 reps=1\n    file: crash.rb\n        1 000 OP_TCLASS R2\n        1 001 OP_LAMBDA R3      I(+1)   1\n        1 002 OP_METHOD R2      :method\n        5 003 OP_LOADSELF       R2\n        5 004 OP_JMPNOT R1      007\n        5 005 OP_LOADI  R3      0\n        5 006 OP_MOVE   R1      R3              ; R1:a\n        5 007 OP_SENDB  R2      :method 0\n        5 008 OP_STOP\n\n    irep 0x10db740 nregs=3 nlocals=2 pools=0 syms=1 reps=0\n    file: crash.rb\n        1 000 OP_ENTER  0:0:0:0:0:0:0\n        2 001 OP_BLKPUSH        R2      0:0:0:0\n        2 002 OP_SEND   R2      :call   0\n        2 003 OP_RETURN R2      return\n\nFrom the above, it can be seen that R3 is set to a lambda representing the method `method` but then never re-set again in the true branch of the `JMPNOT`. Furthermore, the condition of `JMPNOT` will always be true in this particular case since `a` was never defined so the use of the \u0026\u0026= assignment operator causes it to be set to `nil`.\n\nSince a method called through `SENDB A B C` expects the passed block to be located in the register A+C+1, which is R3 in the caller's context, it is obvious the method will instead receive the lambda representing `method` instead. Since lambdas are represented as `(RProc *)`, just as blocks are, this won't cause a type error. However, this particular lambda is not a closure so its `(RProc *)` doesn't contain an `env` member and it is a null pointer.\n\nNote that the problem isn't limited to methods with blocks, as can be seen from this slightly modified example which also causes a segfault:\n\nmodified_crash.rb:\n------------------\n\n    def method(x)\n        x.call\n    end\n\n    method(a \u0026\u0026= 0)\n\nWe then investigated further to check why the code generator was producing faulty bytecode, only to find that it in fact emits a correct `MOVE R3 R1` instruction immediately after the `LOADSELF`. However, since it is then followed by an appropriately \"shaped\" `JMPNOT`, it triggers the following peephole reduction rule which elides the `MOVE`:\n\n    MOVE   R3   R1\n    JMPNOT R3    0\n    --------------\n    JMPNOT R1    0\n\nThe rule in question is located in `ext/mruby_engine/mruby/mrbgems/mruby-compiler/core/codegen.c`, line 350. In another related example where the operation `a \u0026\u0026= 0` is done outside the argument list, the bytecode is almost exactly the same, just shuffled around. However, this shuffling prevents the `MOVE` and `JMPNOT` in being adjacent, which prevents the peephole rule from triggering and results in an ordinary mruby exception:\n\nnon_crash.rb:\n-------------\n\n    def method\n        yield\n    end\n\n    a \u0026\u0026= 0\n\n    method(\u0026a)\n\nThis yields the following AST and bytecode:\n\n    00001 NODE_SCOPE:\n    00005   local variables:\n    00005     a\n    00001   NODE_BEGIN:\n    00001     NODE_DEF:\n    00003       method\n    00002       NODE_BEGIN:\n    00002         NODE_YIELD:\n    00005     NODE_OP_ASGN:\n    00005       lhs:\n    00005         NODE_LVAR a\n    00005       op='\u0026\u0026' (666)\n    00005       NODE_INT 0 base 10\n    00007     NODE_CALL:\n    00007       NODE_SELF\n    00007       method='method' (665)\n    00007       args:\n    00007       block:\n    00007         NODE_BLOCK_ARG:\n    00007           NODE_LVAR a\n    irep 0x2468920 nregs=4 nlocals=2 pools=0 syms=1 reps=1\n    file: a-new-kind-of-crash.7\n        1 000 OP_TCLASS R2\n        1 001 OP_LAMBDA R3      I(+1)   1\n        1 002 OP_METHOD R2      :method\n        5 003 OP_JMPNOT R1      005\n        5 004 OP_LOADI  R1      0               ; R1:a\n        7 005 OP_LOADSELF       R2\n        7 006 OP_MOVE   R3      R1              ; R1:a   \u003c\u003c\u003cthe MOVE isn't elided\u003e\u003e\u003e\n        7 007 OP_SENDB  R2      :method 0\n        7 008 OP_STOP\n\n    irep 0x246e740 nregs=3 nlocals=2 pools=0 syms=1 reps=0\n    file: a-new-kind-of-crash.7\n        1 000 OP_ENTER  0:0:0:0:0:0:0\n        2 001 OP_BLKPUSH        R2      0:0:0:0\n        2 002 OP_SEND   R2      :call   0\n        2 003 OP_RETURN R2      return\n\n    trace:\n            [1] a-new-kind-of-crash.7:2:in Object.method\n            [0] a-new-kind-of-crash.7:7\n    LocalJumpError: unexpected yield\n\nSolution\n========\n\nWe investigated several possible solutions, but ultimately the peephole optimization in question seems very precarious. As best as we could tell, the triggering factor seems to be an AST with a `NODE_OP_ASGN` nested inside a `NODE_CALL` (not necessarily as an immediate child). Since most of the work is done in the function `codegen` which is called recursively, there is no simple way to detect this special case without examining the AST. Therefore, presumably a flag should be set when the code generator enters a `NODE_CALL` so the peepholer knows not to make this optimization if inside it.\n\nSince with our limited knowledge of the codebase it's not obvious that this is the right solution, we decided to simply disable the optimization for now since it is relatively low impact. We supply the following patch:\n\n    diff --git a/mrbgems/mruby-compiler/core/codegen.c b/mrbgems/mruby-compiler/core/codegen.c\n    index 9b064b8..6539ed4 100644\n    --- a/mrbgems/mruby-compiler/core/codegen.c\n    +++ b/mrbgems/mruby-compiler/core/codegen.c\n    @@ -346,13 +346,6 @@ genop_peep(codegen_scope *s, mrb_code i, int val)\n            }\n        }\n        break;\n    -    case OP_JMPIF:\n    -    case OP_JMPNOT:\n    -      if (c0 == OP_MOVE \u0026\u0026 GETARG_A(i) == GETARG_A(i0)) {\n    -        s-\u003eiseq[s-\u003epc-1] = MKOP_AsBx(c1, GETARG_B(i0), GETARG_sBx(i));\n    -        return s-\u003epc-1;\n    -      }\n    -      break;\n        default:\n        break;\n        }\n\nWith the optimization disabled, the segfault no longer happens and the code passes all tests. If the mruby developers insist that this optimization should remain, we are willing to work with them to develop a fix.\n\n-- \nDenis Kasak\nDamir Jelić","vulnerability_information_html":"\u003ch1 id=\"introduction\"\u003eIntroduction\u003c/h1\u003e\n\n\u003cp\u003eCertain valid Ruby programs are able to cause a segmentation fault in mruby through a null pointer derefence, which in turn leads to a crash in mruby_engine and the parent MRI Ruby process.\u003c/p\u003e\n\n\u003ch1 id=\"proof-of-concept\"\u003eProof of concept\u003c/h1\u003e\n\n\u003ch2 id=\"crash-rb\"\u003ecrash.rb:\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003edef method\n    yield\nend\n\nmethod(\u0026amp;a \u0026amp;\u0026amp;= 0)\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003col\u003e\n\u003cli\u003eSave the above code as crash.rb\u003c/li\u003e\n\u003cli\u003eRun either:\na) mruby crash.rb\nb) sandbox crash.rb\u003c/li\u003e\n\u003cli\u003eBoth cause a segmentation fault.\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003ch1 id=\"discussion\"\u003eDiscussion\u003c/h1\u003e\n\n\u003cp\u003eEverything below assumes the latest master of the mruby repository as of Nov 12th, which is commit \u003ccode\u003e88604e39ac9c25ffdad2e3f03be26516fe866038\u003c/code\u003e.\u003c/p\u003e\n\n\u003cp\u003eThe null pointer dereference itself for the above POC happens in \u003ccode\u003eext/mruby_engine/mruby/src/vm.c\u003c/code\u003e, line 1266:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e    regs[0] = m-\u0026gt;env-\u0026gt;stack[0];\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThe \u003ccode\u003eenv\u003c/code\u003e member of is a null pointer since \u003ccode\u003em\u003c/code\u003e refers to a \u003ccode\u003eRProc *\u003c/code\u003e of a non-closure lambda.\u003c/p\u003e\n\n\u003cp\u003eThe underlying cause of the bug is an unsafe peephole optimization during code generation which isn\u0026#39;t a valid transformation in certain contexts. Let\u0026#39;s examine the debug information generated by running \u003ccode\u003emruby -v crash.rb\u003c/code\u003e:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e00001 NODE_SCOPE:\n00005   local variables:\n00005     a\n00001   NODE_BEGIN:\n00001     NODE_DEF:\n00003       method\n00002       NODE_BEGIN:\n00002         NODE_YIELD:\n00005     NODE_CALL:\n00005       NODE_SELF\n00005       method=\u0026#39;method\u0026#39; (665)\n00005       args:\n00005       block:\n00005         NODE_BLOCK_ARG:\n00005           NODE_OP_ASGN:\n00005             lhs:\n00005               NODE_LVAR a\n00005             op=\u0026#39;\u0026amp;\u0026amp;\u0026#39; (666)\n00005             NODE_INT 0 base 10\nirep 0x10d5920 nregs=4 nlocals=2 pools=0 syms=1 reps=1\nfile: crash.rb\n    1 000 OP_TCLASS R2\n    1 001 OP_LAMBDA R3      I(+1)   1\n    1 002 OP_METHOD R2      :method\n    5 003 OP_LOADSELF       R2\n    5 004 OP_JMPNOT R1      007\n    5 005 OP_LOADI  R3      0\n    5 006 OP_MOVE   R1      R3              ; R1:a\n    5 007 OP_SENDB  R2      :method 0\n    5 008 OP_STOP\n\nirep 0x10db740 nregs=3 nlocals=2 pools=0 syms=1 reps=0\nfile: crash.rb\n    1 000 OP_ENTER  0:0:0:0:0:0:0\n    2 001 OP_BLKPUSH        R2      0:0:0:0\n    2 002 OP_SEND   R2      :call   0\n    2 003 OP_RETURN R2      return\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eFrom the above, it can be seen that R3 is set to a lambda representing the method \u003ccode\u003emethod\u003c/code\u003e but then never re-set again in the true branch of the \u003ccode\u003eJMPNOT\u003c/code\u003e. Furthermore, the condition of \u003ccode\u003eJMPNOT\u003c/code\u003e will always be true in this particular case since \u003ccode\u003ea\u003c/code\u003e was never defined so the use of the \u0026amp;\u0026amp;= assignment operator causes it to be set to \u003ccode\u003enil\u003c/code\u003e.\u003c/p\u003e\n\n\u003cp\u003eSince a method called through \u003ccode\u003eSENDB A B C\u003c/code\u003e expects the passed block to be located in the register A+C+1, which is R3 in the caller\u0026#39;s context, it is obvious the method will instead receive the lambda representing \u003ccode\u003emethod\u003c/code\u003e instead. Since lambdas are represented as \u003ccode\u003e(RProc *)\u003c/code\u003e, just as blocks are, this won\u0026#39;t cause a type error. However, this particular lambda is not a closure so its \u003ccode\u003e(RProc *)\u003c/code\u003e doesn\u0026#39;t contain an \u003ccode\u003eenv\u003c/code\u003e member and it is a null pointer.\u003c/p\u003e\n\n\u003cp\u003eNote that the problem isn\u0026#39;t limited to methods with blocks, as can be seen from this slightly modified example which also causes a segfault:\u003c/p\u003e\n\n\u003ch2 id=\"modified_crash-rb\"\u003emodified_crash.rb:\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003edef method(x)\n    x.call\nend\n\nmethod(a \u0026amp;\u0026amp;= 0)\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eWe then investigated further to check why the code generator was producing faulty bytecode, only to find that it in fact emits a correct \u003ccode\u003eMOVE R3 R1\u003c/code\u003e instruction immediately after the \u003ccode\u003eLOADSELF\u003c/code\u003e. However, since it is then followed by an appropriately \u0026quot;shaped\u0026quot; \u003ccode\u003eJMPNOT\u003c/code\u003e, it triggers the following peephole reduction rule which elides the \u003ccode\u003eMOVE\u003c/code\u003e:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003eMOVE   R3   R1\nJMPNOT R3    0\n--------------\nJMPNOT R1    0\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThe rule in question is located in \u003ccode\u003eext/mruby_engine/mruby/mrbgems/mruby-compiler/core/codegen.c\u003c/code\u003e, line 350. In another related example where the operation \u003ccode\u003ea \u0026amp;\u0026amp;= 0\u003c/code\u003e is done outside the argument list, the bytecode is almost exactly the same, just shuffled around. However, this shuffling prevents the \u003ccode\u003eMOVE\u003c/code\u003e and \u003ccode\u003eJMPNOT\u003c/code\u003e in being adjacent, which prevents the peephole rule from triggering and results in an ordinary mruby exception:\u003c/p\u003e\n\n\u003ch2 id=\"non_crash-rb\"\u003enon_crash.rb:\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003edef method\n    yield\nend\n\na \u0026amp;\u0026amp;= 0\n\nmethod(\u0026amp;a)\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThis yields the following AST and bytecode:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e00001 NODE_SCOPE:\n00005   local variables:\n00005     a\n00001   NODE_BEGIN:\n00001     NODE_DEF:\n00003       method\n00002       NODE_BEGIN:\n00002         NODE_YIELD:\n00005     NODE_OP_ASGN:\n00005       lhs:\n00005         NODE_LVAR a\n00005       op=\u0026#39;\u0026amp;\u0026amp;\u0026#39; (666)\n00005       NODE_INT 0 base 10\n00007     NODE_CALL:\n00007       NODE_SELF\n00007       method=\u0026#39;method\u0026#39; (665)\n00007       args:\n00007       block:\n00007         NODE_BLOCK_ARG:\n00007           NODE_LVAR a\nirep 0x2468920 nregs=4 nlocals=2 pools=0 syms=1 reps=1\nfile: a-new-kind-of-crash.7\n    1 000 OP_TCLASS R2\n    1 001 OP_LAMBDA R3      I(+1)   1\n    1 002 OP_METHOD R2      :method\n    5 003 OP_JMPNOT R1      005\n    5 004 OP_LOADI  R1      0               ; R1:a\n    7 005 OP_LOADSELF       R2\n    7 006 OP_MOVE   R3      R1              ; R1:a   \u0026lt;\u0026lt;\u0026lt;the MOVE isn\u0026#39;t elided\u0026gt;\u0026gt;\u0026gt;\n    7 007 OP_SENDB  R2      :method 0\n    7 008 OP_STOP\n\nirep 0x246e740 nregs=3 nlocals=2 pools=0 syms=1 reps=0\nfile: a-new-kind-of-crash.7\n    1 000 OP_ENTER  0:0:0:0:0:0:0\n    2 001 OP_BLKPUSH        R2      0:0:0:0\n    2 002 OP_SEND   R2      :call   0\n    2 003 OP_RETURN R2      return\n\ntrace:\n        [1] a-new-kind-of-crash.7:2:in Object.method\n        [0] a-new-kind-of-crash.7:7\nLocalJumpError: unexpected yield\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch1 id=\"solution\"\u003eSolution\u003c/h1\u003e\n\n\u003cp\u003eWe investigated several possible solutions, but ultimately the peephole optimization in question seems very precarious. As best as we could tell, the triggering factor seems to be an AST with a \u003ccode\u003eNODE_OP_ASGN\u003c/code\u003e nested inside a \u003ccode\u003eNODE_CALL\u003c/code\u003e (not necessarily as an immediate child). Since most of the work is done in the function \u003ccode\u003ecodegen\u003c/code\u003e which is called recursively, there is no simple way to detect this special case without examining the AST. Therefore, presumably a flag should be set when the code generator enters a \u003ccode\u003eNODE_CALL\u003c/code\u003e so the peepholer knows not to make this optimization if inside it.\u003c/p\u003e\n\n\u003cp\u003eSince with our limited knowledge of the codebase it\u0026#39;s not obvious that this is the right solution, we decided to simply disable the optimization for now since it is relatively low impact. We supply the following patch:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight diff\"\u003e\u003ccode\u003e\u003cspan class=\"gh\"\u003ediff --git a/mrbgems/mruby-compiler/core/codegen.c b/mrbgems/mruby-compiler/core/codegen.c\nindex 9b064b8..6539ed4 100644\n\u003c/span\u003e\u003cspan class=\"gd\"\u003e--- a/mrbgems/mruby-compiler/core/codegen.c\n\u003c/span\u003e\u003cspan class=\"gi\"\u003e+++ b/mrbgems/mruby-compiler/core/codegen.c\n\u003c/span\u003e\u003cspan class=\"p\"\u003e@@ -346,13 +346,6 @@\u003c/span\u003e genop_peep(codegen_scope *s, mrb_code i, int val)\n        }\n    }\n    break;\n\u003cspan class=\"gd\"\u003e-    case OP_JMPIF:\n-    case OP_JMPNOT:\n-      if (c0 == OP_MOVE \u0026amp;\u0026amp; GETARG_A(i) == GETARG_A(i0)) {\n-        s-\u0026gt;iseq[s-\u0026gt;pc-1] = MKOP_AsBx(c1, GETARG_B(i0), GETARG_sBx(i));\n-        return s-\u0026gt;pc-1;\n-      }\n-      break;\n\u003c/span\u003e    default:\n    break;\n    }\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eWith the optimization disabled, the segfault no longer happens and the code passes all tests. If the mruby developers insist that this optimization should remain, we are willing to work with them to develop a fix.\u003c/p\u003e\n\n\u003cp\u003e-- \u003cbr\u003e\nDenis Kasak\u003cbr\u003e\nDamir Jelić\u003c/p\u003e\n","bounty_amount":"10000.0","formatted_bounty":"$10,000","weakness":{"id":48,"name":"Denial of Service"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":134371,"file_name":"crash.rb","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/134/371/38f1f3d1ba3438a653caecffc265292cbe5de8da/crash.rb?response-content-disposition=attachment%3B%20filename%3D%22crash.rb%22%3B%20filename%2A%3DUTF-8%27%27crash.rb\u0026response-content-type=text%2Fplain\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQW2BAZGD3%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T044544Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJz%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQDf7CC1janFXxWWF6QZ1Z6X6%2F6j0WDhv4gDyzEWu%2BScUAIhAOhgsmE64VangXFyIz5AGmDMLeT8sYG2vBQ4PwiaYS%2FZKrQDCFUQARoMMDEzNjE5Mjc0ODQ5Igy754oCq3nK3vWmRbMqkQM98qKdRlMDTd4bBwR4jJMppOWz7EU3ySwJK1geVZm7GvrSHyp8wAx03nVbAIisdh9q5SCYJs%2FJTXi%2Fsm9znfJcHgIy1DUYcyZol0zQmN4hQAlOUZZ6AJANKMjzew6Gbci4hpgZqkt7kMNinONmzU36EDiWMOc0y0LBIMMe8ckWdal2vM1amkx9g4%2B7jkxStLKe4Ry%2FVeqOEFeDj5B3%2Fim8atXFDPnaA6ZctYC0kADebiu9zFF1dQsSdkzsLG93dLAMR0ARXm0vun9nbqpp5oxDQafvSrdE7oDp0yem%2B391K5yvQ%2FVkTdyMd797ooD1IAYqUdwlX0lVblqv9ErzI2EUbOnFhO5widZFoU8s5JQDxyTzDlNAHHPnQpU8XD7uIRyR%2Bh43I9VvsEn1pERJ2rOM57I1PkAM8vesvdhiNkLY7KsmmB1q5drdmKxzSDeK5uPJY%2F7b6ZdCcYzDgNfX18d6h0A0FHbvXn7qPH9NQWGUsNXamCikRs9AA%2BK%2BzqwxI%2FlZdCdkUBJNbFqefOmuHA6y4DCuw6r%2FBTrqAZ4iBH5JOWBgJ5BPglFYT1gWFkwyMqq8gmMxb5SeS%2FjunuR9x9HhadmGfzTt7avXh7ra%2BbCbT8G5EBTHekw5tLrBpYwkzmLiedzIpJ4pJqrAXmk%2B6qfKdpUFGOfE%2FoOdzhIkM32hFOTOwwCcLwfUCOQXCXHweJlGlDZdV%2FgvnAv5llJv80AS6mRncqu5cTdZ6kwskL6mtLuZx022Hs9iVQEhZVcVFVxWNFIMlrPZufuNWFtnv13RkAoiqYOJgDn3UWRAP9lucn7OMZs0NyqKFy1iLho2FCO%2BegcGHVqDf%2FVxOtLAlnkhjmFRxg%3D%3D\u0026X-Amz-Signature=387211427668aba4d3a65ad9ed7bbdbb95d64a82f9050776549fa023b2ec995a","file_size":43,"type":"text/plain"},{"id":134372,"file_name":"modified_crash.rb","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/134/372/bf23b4d14eefab771278d93c17aeb191084830f1/modified_crash.rb?response-content-disposition=attachment%3B%20filename%3D%22modified_crash.rb%22%3B%20filename%2A%3DUTF-8%27%27modified_crash.rb\u0026response-content-type=text%2Fplain\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQW2BAZGD3%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T044544Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJz%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQDf7CC1janFXxWWF6QZ1Z6X6%2F6j0WDhv4gDyzEWu%2BScUAIhAOhgsmE64VangXFyIz5AGmDMLeT8sYG2vBQ4PwiaYS%2FZKrQDCFUQARoMMDEzNjE5Mjc0ODQ5Igy754oCq3nK3vWmRbMqkQM98qKdRlMDTd4bBwR4jJMppOWz7EU3ySwJK1geVZm7GvrSHyp8wAx03nVbAIisdh9q5SCYJs%2FJTXi%2Fsm9znfJcHgIy1DUYcyZol0zQmN4hQAlOUZZ6AJANKMjzew6Gbci4hpgZqkt7kMNinONmzU36EDiWMOc0y0LBIMMe8ckWdal2vM1amkx9g4%2B7jkxStLKe4Ry%2FVeqOEFeDj5B3%2Fim8atXFDPnaA6ZctYC0kADebiu9zFF1dQsSdkzsLG93dLAMR0ARXm0vun9nbqpp5oxDQafvSrdE7oDp0yem%2B391K5yvQ%2FVkTdyMd797ooD1IAYqUdwlX0lVblqv9ErzI2EUbOnFhO5widZFoU8s5JQDxyTzDlNAHHPnQpU8XD7uIRyR%2Bh43I9VvsEn1pERJ2rOM57I1PkAM8vesvdhiNkLY7KsmmB1q5drdmKxzSDeK5uPJY%2F7b6ZdCcYzDgNfX18d6h0A0FHbvXn7qPH9NQWGUsNXamCikRs9AA%2BK%2BzqwxI%2FlZdCdkUBJNbFqefOmuHA6y4DCuw6r%2FBTrqAZ4iBH5JOWBgJ5BPglFYT1gWFkwyMqq8gmMxb5SeS%2FjunuR9x9HhadmGfzTt7avXh7ra%2BbCbT8G5EBTHekw5tLrBpYwkzmLiedzIpJ4pJqrAXmk%2B6qfKdpUFGOfE%2FoOdzhIkM32hFOTOwwCcLwfUCOQXCXHweJlGlDZdV%2FgvnAv5llJv80AS6mRncqu5cTdZ6kwskL6mtLuZx022Hs9iVQEhZVcVFVxWNFIMlrPZufuNWFtnv13RkAoiqYOJgDn3UWRAP9lucn7OMZs0NyqKFy1iLho2FCO%2BegcGHVqDf%2FVxOtLAlnkhjmFRxg%3D%3D\u0026X-Amz-Signature=3918f2c04f1f2464222bbf538ca88b6e696ae9ba596e42aa73110d1f04ced2f3","file_size":44,"type":"text/plain"},{"id":134373,"file_name":"non_crash.rb","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/134/373/3b4933693d0c30ad504f4863c3ffca20472677d4/non_crash.rb?response-content-disposition=attachment%3B%20filename%3D%22non_crash.rb%22%3B%20filename%2A%3DUTF-8%27%27non_crash.rb\u0026response-content-type=text%2Fplain\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQW2BAZGD3%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T044544Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJz%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQDf7CC1janFXxWWF6QZ1Z6X6%2F6j0WDhv4gDyzEWu%2BScUAIhAOhgsmE64VangXFyIz5AGmDMLeT8sYG2vBQ4PwiaYS%2FZKrQDCFUQARoMMDEzNjE5Mjc0ODQ5Igy754oCq3nK3vWmRbMqkQM98qKdRlMDTd4bBwR4jJMppOWz7EU3ySwJK1geVZm7GvrSHyp8wAx03nVbAIisdh9q5SCYJs%2FJTXi%2Fsm9znfJcHgIy1DUYcyZol0zQmN4hQAlOUZZ6AJANKMjzew6Gbci4hpgZqkt7kMNinONmzU36EDiWMOc0y0LBIMMe8ckWdal2vM1amkx9g4%2B7jkxStLKe4Ry%2FVeqOEFeDj5B3%2Fim8atXFDPnaA6ZctYC0kADebiu9zFF1dQsSdkzsLG93dLAMR0ARXm0vun9nbqpp5oxDQafvSrdE7oDp0yem%2B391K5yvQ%2FVkTdyMd797ooD1IAYqUdwlX0lVblqv9ErzI2EUbOnFhO5widZFoU8s5JQDxyTzDlNAHHPnQpU8XD7uIRyR%2Bh43I9VvsEn1pERJ2rOM57I1PkAM8vesvdhiNkLY7KsmmB1q5drdmKxzSDeK5uPJY%2F7b6ZdCcYzDgNfX18d6h0A0FHbvXn7qPH9NQWGUsNXamCikRs9AA%2BK%2BzqwxI%2FlZdCdkUBJNbFqefOmuHA6y4DCuw6r%2FBTrqAZ4iBH5JOWBgJ5BPglFYT1gWFkwyMqq8gmMxb5SeS%2FjunuR9x9HhadmGfzTt7avXh7ra%2BbCbT8G5EBTHekw5tLrBpYwkzmLiedzIpJ4pJqrAXmk%2B6qfKdpUFGOfE%2FoOdzhIkM32hFOTOwwCcLwfUCOQXCXHweJlGlDZdV%2FgvnAv5llJv80AS6mRncqu5cTdZ6kwskL6mtLuZx022Hs9iVQEhZVcVFVxWNFIMlrPZufuNWFtnv13RkAoiqYOJgDn3UWRAP9lucn7OMZs0NyqKFy1iLho2FCO%2BegcGHVqDf%2FVxOtLAlnkhjmFRxg%3D%3D\u0026X-Amz-Signature=eb6ff864ec2d96d46117ef316f5da1aa0c82c8b440bdef119121edbbd47c76b4","file_size":46,"type":"text/plain"},{"id":134374,"file_name":"segfault.patch","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/134/374/e8345f181f4aa7b080a5a59bb0145f22b5e5b955/segfault.patch?response-content-disposition=attachment%3B%20filename%3D%22segfault.patch%22%3B%20filename%2A%3DUTF-8%27%27segfault.patch\u0026response-content-type=text%2Fx-diff\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQW2BAZGD3%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T044544Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJz%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQDf7CC1janFXxWWF6QZ1Z6X6%2F6j0WDhv4gDyzEWu%2BScUAIhAOhgsmE64VangXFyIz5AGmDMLeT8sYG2vBQ4PwiaYS%2FZKrQDCFUQARoMMDEzNjE5Mjc0ODQ5Igy754oCq3nK3vWmRbMqkQM98qKdRlMDTd4bBwR4jJMppOWz7EU3ySwJK1geVZm7GvrSHyp8wAx03nVbAIisdh9q5SCYJs%2FJTXi%2Fsm9znfJcHgIy1DUYcyZol0zQmN4hQAlOUZZ6AJANKMjzew6Gbci4hpgZqkt7kMNinONmzU36EDiWMOc0y0LBIMMe8ckWdal2vM1amkx9g4%2B7jkxStLKe4Ry%2FVeqOEFeDj5B3%2Fim8atXFDPnaA6ZctYC0kADebiu9zFF1dQsSdkzsLG93dLAMR0ARXm0vun9nbqpp5oxDQafvSrdE7oDp0yem%2B391K5yvQ%2FVkTdyMd797ooD1IAYqUdwlX0lVblqv9ErzI2EUbOnFhO5widZFoU8s5JQDxyTzDlNAHHPnQpU8XD7uIRyR%2Bh43I9VvsEn1pERJ2rOM57I1PkAM8vesvdhiNkLY7KsmmB1q5drdmKxzSDeK5uPJY%2F7b6ZdCcYzDgNfX18d6h0A0FHbvXn7qPH9NQWGUsNXamCikRs9AA%2BK%2BzqwxI%2FlZdCdkUBJNbFqefOmuHA6y4DCuw6r%2FBTrqAZ4iBH5JOWBgJ5BPglFYT1gWFkwyMqq8gmMxb5SeS%2FjunuR9x9HhadmGfzTt7avXh7ra%2BbCbT8G5EBTHekw5tLrBpYwkzmLiedzIpJ4pJqrAXmk%2B6qfKdpUFGOfE%2FoOdzhIkM32hFOTOwwCcLwfUCOQXCXHweJlGlDZdV%2FgvnAv5llJv80AS6mRncqu5cTdZ6kwskL6mtLuZx022Hs9iVQEhZVcVFVxWNFIMlrPZufuNWFtnv13RkAoiqYOJgDn3UWRAP9lucn7OMZs0NyqKFy1iLho2FCO%2BegcGHVqDf%2FVxOtLAlnkhjmFRxg%3D%3D\u0026X-Amz-Signature=bf23ec0510ae687d09aaa0a81b6cfb66511ca952f19a362ef46610777a85fa37","file_size":569,"type":"text/x-diff"}],"allow_singular_disclosure_at":"2017-01-15T19:49:16.711Z","allow_singular_disclosure_after":-124707387.941869,"singular_disclosure_allowed":true,"vote_count":3,"voters":["dkasak","eveeez","spetr0x"],"severity":{"rating":"high","score":8.6,"author_type":"User","metrics":{"attack_vector":"network","attack_complexity":"low","privileges_required":"none","user_interaction":"none","scope":"changed","confidentiality":"none","integrity":"none","availability":"high"}},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":1298353,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Attached is a possible fix for the segfault which doesn't necessitate removing the optimisation altogether. Note that we can't guarantee there aren't other cases where this particular optimisation is unsafe, but the fix works for all the test cases we've managed to produce so far. \n\nThe fix works by tracking whether we are inside a function call parameter list while doing the optimisation (i.e. whether `gen_call` is an ancestor of the current `genop_peep` call in the function call graph). This is tracked in an `int` instead of a boolean so nested function calls are handled appropriately. This may introduce the possibility of `int` overflow if the call stack is not otherwise limited.\n\nWe also attempted to add a test case (also attached) for this into mruby's test suite:\n\n    diff --git a/test/t/bs_block.rb b/test/t/bs_block.rb\n    index 04a4a15..ad4aec8 100644\n    --- a/test/t/bs_block.rb\n    +++ b/test/t/bs_block.rb\n    @@ -519,3 +519,15 @@ assert('BS Block 38') do\n    \n    assert_equal [1,2,3,4,5], iter{|a,b,c=:c,d,e| [a,b,c,d,e]}\n    end\n    +\n    +assert('BS Block 39') do\n    +  module TestYieldNilFromAssignToUndefined\n    +    def m\n    +      yield\n    +    end\n    +  end\n    +\n    +  assert_raise(LocalJumpError) do\n    +    TestYieldNilFromAssignToUndefined.m(\u0026z \u0026\u0026= 0)\n    +  end\n    +end\n\nHowever, the test doesn't crash mruby, presumably because the presence of the test suite context changes the order/composition of the opcodes, preventing the optimization from getting triggered. This serves well to point out the relative flakiness of the optimisation.","markdown_message":"\u003cp\u003eAttached is a possible fix for the segfault which doesn\u0026#39;t necessitate removing the optimisation altogether. Note that we can\u0026#39;t guarantee there aren\u0026#39;t other cases where this particular optimisation is unsafe, but the fix works for all the test cases we\u0026#39;ve managed to produce so far. \u003c/p\u003e\n\n\u003cp\u003eThe fix works by tracking whether we are inside a function call parameter list while doing the optimisation (i.e. whether \u003ccode\u003egen_call\u003c/code\u003e is an ancestor of the current \u003ccode\u003egenop_peep\u003c/code\u003e call in the function call graph). This is tracked in an \u003ccode\u003eint\u003c/code\u003e instead of a boolean so nested function calls are handled appropriately. This may introduce the possibility of \u003ccode\u003eint\u003c/code\u003e overflow if the call stack is not otherwise limited.\u003c/p\u003e\n\n\u003cp\u003eWe also attempted to add a test case (also attached) for this into mruby\u0026#39;s test suite:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight diff\"\u003e\u003ccode\u003e\u003cspan class=\"gh\"\u003ediff --git a/test/t/bs_block.rb b/test/t/bs_block.rb\nindex 04a4a15..ad4aec8 100644\n\u003c/span\u003e\u003cspan class=\"gd\"\u003e--- a/test/t/bs_block.rb\n\u003c/span\u003e\u003cspan class=\"gi\"\u003e+++ b/test/t/bs_block.rb\n\u003c/span\u003e\u003cspan class=\"p\"\u003e@@ -519,3 +519,15 @@\u003c/span\u003e assert(\u0026#39;BS Block 38\u0026#39;) do\n\nassert_equal [1,2,3,4,5], iter{|a,b,c=:c,d,e| [a,b,c,d,e]}\n\u003cspan class=\"p\"\u003eend\n\u003c/span\u003e\u003cspan class=\"gi\"\u003e+\n+assert(\u0026#39;BS Block 39\u0026#39;) do\n+  module TestYieldNilFromAssignToUndefined\n+    def m\n+      yield\n+    end\n+  end\n+\n+  assert_raise(LocalJumpError) do\n+    TestYieldNilFromAssignToUndefined.m(\u0026amp;z \u0026amp;\u0026amp;= 0)\n+  end\n+end\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eHowever, the test doesn\u0026#39;t crash mruby, presumably because the presence of the test suite context changes the order/composition of the opcodes, preventing the optimization from getting triggered. This serves well to point out the relative flakiness of the optimisation.\u003c/p\u003e\n","automated_response":false,"created_at":"2016-11-14T15:03:11.499Z","updated_at":"2016-11-14T15:03:11.499Z","actor":{"username":"dkasak","cleared":true,"url":"/dkasak","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/122/858/df3e45a00fd0f5e53ef7dc7f9b12168cbde93200_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"attachments":[{"id":134621,"filename":"peephole-segfault-test.patch","type":"text/x-diff","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/134/621/4f700617acd43c97e7ab27ee6f51f706038b47ab/peephole-segfault-test.patch?response-content-disposition=attachment%3B%20filename%3D%22peephole-segfault-test.patch%22%3B%20filename%2A%3DUTF-8%27%27peephole-segfault-test.patch\u0026response-content-type=text%2Fx-diff\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQW2BAZGD3%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T044544Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJz%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQDf7CC1janFXxWWF6QZ1Z6X6%2F6j0WDhv4gDyzEWu%2BScUAIhAOhgsmE64VangXFyIz5AGmDMLeT8sYG2vBQ4PwiaYS%2FZKrQDCFUQARoMMDEzNjE5Mjc0ODQ5Igy754oCq3nK3vWmRbMqkQM98qKdRlMDTd4bBwR4jJMppOWz7EU3ySwJK1geVZm7GvrSHyp8wAx03nVbAIisdh9q5SCYJs%2FJTXi%2Fsm9znfJcHgIy1DUYcyZol0zQmN4hQAlOUZZ6AJANKMjzew6Gbci4hpgZqkt7kMNinONmzU36EDiWMOc0y0LBIMMe8ckWdal2vM1amkx9g4%2B7jkxStLKe4Ry%2FVeqOEFeDj5B3%2Fim8atXFDPnaA6ZctYC0kADebiu9zFF1dQsSdkzsLG93dLAMR0ARXm0vun9nbqpp5oxDQafvSrdE7oDp0yem%2B391K5yvQ%2FVkTdyMd797ooD1IAYqUdwlX0lVblqv9ErzI2EUbOnFhO5widZFoU8s5JQDxyTzDlNAHHPnQpU8XD7uIRyR%2Bh43I9VvsEn1pERJ2rOM57I1PkAM8vesvdhiNkLY7KsmmB1q5drdmKxzSDeK5uPJY%2F7b6ZdCcYzDgNfX18d6h0A0FHbvXn7qPH9NQWGUsNXamCikRs9AA%2BK%2BzqwxI%2FlZdCdkUBJNbFqefOmuHA6y4DCuw6r%2FBTrqAZ4iBH5JOWBgJ5BPglFYT1gWFkwyMqq8gmMxb5SeS%2FjunuR9x9HhadmGfzTt7avXh7ra%2BbCbT8G5EBTHekw5tLrBpYwkzmLiedzIpJ4pJqrAXmk%2B6qfKdpUFGOfE%2FoOdzhIkM32hFOTOwwCcLwfUCOQXCXHweJlGlDZdV%2FgvnAv5llJv80AS6mRncqu5cTdZ6kwskL6mtLuZx022Hs9iVQEhZVcVFVxWNFIMlrPZufuNWFtnv13RkAoiqYOJgDn3UWRAP9lucn7OMZs0NyqKFy1iLho2FCO%2BegcGHVqDf%2FVxOtLAlnkhjmFRxg%3D%3D\u0026X-Amz-Signature=4cf82a4720e8051c5dd85cdbc79933bd054e6fca3c75511a56cd72cefdd3f3a9"},{"id":134620,"filename":"peephole-segfault-fix.patch","type":"text/x-diff","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/134/620/fac9b7ea4b5e61be514f7b5e19cc4c2ed2a48057/peephole-segfault-fix.patch?response-content-disposition=attachment%3B%20filename%3D%22peephole-segfault-fix.patch%22%3B%20filename%2A%3DUTF-8%27%27peephole-segfault-fix.patch\u0026response-content-type=text%2Fx-diff\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQW2BAZGD3%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T044544Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJz%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQDf7CC1janFXxWWF6QZ1Z6X6%2F6j0WDhv4gDyzEWu%2BScUAIhAOhgsmE64VangXFyIz5AGmDMLeT8sYG2vBQ4PwiaYS%2FZKrQDCFUQARoMMDEzNjE5Mjc0ODQ5Igy754oCq3nK3vWmRbMqkQM98qKdRlMDTd4bBwR4jJMppOWz7EU3ySwJK1geVZm7GvrSHyp8wAx03nVbAIisdh9q5SCYJs%2FJTXi%2Fsm9znfJcHgIy1DUYcyZol0zQmN4hQAlOUZZ6AJANKMjzew6Gbci4hpgZqkt7kMNinONmzU36EDiWMOc0y0LBIMMe8ckWdal2vM1amkx9g4%2B7jkxStLKe4Ry%2FVeqOEFeDj5B3%2Fim8atXFDPnaA6ZctYC0kADebiu9zFF1dQsSdkzsLG93dLAMR0ARXm0vun9nbqpp5oxDQafvSrdE7oDp0yem%2B391K5yvQ%2FVkTdyMd797ooD1IAYqUdwlX0lVblqv9ErzI2EUbOnFhO5widZFoU8s5JQDxyTzDlNAHHPnQpU8XD7uIRyR%2Bh43I9VvsEn1pERJ2rOM57I1PkAM8vesvdhiNkLY7KsmmB1q5drdmKxzSDeK5uPJY%2F7b6ZdCcYzDgNfX18d6h0A0FHbvXn7qPH9NQWGUsNXamCikRs9AA%2BK%2BzqwxI%2FlZdCdkUBJNbFqefOmuHA6y4DCuw6r%2FBTrqAZ4iBH5JOWBgJ5BPglFYT1gWFkwyMqq8gmMxb5SeS%2FjunuR9x9HhadmGfzTt7avXh7ra%2BbCbT8G5EBTHekw5tLrBpYwkzmLiedzIpJ4pJqrAXmk%2B6qfKdpUFGOfE%2FoOdzhIkM32hFOTOwwCcLwfUCOQXCXHweJlGlDZdV%2FgvnAv5llJv80AS6mRncqu5cTdZ6kwskL6mtLuZx022Hs9iVQEhZVcVFVxWNFIMlrPZufuNWFtnv13RkAoiqYOJgDn3UWRAP9lucn7OMZs0NyqKFy1iLho2FCO%2BegcGHVqDf%2FVxOtLAlnkhjmFRxg%3D%3D\u0026X-Amz-Signature=406005286980d689dbac510b8c5a8100709401e95eb22224450b30507a641c96"}],"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1299415,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Thank you for your report! We've reproduced the issue, and our engineering team is investigating.","markdown_message":"\u003cp\u003eThank you for your report! We\u0026#39;ve reproduced the issue, and our engineering team is investigating.\u003c/p\u003e\n","automated_response":false,"created_at":"2016-11-14T22:26:46.346Z","updated_at":"2016-11-14T22:26:46.346Z","actor":{"username":"clayton","cleared":false,"url":"/clayton","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/YKjJrQvn996bd2n67ELXwtHt/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1307412,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Hi @dkasak, thank you for your report and the patch! We've deployed a fix for this in our production environment as of earlier today.\n\nI'm marking this issue as resolved now but we still need to fix this bug upstream before we can assess the impact \u0026 determine a final bounty amount. This may take a few weeks since we received a large number of valid issues and we want to calibrate our payouts across all of them.","markdown_message":"\u003cp\u003eHi \u003ca href=\"/dkasak\"\u003e@dkasak\u003c/a\u003e, thank you for your report and the patch! We\u0026#39;ve deployed a fix for this in our production environment as of earlier today.\u003c/p\u003e\n\n\u003cp\u003eI\u0026#39;m marking this issue as resolved now but we still need to fix this bug upstream before we can assess the impact \u0026amp; determine a final bounty amount. This may take a few weeks since we received a large number of valid issues and we want to calibrate our payouts across all of them.\u003c/p\u003e\n","automated_response":false,"created_at":"2016-11-18T20:43:47.463Z","updated_at":"2016-11-18T20:43:47.463Z","actor":{"username":"francoischagnon","cleared":false,"url":"/francoischagnon","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/019/168/5d577fe97283a5483331257b629b6287ed4d287b_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"dkasak","url":"/dkasak"},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1319220,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"The fix for this issue has ben merged upstream: https://github.com/Shopify/mruby-internal/pull/49/files","markdown_message":"\u003cp\u003eThe fix for this issue has ben merged upstream: \u003ca title=\"https://github.com/Shopify/mruby-internal/pull/49/files\" href=\"/redirect?url=https%3A%2F%2Fgithub.com%2FShopify%2Fmruby-internal%2Fpull%2F49%2Ffiles\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://github.com/Shopify/mruby-internal/pull/49/files\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n","automated_response":false,"created_at":"2016-11-25T15:40:47.839Z","updated_at":"2016-11-25T15:40:47.839Z","actor":{"username":"francoischagnon","cleared":false,"url":"/francoischagnon","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/019/168/5d577fe97283a5483331257b629b6287ed4d287b_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1370019,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Thanks for helping improve the security of Shopify Scripts and the mruby project!","markdown_message":"\u003cp\u003eThanks for helping improve the security of Shopify Scripts and the mruby project!\u003c/p\u003e\n","automated_response":false,"created_at":"2016-12-16T19:49:10.424Z","updated_at":"2016-12-16T19:49:10.424Z","actor":{"url":"/shopify-scripts","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/015/668/ebbe467de8ef2fc936053593e1289e30f04c3b06_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"shopify-scripts"}},"bounty_amount":"10000.0","bounty_currency":"usd","genius_execution_id":null,"team_handle":"shopify-scripts","collaborator":{"username":"dkasak","url":"/dkasak"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1370020,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2016-12-16T19:49:16.689Z","updated_at":"2016-12-16T19:49:16.689Z","first_to_agree":true,"actor":{"username":"andrewdunbar","cleared":false,"url":"/andrewdunbar","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/019/164/5b0e89675ed6dbb9df87223e9f8f58e2125bb56b_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1370370,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2016-12-16T21:42:33.452Z","updated_at":"2016-12-16T21:42:33.452Z","actor":{"username":"dkasak","cleared":true,"url":"/dkasak","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/122/858/df3e45a00fd0f5e53ef7dc7f9b12168cbde93200_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1370371,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2016-12-16T21:42:33.483Z","updated_at":"2016-12-16T21:42:33.483Z","actor":{"username":"dkasak","cleared":true,"url":"/dkasak","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/122/858/df3e45a00fd0f5e53ef7dc7f9b12168cbde93200_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"shopify-scripts","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}