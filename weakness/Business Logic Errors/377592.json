{"id":377592,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8zNzc1OTI=","url":"https://hackerone.com/reports/377592","title":"A bug in the Monero wallet balance can enable theft from exchanges","state":"Closed","substate":"resolved","severity_rating":"critical","readable_substate":"Resolved","created_at":"2018-07-05T16:49:15.267Z","submitted_at":"2018-07-05T16:49:15.267Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"jagerman","url":"/jagerman","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":7731,"url":"https://hackerone.com/monero","handle":"monero","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/007/731/55634f7fcd917725c7a5771cc6e7c9b4d5fe0c22_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/007/731/55634f7fcd917725c7a5771cc6e7c9b4d5fe0c22_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":false,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Monero","twitter_handle":"monero","website":"https://getmonero.org","about":" Monero: the secure, private, untraceable cryptocurrency"}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2018-08-02T00:12:00.655Z","bug_reporter_agreed_on_going_public_at":null,"team_member_agreed_on_going_public_at":"2018-07-27T10:22:05.123Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"**Summary:**\nA Monero bug (already fixed in master) allows theft from exchanges.  This has been exploited again a Monero-derived coin, so the exploit may be underway currently.\n\n**Description:**\n(fluffypony: Also please mention you spoke to me and I recommended you put it on HackerOne)\n\nPR #3985 fixed a wallet balance display bug, which seems innocuous enough, but this bug also extends to exchanges: a transfer of, e.g., 1 XMR to an exchange with a duplicated TX pub key will show up on an exchange as a 2 XMR deposit, which then allows the attacker to withdraw 2 XMR from the exchange's wallet.  An attacker could exploit this repeatedly to siphon of all of the exchange's balance.\n\n## Releases Affected:\n\n  * 0.12.2.0, which is currently active and used by exchanges, and likely earlier releases.\n  * current master and the 0.12.3.0 PR branch have the fix applied\n\n## Steps To Reproduce:\n\n  1. deliberately double-sign a transaction with the tx pub key, e.g. by doubling the `add_tx_pub_key_to_extra(tx, txkey_pub);` call in `src/cryptonote_core/cryptonote_tx_utils.cpp`.\n  1. Transfer an amount (or send to an exchange)\n  1. See 2x the transferred amount appear on the recipient wallet (or the exchange).\n\n## Supporting Material/References:\n\n  * I've notified several other Monero-derived coins that I am in contact with, along with Cryptopia.\n  * This attack was carried out against ArQmA on altex.exchange; 4 different wallets managed to steal the entire ARQ exchange deposits before the ARQ wallet was put into maintenance.\n\n## Impact\n\nTheft of all coins deposited in an exchange wallet.","vulnerability_information_html":"\u003cp\u003e\u003cstrong\u003eSummary:\u003c/strong\u003e\u003cbr\u003e\nA Monero bug (already fixed in master) allows theft from exchanges.  This has been exploited again a Monero-derived coin, so the exploit may be underway currently.\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eDescription:\u003c/strong\u003e\u003cbr\u003e\n(fluffypony: Also please mention you spoke to me and I recommended you put it on HackerOne)\u003c/p\u003e\n\n\u003cp\u003ePR \u003ca href=\"/reports/3985\"\u003e#3985\u003c/a\u003e fixed a wallet balance display bug, which seems innocuous enough, but this bug also extends to exchanges: a transfer of, e.g., 1 XMR to an exchange with a duplicated TX pub key will show up on an exchange as a 2 XMR deposit, which then allows the attacker to withdraw 2 XMR from the exchange\u0026#39;s wallet.  An attacker could exploit this repeatedly to siphon of all of the exchange\u0026#39;s balance.\u003c/p\u003e\n\n\u003ch2 id=\"releases-affected\"\u003eReleases Affected:\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003e0.12.2.0, which is currently active and used by exchanges, and likely earlier releases.\u003c/li\u003e\n\u003cli\u003ecurrent master and the 0.12.3.0 PR branch have the fix applied\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2 id=\"steps-to-reproduce\"\u003eSteps To Reproduce:\u003c/h2\u003e\n\n\u003col\u003e\n\u003cli\u003edeliberately double-sign a transaction with the tx pub key, e.g. by doubling the \u003ccode\u003eadd_tx_pub_key_to_extra(tx, txkey_pub);\u003c/code\u003e call in \u003ccode\u003esrc/cryptonote_core/cryptonote_tx_utils.cpp\u003c/code\u003e.\u003c/li\u003e\n\u003cli\u003eTransfer an amount (or send to an exchange)\u003c/li\u003e\n\u003cli\u003eSee 2x the transferred amount appear on the recipient wallet (or the exchange).\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003ch2 id=\"supporting-material-references\"\u003eSupporting Material/References:\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003eI\u0026#39;ve notified several other Monero-derived coins that I am in contact with, along with Cryptopia.\u003c/li\u003e\n\u003cli\u003eThis attack was carried out against ArQmA on altex.exchange; 4 different wallets managed to steal the entire ARQ exchange deposits before the ARQ wallet was put into maintenance.\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2 id=\"impact\"\u003eImpact\u003c/h2\u003e\n\n\u003cp\u003eTheft of all coins deposited in an exchange wallet.\u003c/p\u003e\n","weakness":{"id":65,"name":"Business Logic Errors"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2018-08-26T10:22:05.205Z","allow_singular_disclosure_after":-73941848.42044161,"singular_disclosure_allowed":true,"vote_count":3,"voters":["apapedulimu","cryptographer","frrrrriend"],"severity":{"rating":"critical","author_type":"User"},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":2994765,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks. As you saw, it's been fixed already. The multiplier is in fact up to however many tx keys can fit in a tx. 0.12.3.0 will be released very soon.","markdown_message":"\u003cp\u003eThanks. As you saw, it\u0026#39;s been fixed already. The multiplier is in fact up to however many tx keys can fit in a tx. 0.12.3.0 will be released very soon.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-07-05T18:11:19.202Z","updated_at":"2018-07-05T18:11:19.202Z","actor":{"username":"moneromooo","cleared":false,"url":"/moneromooo","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"monero","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2995879,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","markdown_message":"","automated_response":false,"created_at":"2018-07-05T20:51:28.731Z","updated_at":"2018-07-05T20:51:28.731Z","actor":{"username":"anonimal","cleared":false,"url":"/anonimal","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/040/857/f23cc3be09a21e17bc43975987c10ba2b6427239_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"monero","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3105052,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Hi @jagerman, thank you for the report. This is fixed in https://github.com/monero-project/monero/releases/tag/v0.12.3.0. Please paste an XMR address if you want a bounty payout.","markdown_message":"\u003cp\u003eHi \u003ca href=\"/jagerman\"\u003e@jagerman\u003c/a\u003e, thank you for the report. This is fixed in \u003ca title=\"https://github.com/monero-project/monero/releases/tag/v0.12.3.0\" href=\"/redirect?url=https%3A%2F%2Fgithub.com%2Fmonero-project%2Fmonero%2Freleases%2Ftag%2Fv0.12.3.0\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://github.com/monero-project/monero/releases/tag/v0.12.3.0\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e. Please paste an XMR address if you want a bounty payout.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-07-27T10:21:57.397Z","updated_at":"2018-07-27T10:21:57.397Z","actor":{"username":"anonimal","cleared":false,"url":"/anonimal","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/040/857/f23cc3be09a21e17bc43975987c10ba2b6427239_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"jagerman","url":"/jagerman"},"genius_execution_id":null,"team_handle":"monero","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3105053,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2018-07-27T10:22:05.153Z","updated_at":"2018-07-27T10:22:05.153Z","first_to_agree":true,"actor":{"username":"anonimal","cleared":false,"url":"/anonimal","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/040/857/f23cc3be09a21e17bc43975987c10ba2b6427239_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"monero","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3105398,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"4AwXiXiKP3c8gMkcww4PNQAMvcZ9vn1vteVPnrivJQus6ykSdfuJwZicAwPTdJjHwpMAuFQi48RTvdtXNLJ9TxtRNAFvXdr","markdown_message":"\u003cp\u003e4AwXiXiKP3c8gMkcww4PNQAMvcZ9vn1vteVPnrivJQus6ykSdfuJwZicAwPTdJjHwpMAuFQi48RTvdtXNLJ9TxtRNAFvXdr\u003c/p\u003e\n","automated_response":false,"created_at":"2018-07-27T12:53:07.994Z","updated_at":"2018-07-27T12:53:07.994Z","actor":{"username":"jagerman","cleared":false,"url":"/jagerman","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"monero","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3129850,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Sent 10 XMR: \u003c5388617a44e293e6dae7a17699897414af6cff3b206a77ae8ecbdf7accb6c39d\u003e","markdown_message":"\u003cp\u003eSent 10 XMR: \u0026lt;5388617a44e293e6dae7a17699897414af6cff3b206a77ae8ecbdf7accb6c39d\u0026gt;\u003c/p\u003e\n","automated_response":false,"created_at":"2018-08-01T18:36:57.178Z","updated_at":"2018-08-01T18:36:57.178Z","actor":{"username":"luigi1111w","cleared":false,"url":"/luigi1111w","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"monero","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3130815,"is_internal":false,"editable":false,"type":"Activities::SwagAwarded","message":"","markdown_message":"","automated_response":false,"created_at":"2018-08-02T00:10:25.521Z","updated_at":"2018-08-02T00:10:25.521Z","actor":{"url":"/monero","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/007/731/55634f7fcd917725c7a5771cc6e7c9b4d5fe0c22_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Monero"}},"reporter":{"username":"jagerman","url":"/jagerman"},"genius_execution_id":null,"team_handle":"monero","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3130816,"is_internal":false,"editable":false,"type":"Activities::ManuallyDisclosed","message":"","markdown_message":"","automated_response":false,"created_at":"2018-08-02T00:12:00.520Z","updated_at":"2018-08-02T00:12:00.520Z","actor":{"username":"anonimal","cleared":false,"url":"/anonimal","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/040/857/f23cc3be09a21e17bc43975987c10ba2b6427239_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"monero","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}