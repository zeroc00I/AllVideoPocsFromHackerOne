{"id":211283,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8yMTEyODM=","url":"https://hackerone.com/reports/211283","title":"Cross Site WebSocket Hijacking","state":"Closed","substate":"informative","severity_rating":"medium","readable_substate":"Informative","created_at":"2017-03-07T07:55:45.004Z","submitted_at":"2017-03-07T07:55:45.004Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"aishu_kc","url":"/aishu_kc","profile_picture_urls":{"small":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":1601,"url":"https://hackerone.com/legalrobot","handle":"legalrobot","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/001/601/0f164c3d9618b04b006b859517ff032ec57ab42a_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/601/0f164c3d9618b04b006b859517ff032ec57ab42a_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"paused","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Legal Robot","twitter_handle":"LegalRobot","website":"https://www.legalrobot.com","about":"Automated legal document review using artificial intelligence"}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2017-10-16T07:07:08.356Z","bug_reporter_agreed_on_going_public_at":"2017-10-16T07:07:08.312Z","team_member_agreed_on_going_public_at":"2017-08-26T23:09:59.492Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"### Description:\nThe given URL fails to validate Origin header- leading to Cross-Site WebSocket Hijacking. \n\n### Impact:\nThe impact, however, depends on how the server is configured. For example, it might require an authentication token which are user specific. In such cases, it might not be as sever as it would be in cases where server doesn't require anything at all.  \nSince almost all the request in the site are performed in web socket, it might be possible to hijack the websocket. The impact would be similar to side-wise CSRF plus every response from server could be possible to be read by attacker.\n\n### Affected Domain: \napp.legalrobot.com/socketjs/444/jfalksf/websocket\n\n### Reference: \nhttps://www.christian-schneider.net/CrossSiteWebSocketHijacking.html\nhttps://www.notsosecure.com/how-cross-site-websocket-hijacking-could-lead-to-full-session-compromise/","vulnerability_information_html":"\u003ch3 id=\"description\"\u003eDescription:\u003c/h3\u003e\n\n\u003cp\u003eThe given URL fails to validate Origin header- leading to Cross-Site WebSocket Hijacking. \u003c/p\u003e\n\n\u003ch3 id=\"impact\"\u003eImpact:\u003c/h3\u003e\n\n\u003cp\u003eThe impact, however, depends on how the server is configured. For example, it might require an authentication token which are user specific. In such cases, it might not be as sever as it would be in cases where server doesn\u0026#39;t require anything at all.\u003cbr\u003e\u003cbr\u003e\nSince almost all the request in the site are performed in web socket, it might be possible to hijack the websocket. The impact would be similar to side-wise CSRF plus every response from server could be possible to be read by attacker.\u003c/p\u003e\n\n\u003ch3 id=\"affected-domain\"\u003eAffected Domain:\u003c/h3\u003e\n\n\u003cp\u003eapp.legalrobot.com/socketjs/444/jfalksf/websocket\u003c/p\u003e\n\n\u003ch3 id=\"reference\"\u003eReference:\u003c/h3\u003e\n\n\u003cp\u003e\u003ca title=\"https://www.christian-schneider.net/CrossSiteWebSocketHijacking.html\" href=\"/redirect?url=https%3A%2F%2Fwww.christian-schneider.net%2FCrossSiteWebSocketHijacking.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://www.christian-schneider.net/CrossSiteWebSocketHijacking.html\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003cbr\u003e\n\u003ca title=\"https://www.notsosecure.com/how-cross-site-websocket-hijacking-could-lead-to-full-session-compromise/\" href=\"/redirect?url=https%3A%2F%2Fwww.notsosecure.com%2Fhow-cross-site-websocket-hijacking-could-lead-to-full-session-compromise%2F\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://www.notsosecure.com/how-cross-site-websocket-hijacking-could-lead-to-full-session-compromise/\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n","weakness":{"id":27,"name":"Improper Authentication - Generic"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":null,"vote_count":0,"voters":[],"severity":{"rating":"medium","author_type":"User"},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":1523723,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Sorry I forgot to attach the screen-shot.","markdown_message":"\u003cp\u003eSorry I forgot to attach the screen-shot.\u003c/p\u003e\n","automated_response":false,"created_at":"2017-03-07T07:56:28.922Z","updated_at":"2017-03-07T07:56:28.922Z","actor":{"username":"aishu_kc","cleared":false,"url":"/aishu_kc","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"attachments":[{"id":166845,"filename":"Screenshot_from_2017-03-07_13-20-09.png","type":"image/png","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/166/845/78c0b460c8f71018872f63870da03a25ba429312/Screenshot_from_2017-03-07_13-20-09.png?response-content-disposition=attachment%3B%20filename%3D%22Screenshot_from_2017-03-07_13-20-09.png%22%3B%20filename%2A%3DUTF-8%27%27Screenshot_from_2017-03-07_13-20-09.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQVBWWKZ4H%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T045655Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJz%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQCmEbZvVQ%2FI1GHRJjrhZK2Y6zh4lCWK725%2FwOpNu%2BnZkAIhAIZlqGHog%2B4PZMdnvhSU5APZbycPDz1wpNXbi5uE94ueKrQDCFUQARoMMDEzNjE5Mjc0ODQ5IgxU5AAHhqo1cPAzbTcqkQOGB5pEHXl6QCBCTSHUmyd%2FF8M3rpTqzp%2BOigrWU%2BrXYHZYm%2BGDawsiXhnqeD9o8Qw0b%2Fr0efVbRmhj5baoPrxgSiY%2B9zsreR3qClZZKnS0%2Brs8OqiMGd3clBbyfOxw2fa2vgQglV4dLF6EXSiGfxOms8eWdw%2F8mPtc81dMxDIlxTs50KUnd6aUjgG5BJs2k%2FL0rOKXYBS%2FdVqIQdN8JcCKMvqDv0u7pvSGEecQXa7pGdf07ufO02E64eU0OnaTeNyoq7WlZzT%2FGyvHjVtIvbXdPW15pwZm2Q4u8%2FW7ksSv4%2BxsESWLLCop0OeGUhtIppCDQlaMPC9JTj0HYKbMEGmZagmLfgHX4DKRg75%2FLNQViGcE%2FRCCaMxd6wrsv0dlz4dekjWvp4mXzLFkuKBM6c%2F%2BAemkmkgOJKnp%2FJUV1zJTe%2BO14GyIigsvxJqvrnKvkmsUrYwar1bX%2Be7UkqGzVbMAlsbRDNIOok7bVRXerhpXnbqFQsLWlqe%2BNfa4gSSfmgu4iIjCRRMdTWsvy2NQHfTsGjDAzar%2FBTrqAcniMm3eG7%2BxDZb9XVqMyQiSNyiuBD8pwO78bO8T3Uu8vSI3S05C6UCutmNkOnjR9D2NZaOgbFO4YujbW%2FY0mhhdjSppvg%2Bzdgu0AfZOou0DDwqm4vwEc0ekiNYUD6KHvD5tZwOaalihV5dSfbzoDyvfsJI6x7RYpBZmwPcshKw3Csz0uZew1JqrbUJVmc9v6q0aXols8bxyDKKPfp6siyzKhHELgTS3XGskds%2BWx5FaWemc%2Bo8QqyIuoOtWjmUwF39ydFOfg%2FyeKdwBxELGLKCSN8MyV6ov7IBrib4UiM%2F6l36ymDoHIX8ohg%3D%3D\u0026X-Amz-Signature=984a2838e0abc0b6ab031a64c348add85f0d7bdac5a302ce6c2b22112f1ec63a"}],"genius_execution_id":null,"team_handle":"legalrobot","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1524655,"is_internal":false,"editable":false,"type":"Activities::BugInformative","message":"Thanks for the report. Luckily for us, the framework we use (Meteor), while it relies heavily on web sockets, seems to be immune to this type of attack because it uses on localStorage for authentication rather than cookie-based auth, or other fairly vulnerable methods. By design, the sensitive information in localStorage is only accessible by javascript from the same origin.\n\nWhile it is possible to replay an upgrade request from another origin, the process you describe would require an attacker to compromise a user's browser to access the digest in order to be authenticated. If the browser itself is compromised, that's not really something we could protect against.\n\nHere is some more detail on the security implications of CSWSH-type attacks in Meteor: http://www.east5th.co/blog/2015/06/08/authentication-with-localstorage/\n\nNow, if there was some way to establish an authenticated web socket connection from another origin, that would be A Very Bad Day™ for us, and for every other site that uses the Meteor framework. It's one reason we're so sensitive to respond to script injection attacks since some of those could potentially expose localStorage. Perhaps that is a potential attack vector for you to attempt: if you can somehow inject a script and expose the token in localStorage, then use that to execute arbitrary code on a malicious server. So, I'm going to close out this issue and we can reopen it if an attack like that can be demonstrated.","markdown_message":"\u003cp\u003eThanks for the report. Luckily for us, the framework we use (Meteor), while it relies heavily on web sockets, seems to be immune to this type of attack because it uses on localStorage for authentication rather than cookie-based auth, or other fairly vulnerable methods. By design, the sensitive information in localStorage is only accessible by javascript from the same origin.\u003c/p\u003e\n\n\u003cp\u003eWhile it is possible to replay an upgrade request from another origin, the process you describe would require an attacker to compromise a user\u0026#39;s browser to access the digest in order to be authenticated. If the browser itself is compromised, that\u0026#39;s not really something we could protect against.\u003c/p\u003e\n\n\u003cp\u003eHere is some more detail on the security implications of CSWSH-type attacks in Meteor: \u003ca title=\"http://www.east5th.co/blog/2015/06/08/authentication-with-localstorage/\" href=\"/redirect?url=http%3A%2F%2Fwww.east5th.co%2Fblog%2F2015%2F06%2F08%2Fauthentication-with-localstorage%2F\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttp://www.east5th.co/blog/2015/06/08/authentication-with-localstorage/\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eNow, if there was some way to establish an authenticated web socket connection from another origin, that would be A Very Bad Day™ for us, and for every other site that uses the Meteor framework. It\u0026#39;s one reason we\u0026#39;re so sensitive to respond to script injection attacks since some of those could potentially expose localStorage. Perhaps that is a potential attack vector for you to attempt: if you can somehow inject a script and expose the token in localStorage, then use that to execute arbitrary code on a malicious server. So, I\u0026#39;m going to close out this issue and we can reopen it if an attack like that can be demonstrated.\u003c/p\u003e\n","automated_response":false,"created_at":"2017-03-07T16:55:31.379Z","updated_at":"2017-03-07T16:55:31.379Z","actor":{"username":"danrubins","cleared":false,"url":"/danrubins","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/021/222/c1d0d51f40e0c570e2153b6801fe54c997c757f0_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"legalrobot","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":1957534,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2017-08-26T23:09:59.510Z","updated_at":"2017-08-26T23:09:59.510Z","first_to_agree":true,"actor":{"username":"danrubins","cleared":false,"url":"/danrubins","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/021/222/c1d0d51f40e0c570e2153b6801fe54c997c757f0_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"legalrobot","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2068278,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2017-10-16T07:07:08.334Z","updated_at":"2017-10-16T07:07:08.334Z","actor":{"username":"aishu_kc","cleared":false,"url":"/aishu_kc","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"legalrobot","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":2068279,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2017-10-16T07:07:08.370Z","updated_at":"2017-10-16T07:07:08.370Z","actor":{"username":"aishu_kc","cleared":false,"url":"/aishu_kc","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"legalrobot","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}