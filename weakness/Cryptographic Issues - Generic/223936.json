{"id":223936,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8yMjM5MzY=","url":"https://hackerone.com/reports/223936","title":"Multiple cryptographic vulnerabilities in login page on ███████","state":"Closed","substate":"resolved","severity_rating":"medium","readable_substate":"Resolved","created_at":"2017-04-26T01:01:49.535Z","submitted_at":"2017-04-26T01:01:49.535Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"tcpiplab","url":"/tcpiplab","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/113/049/692d3d0775ad3998c4e2aee97daa865a1827cfb7_original.jpeg/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":16064,"url":"https://hackerone.com/deptofdefense","handle":"deptofdefense","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/016/064/46cd0286b1fa224aaa2cb9dfaaca9fa22b5b80b2_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/016/064/46cd0286b1fa224aaa2cb9dfaaca9fa22b5b80b2_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":false,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"U.S. Dept Of Defense","twitter_handle":"DC3VDP","website":"https://www.dc3.mil/vulnerability-disclosure","about":""}},"has_bounty?":false,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2019-12-02T18:53:22.652Z","bug_reporter_agreed_on_going_public_at":"2019-01-23T02:39:41.012Z","team_member_agreed_on_going_public_at":"2019-12-02T18:53:22.532Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"**Summary:**\nI realize that this report's title may not make sense yet. In one sentence: users logging in to the [███████ Server REST API Login page](http://██████/server/rest/login) can have their passwords stolen by an attacker on the same LAN or WiFi as the victim trying to log in.\n\n**Description:**\nTo save the reader any confusion, I'll point out that this is an unusual case where, instead of using HTTPS for password confidentiality in transit, the server sends RSA encryption scripts to the browser. The browser then encrypts the password before sending the login request to the server. Using ARP poisoning  I was able to Man-in-the-Middle (MitM) traffic between a victim and the login server. This enabled me to inject my public key into the login page, capture the encrypted password and decrypt it (using my private key), revealing the victim's plaintext password.\n\n## Impact\n\nUser accounts on the [████████ Server REST API server](http://███████/server/rest/login) could be compromised.\n\n## Step-by-step Reproduction Instructions\nBecause this report is so long, I'm only putting in this summarized list of steps. But if you want a full step-by-step with screenshots, the Ettercap filter, my Python decryption script and everything, I've already written it up. Just ask. \n\n1. The attacker must be on the same Layer 2 network segment (LAN, or WiFi) as the victim's computer.\n1. The attacker runs Ettercap, specifying the IP addresses of:\n   * The gateway router\n   * The victim's computer\n1. Using Ettercap, the attacker conducts an ARP Poisoning attack against the victim's computer and that of the gateway router, thereby acting as a proxy for traffic between those two devices.\n1. When the victim's browser sends a `GET` for `http://███/server/rest/login`, the attacker:\n   1. intercepts the server's response,\n   1. modifies the HTML form, replacing the server's public key modulus string with the attacker's public key modulus string.\n1. The victim enters `username` and `password` values in the modified HTML form and clicks the `Login` button. The `RSA.js` (and other scripts) run in the victim's browser as usual, but the resulting ciphertext is the user's password encrypted for the public key of the attacker. The victim's browser sends these values in a `POST` to `/server/rest/login`, but because of the ARP Poisoning attack, the `POST` is sent to the attacker's computer.\n1. The attacker, using OpenSSL and their own RSA private key, decrypts the encrypted password, thus recovering the plaintext password.\n1. Optional: The attacker re-encrypts the victim's plaintext password using the login page's original public key.\n1. Optional: The attacker places the now encrypted password value into a new `POST` to `/server/rest/login` and sends the request to the gateway router, thereby allowing the victim to authenticate to the server.\n1. At this point the attack is successful. Note: the attacker still needs to tell Ettercap to stop the ARP Poisoning attack, causing it to send the ARP Correction packet, thereby restoring normal connectivity between the victim and the gateway router.\n## Product, Version, and Configuration (If applicable)\n\n## Suggested Mitigation/Remediation Actions\n\n1. Require HTTPS for sending username/password to the server.\n   * This would solve the whole problem\n1. At the risk of sounding pedantic, client-side encryption via Javascript is not an effective security control. But I do realize that there may be use-case requirements for your application that I don't know about.   \n1. If you do have some reason why you *must* continue using client-side encryption, please know that the `RSA.js` script is using a vulnerable padding standard (PKCS#1v1.5). Unfortunately, the developer's [new RSA.js script](http://www.ohdave.com/rsa/RSA.js) is still using PKCS#1v1.5 padding which is vulnerable to a chosen ciphertext attack. The [Cryptosense](https://cryptosense.com/why-pkcs1v1-5-encryption-should-be-put-out-of-our-misery/) blog explains in detail. FYI I did not attempt to exploit this padding vulnerability.","vulnerability_information_html":"\u003cp\u003e\u003cstrong\u003eSummary:\u003c/strong\u003e\u003cbr\u003e\nI realize that this report\u0026#39;s title may not make sense yet. In one sentence: users logging in to the \u003ca href=\"/redirect?url=http%3A%2F%2Fxn--4zhaaaaa%2Fserver%2Frest%2Flogin\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003e███████ Server REST API Login page\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e can have their passwords stolen by an attacker on the same LAN or WiFi as the victim trying to log in.\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eDescription:\u003c/strong\u003e\u003cbr\u003e\nTo save the reader any confusion, I\u0026#39;ll point out that this is an unusual case where, instead of using HTTPS for password confidentiality in transit, the server sends RSA encryption scripts to the browser. The browser then encrypts the password before sending the login request to the server. Using ARP poisoning  I was able to Man-in-the-Middle (MitM) traffic between a victim and the login server. This enabled me to inject my public key into the login page, capture the encrypted password and decrypt it (using my private key), revealing the victim\u0026#39;s plaintext password.\u003c/p\u003e\n\n\u003ch2 id=\"impact\"\u003eImpact\u003c/h2\u003e\n\n\u003cp\u003eUser accounts on the \u003ca href=\"/redirect?url=http%3A%2F%2Fxn--4zhaaaaaa%2Fserver%2Frest%2Flogin\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003e████████ Server REST API server\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e could be compromised.\u003c/p\u003e\n\n\u003ch2 id=\"step-by-step-reproduction-instructions\"\u003eStep-by-step Reproduction Instructions\u003c/h2\u003e\n\n\u003cp\u003eBecause this report is so long, I\u0026#39;m only putting in this summarized list of steps. But if you want a full step-by-step with screenshots, the Ettercap filter, my Python decryption script and everything, I\u0026#39;ve already written it up. Just ask. \u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eThe attacker must be on the same Layer 2 network segment (LAN, or WiFi) as the victim\u0026#39;s computer.\u003c/li\u003e\n\u003cli\u003eThe attacker runs Ettercap, specifying the IP addresses of:\n\n\u003cul\u003e\n\u003cli\u003eThe gateway router\u003c/li\u003e\n\u003cli\u003eThe victim\u0026#39;s computer\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eUsing Ettercap, the attacker conducts an ARP Poisoning attack against the victim\u0026#39;s computer and that of the gateway router, thereby acting as a proxy for traffic between those two devices.\u003c/li\u003e\n\u003cli\u003eWhen the victim\u0026#39;s browser sends a \u003ccode\u003eGET\u003c/code\u003e for \u003ccode\u003ehttp://███/server/rest/login\u003c/code\u003e, the attacker:\n\n\u003col\u003e\n\u003cli\u003eintercepts the server\u0026#39;s response,\u003c/li\u003e\n\u003cli\u003emodifies the HTML form, replacing the server\u0026#39;s public key modulus string with the attacker\u0026#39;s public key modulus string.\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/li\u003e\n\u003cli\u003eThe victim enters \u003ccode\u003eusername\u003c/code\u003e and \u003ccode\u003epassword\u003c/code\u003e values in the modified HTML form and clicks the \u003ccode\u003eLogin\u003c/code\u003e button. The \u003ccode\u003eRSA.js\u003c/code\u003e (and other scripts) run in the victim\u0026#39;s browser as usual, but the resulting ciphertext is the user\u0026#39;s password encrypted for the public key of the attacker. The victim\u0026#39;s browser sends these values in a \u003ccode\u003ePOST\u003c/code\u003e to \u003ccode\u003e/server/rest/login\u003c/code\u003e, but because of the ARP Poisoning attack, the \u003ccode\u003ePOST\u003c/code\u003e is sent to the attacker\u0026#39;s computer.\u003c/li\u003e\n\u003cli\u003eThe attacker, using OpenSSL and their own RSA private key, decrypts the encrypted password, thus recovering the plaintext password.\u003c/li\u003e\n\u003cli\u003eOptional: The attacker re-encrypts the victim\u0026#39;s plaintext password using the login page\u0026#39;s original public key.\u003c/li\u003e\n\u003cli\u003eOptional: The attacker places the now encrypted password value into a new \u003ccode\u003ePOST\u003c/code\u003e to \u003ccode\u003e/server/rest/login\u003c/code\u003e and sends the request to the gateway router, thereby allowing the victim to authenticate to the server.\u003c/li\u003e\n\u003cli\u003eAt this point the attack is successful. Note: the attacker still needs to tell Ettercap to stop the ARP Poisoning attack, causing it to send the ARP Correction packet, thereby restoring normal connectivity between the victim and the gateway router.\n## Product, Version, and Configuration (If applicable)\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003ch2 id=\"suggested-mitigation-remediation-actions\"\u003eSuggested Mitigation/Remediation Actions\u003c/h2\u003e\n\n\u003col\u003e\n\u003cli\u003eRequire HTTPS for sending username/password to the server.\n\n\u003cul\u003e\n\u003cli\u003eThis would solve the whole problem\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eAt the risk of sounding pedantic, client-side encryption via Javascript is not an effective security control. But I do realize that there may be use-case requirements for your application that I don\u0026#39;t know about.\u003cbr\u003e\n\u003c/li\u003e\n\u003cli\u003eIf you do have some reason why you \u003cem\u003emust\u003c/em\u003e continue using client-side encryption, please know that the \u003ccode\u003eRSA.js\u003c/code\u003e script is using a vulnerable padding standard (PKCS#1v1.5). Unfortunately, the developer\u0026#39;s \u003ca href=\"/redirect?url=http%3A%2F%2Fwww.ohdave.com%2Frsa%2FRSA.js\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003enew RSA.js script\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e is still using PKCS#1v1.5 padding which is vulnerable to a chosen ciphertext attack. The \u003ca href=\"/redirect?url=https%3A%2F%2Fcryptosense.com%2Fwhy-pkcs1v1-5-encryption-should-be-put-out-of-our-misery%2F\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003eCryptosense\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e blog explains in detail. FYI I did not attempt to exploit this padding vulnerability.\u003c/li\u003e\n\u003c/ol\u003e\n","weakness":{"id":32,"name":"Cryptographic Issues - Generic"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":null,"vote_count":2,"voters":["demonia","lovebugpaul"],"severity":{"rating":"medium","author_type":"Team"},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":1636497,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Greetings from the Department of Defense (DoD),\n\nThank you for supporting the DoD Vulnerability Disclosure Program (VDP).\n\nBy submitting this report, you acknowledge understanding of, and agreement to, the DoD Vulnerability Disclosure Policy as detailed at @DeptofDefense.\n\nThe VDP Team will review your report to ensure compliance with the DoD Vulnerability Disclosure Policy.  If your report is determined to be out-of-scope, it will be closed without action.\n\nWe will attempt to validate in-scope vulnerability reports and may request additional information from you if necessary. We will forward reports with validated vulnerabilities to DoD system owners for their action.\n\nOur goal is to provide you with status updates not less than every two weeks until the reported vulnerability is resolved.\n\nRegards,\n\nThe VDP Team","markdown_message":"\u003cp\u003eGreetings from the Department of Defense (DoD),\u003c/p\u003e\n\n\u003cp\u003eThank you for supporting the DoD Vulnerability Disclosure Program (VDP).\u003c/p\u003e\n\n\u003cp\u003eBy submitting this report, you acknowledge understanding of, and agreement to, the DoD Vulnerability Disclosure Policy as detailed at \u003ca href=\"/deptofdefense\"\u003e@DeptofDefense\u003c/a\u003e.\u003c/p\u003e\n\n\u003cp\u003eThe VDP Team will review your report to ensure compliance with the DoD Vulnerability Disclosure Policy.  If your report is determined to be out-of-scope, it will be closed without action.\u003c/p\u003e\n\n\u003cp\u003eWe will attempt to validate in-scope vulnerability reports and may request additional information from you if necessary. We will forward reports with validated vulnerabilities to DoD system owners for their action.\u003c/p\u003e\n\n\u003cp\u003eOur goal is to provide you with status updates not less than every two weeks until the reported vulnerability is resolved.\u003c/p\u003e\n\n\u003cp\u003eRegards,\u003c/p\u003e\n\n\u003cp\u003eThe VDP Team\u003c/p\u003e\n","automated_response":true,"created_at":"2017-04-26T01:01:49.660Z","updated_at":"2017-04-26T01:01:49.660Z","actor":{"url":"/deptofdefense","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/016/064/46cd0286b1fa224aaa2cb9dfaaca9fa22b5b80b2_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"U.S. Dept Of Defense"}},"genius_execution_id":null,"team_handle":"deptofdefense","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1660764,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Greetings,\n\nWe have validated the vulnerability you reported and are preparing to forward this report to the affected DoD system owner for resolution.\n\nThank you for bringing this vulnerability to our attention!\n\nWe will endeavor to answer any questions the system owners may have regarding this report; however, there is a possibility we will need to contact you if they require more information to resolve the vulnerability.\n\nYou will receive another status update after we have confirmed your report has been resolved by the system owner. If you have any questions, please let me know.\n\nThanks again for supporting the DoD Vulnerability Disclosure Program.\n\nRegards,\n\nThe VDP Team","markdown_message":"\u003cp\u003eGreetings,\u003c/p\u003e\n\n\u003cp\u003eWe have validated the vulnerability you reported and are preparing to forward this report to the affected DoD system owner for resolution.\u003c/p\u003e\n\n\u003cp\u003eThank you for bringing this vulnerability to our attention!\u003c/p\u003e\n\n\u003cp\u003eWe will endeavor to answer any questions the system owners may have regarding this report; however, there is a possibility we will need to contact you if they require more information to resolve the vulnerability.\u003c/p\u003e\n\n\u003cp\u003eYou will receive another status update after we have confirmed your report has been resolved by the system owner. If you have any questions, please let me know.\u003c/p\u003e\n\n\u003cp\u003eThanks again for supporting the DoD Vulnerability Disclosure Program.\u003c/p\u003e\n\n\u003cp\u003eRegards,\u003c/p\u003e\n\n\u003cp\u003eThe VDP Team\u003c/p\u003e\n","automated_response":false,"created_at":"2017-05-08T16:34:38.719Z","updated_at":"2017-05-08T16:34:38.719Z","actor":{"username":"bwluebberthill","cleared":false,"url":"/bwluebberthill","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"deptofdefense","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":1661019,"is_internal":false,"editable":false,"type":"Activities::ReportSeverityUpdated","message":"","markdown_message":"","automated_response":false,"created_at":"2017-05-08T17:51:33.995Z","updated_at":"2017-05-08T17:51:33.995Z","additional_data":{"old_severity":null,"new_severity":"Medium","old_severity_id":null,"new_severity_id":40983},"actor":{"username":"bwluebberthill","cleared":false,"url":"/bwluebberthill","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"deptofdefense","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4017765,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"Good news!\n\nThe vulnerability you reported has been resolved and this report is now closed. If you have any further questions or disagree that the report is resolved, please let us know.\n\nThank you for your time and effort to improve the security of the DoD information network.\n\nRegards,\n\nThe VDP Team","markdown_message":"\u003cp\u003eGood news!\u003c/p\u003e\n\n\u003cp\u003eThe vulnerability you reported has been resolved and this report is now closed. If you have any further questions or disagree that the report is resolved, please let us know.\u003c/p\u003e\n\n\u003cp\u003eThank you for your time and effort to improve the security of the DoD information network.\u003c/p\u003e\n\n\u003cp\u003eRegards,\u003c/p\u003e\n\n\u003cp\u003eThe VDP Team\u003c/p\u003e\n","automated_response":false,"created_at":"2019-01-22T14:51:19.060Z","updated_at":"2019-01-22T14:51:19.060Z","actor":{"username":"ag3nt-j1","cleared":false,"url":"/ag3nt-j1","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"reporter":{"username":"tcpiplab","url":"/tcpiplab"},"genius_execution_id":null,"team_handle":"deptofdefense","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":4021667,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Thank you. I'm requesting that this be disclosed. It was really interesting. Let me know what, if anything, you want redacted, or if you have any questions. ","markdown_message":"\u003cp\u003eThank you. I\u0026#39;m requesting that this be disclosed. It was really interesting. Let me know what, if anything, you want redacted, or if you have any questions. \u003c/p\u003e\n","automated_response":false,"created_at":"2019-01-23T02:39:41.035Z","updated_at":"2019-01-23T02:39:41.035Z","first_to_agree":true,"actor":{"username":"tcpiplab","cleared":false,"url":"/tcpiplab","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/113/049/692d3d0775ad3998c4e2aee97daa865a1827cfb7_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"deptofdefense","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":6450491,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Approved for disclosure. Thanks for your participation in the DoD Vulnerability Disclosure Program (VDP). Please follow us on Twitter @DC3VDP","markdown_message":"\u003cp\u003eApproved for disclosure. Thanks for your participation in the DoD Vulnerability Disclosure Program (VDP). Please follow us on Twitter \u003ca href=\"/dc3vdp\"\u003e@DC3VDP\u003c/a\u003e\u003c/p\u003e\n","automated_response":false,"created_at":"2019-12-02T18:53:22.548Z","updated_at":"2019-12-02T18:53:22.548Z","actor":{"username":"agent-1","cleared":false,"url":"/agent-1","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/379/490/775a471f25ef037fbf277e8b5d5a50bbb9e9ab56_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"deptofdefense","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":6450492,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2019-12-02T18:53:22.666Z","updated_at":"2019-12-02T18:53:22.666Z","actor":{"username":"agent-1","cleared":false,"url":"/agent-1","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/379/490/775a471f25ef037fbf277e8b5d5a50bbb9e9ab56_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"deptofdefense","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}