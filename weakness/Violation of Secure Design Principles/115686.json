{"id":115686,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC8xMTU2ODY=","url":"https://hackerone.com/reports/115686","title":"[tor] pre-emptive defenses, potential vulnerabilities","state":"Closed","substate":"resolved","readable_substate":"Resolved","created_at":"2016-02-10T12:02:55.218Z","submitted_at":"2016-02-10T12:02:55.218Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"guido","url":"/guido","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/002/983/e55b0b2324777fb7efc2de4212fd8d337ca816bd_original.jpg/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":1800,"url":"https://hackerone.com/torproject","handle":"torproject","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/001/800/6e575d0a9127b91e83833cf4a9e6be6e8b30cbc3_original.jpg/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/800/6e575d0a9127b91e83833cf4a9e6be6e8b30cbc3_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"paused","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Tor","twitter_handle":"torproject","website":"https://www.torproject.org/","about":"Anonymity Online"}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2017-11-26T13:14:04.234Z","bug_reporter_agreed_on_going_public_at":null,"team_member_agreed_on_going_public_at":"2017-10-27T13:13:57.752Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Replacing all ```tor_malloc``` calls with tor_calloc and ```tor_malloc_zero```\n==============================================================\n\nZeroing memory upon allocating it will prevent vulnerabilities that consist of transmitting data buffers which are not wholly initialized with the intended data (or contain remnants of previous contents).\n\nPseudocode:\n```c\nchar* outbuffer = tor_malloc(100);\nmemcpy(outbuffer, inbuffer, i);\nsend(outbuffer);\n```\n\nIf ```i``` is the result of a calculation whose outcome is _presumed_ to align with the outbuffer's size (100), but in practice is prone to a corner-case where the result is in fact less than 100, then whatever uninitialized memory is present in the allocated heap memory will be transmitted to the other party.\n\nBut if you're using ```tor_malloc_zero``` instead, then the uninitialized memory would simply consist of zeroes, and thus useless for a malicious recipient of the buffer.\n\n```tor_calloc``` is like ```tor_malloc_zero``` in that it zeroes the allocated memory before disclosing it to the invoking function, and moreover has the property of accepting two size_t parameters and verifying whether the product (result of multiplication) is prone to an overflow, and fails if it is. Therefore, it is ideal to use as a substitute for manual multiplication in preparation for a ```tor_malloc``` or ```tor_malloc_zero```:\n\n```c\ntor_malloc(n * sizeof(some_struct_t));\n```\n\nIn instances such as this, it is again _presumed_ that the product of ```n``` and the ```sizeof``` cannot result in an overflow. Even when this is fairly obvious, I'd say there is no reason to delegate the multiplication to ```tor_calloc``` that offers a hard guarantee that the multiplication is safe. As your code grows, and the value of ```n``` starts hinging on factors that may not be immediately obvious, or if fields are added to some_struct_t in order to cater to future requirements, overflows may become a reality without the protection that ```tor_calloc``` offers.\n\nPotential heap corruption via ```write_escaped_data``` in control.c\n==============================================================\n/** Given a \u003cb\u003elen\u003c/b\u003e-character string in \u003cb\u003edata\u003c/b\u003e, made of lines\n * terminated by CRLF, allocate a new string in *\u003cb\u003eout\u003c/b\u003e, and copy the\n * contents of \u003cb\u003edata\u003c/b\u003e into *\u003cb\u003eout\u003c/b\u003e, adding a period before any period\n * that appears at the start of a line, and adding a period-CRLF line at\n * the end. Replace all LF characters sequences with CRLF.  Return the number\n * of bytes in *\u003cb\u003eout\u003c/b\u003e.\n */\nSTATIC size_t\nwrite_escaped_data(const char *data, size_t len, char **out)\n{\n  size_t sz_out = len+8;\n  char *outp;\n  const char *start = data, *end;\n  int i;\n  int start_of_line;\n  for (i=0; i\u003c(int)len; ++i) {\n    if (data[i]== '\\n')\n      sz_out += 2; /* Maybe add a CR; maybe add a dot. */\n  }\n  *out = outp = tor_malloc(sz_out+1);\n  end = data+len;\n  start_of_line = 1;\n  while (data \u003c end) {\n    if (*data == '\\n') {\n      if (data \u003e start \u0026\u0026 data[-1] != '\\r')\n        *outp++ = '\\r';\n      start_of_line = 1;\n    } else if (*data == '.') {\n      if (start_of_line) {\n        start_of_line = 0;\n        *outp++ = '.';\n      }\n    } else {\n      start_of_line = 0;\n    }\n    *outp++ = *data++;\n  }\n  if (outp \u003c *out+2 || fast_memcmp(outp-2, \"\\r\\n\", 2)) {\n    *outp++ = '\\r';\n    *outp++ = '\\n';\n  }\n  *outp++ = '.';\n  *outp++ = '\\r';\n  *outp++ = '\\n';\n  *outp = '\\0'; /* NUL-terminate just in case. */\n  tor_assert((outp - *out) \u003c= (int)sz_out);\n  return outp - *out;\n}\n\nThere are two potential vulnerabilities lurking here:\n\n1. If the input size (```len```) \u003e= 0x80000000, then this loop will not execute at all:\n        \n```c\n  for (i=0; i\u003c(int)len; ++i) {\n    if (data[i]== '\\n')\n      sz_out += 2; /* Maybe add a CR; maybe add a dot. */\n  }\n```\n\nBecause the condition ```i\u003c(int)len``` is effectively ```i\u003c(negative number)``` and ```i``` is intialized to 0, this can never be true. As a result of this, the output buffer (whose size is based on sz_out) is too small to hold the result for an input buffer containing '\\n' characters.\nTriggering this is typically only feasible on a 64-bit system, because if the input buffer is \u003e= 0x80000000 bytes, then sz_out is set to 0x80000008 bytes, and allocating such an amount twice (one for the input buffer, and one for the output buffer) is not possible on a 32-bit system.\n\n2. If the equation (number of '\\n' characters in input buffer * 2 + size of input buffer) exceeds 0xFFFFFFFF, then this will cause heap corruption on a 32-bit system, because sz_out overflows.\n\nSee my attached proof of concept. Compile and execute like this:\n\n```c\ngcc -fsanitize=address -fomit-frame-pointer write_escaped_data.c; ./a.out 1\ngcc -m32 -fsanitize=address -fomit-frame-pointer write_escaped_data.c; ./a.out 2\n```\n\nAs for real exploitability, I spent some effort on creating a real, remote proof of concept for this, but because the data that write_escaped_data may process is the result a multitude of (to me) intricate processes it is hard to come up with a reliable attack.\n\n```write_escaped_data``` draws data from all the getinfo_helper_* functions (via ```handle_control_getinfo``` and ```handle_getinfo_helper```) as well as the amalgate of many potentially many, reasonably large strings in ```control_event_networkstatus_changed_helper```: \n\n```c\n  SMARTLIST_FOREACH(statuses, const routerstatus_t *, rs,\n    {\n      s = networkstatus_getinfo_helper_single(rs);\n      if (!s) continue;\n      smartlist_add(strs, s);\n    });\n\n  s = smartlist_join_strings(strs, \"\", 0, NULL);\n  write_escaped_data(s, strlen(s), \u0026esc);\n```\n\nbase64_decode potential heap corruption on 32-bit systems\n==============================================================\n```c\nint\nbase64_decode(char *dest, size_t destlen, const char *src, size_t srclen)\n{\n...\n...\n  if (destlen \u003c (srclen*3)/4)\n    return -1;\n  if (destlen \u003e SIZE_T_CEILING)\n    return -1;\n```\n\nThe problem here is that the multiplication (by 3) occurs before the division (by 4).\n\nFor source strings larger than 0xFFFFFFFF / 3 == 0x55555555, an overflow will occur within this calculation. If the result of the overflow-affected calculation is smaller than what ```destlen``` is, then this check will be passed and memory will be corrupted.\n\nSee my proof of concept:\n\n```\n$ gcc -m32 -fsanitize=address -fomit-frame-pointer base64_decode.c; ./a.out \n=================================================================\n==32449== ERROR: AddressSanitizer: stack-buffer-overflow on address 0xfff6fe04 at pc 0x804898b bp 0xfff6fcf8 sp 0xfff6fcec\n...\n...\n```\n\nPotential heap corruption in do_getpass in routerkeys.c\n==============================================================\nAt present this cannot be triggered, but, unless this code was designed like this on purpose and you're aware of the weakness, you might want to revisit it.\n\n```do_getpass``` contains this code:\n```c\n  if (twice) {\n    const char msg[] = \"One more time:\";\n    size_t p2len = strlen(prompt) + 1;\n    if (p2len \u003c sizeof(msg))\n      p2len = sizeof(msg);\n    prompt2 = tor_malloc(strlen(prompt)+1);\n    memset(prompt2, ' ', p2len);\n    memcpy(prompt2 + p2len - sizeof(msg), msg, sizeof(msg));\n\n    buf2 = tor_malloc_zero(buflen);\n  }\n```\n\nThere is only one call to this function in the code for which twice == 1:\n\n```code\n  if (do_getpass(\"Enter new passphrase:\", pwbuf0, sizeof(pwbuf0), 1,\n                 get_options()) \u003c 0) {\n    log_warn(LD_OR, \"NO/failed passphrase\");\n    return -1;\n  }\n```\n\nThis will not trigger a memory corruption, but if the first parameter had been shorter, it would:\n\nCompile and run like this:\n\n```\n$ gcc -fomit-frame-pointer -fsanitize=address do_getpass.c \n$ ./a.out \"Enter new passphrase:\"\n$ ./a.out \"Enter new passphrase\"\n$ ./a.out \"Enter new passphras\"\n$ ./a.out \"Enter new passphra\"\n$ ./a.out \"Enter new passphr\"\n$ ./a.out \"Enter new passph\"\n$ ./a.out \"Enter new passp\"\n$ ./a.out \"Enter new pass\"\n$ ./a.out \"Enter new pas\"\n\n==7883== ERROR: AddressSanitizer: heap-buffer-overflow on address 0x60040000dffe at pc 0x400c0a bp 0x7fff8d9c22e0 sp 0x7fff8d9c22d8\n...\n...\n```\n\nSo it's not really a vulnerability at present, but I thought I'd mention it to you since it struck me as odd and it could become a problem if you pass a dynamic, potentially short string (for ex. created with snprintf) to do_getpass.","vulnerability_information_html":"\u003ch1 id=\"replacing-all-tor_malloc-calls-with-tor_calloc-and-tor_malloc_zero\"\u003eReplacing all \u003ccode\u003etor_malloc\u003c/code\u003e calls with tor_calloc and \u003ccode\u003etor_malloc_zero\u003c/code\u003e\n\u003c/h1\u003e\n\n\u003cp\u003eZeroing memory upon allocating it will prevent vulnerabilities that consist of transmitting data buffers which are not wholly initialized with the intended data (or contain remnants of previous contents).\u003c/p\u003e\n\n\u003cp\u003ePseudocode:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight c\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003echar\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003eoutbuffer\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etor_malloc\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e100\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"n\"\u003ememcpy\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eoutbuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003einbuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"n\"\u003esend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eoutbuffer\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eIf \u003ccode\u003ei\u003c/code\u003e is the result of a calculation whose outcome is \u003cu\u003epresumed\u003c/u\u003e to align with the outbuffer\u0026#39;s size (100), but in practice is prone to a corner-case where the result is in fact less than 100, then whatever uninitialized memory is present in the allocated heap memory will be transmitted to the other party.\u003c/p\u003e\n\n\u003cp\u003eBut if you\u0026#39;re using \u003ccode\u003etor_malloc_zero\u003c/code\u003e instead, then the uninitialized memory would simply consist of zeroes, and thus useless for a malicious recipient of the buffer.\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003etor_calloc\u003c/code\u003e is like \u003ccode\u003etor_malloc_zero\u003c/code\u003e in that it zeroes the allocated memory before disclosing it to the invoking function, and moreover has the property of accepting two size_t parameters and verifying whether the product (result of multiplication) is prone to an overflow, and fails if it is. Therefore, it is ideal to use as a substitute for manual multiplication in preparation for a \u003ccode\u003etor_malloc\u003c/code\u003e or \u003ccode\u003etor_malloc_zero\u003c/code\u003e:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight c\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003etor_malloc\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003en\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"nf\"\u003esizeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esome_struct_t\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eIn instances such as this, it is again \u003cu\u003epresumed\u003c/u\u003e that the product of \u003ccode\u003en\u003c/code\u003e and the \u003ccode\u003esizeof\u003c/code\u003e cannot result in an overflow. Even when this is fairly obvious, I\u0026#39;d say there is no reason to delegate the multiplication to \u003ccode\u003etor_calloc\u003c/code\u003e that offers a hard guarantee that the multiplication is safe. As your code grows, and the value of \u003ccode\u003en\u003c/code\u003e starts hinging on factors that may not be immediately obvious, or if fields are added to some_struct_t in order to cater to future requirements, overflows may become a reality without the protection that \u003ccode\u003etor_calloc\u003c/code\u003e offers.\u003c/p\u003e\n\n\u003ch1 id=\"potential-heap-corruption-via-write_escaped_data-in-control-c\"\u003ePotential heap corruption via \u003ccode\u003ewrite_escaped_data\u003c/code\u003e in control.c\u003c/h1\u003e\n\n\u003cp\u003e/** Given a \u0026lt;b\u0026gt;len\u0026lt;/b\u0026gt;-character string in \u0026lt;b\u0026gt;data\u0026lt;/b\u0026gt;, made of lines\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eterminated by CRLF, allocate a new string in *\u0026lt;b\u0026gt;out\u0026lt;/b\u0026gt;, and copy the\u003c/li\u003e\n\u003cli\u003econtents of \u0026lt;b\u0026gt;data\u0026lt;/b\u0026gt; into *\u0026lt;b\u0026gt;out\u0026lt;/b\u0026gt;, adding a period before any period\u003c/li\u003e\n\u003cli\u003ethat appears at the start of a line, and adding a period-CRLF line at\u003c/li\u003e\n\u003cli\u003ethe end. Replace all LF characters sequences with CRLF.  Return the number\u003c/li\u003e\n\u003cli\u003eof bytes in \u003cem\u003e\u0026lt;b\u0026gt;out\u0026lt;/b\u0026gt;.\n*/\nSTATIC size_t\nwrite_escaped_data(const char *data, size_t len, char **out)\n{\nsize_t sz_out = len+8;\nchar *outp;\nconst char *start = data, *end;\nint i;\nint start_of_line;\nfor (i=0; i\u0026lt;(int)len; ++i) {\nif (data[i]== \u0026#39;\\n\u0026#39;)\n  sz_out += 2; /\u003c/em\u003e Maybe add a CR; maybe add a dot. \u003cem\u003e/\n}\n*out = outp = tor_malloc(sz_out+1);\nend = data+len;\nstart_of_line = 1;\nwhile (data \u0026lt; end) {\nif (*data == \u0026#39;\\n\u0026#39;) {\n  if (data \u0026gt; start \u0026amp;\u0026amp; data[-1] != \u0026#39;\\r\u0026#39;)\n    *outp++ = \u0026#39;\\r\u0026#39;;\n  start_of_line = 1;\n} else if (*data == \u0026#39;.\u0026#39;) {\n  if (start_of_line) {\n    start_of_line = 0;\n    *outp++ = \u0026#39;.\u0026#39;;\n  }\n} else {\n  start_of_line = 0;\n}\n*outp++ = *data++;\n}\nif (outp \u0026lt; *out+2 || fast_memcmp(outp-2, \u0026quot;\\r\\n\u0026quot;, 2)) {\n*outp++ = \u0026#39;\\r\u0026#39;;\n*outp++ = \u0026#39;\\n\u0026#39;;\n}\n*outp++ = \u0026#39;.\u0026#39;;\n*outp++ = \u0026#39;\\r\u0026#39;;\n*outp++ = \u0026#39;\\n\u0026#39;;\n*outp = \u0026#39;\\0\u0026#39;; /\u003c/em\u003e NUL-terminate just in case. */\ntor_assert((outp - *out) \u0026lt;= (int)sz_out);\nreturn outp - *out;\n}\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eThere are two potential vulnerabilities lurking here:\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eIf the input size (\u003ccode\u003elen\u003c/code\u003e) \u0026gt;= 0x80000000, then this loop will not execute at all:\u003c/li\u003e\n\u003c/ol\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight c\"\u003e\u003ccode\u003e  \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003elen\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"o\"\u003e++\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"sc\"\u003e\u0026#39;\\n\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n      \u003cspan class=\"n\"\u003esz_out\u003c/span\u003e \u003cspan class=\"o\"\u003e+=\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"cm\"\u003e/* Maybe add a CR; maybe add a dot. */\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eBecause the condition \u003ccode\u003ei\u0026lt;(int)len\u003c/code\u003e is effectively \u003ccode\u003ei\u0026lt;(negative number)\u003c/code\u003e and \u003ccode\u003ei\u003c/code\u003e is intialized to 0, this can never be true. As a result of this, the output buffer (whose size is based on sz_out) is too small to hold the result for an input buffer containing \u0026#39;\\n\u0026#39; characters.\u003cbr\u003e\nTriggering this is typically only feasible on a 64-bit system, because if the input buffer is \u0026gt;= 0x80000000 bytes, then sz_out is set to 0x80000008 bytes, and allocating such an amount twice (one for the input buffer, and one for the output buffer) is not possible on a 32-bit system.\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eIf the equation (number of \u0026#39;\\n\u0026#39; characters in input buffer * 2 + size of input buffer) exceeds 0xFFFFFFFF, then this will cause heap corruption on a 32-bit system, because sz_out overflows.\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eSee my attached proof of concept. Compile and execute like this:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight c\"\u003e\u003ccode\u003e\u003cspan class=\"n\"\u003egcc\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003efsanitize\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eaddress\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003efomit\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003eframe\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003epointer\u003c/span\u003e \u003cspan class=\"n\"\u003ewrite_escaped_data\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ec\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eout\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n\u003cspan class=\"n\"\u003egcc\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003em32\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003efsanitize\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eaddress\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003efomit\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003eframe\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003epointer\u003c/span\u003e \u003cspan class=\"n\"\u003ewrite_escaped_data\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ec\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eout\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eAs for real exploitability, I spent some effort on creating a real, remote proof of concept for this, but because the data that write_escaped_data may process is the result a multitude of (to me) intricate processes it is hard to come up with a reliable attack.\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003ewrite_escaped_data\u003c/code\u003e draws data from all the getinfo_helper_* functions (via \u003ccode\u003ehandle_control_getinfo\u003c/code\u003e and \u003ccode\u003ehandle_getinfo_helper\u003c/code\u003e) as well as the amalgate of many potentially many, reasonably large strings in \u003ccode\u003econtrol_event_networkstatus_changed_helper\u003c/code\u003e: \u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight c\"\u003e\u003ccode\u003e  \u003cspan class=\"n\"\u003eSMARTLIST_FOREACH\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estatuses\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"n\"\u003erouterstatus_t\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ers\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"n\"\u003es\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003enetworkstatus_getinfo_helper_single\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ers\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n      \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"n\"\u003es\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003econtinue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"n\"\u003esmartlist_add\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estrs\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003es\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\n  \u003cspan class=\"n\"\u003es\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003esmartlist_join_strings\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estrs\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026quot;\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nb\"\u003eNULL\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"n\"\u003ewrite_escaped_data\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003es\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003estrlen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003es\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003eesc\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch1 id=\"base64_decode-potential-heap-corruption-on-32-bit-systems\"\u003ebase64_decode potential heap corruption on 32-bit systems\u003c/h1\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight c\"\u003e\u003ccode\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\n\u003cspan class=\"nf\"\u003ebase64_decode\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003echar\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003edest\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003esize_t\u003c/span\u003e \u003cspan class=\"n\"\u003edestlen\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003echar\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003esrc\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003esize_t\u003c/span\u003e \u003cspan class=\"n\"\u003esrclen\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003cspan class=\"p\"\u003e...\u003c/span\u003e\n\u003cspan class=\"p\"\u003e...\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edestlen\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esrclen\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edestlen\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eSIZE_T_CEILING\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThe problem here is that the multiplication (by 3) occurs before the division (by 4).\u003c/p\u003e\n\n\u003cp\u003eFor source strings larger than 0xFFFFFFFF / 3 == 0x55555555, an overflow will occur within this calculation. If the result of the overflow-affected calculation is smaller than what \u003ccode\u003edestlen\u003c/code\u003e is, then this check will be passed and memory will be corrupted.\u003c/p\u003e\n\n\u003cp\u003eSee my proof of concept:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e$ gcc -m32 -fsanitize=address -fomit-frame-pointer base64_decode.c; ./a.out \n=================================================================\n==32449== ERROR: AddressSanitizer: stack-buffer-overflow on address 0xfff6fe04 at pc 0x804898b bp 0xfff6fcf8 sp 0xfff6fcec\n...\n...\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch1 id=\"potential-heap-corruption-in-do_getpass-in-routerkeys-c\"\u003ePotential heap corruption in do_getpass in routerkeys.c\u003c/h1\u003e\n\n\u003cp\u003eAt present this cannot be triggered, but, unless this code was designed like this on purpose and you\u0026#39;re aware of the weakness, you might want to revisit it.\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003edo_getpass\u003c/code\u003e contains this code:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight c\"\u003e\u003ccode\u003e  \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etwice\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003echar\u003c/span\u003e \u003cspan class=\"n\"\u003emsg\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026quot;One more time:\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003esize_t\u003c/span\u003e \u003cspan class=\"n\"\u003ep2len\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003estrlen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eprompt\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ep2len\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"k\"\u003esizeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emsg\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n      \u003cspan class=\"n\"\u003ep2len\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003esizeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emsg\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eprompt2\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etor_malloc\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estrlen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eprompt\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ememset\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eprompt2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"sc\"\u003e\u0026#39; \u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ep2len\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ememcpy\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eprompt2\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003ep2len\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"k\"\u003esizeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emsg\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"n\"\u003emsg\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003esizeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emsg\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003ebuf2\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etor_malloc_zero\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebuflen\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThere is only one call to this function in the code for which twice == 1:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e  if (do_getpass(\u0026quot;Enter new passphrase:\u0026quot;, pwbuf0, sizeof(pwbuf0), 1,\n                 get_options()) \u0026lt; 0) {\n    log_warn(LD_OR, \u0026quot;NO/failed passphrase\u0026quot;);\n    return -1;\n  }\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThis will not trigger a memory corruption, but if the first parameter had been shorter, it would:\u003c/p\u003e\n\n\u003cp\u003eCompile and run like this:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e$ gcc -fomit-frame-pointer -fsanitize=address do_getpass.c \n$ ./a.out \u0026quot;Enter new passphrase:\u0026quot;\n$ ./a.out \u0026quot;Enter new passphrase\u0026quot;\n$ ./a.out \u0026quot;Enter new passphras\u0026quot;\n$ ./a.out \u0026quot;Enter new passphra\u0026quot;\n$ ./a.out \u0026quot;Enter new passphr\u0026quot;\n$ ./a.out \u0026quot;Enter new passph\u0026quot;\n$ ./a.out \u0026quot;Enter new passp\u0026quot;\n$ ./a.out \u0026quot;Enter new pass\u0026quot;\n$ ./a.out \u0026quot;Enter new pas\u0026quot;\n\n==7883== ERROR: AddressSanitizer: heap-buffer-overflow on address 0x60040000dffe at pc 0x400c0a bp 0x7fff8d9c22e0 sp 0x7fff8d9c22d8\n...\n...\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eSo it\u0026#39;s not really a vulnerability at present, but I thought I\u0026#39;d mention it to you since it struck me as odd and it could become a problem if you pass a dynamic, potentially short string (for ex. created with snprintf) to do_getpass.\u003c/p\u003e\n","bounty_amount":"500.0","formatted_bounty":"$500","weakness":{"id":57,"name":"Violation of Secure Design Principles"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":72882,"file_name":"do_getpass.c","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/072/882/cddc74dce8b0c1cb33f907909f3b239881514b9b/do_getpass.c?response-content-disposition=attachment%3B%20filename%3D%22do_getpass.c%22%3B%20filename%2A%3DUTF-8%27%27do_getpass.c\u0026response-content-type=text%2Fx-c\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQTGH7D7G4%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T041813Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJz%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIF3bZwIuJVbBath9RBAagycfg6N290U9MaBDwIhhNMqjAiEA5QJFTUjUu%2BelINQ8mBSRMtPAJunx%2FkQdIQYoGvxoAn0qtAMIVRABGgwwMTM2MTkyNzQ4NDkiDKWCtAdrSoxlUzEo5CqRA2KbCK2gb0cQjXvMxG7rxH%2BqkR2WSbvaIs%2FZazFNKw1eZW2WrZTy5Q04uSJp6R8rbsBzRSLIFhyP9QTQMq5P15qLdwXnZbOxNVoADzWwgfUfGt%2BOwI%2BEjM3ovXNd1aGU0Ee1TBGk3LBN3uQ8ppV7Xii57PrmCtM4dm9usXbAaaa8f8QiQFPH1YTkHf%2FPe1cgMlFNJFqSrmu3ZMinUb9pxpphywkYT29wP%2Fak4Sy9A3St63iqnDzi8wrdG9%2FGdB7M03pSeaVTcH99G5j%2FqMpFpJxYN8TNlglA1OWgt7QlVOqnq65zCp4szGmwzF1FrjkS%2Bp3wB27lGxlw0v79ozRdwRBFBFvrSgSeToK8vpEBIlnO4uogSsVneM6zoYfyQw3%2F6HqcPg9mVWJmJS4QLMpQTMd%2FMeYn%2F%2Ffl2Vt%2Bb0X2rNtQPeWMGpzHpq6XAiCjZ%2F33fJuN%2B3j9Lmo023GSXKu%2B%2FkZTBp3waVREDqE%2BNeB30X8ZT5%2BW0bqtpGbJe8ig5jtSZzprCWg9v84Utvz3uaa%2Bcjz7MJPPqv8FOusBEHCYkRstnRk5lzIXoX3CRWjAJcL61b1gmhmecG%2Fow23IgJkGaQ5%2B%2FkCWvGrt4rLn9BlUKR84X6ifbCLPwMQevITvtVqg1wdT%2FzOjUyHnqnZVOyLFoqLXk9MNjw1VTb%2FmSNp%2Bd5NsBD5KiAAd50U1%2F1jl5yoSrl0DpEi6Yzv0bFigmUQPNRZeTImBJ2V75RxXBbDSoevWuBT70W%2F8%2BsoyTMqti7McilmsidA1BnI1f8HDTyMQGIoexlo%2BO7e5AiNtCUboKL2ZiertWXe5cEVF9mAVgHpVtz7pIIElyyZjsKslJzP%2B5WRhYUkMYg%3D%3D\u0026X-Amz-Signature=2769c18f4d5e4a8838ed04d401e2af30b59c42d42a9bbf84b008ed5fb0f17b8d","file_size":651,"type":"text/x-c"},{"id":72883,"file_name":"base64_decode.c","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/072/883/2a81f5207bb56e2e25405dafcbf323265d2a04fc/base64_decode.c?response-content-disposition=attachment%3B%20filename%3D%22base64_decode.c%22%3B%20filename%2A%3DUTF-8%27%27base64_decode.c\u0026response-content-type=text%2Fx-c\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQTGH7D7G4%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T041813Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJz%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIF3bZwIuJVbBath9RBAagycfg6N290U9MaBDwIhhNMqjAiEA5QJFTUjUu%2BelINQ8mBSRMtPAJunx%2FkQdIQYoGvxoAn0qtAMIVRABGgwwMTM2MTkyNzQ4NDkiDKWCtAdrSoxlUzEo5CqRA2KbCK2gb0cQjXvMxG7rxH%2BqkR2WSbvaIs%2FZazFNKw1eZW2WrZTy5Q04uSJp6R8rbsBzRSLIFhyP9QTQMq5P15qLdwXnZbOxNVoADzWwgfUfGt%2BOwI%2BEjM3ovXNd1aGU0Ee1TBGk3LBN3uQ8ppV7Xii57PrmCtM4dm9usXbAaaa8f8QiQFPH1YTkHf%2FPe1cgMlFNJFqSrmu3ZMinUb9pxpphywkYT29wP%2Fak4Sy9A3St63iqnDzi8wrdG9%2FGdB7M03pSeaVTcH99G5j%2FqMpFpJxYN8TNlglA1OWgt7QlVOqnq65zCp4szGmwzF1FrjkS%2Bp3wB27lGxlw0v79ozRdwRBFBFvrSgSeToK8vpEBIlnO4uogSsVneM6zoYfyQw3%2F6HqcPg9mVWJmJS4QLMpQTMd%2FMeYn%2F%2Ffl2Vt%2Bb0X2rNtQPeWMGpzHpq6XAiCjZ%2F33fJuN%2B3j9Lmo023GSXKu%2B%2FkZTBp3waVREDqE%2BNeB30X8ZT5%2BW0bqtpGbJe8ig5jtSZzprCWg9v84Utvz3uaa%2Bcjz7MJPPqv8FOusBEHCYkRstnRk5lzIXoX3CRWjAJcL61b1gmhmecG%2Fow23IgJkGaQ5%2B%2FkCWvGrt4rLn9BlUKR84X6ifbCLPwMQevITvtVqg1wdT%2FzOjUyHnqnZVOyLFoqLXk9MNjw1VTb%2FmSNp%2Bd5NsBD5KiAAd50U1%2F1jl5yoSrl0DpEi6Yzv0bFigmUQPNRZeTImBJ2V75RxXBbDSoevWuBT70W%2F8%2BsoyTMqti7McilmsidA1BnI1f8HDTyMQGIoexlo%2BO7e5AiNtCUboKL2ZiertWXe5cEVF9mAVgHpVtz7pIIElyyZjsKslJzP%2B5WRhYUkMYg%3D%3D\u0026X-Amz-Signature=f652fde74ecf888a1c27379c2855cca9341ce7a24c3bdce03fdf70a070bce2d2","file_size":3716,"type":"text/x-c"},{"id":72884,"file_name":"write_escaped_data.c","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/072/884/54688db732a59d28081d671200cfc4b7efe26e79/write_escaped_data.c?response-content-disposition=attachment%3B%20filename%3D%22write_escaped_data.c%22%3B%20filename%2A%3DUTF-8%27%27write_escaped_data.c\u0026response-content-type=text%2Fx-c\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQTGH7D7G4%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T041813Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJz%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIF3bZwIuJVbBath9RBAagycfg6N290U9MaBDwIhhNMqjAiEA5QJFTUjUu%2BelINQ8mBSRMtPAJunx%2FkQdIQYoGvxoAn0qtAMIVRABGgwwMTM2MTkyNzQ4NDkiDKWCtAdrSoxlUzEo5CqRA2KbCK2gb0cQjXvMxG7rxH%2BqkR2WSbvaIs%2FZazFNKw1eZW2WrZTy5Q04uSJp6R8rbsBzRSLIFhyP9QTQMq5P15qLdwXnZbOxNVoADzWwgfUfGt%2BOwI%2BEjM3ovXNd1aGU0Ee1TBGk3LBN3uQ8ppV7Xii57PrmCtM4dm9usXbAaaa8f8QiQFPH1YTkHf%2FPe1cgMlFNJFqSrmu3ZMinUb9pxpphywkYT29wP%2Fak4Sy9A3St63iqnDzi8wrdG9%2FGdB7M03pSeaVTcH99G5j%2FqMpFpJxYN8TNlglA1OWgt7QlVOqnq65zCp4szGmwzF1FrjkS%2Bp3wB27lGxlw0v79ozRdwRBFBFvrSgSeToK8vpEBIlnO4uogSsVneM6zoYfyQw3%2F6HqcPg9mVWJmJS4QLMpQTMd%2FMeYn%2F%2Ffl2Vt%2Bb0X2rNtQPeWMGpzHpq6XAiCjZ%2F33fJuN%2B3j9Lmo023GSXKu%2B%2FkZTBp3waVREDqE%2BNeB30X8ZT5%2BW0bqtpGbJe8ig5jtSZzprCWg9v84Utvz3uaa%2Bcjz7MJPPqv8FOusBEHCYkRstnRk5lzIXoX3CRWjAJcL61b1gmhmecG%2Fow23IgJkGaQ5%2B%2FkCWvGrt4rLn9BlUKR84X6ifbCLPwMQevITvtVqg1wdT%2FzOjUyHnqnZVOyLFoqLXk9MNjw1VTb%2FmSNp%2Bd5NsBD5KiAAd50U1%2F1jl5yoSrl0DpEi6Yzv0bFigmUQPNRZeTImBJ2V75RxXBbDSoevWuBT70W%2F8%2BsoyTMqti7McilmsidA1BnI1f8HDTyMQGIoexlo%2BO7e5AiNtCUboKL2ZiertWXe5cEVF9mAVgHpVtz7pIIElyyZjsKslJzP%2B5WRhYUkMYg%3D%3D\u0026X-Amz-Signature=09d3cb584b3de9042bbdff1d1410aff267e310eb13732ce5a4126f811736e688","file_size":3155,"type":"text/x-c"}],"allow_singular_disclosure_at":"2017-11-26T13:13:57.886Z","allow_singular_disclosure_after":-97513455.81709282,"singular_disclosure_allowed":true,"vote_count":8,"voters":["jensec","fa1rlight","eveeez","geeknik","cr4xerbik4sh","japz","sh3r1","captianamerica5"],"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":792713,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Looks like I ruined the layout a bit in the ```write_escaped_data``` chapter, I had meant to put the listing of that function there.","markdown_message":"\u003cp\u003eLooks like I ruined the layout a bit in the \u003ccode\u003ewrite_escaped_data\u003c/code\u003e chapter, I had meant to put the listing of that function there.\u003c/p\u003e\n","automated_response":false,"created_at":"2016-02-10T12:04:49.026Z","updated_at":"2016-02-10T12:04:49.026Z","actor":{"username":"guido","cleared":false,"url":"/guido","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/983/e55b0b2324777fb7efc2de4212fd8d337ca816bd_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"torproject","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":796542,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hello guido,\n\nthanks for the new bug reports!\n\nI'll forward them to more Tor devs tomorrow, and handle them all next week.\n\nLet me know if you are in a hurry and I will allocate extra resources to this end.\n\nThanks!","markdown_message":"\u003cp\u003eHello guido,\u003c/p\u003e\n\n\u003cp\u003ethanks for the new bug reports!\u003c/p\u003e\n\n\u003cp\u003eI\u0026#39;ll forward them to more Tor devs tomorrow, and handle them all next week.\u003c/p\u003e\n\n\u003cp\u003eLet me know if you are in a hurry and I will allocate extra resources to this end.\u003c/p\u003e\n\n\u003cp\u003eThanks!\u003c/p\u003e\n","automated_response":false,"created_at":"2016-02-13T01:23:52.546Z","updated_at":"2016-02-13T01:23:52.546Z","actor":{"username":"asn","cleared":false,"url":"/asn","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"torproject","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":796774,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Not in a hurry, take your time :).\n\nGuido","markdown_message":"\u003cp\u003eNot in a hurry, take your time :).\u003c/p\u003e\n\n\u003cp\u003eGuido\u003c/p\u003e\n","automated_response":false,"created_at":"2016-02-13T11:39:47.461Z","updated_at":"2016-02-13T11:39:47.461Z","actor":{"username":"guido","cleared":false,"url":"/guido","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/983/e55b0b2324777fb7efc2de4212fd8d337ca816bd_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"torproject","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":821763,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi, could you please comment on this one?","markdown_message":"\u003cp\u003eHi, could you please comment on this one?\u003c/p\u003e\n","automated_response":false,"created_at":"2016-03-02T23:18:03.478Z","updated_at":"2016-03-02T23:18:03.478Z","actor":{"username":"guido","cleared":false,"url":"/guido","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/983/e55b0b2324777fb7efc2de4212fd8d337ca816bd_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"torproject","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":822610,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hello there,\n\nthe fact that this report contains multiple bugs makes it hard to analyze and figure out it's reward.\n\nAfter discussion with other Tor devs, we are mainly concerned about the bug in `write_escaped_data` but we can't find a nice way to remotely trigger it either.\n\nThe `base64_decode()` bug is also interesting but we couldn't find a place where we call it with such huge strings from the network.  The size of most directory documents are restricted by size. If you can find such a codepath, please let us know.\n\nWith the current state of this bug report, we are considering rewarding $500 to this bug report, mainly because of the two bugs above.\n\nI will let this open some more in case you get more time to analyze this.\n\nThanks again!\n","markdown_message":"\u003cp\u003eHello there,\u003c/p\u003e\n\n\u003cp\u003ethe fact that this report contains multiple bugs makes it hard to analyze and figure out it\u0026#39;s reward.\u003c/p\u003e\n\n\u003cp\u003eAfter discussion with other Tor devs, we are mainly concerned about the bug in \u003ccode\u003ewrite_escaped_data\u003c/code\u003e but we can\u0026#39;t find a nice way to remotely trigger it either.\u003c/p\u003e\n\n\u003cp\u003eThe \u003ccode\u003ebase64_decode()\u003c/code\u003e bug is also interesting but we couldn\u0026#39;t find a place where we call it with such huge strings from the network.  The size of most directory documents are restricted by size. If you can find such a codepath, please let us know.\u003c/p\u003e\n\n\u003cp\u003eWith the current state of this bug report, we are considering rewarding $500 to this bug report, mainly because of the two bugs above.\u003c/p\u003e\n\n\u003cp\u003eI will let this open some more in case you get more time to analyze this.\u003c/p\u003e\n\n\u003cp\u003eThanks again!\u003c/p\u003e\n","automated_response":false,"created_at":"2016-03-03T14:48:00.910Z","updated_at":"2016-03-03T14:48:00.910Z","actor":{"username":"asn","cleared":false,"url":"/asn","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"torproject","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":829270,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Awarding $500 here. Will update the ticket when we file the bugs on the bug tracker.\nThanks!","markdown_message":"\u003cp\u003eAwarding $500 here. Will update the ticket when we file the bugs on the bug tracker.\u003cbr\u003e\nThanks!\u003c/p\u003e\n","automated_response":false,"created_at":"2016-03-08T16:59:22.472Z","updated_at":"2016-03-08T16:59:22.472Z","actor":{"url":"/torproject","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/800/6e575d0a9127b91e83833cf4a9e6be6e8b30cbc3_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Tor"}},"bounty_amount":"500.0","bounty_currency":"usd","genius_execution_id":null,"team_handle":"torproject","collaborator":{"username":"guido","url":"/guido"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":829914,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks!!","markdown_message":"\u003cp\u003eThanks!!\u003c/p\u003e\n","automated_response":false,"created_at":"2016-03-08T22:39:35.622Z","updated_at":"2016-03-08T22:39:35.622Z","actor":{"username":"guido","cleared":false,"url":"/guido","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/983/e55b0b2324777fb7efc2de4212fd8d337ca816bd_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"torproject","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":864330,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","markdown_message":"","automated_response":false,"created_at":"2016-03-23T09:06:25.158Z","updated_at":"2016-03-23T09:06:25.158Z","actor":{"username":"geko","cleared":false,"url":"/geko","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"torproject","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":985190,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Can this one too be marked as \"resolved\" when you're ready? Thanks.","markdown_message":"\u003cp\u003eCan this one too be marked as \u0026quot;resolved\u0026quot; when you\u0026#39;re ready? Thanks.\u003c/p\u003e\n","automated_response":false,"created_at":"2016-05-26T14:58:07.044Z","updated_at":"2016-05-26T14:58:07.044Z","actor":{"username":"guido","cleared":false,"url":"/guido","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/983/e55b0b2324777fb7efc2de4212fd8d337ca816bd_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"torproject","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":985368,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"there you go. Sorry. Pretty new to this hackerone thing :)","markdown_message":"\u003cp\u003ethere you go. Sorry. Pretty new to this hackerone thing :)\u003c/p\u003e\n","automated_response":false,"created_at":"2016-05-26T16:27:49.098Z","updated_at":"2016-05-26T16:27:49.098Z","actor":{"username":"asn","cleared":false,"url":"/asn","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"guido","url":"/guido"},"genius_execution_id":null,"team_handle":"torproject","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2108317,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Handled as part of tor's tickets #19281 and #19222.","markdown_message":"\u003cp\u003eHandled as part of tor\u0026#39;s tickets \u003ca href=\"/reports/19281\"\u003e#19281\u003c/a\u003e and \u003ca href=\"/reports/19222\"\u003e#19222\u003c/a\u003e.\u003c/p\u003e\n","automated_response":false,"created_at":"2017-10-27T13:13:57.793Z","updated_at":"2017-10-27T13:13:57.793Z","first_to_agree":true,"actor":{"username":"asn","cleared":false,"url":"/asn","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"torproject","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":2182463,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2017-11-26T13:14:04.258Z","updated_at":"2017-11-26T13:14:04.258Z","actor":{"url":"/torproject","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/001/800/6e575d0a9127b91e83833cf4a9e6be6e8b30cbc3_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Tor"}},"genius_execution_id":null,"team_handle":"torproject","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}