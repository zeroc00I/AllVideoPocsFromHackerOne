{"id":435618,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC80MzU2MTg=","url":"https://hackerone.com/reports/435618","title":"Kaspersky Password Manager is vulnerable to HTML injection in the browser action pop-up via user name","state":"Closed","substate":"resolved","severity_rating":"medium","readable_substate":"Resolved","created_at":"2018-11-07T11:33:36.938Z","submitted_at":"2018-11-07T11:33:36.938Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"palant","url":"/palant","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/125/397/69a28ca9d5030b1db03411852407732328b571c3_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":false,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":2379,"url":"https://hackerone.com/kaspersky","handle":"kaspersky","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/002/379/d7dc3ce53a84816885872fb423816bfbbbd36390_original.png/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/379/d7dc3ce53a84816885872fb423816bfbbbd36390_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"Kaspersky","twitter_handle":"kaspersky","website":"http://www.kaspersky.com","about":"Kaspersky is the worldâ€™s largest privately-held vendor of endpoint protection and cybersecurity solutions for business and consumers."}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2018-12-24T05:31:48.182Z","bug_reporter_agreed_on_going_public_at":"2018-12-03T11:23:16.398Z","team_member_agreed_on_going_public_at":"2018-12-24T05:31:48.124Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"*Note*: According to https://www.securityweek.com/kaspersky-adds-password-manager-bug-bounty-program and some other sources, Kaspersky Password Manager is in scope for this program. The program description doesn't reflect this however.\n\n**Summary**\nThere is a stored XSS vulnerability in popover.html (the page being displayed as browser action pop-up in the Kaspersky Password Manager browser extension) via user names. While exploitation is complicated due to Content Security Policy, this isn't harmless either.\n\n**Description**\npopover.html fails to escape user names, so this is a proper stored XSS vulnerability. However, Content Security Policy prevents arbitrary script execution here. What can still be done is injecting HTML code. For my proof of concept I chose to inject an external stylesheet and an iframe tag. The result is a perfectly spoofed master password prompt, for the user this is impossible to distinguish from the real thing.\n\n**Environment**\n- Scope: Application\n- Product name: Kaspersky Password Manager\n- Product version: 9.0.1.447\n- OS name and version (incl SP): Windows 10 Version 1803\n- Attack type: XSS\n- Maximum user privileges needed to reproduce your issue: no privileges\n\n**Steps to reproduce**\n1. Download the attached tricky_login.html, x.html, x.css files into a directory and make them available via any web server (localhost will do).\n2. Make sure Kaspersky Password Manager is installed in your browser and unlocked.\n3. Go to http://.../tricky_login.html with your browser (I tried this with Firefox 62 and Chrome 70).\n4. Enter any credentials into the login form and click \"Log in.\"\n5. Allow Kaspersky Password Manager to save these credentials. Note that the dialog shows exactly the user name you entered - while the webpage manipulated it to add HTML code at the end, the HTML code follows after a number of spaces so that it is cut off in the display here.\n6. Now the page claims that something went wrong and asks you to try again. At the same time, KPM icons on the input fields also claim an issue and ask you to use the toolbar button - these icons have been manipulated by the website. Do as you are told and click the toolbar button.\n7. Note how the toolbar button displays a proper master password prompt to you. In Firefox you will see a warning but only if the web server isn't using HTTPS. Enter something into the master password field and click \"Unlock.\"\n\nYou will see an alert message saying: \"Gotcha! Your password is: ...\" The page you entered your password on didn't belong to Kaspersky Password Manager, it was rather x.html from this proof of concept.\n\n## Impact\n\nAs long as CSP is enabled, the impact is limited. However, as this proof of concept illustrates, this still allows websites to spoof trusted KPM user interface and trick users into entering their passwords. At the very least, websites could inject tracking images to monitor KPM usage.","vulnerability_information_html":"\u003cp\u003e\u003cem\u003eNote\u003c/em\u003e: According to \u003ca title=\"https://www.securityweek.com/kaspersky-adds-password-manager-bug-bounty-program\" href=\"/redirect?url=https%3A%2F%2Fwww.securityweek.com%2Fkaspersky-adds-password-manager-bug-bounty-program\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://www.securityweek.com/kaspersky-adds-password-manager-bug-bounty-program\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e and some other sources, Kaspersky Password Manager is in scope for this program. The program description doesn\u0026#39;t reflect this however.\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eSummary\u003c/strong\u003e\u003cbr\u003e\nThere is a stored XSS vulnerability in popover.html (the page being displayed as browser action pop-up in the Kaspersky Password Manager browser extension) via user names. While exploitation is complicated due to Content Security Policy, this isn\u0026#39;t harmless either.\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eDescription\u003c/strong\u003e\u003cbr\u003e\npopover.html fails to escape user names, so this is a proper stored XSS vulnerability. However, Content Security Policy prevents arbitrary script execution here. What can still be done is injecting HTML code. For my proof of concept I chose to inject an external stylesheet and an iframe tag. The result is a perfectly spoofed master password prompt, for the user this is impossible to distinguish from the real thing.\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eEnvironment\u003c/strong\u003e\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eScope: Application\u003c/li\u003e\n\u003cli\u003eProduct name: Kaspersky Password Manager\u003c/li\u003e\n\u003cli\u003eProduct version: 9.0.1.447\u003c/li\u003e\n\u003cli\u003eOS name and version (incl SP): Windows 10 Version 1803\u003c/li\u003e\n\u003cli\u003eAttack type: XSS\u003c/li\u003e\n\u003cli\u003eMaximum user privileges needed to reproduce your issue: no privileges\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e\u003cstrong\u003eSteps to reproduce\u003c/strong\u003e\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eDownload the attached tricky_login.html, x.html, x.css files into a directory and make them available via any web server (localhost will do).\u003c/li\u003e\n\u003cli\u003eMake sure Kaspersky Password Manager is installed in your browser and unlocked.\u003c/li\u003e\n\u003cli\u003eGo to http://.../tricky_login.html with your browser (I tried this with Firefox 62 and Chrome 70).\u003c/li\u003e\n\u003cli\u003eEnter any credentials into the login form and click \u0026quot;Log in.\u0026quot;\u003c/li\u003e\n\u003cli\u003eAllow Kaspersky Password Manager to save these credentials. Note that the dialog shows exactly the user name you entered - while the webpage manipulated it to add HTML code at the end, the HTML code follows after a number of spaces so that it is cut off in the display here.\u003c/li\u003e\n\u003cli\u003eNow the page claims that something went wrong and asks you to try again. At the same time, KPM icons on the input fields also claim an issue and ask you to use the toolbar button - these icons have been manipulated by the website. Do as you are told and click the toolbar button.\u003c/li\u003e\n\u003cli\u003eNote how the toolbar button displays a proper master password prompt to you. In Firefox you will see a warning but only if the web server isn\u0026#39;t using HTTPS. Enter something into the master password field and click \u0026quot;Unlock.\u0026quot;\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eYou will see an alert message saying: \u0026quot;Gotcha! Your password is: ...\u0026quot; The page you entered your password on didn\u0026#39;t belong to Kaspersky Password Manager, it was rather x.html from this proof of concept.\u003c/p\u003e\n\n\u003ch2 id=\"impact\"\u003eImpact\u003c/h2\u003e\n\n\u003cp\u003eAs long as CSP is enabled, the impact is limited. However, as this proof of concept illustrates, this still allows websites to spoof trusted KPM user interface and trick users into entering their passwords. At the very least, websites could inject tracking images to monitor KPM usage.\u003c/p\u003e\n","bounty_amount":"2000.0","formatted_bounty":"$2,000","weakness":{"id":62,"name":"Cross-site Scripting (XSS) - Stored"},"original_report_id":null,"original_report_url":null,"attachments":[],"allow_singular_disclosure_at":"2019-01-02T11:23:16.451Z","allow_singular_disclosure_after":-62793271.406967156,"singular_disclosure_allowed":true,"vote_count":32,"voters":["kapytein","spam404","mik317","sameerphad72","ahiezer","dhakal_ananda","theappsec","mygf","geeknik","an0nym0us","and 22 more..."],"severity":{"rating":"medium","author_type":"User"},"structured_scope":null,"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":3599795,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi man.\n\nThx for the report. It works. I'll get back to you later.","markdown_message":"\u003cp\u003eHi man.\u003c/p\u003e\n\n\u003cp\u003eThx for the report. It works. I\u0026#39;ll get back to you later.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-11-07T13:16:41.702Z","updated_at":"2018-11-07T13:16:41.702Z","actor":{"username":"artem_baranov","cleared":false,"url":"/artem_baranov","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/257/241/2e90c2393e57c257791b2e8deb7c0a43607a1315_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"kaspersky","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3599796,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"","markdown_message":"","automated_response":false,"created_at":"2018-11-07T13:16:55.339Z","updated_at":"2018-11-07T13:16:55.339Z","actor":{"username":"artem_baranov","cleared":false,"url":"/artem_baranov","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/257/241/2e90c2393e57c257791b2e8deb7c0a43607a1315_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"kaspersky","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3645013,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"The vulnerability you've reported will be fixed in the near product release. We are considering the possibility a reward payout.\n","markdown_message":"\u003cp\u003eThe vulnerability you\u0026#39;ve reported will be fixed in the near product release. We are considering the possibility a reward payout.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-11-14T20:30:26.408Z","updated_at":"2018-11-14T20:30:26.408Z","actor":{"username":"artem_baranov","cleared":false,"url":"/artem_baranov","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/257/241/2e90c2393e57c257791b2e8deb7c0a43607a1315_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"kaspersky","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3647218,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"Dear palant, \nWe would like to thank you for this report. Your help is appreciated for us.\nYour research and your reports will allow to make our products better.\nWe have decided to award you a bounty for your contribution to kaspersky labs product security.\nThank you.","markdown_message":"\u003cp\u003eDear palant, \u003cbr\u003e\nWe would like to thank you for this report. Your help is appreciated for us.\u003cbr\u003e\nYour research and your reports will allow to make our products better.\u003cbr\u003e\nWe have decided to award you a bounty for your contribution to kaspersky labs product security.\u003cbr\u003e\nThank you.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-11-15T09:39:41.269Z","updated_at":"2018-11-15T09:39:41.269Z","actor":{"url":"/kaspersky","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/002/379/d7dc3ce53a84816885872fb423816bfbbbd36390_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"Kaspersky"}},"bounty_amount":"2000.0","bounty_currency":"usd","bonus_amount":"0.0","genius_execution_id":null,"team_handle":"kaspersky","collaborator":{"username":"palant","url":"/palant"},"actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3750643,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi.\n\nUpdated version of KPM was released. The ticket will be closed.","markdown_message":"\u003cp\u003eHi.\u003c/p\u003e\n\n\u003cp\u003eUpdated version of KPM was released. The ticket will be closed.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-12-03T11:09:22.055Z","updated_at":"2018-12-03T11:09:22.055Z","actor":{"username":"artem_baranov","cleared":false,"url":"/artem_baranov","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/257/241/2e90c2393e57c257791b2e8deb7c0a43607a1315_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"kaspersky","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3750644,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"","markdown_message":"","automated_response":false,"created_at":"2018-12-03T11:09:38.000Z","updated_at":"2018-12-03T11:09:38.000Z","actor":{"username":"artem_baranov","cleared":false,"url":"/artem_baranov","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/257/241/2e90c2393e57c257791b2e8deb7c0a43607a1315_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"reporter":{"username":"palant","url":"/palant"},"genius_execution_id":null,"team_handle":"kaspersky","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3750694,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2018-12-03T11:23:16.421Z","updated_at":"2018-12-03T11:23:16.421Z","first_to_agree":true,"actor":{"username":"palant","cleared":false,"url":"/palant","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/125/397/69a28ca9d5030b1db03411852407732328b571c3_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"kaspersky","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3766593,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Hi man.\n\nWe are considering a possibility to allow you to publish information about this vulnerability, but we need time to prepare a security advisory for our support page. I'll get back to you later and clarify our decision.","markdown_message":"\u003cp\u003eHi man.\u003c/p\u003e\n\n\u003cp\u003eWe are considering a possibility to allow you to publish information about this vulnerability, but we need time to prepare a security advisory for our support page. I\u0026#39;ll get back to you later and clarify our decision.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-12-05T10:46:41.633Z","updated_at":"2018-12-05T10:46:41.633Z","actor":{"username":"artem_baranov","cleared":false,"url":"/artem_baranov","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/257/241/2e90c2393e57c257791b2e8deb7c0a43607a1315_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"kaspersky","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3863204,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"What's the timeline for this?","markdown_message":"\u003cp\u003eWhat\u0026#39;s the timeline for this?\u003c/p\u003e\n","automated_response":false,"created_at":"2018-12-18T18:42:47.905Z","updated_at":"2018-12-18T18:42:47.905Z","actor":{"username":"palant","cleared":false,"url":"/palant","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/125/397/69a28ca9d5030b1db03411852407732328b571c3_original.png/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"kaspersky","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":3865379,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"An advisory is scheduled to be published 24th December. After that, disclosure will be allowed.","markdown_message":"\u003cp\u003eAn advisory is scheduled to be published 24th December. After that, disclosure will be allowed.\u003c/p\u003e\n","automated_response":false,"created_at":"2018-12-19T08:33:56.204Z","updated_at":"2018-12-19T08:33:56.204Z","actor":{"username":"artem_baranov","cleared":false,"url":"/artem_baranov","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/257/241/2e90c2393e57c257791b2e8deb7c0a43607a1315_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"kaspersky","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3885269,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Advisory has been released. \n\nhttps://support.kaspersky.com/vulnerability.aspx?el=12430#241218","markdown_message":"\u003cp\u003eAdvisory has been released. \u003c/p\u003e\n\n\u003cp\u003e\u003ca title=\"https://support.kaspersky.com/vulnerability.aspx?el=12430#241218\" href=\"/redirect?url=https%3A%2F%2Fsupport.kaspersky.com%2Fvulnerability.aspx%3Fel%3D12430%23241218\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e\u003cspan\u003ehttps://support.kaspersky.com/vulnerability.aspx?el=12430#241218\u003c/span\u003e\u003ci class=\"icon-external-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/p\u003e\n","automated_response":false,"created_at":"2018-12-24T05:29:57.821Z","updated_at":"2018-12-24T05:29:57.821Z","actor":{"username":"artem_baranov","cleared":false,"url":"/artem_baranov","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/257/241/2e90c2393e57c257791b2e8deb7c0a43607a1315_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"kaspersky","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3885270,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2018-12-24T05:31:48.145Z","updated_at":"2018-12-24T05:31:48.145Z","actor":{"username":"artem_baranov","cleared":false,"url":"/artem_baranov","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/257/241/2e90c2393e57c257791b2e8deb7c0a43607a1315_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"kaspersky","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":3885271,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2018-12-24T05:31:48.196Z","updated_at":"2018-12-24T05:31:48.196Z","actor":{"username":"artem_baranov","cleared":false,"url":"/artem_baranov","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/257/241/2e90c2393e57c257791b2e8deb7c0a43607a1315_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"kaspersky","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":6438547,"is_internal":false,"editable":false,"type":"Activities::ReportTitleUpdated","message":"","markdown_message":"","automated_response":false,"created_at":"2019-11-30T17:38:46.307Z","updated_at":"2019-11-30T17:38:46.307Z","additional_data":{"old_title":"Kaspersky Password Manager: HTML injection in the browser action pop-up via user name","new_title":"Kaspersky Password Manager is vulnerable to HTML injection in the browser action pop-up via user name"},"actor":{"username":"artem_baranov","cleared":false,"url":"/artem_baranov","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/257/241/2e90c2393e57c257791b2e8deb7c0a43607a1315_original.jpeg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"kaspersky","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}